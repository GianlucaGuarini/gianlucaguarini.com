!function(){var e,t,r,i;!function(){e=function(e){return this.position=e.position,this.vx=e.vx||0,this.vy=e.vy||0,this.vz=e.vz||0,this.rotation={},this.rotation.x=e.rotation&&e.rotation.x?e.rotation.x:0,this.rotation.y=e.rotation&&e.rotation.y?e.rotation.y:0,this.rotation.z=e.rotation&&e.rotation.z?e.rotation.z:0,this.delay=e.delay||0,this.speed=e.speed||0,this},function(){function e(r,i){if(r=r?r:"",i=i||{},r instanceof e)return r;if(!(this instanceof e))return new e(r,i);var n=t(r);this._originalInput=r,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=O(100*this._a)/100,this._format=i.format||n.format,this._gradientType=i.gradientType,this._r<1&&(this._r=O(this._r)),this._g<1&&(this._g=O(this._g)),this._b<1&&(this._b=O(this._b)),this._ok=n.ok,this._tc_id=V++}function t(e){var t={r:0,g:0,b:0},i=1,o=!1,s=!1;return"string"==typeof e&&(e=F(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=r(e.r,e.g,e.b),o=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=P(e.s),e.v=P(e.v),t=a(e.h,e.s,e.v),o=!0,s="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=P(e.s),e.l=P(e.l),t=n(e.h,e.s,e.l),o=!0,s="hsl"),e.hasOwnProperty("a")&&(i=e.a)),i=S(i),{ok:o,format:e.format||s,r:I(255,k(t.r,0)),g:I(255,k(t.g,0)),b:I(255,k(t.b,0)),a:i}}function r(e,t,r){return{r:255*M(e,255),g:255*M(t,255),b:255*M(r,255)}}function i(e,t,r){e=M(e,255),t=M(t,255),r=M(r,255);var i,n,o=k(e,t,r),a=I(e,t,r),s=(o+a)/2;if(o==a)i=n=0;else{var l=o-a;switch(n=s>.5?l/(2-o-a):l/(o+a),o){case e:i=(t-r)/l+(r>t?6:0);break;case t:i=(r-e)/l+2;break;case r:i=(e-t)/l+4}i/=6}return{h:i,s:n,l:s}}function n(e,t,r){function i(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+(t-e)*(2/3-r)*6:e}var n,o,a;if(e=M(e,360),t=M(t,100),r=M(r,100),0===t)n=o=a=r;else{var s=.5>r?r*(1+t):r+t-r*t,l=2*r-s;n=i(l,s,e+1/3),o=i(l,s,e),a=i(l,s,e-1/3)}return{r:255*n,g:255*o,b:255*a}}function o(e,t,r){e=M(e,255),t=M(t,255),r=M(r,255);var i,n,o=k(e,t,r),a=I(e,t,r),s=o,l=o-a;if(n=0===o?0:l/o,o==a)i=0;else{switch(o){case e:i=(t-r)/l+(r>t?6:0);break;case t:i=(r-e)/l+2;break;case r:i=(e-t)/l+4}i/=6}return{h:i,s:n,v:s}}function a(e,t,r){e=6*M(e,360),t=M(t,100),r=M(r,100);var i=B.floor(e),n=e-i,o=r*(1-t),a=r*(1-n*t),s=r*(1-(1-n)*t),l=i%6,h=[r,a,o,o,s,r][l],c=[s,r,r,a,o,o][l],u=[o,o,s,r,r,a][l];return{r:255*h,g:255*c,b:255*u}}function s(e,t,r,i){var n=[L(O(e).toString(16)),L(O(t).toString(16)),L(O(r).toString(16))];return i&&n[0].charAt(0)==n[0].charAt(1)&&n[1].charAt(0)==n[1].charAt(1)&&n[2].charAt(0)==n[2].charAt(1)?n[0].charAt(0)+n[1].charAt(0)+n[2].charAt(0):n.join("")}function l(e,t,r,i){var n=[L(R(i)),L(O(e).toString(16)),L(O(t).toString(16)),L(O(r).toString(16))];return n.join("")}function h(t,r){r=0===r?0:r||10;var i=e(t).toHsl();return i.s-=r/100,i.s=T(i.s),e(i)}function c(t,r){r=0===r?0:r||10;var i=e(t).toHsl();return i.s+=r/100,i.s=T(i.s),e(i)}function u(t){return e(t).desaturate(100)}function f(t,r){r=0===r?0:r||10;var i=e(t).toHsl();return i.l+=r/100,i.l=T(i.l),e(i)}function p(t,r){r=0===r?0:r||10;var i=e(t).toRgb();return i.r=k(0,I(255,i.r-O(255*-(r/100)))),i.g=k(0,I(255,i.g-O(255*-(r/100)))),i.b=k(0,I(255,i.b-O(255*-(r/100)))),e(i)}function d(t,r){r=0===r?0:r||10;var i=e(t).toHsl();return i.l-=r/100,i.l=T(i.l),e(i)}function m(t,r){var i=e(t).toHsl(),n=(O(i.h)+r)%360;return i.h=0>n?360+n:n,e(i)}function g(t){var r=e(t).toHsl();return r.h=(r.h+180)%360,e(r)}function v(t){var r=e(t).toHsl(),i=r.h;return[e(t),e({h:(i+120)%360,s:r.s,l:r.l}),e({h:(i+240)%360,s:r.s,l:r.l})]}function y(t){var r=e(t).toHsl(),i=r.h;return[e(t),e({h:(i+90)%360,s:r.s,l:r.l}),e({h:(i+180)%360,s:r.s,l:r.l}),e({h:(i+270)%360,s:r.s,l:r.l})]}function x(t){var r=e(t).toHsl(),i=r.h;return[e(t),e({h:(i+72)%360,s:r.s,l:r.l}),e({h:(i+216)%360,s:r.s,l:r.l})]}function w(t,r,i){r=r||6,i=i||30;var n=e(t).toHsl(),o=360/i,a=[e(t)];for(n.h=(n.h-(o*r>>1)+720)%360;--r;)n.h=(n.h+o)%360,a.push(e(n));return a}function b(t,r){r=r||6;for(var i=e(t).toHsv(),n=i.h,o=i.s,a=i.v,s=[],l=1/r;r--;)s.push(e({h:n,s:o,v:a})),a=(a+l)%1;return s}function _(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t}function S(e){return e=parseFloat(e),(isNaN(e)||0>e||e>1)&&(e=1),e}function M(e,t){A(e)&&(e="100%");var r=E(e);return e=I(t,k(0,parseFloat(e))),r&&(e=parseInt(e*t,10)/100),B.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function T(e){return I(1,k(0,e))}function C(e){return parseInt(e,16)}function A(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)}function E(e){return"string"==typeof e&&-1!=e.indexOf("%")}function L(e){return 1==e.length?"0"+e:""+e}function P(e){return 1>=e&&(e=100*e+"%"),e}function R(e){return Math.round(255*parseFloat(e)).toString(16)}function D(e){return C(e)/255}function F(e){e=e.replace(U,"").replace(z,"").toLowerCase();var t=!1;if(G[e])e=G[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var r;return(r=W.rgb.exec(e))?{r:r[1],g:r[2],b:r[3]}:(r=W.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=W.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=W.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=W.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=W.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=W.hex8.exec(e))?{a:D(r[1]),r:C(r[2]),g:C(r[3]),b:C(r[4]),format:t?"name":"hex8"}:(r=W.hex6.exec(e))?{r:C(r[1]),g:C(r[2]),b:C(r[3]),format:t?"name":"hex"}:(r=W.hex3.exec(e))?{r:C(r[1]+""+r[1]),g:C(r[2]+""+r[2]),b:C(r[3]+""+r[3]),format:t?"name":"hex"}:!1}function N(e){var t,r;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),r=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA"),"small"!==r&&"large"!==r&&(r="small"),{level:t,size:r}}var U=/^[\s,#]+/,z=/\s+$/,V=0,B=Math,O=B.round,I=B.min,k=B.max,H=B.random;e.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var e,t,r,i,n,o,a=this.toRgb();return e=a.r/255,t=a.g/255,r=a.b/255,i=.03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4),n=.03928>=t?t/12.92:Math.pow((t+.055)/1.055,2.4),o=.03928>=r?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*i+.7152*n+.0722*o},setAlpha:function(e){return this._a=S(e),this._roundA=O(100*this._a)/100,this},toHsv:function(){var e=o(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=o(this._r,this._g,this._b),t=O(360*e.h),r=O(100*e.s),i=O(100*e.v);return 1==this._a?"hsv("+t+", "+r+"%, "+i+"%)":"hsva("+t+", "+r+"%, "+i+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=O(360*e.h),r=O(100*e.s),n=O(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+n+"%)":"hsla("+t+", "+r+"%, "+n+"%, "+this._roundA+")"},toHex:function(e){return s(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return l(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:O(this._r),g:O(this._g),b:O(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+O(this._r)+", "+O(this._g)+", "+O(this._b)+")":"rgba("+O(this._r)+", "+O(this._g)+", "+O(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:O(100*M(this._r,255))+"%",g:O(100*M(this._g,255))+"%",b:O(100*M(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+O(100*M(this._r,255))+"%, "+O(100*M(this._g,255))+"%, "+O(100*M(this._b,255))+"%)":"rgba("+O(100*M(this._r,255))+"%, "+O(100*M(this._g,255))+"%, "+O(100*M(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":this._a<1?!1:j[s(this._r,this._g,this._b,!0)]||!1},toFilter:function(t){var r="#"+l(this._r,this._g,this._b,this._a),i=r,n=this._gradientType?"GradientType = 1, ":"";if(t){var o=e(t);i=o.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+n+"startColorstr="+r+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var r=!1,i=this._a<1&&this._a>=0,n=!t&&i&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return n?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),("hex"===e||"hex6"===e)&&(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString())},_applyModification:function(e,t){var r=e.apply(null,[this].concat([].slice.call(t)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(f,arguments)},brighten:function(){return this._applyModification(p,arguments)},darken:function(){return this._applyModification(d,arguments)},desaturate:function(){return this._applyModification(h,arguments)},saturate:function(){return this._applyModification(c,arguments)},greyscale:function(){return this._applyModification(u,arguments)},spin:function(){return this._applyModification(m,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(w,arguments)},complement:function(){return this._applyCombination(g,arguments)},monochromatic:function(){return this._applyCombination(b,arguments)},splitcomplement:function(){return this._applyCombination(x,arguments)},triad:function(){return this._applyCombination(v,arguments)},tetrad:function(){return this._applyCombination(y,arguments)}},e.fromRatio=function(t,r){if("object"==typeof t){var i={};for(var n in t)t.hasOwnProperty(n)&&("a"===n?i[n]=t[n]:i[n]=P(t[n]));t=i}return e(t,r)},e.equals=function(t,r){return t&&r?e(t).toRgbString()==e(r).toRgbString():!1},e.random=function(){return e.fromRatio({r:H(),g:H(),b:H()})},e.mix=function(t,r,i){i=0===i?0:i||50;var n,o=e(t).toRgb(),a=e(r).toRgb(),s=i/100,l=2*s-1,h=a.a-o.a;n=l*h==-1?l:(l+h)/(1+l*h),n=(n+1)/2;var c=1-n,u={r:a.r*n+o.r*c,g:a.g*n+o.g*c,b:a.b*n+o.b*c,a:a.a*s+o.a*(1-s)};return e(u)},e.readability=function(t,r){var i=e(t),n=e(r);return(Math.max(i.getLuminance(),n.getLuminance())+.05)/(Math.min(i.getLuminance(),n.getLuminance())+.05)},e.isReadable=function(t,r,i){var n,o,a=e.readability(t,r);switch(o=!1,n=N(i),n.level+n.size){case"AAsmall":case"AAAlarge":o=a>=4.5;break;case"AAlarge":o=a>=3;break;case"AAAsmall":o=a>=7}return o},e.mostReadable=function(t,r,i){var n,o,a,s,l=null,h=0;i=i||{},o=i.includeFallbackColors,a=i.level,s=i.size;for(var c=0;c<r.length;c++)n=e.readability(t,r[c]),n>h&&(h=n,l=e(r[c]));return e.isReadable(t,l,{level:a,size:s})||!o?l:(i.includeFallbackColors=!1,e.mostReadable(t,["#fff","#000"],i))};var G=e.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},j=e.hexNames=_(G),W=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",r="(?:"+t+")|(?:"+e+")",i="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?",n="[\\s|\\(]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")[,|\\s]+("+r+")\\s*\\)?";return{rgb:new RegExp("rgb"+i),rgba:new RegExp("rgba"+n),hsl:new RegExp("hsl"+i),hsla:new RegExp("hsla"+n),hsv:new RegExp("hsv"+i),hsva:new RegExp("hsva"+n),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define&&define.amd?define("tinycolor",[],function(){return e}):window.tinycolor=e}();var n=n||function(){var e=[];return{getAll:function(){return e},removeAll:function(){e=[]},add:function(t){e.push(t)},remove:function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},update:function(t,r){if(0===e.length)return!1;var i=0;for(t=void 0!==t?t:n.now();i<e.length;)e[i].update(t)||r?i++:e.splice(i,1);return!0}}}();!function(){void 0===this.window&&void 0!==this.process?n.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e3}:void 0!==this.window&&void 0!==window.performance&&void 0!==window.performance.now?n.now=window.performance.now.bind(window.performance):void 0!==Date.now?n.now=Date.now:n.now=function(){return(new Date).getTime()}}(),n.Tween=function(e){var t=e,r={},i={},o={},a=1e3,s=0,l=!1,h=!1,c=!1,u=0,f=null,p=n.Easing.Linear.None,d=n.Interpolation.Linear,m=[],g=null,v=!1,y=null,x=null,w=null;for(var b in e)r[b]=parseFloat(e[b],10);this.to=function(e,t){return void 0!==t&&(a=t),i=e,this},this.start=function(e){n.add(this),h=!0,v=!1,f=void 0!==e?e:n.now(),f+=u;for(var a in i){if(i[a]instanceof Array){if(0===i[a].length)continue;i[a]=[t[a]].concat(i[a])}void 0!==r[a]&&(r[a]=t[a],r[a]instanceof Array==!1&&(r[a]*=1),o[a]=r[a]||0)}return this},this.stop=function(){return h?(n.remove(this),h=!1,null!==w&&w.call(t),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var e=0,t=m.length;t>e;e++)m[e].stop()},this.delay=function(e){return u=e,this},this.repeat=function(e){return s=e,this},this.yoyo=function(e){return l=e,this},this.easing=function(e){return p=e,this},this.interpolation=function(e){return d=e,this},this.chain=function(){return m=arguments,this},this.onStart=function(e){return g=e,this},this.onUpdate=function(e){return y=e,this},this.onComplete=function(e){return x=e,this},this.onStop=function(e){return w=e,this},this.update=function(e){var n,h,w;if(f>e)return!0;v===!1&&(null!==g&&g.call(t),v=!0),h=(e-f)/a,h=h>1?1:h,w=p(h);for(n in i)if(void 0!==r[n]){var b=r[n]||0,_=i[n];_ instanceof Array?t[n]=d(_,w):("string"==typeof _&&(_="+"===_.charAt(0)||"-"===_.charAt(0)?b+parseFloat(_,10):parseFloat(_,10)),"number"==typeof _&&(t[n]=b+(_-b)*w))}if(null!==y&&y.call(t,w),1===h){if(s>0){isFinite(s)&&s--;for(n in o){if("string"==typeof i[n]&&(o[n]=o[n]+parseFloat(i[n],10)),l){var S=o[n];o[n]=i[n],i[n]=S}r[n]=o[n]}return l&&(c=!c),f=e+u,!0}null!==x&&x.call(t);for(var M=0,T=m.length;T>M;M++)m[M].start(f+a);return!1}return!0}},n.Easing={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2,1>e?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1)}},Back:{In:function(e){var t=1.70158;return e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-n.Easing.Bounce.Out(1-e)},Out:function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return.5>e?.5*n.Easing.Bounce.In(2*e):.5*n.Easing.Bounce.Out(2*e-1)+.5}}},n.Interpolation={Linear:function(e,t){var r=e.length-1,i=r*t,o=Math.floor(i),a=n.Interpolation.Utils.Linear;return 0>t?a(e[0],e[1],i):t>1?a(e[r],e[r-1],r-i):a(e[o],e[o+1>r?r:o+1],i-o)},Bezier:function(e,t){for(var r=0,i=e.length-1,o=Math.pow,a=n.Interpolation.Utils.Bernstein,s=0;i>=s;s++)r+=o(1-t,i-s)*o(t,s)*e[s]*a(i,s);return r},CatmullRom:function(e,t){var r=e.length-1,i=r*t,o=Math.floor(i),a=n.Interpolation.Utils.CatmullRom;return e[0]===e[r]?(0>t&&(o=Math.floor(i=r*(1+t))),a(e[(o-1+r)%r],e[o],e[(o+1)%r],e[(o+2)%r],i-o)):0>t?e[0]-(a(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[r]-(a(e[r],e[r],e[r-1],e[r-1],i-r)-e[r]):a(e[o?o-1:0],e[o],e[o+1>r?r:o+1],e[o+2>r?r:o+2],i-o)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=n.Interpolation.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:function(){var e=[1];return function(t){var r=1;if(e[t])return e[t];for(var i=t;i>1;i--)r*=i;return e[t]=r,r}}(),CatmullRom:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,l=n*s;return(2*t-2*r+o+a)*l+(-3*t+3*r-2*o-a)*s+o*n+t}}},function(e){"function"==typeof define&&define.amd?define("tweenjs",[],function(){return n}):"undefined"!=typeof module&&"object"==typeof exports?module.exports=n:void 0!==e&&(e.TWEEN=n)}(this),t=function(e,t){return function(r){var i=25,a=2*Math.PI,s=1300;this.$el=r.$el,this.width=r.width,this.height=r.height,this.renderer=new o.CanvasRenderer,this.camera=new o.PerspectiveCamera(45,this.width/this.height,1,1e4),this.scene=new o.Scene,this.Particles=[],this.lines=new o.Geometry,this.color=Number("0x"+window.global.colorHex),this.colorLighten=Number("0x"+t(window.global.colorHex,30).lighten().toHex()),this.camera.position.z=s;var l=function(){return{position:{x:1800*Math.random()-900,y:1800*Math.random()-900,z:1800*Math.random()-900},delay:8e3*Math.random()+2e3,speed:1e4*Math.random()+2e3,rotation:{x:Math.random(),y:Math.random(),z:Math.random()}}},h=function(e){var t=l();new n.Tween(e.vector.position).to({x:t.position.x,y:t.position.y,z:t.position.z},e.vector.speed).onUpdate(function(){e.mesh.rotation.x+=.1,e.mesh.rotation.y+=.1,e.mesh.rotation.z+=.1}).easing(n.Easing.Quadratic.InOut).delay(e.vector.delay).onComplete($.proxy(h,this,e)).start()};return this.setSize=function(e,t){this.camera.aspect=e/t,this.renderer.setSize(e,t),this.camera.updateProjectionMatrix()},this.createParticles=function(){for(var t=new o.MeshBasicMaterial({color:this.color,wireframeLinecap:"round",wireframe:!0}),r=new o.ParticleCanvasMaterial({color:this.colorLighten,program:function(e){e.beginPath(),e.arc(0,0,5,0,a,!0),e.closePath(),e.fill()}}),n=i;n--;){var s=l(),c=new o.Mesh(new o.CubeGeometry(20,20,20),t),u={vector:new e(s),particle:new o.Particle(r),mesh:c};this.Particles.push(u),u.mesh.position=u.vector.position,u.mesh.rotation=u.vector.rotation,u.particle.position=u.vector.position,this.lines.vertices.push(u.mesh.position),this.scene.add(u.mesh),this.scene.add(u.particle),h(u)}this.line=new o.Line(this.lines,new o.LineBasicMaterial({color:14540253,opacity:1,linewidth:1})),this.scene.add(this.line)},this.update=function(){n.update(),this.renderer.render(this.scene,this.camera)},this.$el.html(this.renderer.domElement),this}}(e,tinycolor),r=function(e){this.$el=e||$(window),this.x=0,this.y=0,this.offsetCentered=!1;var t={},r=function(e){return e.originalEvent.targetTouches?e.originalEvent.targetTouches[0]:e},i=function(e){e.preventDefault();var i=r(e),n=i.pageX-t.offset.left,o=i.pageY-t.offset.top;this.offsetCentered&&(n-=t.width/2,o-=t.height/2),this.x=n,this.y=o};return this.init=function(){this.setViewport(),this.bindEvents()},this.bindEvents=function(){this.$el.on("mousernter.Mouse mousemove.Mouse touchstart.Mouse touchenter.Mouse touchmove.Mouse",$.proxy(i,this))},this.setViewport=function(){var e=this.$el.offset();t={width:this.$el.width(),height:this.$el.height(),offset:{top:e?e.top:0,left:e?e.left:0}}},this.destroy=function(){this.$el.off(".Mouse")},this.init(),this},function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function r(e){var t="length"in e&&e.length,r=J.type(e);return"function"===r||J.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}function i(e,t,r){if(J.isFunction(t))return J.grep(e,function(e,i){return!!t.call(e,i,e)!==r});if(t.nodeType)return J.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(se.test(t))return J.filter(t,e,r);t=J.filter(t,e)}return J.grep(e,function(e){return X.call(t,e)>=0!==r})}function n(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t=de[e]={};return J.each(e.match(pe)||[],function(e,r){t[r]=!0}),t}function a(){Q.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1),J.ready()}function s(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=J.expando+s.uid++}function l(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(we,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:xe.test(r)?J.parseJSON(r):r}catch(n){}ye.set(e,t,r)}else r=void 0;return r}function h(){return!0}function c(){return!1}function u(){try{return Q.activeElement}catch(e){}}function f(e,t){return J.nodeName(e,"table")&&J.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function p(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function d(e){var t=ze.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function m(e,t){for(var r=0,i=e.length;i>r;r++)ve.set(e[r],"globalEval",!t||ve.get(t[r],"globalEval"))}function g(e,t){var r,i,n,o,a,s,l,h;if(1===t.nodeType){if(ve.hasData(e)&&(o=ve.access(e),a=ve.set(t,o),h=o.events)){delete a.handle,a.events={};for(n in h)for(r=0,i=h[n].length;i>r;r++)J.event.add(t,n,h[n][r])}ye.hasData(e)&&(s=ye.access(e),l=J.extend({},s),ye.set(t,l))}}function v(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&J.nodeName(e,t)?J.merge([e],r):r}function y(e,t){var r=t.nodeName.toLowerCase();"input"===r&&Me.test(e.type)?t.checked=e.checked:("input"===r||"textarea"===r)&&(t.defaultValue=e.defaultValue)}function x(t,r){var i,n=J(r.createElement(t)).appendTo(r.body),o=e.getDefaultComputedStyle&&(i=e.getDefaultComputedStyle(n[0]))?i.display:J.css(n[0],"display");return n.detach(),o}function w(e){var t=Q,r=Ie[e];return r||(r=x(e,t),"none"!==r&&r||(Oe=(Oe||J("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Oe[0].contentDocument,t.write(),t.close(),r=x(e,t),Oe.detach()),Ie[e]=r),r}function b(e,t,r){var i,n,o,a,s=e.style;return r=r||Ge(e),r&&(a=r.getPropertyValue(t)||r[t]),r&&(""!==a||J.contains(e.ownerDocument,e)||(a=J.style(e,t)),He.test(a)&&ke.test(t)&&(i=s.width,n=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=r.width,s.width=i,s.minWidth=n,s.maxWidth=o)),void 0!==a?a+"":a}function _(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function S(e,t){if(t in e)return t;for(var r=t[0].toUpperCase()+t.slice(1),i=t,n=Ke.length;n--;)if(t=Ke[n]+r,t in e)return t;return i}function M(e,t,r){var i=We.exec(t);return i?Math.max(0,i[1]-(r||0))+(i[2]||"px"):t}function T(e,t,r,i,n){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,a=0;4>o;o+=2)"margin"===r&&(a+=J.css(e,r+_e[o],!0,n)),i?("content"===r&&(a-=J.css(e,"padding"+_e[o],!0,n)),"margin"!==r&&(a-=J.css(e,"border"+_e[o]+"Width",!0,n))):(a+=J.css(e,"padding"+_e[o],!0,n),"padding"!==r&&(a+=J.css(e,"border"+_e[o]+"Width",!0,n)));return a}function C(e,t,r){var i=!0,n="width"===t?e.offsetWidth:e.offsetHeight,o=Ge(e),a="border-box"===J.css(e,"boxSizing",!1,o);if(0>=n||null==n){if(n=b(e,t,o),(0>n||null==n)&&(n=e.style[t]),He.test(n))return n;i=a&&($.boxSizingReliable()||n===e.style[t]),n=parseFloat(n)||0}return n+T(e,t,r||(a?"border":"content"),i,o)+"px"}function A(e,t){for(var r,i,n,o=[],a=0,s=e.length;s>a;a++)i=e[a],i.style&&(o[a]=ve.get(i,"olddisplay"),r=i.style.display,t?(o[a]||"none"!==r||(i.style.display=""),""===i.style.display&&Se(i)&&(o[a]=ve.access(i,"olddisplay",w(i.nodeName)))):(n=Se(i),"none"===r&&n||ve.set(i,"olddisplay",n?r:J.css(i,"display"))));for(a=0;s>a;a++)i=e[a],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[a]||"":"none"));return e}function E(e,t,r,i,n){return new E.prototype.init(e,t,r,i,n)}function L(){return setTimeout(function(){$e=void 0}),$e=J.now()}function P(e,t){var r,i=0,n={height:e};for(t=t?1:0;4>i;i+=2-t)r=_e[i],n["margin"+r]=n["padding"+r]=e;return t&&(n.opacity=n.width=e),n}function R(e,t,r){for(var i,n=(rt[t]||[]).concat(rt["*"]),o=0,a=n.length;a>o;o++)if(i=n[o].call(r,t,e))return i}function D(e,t,r){var i,n,o,a,s,l,h,c,u=this,f={},p=e.style,d=e.nodeType&&Se(e),m=ve.get(e,"fxshow");r.queue||(s=J._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,J.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[p.overflow,p.overflowX,p.overflowY],h=J.css(e,"display"),c="none"===h?ve.get(e,"olddisplay")||w(e.nodeName):h,"inline"===c&&"none"===J.css(e,"float")&&(p.display="inline-block")),r.overflow&&(p.overflow="hidden",u.always(function(){p.overflow=r.overflow[0],p.overflowX=r.overflow[1],p.overflowY=r.overflow[2]}));for(i in t)if(n=t[i],Ze.exec(n)){if(delete t[i],o=o||"toggle"===n,n===(d?"hide":"show")){if("show"!==n||!m||void 0===m[i])continue;d=!0}f[i]=m&&m[i]||J.style(e,i)}else h=void 0;if(J.isEmptyObject(f))"inline"===("none"===h?w(e.nodeName):h)&&(p.display=h);else{m?"hidden"in m&&(d=m.hidden):m=ve.access(e,"fxshow",{}),o&&(m.hidden=!d),d?J(e).show():u.done(function(){J(e).hide()}),u.done(function(){var t;ve.remove(e,"fxshow");for(t in f)J.style(e,t,f[t])});for(i in f)a=R(d?m[i]:0,i,u),i in m||(m[i]=a.start,d&&(a.end=a.start,a.start="width"===i||"height"===i?1:0))}}function F(e,t){var r,i,n,o,a;for(r in e)if(i=J.camelCase(r),n=t[i],o=e[r],J.isArray(o)&&(n=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),a=J.cssHooks[i],a&&"expand"in a){o=a.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=n)}else t[i]=n}function N(e,t,r){var i,n,o=0,a=tt.length,s=J.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=$e||L(),r=Math.max(0,h.startTime+h.duration-t),i=r/h.duration||0,o=1-i,a=0,l=h.tweens.length;l>a;a++)h.tweens[a].run(o);return s.notifyWith(e,[h,o,r]),1>o&&l?r:(s.resolveWith(e,[h]),!1)},h=s.promise({elem:e,props:J.extend({},t),opts:J.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:$e||L(),duration:r.duration,tweens:[],createTween:function(t,r){var i=J.Tween(e,h.opts,t,r,h.opts.specialEasing[t]||h.opts.easing);return h.tweens.push(i),i},stop:function(t){var r=0,i=t?h.tweens.length:0;if(n)return this;for(n=!0;i>r;r++)h.tweens[r].run(1);return t?s.resolveWith(e,[h,t]):s.rejectWith(e,[h,t]),this}}),c=h.props;for(F(c,h.opts.specialEasing);a>o;o++)if(i=tt[o].call(h,e,c,h.opts))return i;return J.map(c,R,h),J.isFunction(h.opts.start)&&h.opts.start.call(e,h),J.fx.timer(J.extend(l,{elem:e,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function U(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,n=0,o=t.toLowerCase().match(pe)||[];if(J.isFunction(r))for(;i=o[n++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function z(e,t,r,i){function n(s){var l;return o[s]=!0,J.each(e[s]||[],function(e,s){var h=s(t,r,i);return"string"!=typeof h||a||o[h]?a?!(l=h):void 0:(t.dataTypes.unshift(h),n(h),!1)}),l}var o={},a=e===xt;return n(t.dataTypes[0])||!o["*"]&&n("*")}function V(e,t){var r,i,n=J.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((n[r]?e:i||(i={}))[r]=t[r]);return i&&J.extend(!0,e,i),e}function B(e,t,r){for(var i,n,o,a,s=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(n in s)if(s[n]&&s[n].test(i)){l.unshift(n);break}if(l[0]in r)o=l[0];else{for(n in r){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}a||(a=n)}o=o||a}return o?(o!==l[0]&&l.unshift(o),r[o]):void 0}function O(e,t,r,i){var n,o,a,s,l,h={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)h[a.toLowerCase()]=e.converters[a];for(o=c.shift();o;)if(e.responseFields[o]&&(r[e.responseFields[o]]=t),!l&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(a=h[l+" "+o]||h["* "+o],!a)for(n in h)if(s=n.split(" "),s[1]===o&&(a=h[l+" "+s[0]]||h["* "+s[0]])){a===!0?a=h[n]:h[n]!==!0&&(o=s[0],c.unshift(s[1]));
break}if(a!==!0)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(u){return{state:"parsererror",error:a?u:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function I(e,t,r,i){var n;if(J.isArray(t))J.each(t,function(t,n){r||Mt.test(e)?i(e,n):I(e+"["+("object"==typeof n?t:"")+"]",n,r,i)});else if(r||"object"!==J.type(t))i(e,t);else for(n in t)I(e+"["+n+"]",t[n],r,i)}function k(e){return J.isWindow(e)?e:9===e.nodeType&&e.defaultView}var H=[],G=H.slice,j=H.concat,W=H.push,X=H.indexOf,q={},Y=q.toString,K=q.hasOwnProperty,$={},Q=e.document,Z="2.1.4",J=function(e,t){return new J.fn.init(e,t)},ee=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,te=/^-ms-/,re=/-([\da-z])/gi,ie=function(e,t){return t.toUpperCase()};J.fn=J.prototype={jquery:Z,constructor:J,selector:"",length:0,toArray:function(){return G.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:G.call(this)},pushStack:function(e){var t=J.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return J.each(this,e,t)},map:function(e){return this.pushStack(J.map(this,function(t,r){return e.call(t,r,t)}))},slice:function(){return this.pushStack(G.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,r=+e+(0>e?t:0);return this.pushStack(r>=0&&t>r?[this[r]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:W,sort:H.sort,splice:H.splice},J.extend=J.fn.extend=function(){var e,t,r,i,n,o,a=arguments[0]||{},s=1,l=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[s]||{},s++),"object"==typeof a||J.isFunction(a)||(a={}),s===l&&(a=this,s--);l>s;s++)if(null!=(e=arguments[s]))for(t in e)r=a[t],i=e[t],a!==i&&(h&&i&&(J.isPlainObject(i)||(n=J.isArray(i)))?(n?(n=!1,o=r&&J.isArray(r)?r:[]):o=r&&J.isPlainObject(r)?r:{},a[t]=J.extend(h,o,i)):void 0!==i&&(a[t]=i));return a},J.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===J.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!J.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==J.type(e)||e.nodeType||J.isWindow(e)?!1:e.constructor&&!K.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?q[Y.call(e)]||"object":typeof e},globalEval:function(e){var t,r=eval;e=J.trim(e),e&&(1===e.indexOf("use strict")?(t=Q.createElement("script"),t.text=e,Q.head.appendChild(t).parentNode.removeChild(t)):r(e))},camelCase:function(e){return e.replace(te,"ms-").replace(re,ie)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var n,o=0,a=e.length,s=r(e);if(i){if(s)for(;a>o&&(n=t.apply(e[o],i),n!==!1);o++);else for(o in e)if(n=t.apply(e[o],i),n===!1)break}else if(s)for(;a>o&&(n=t.call(e[o],o,e[o]),n!==!1);o++);else for(o in e)if(n=t.call(e[o],o,e[o]),n===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(ee,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(r(Object(e))?J.merge(i,"string"==typeof e?[e]:e):W.call(i,e)),i},inArray:function(e,t,r){return null==t?-1:X.call(t,e,r)},merge:function(e,t){for(var r=+t.length,i=0,n=e.length;r>i;i++)e[n++]=t[i];return e.length=n,e},grep:function(e,t,r){for(var i,n=[],o=0,a=e.length,s=!r;a>o;o++)i=!t(e[o],o),i!==s&&n.push(e[o]);return n},map:function(e,t,i){var n,o=0,a=e.length,s=r(e),l=[];if(s)for(;a>o;o++)n=t(e[o],o,i),null!=n&&l.push(n);else for(o in e)n=t(e[o],o,i),null!=n&&l.push(n);return j.apply([],l)},guid:1,proxy:function(e,t){var r,i,n;return"string"==typeof t&&(r=e[t],t=e,e=r),J.isFunction(e)?(i=G.call(arguments,2),n=function(){return e.apply(t||this,i.concat(G.call(arguments)))},n.guid=e.guid=e.guid||J.guid++,n):void 0},now:Date.now,support:$}),J.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){q["[object "+t+"]"]=t.toLowerCase()});var ne=function(e){function t(e,t,r,i){var n,o,a,s,l,h,u,p,d,m;if((t?t.ownerDocument||t:I)!==D&&R(t),t=t||D,r=r||[],s=t.nodeType,"string"!=typeof e||!e||1!==s&&9!==s&&11!==s)return r;if(!i&&N){if(11!==s&&(n=ye.exec(e)))if(a=n[1]){if(9===s){if(o=t.getElementById(a),!o||!o.parentNode)return r;if(o.id===a)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(a))&&B(t,o)&&o.id===a)return r.push(o),r}else{if(n[2])return Z.apply(r,t.getElementsByTagName(e)),r;if((a=n[3])&&b.getElementsByClassName)return Z.apply(r,t.getElementsByClassName(a)),r}if(b.qsa&&(!U||!U.test(e))){if(p=u=O,d=t,m=1!==s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(h=T(e),(u=t.getAttribute("id"))?p=u.replace(we,"\\$&"):t.setAttribute("id",p),p="[id='"+p+"'] ",l=h.length;l--;)h[l]=p+f(h[l]);d=xe.test(e)&&c(t.parentNode)||t,m=h.join(",")}if(m)try{return Z.apply(r,d.querySelectorAll(m)),r}catch(g){}finally{u||t.removeAttribute("id")}}}return A(e.replace(le,"$1"),t,r,i)}function r(){function e(r,i){return t.push(r+" ")>_.cacheLength&&delete e[t.shift()],e[r+" "]=i}var t=[];return e}function i(e){return e[O]=!0,e}function n(e){var t=D.createElement("div");try{return!!e(t)}catch(r){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var r=e.split("|"),i=e.length;i--;)_.attrHandle[r[i]]=t}function a(e,t){var r=t&&e,i=r&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||q)-(~e.sourceIndex||q);if(i)return i;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function s(e){return function(t){var r=t.nodeName.toLowerCase();return"input"===r&&t.type===e}}function l(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function h(e){return i(function(t){return t=+t,i(function(r,i){for(var n,o=e([],r.length,t),a=o.length;a--;)r[n=o[a]]&&(r[n]=!(i[n]=r[n]))})})}function c(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function u(){}function f(e){for(var t=0,r=e.length,i="";r>t;t++)i+=e[t].value;return i}function p(e,t,r){var i=t.dir,n=r&&"parentNode"===i,o=H++;return t.first?function(t,r,o){for(;t=t[i];)if(1===t.nodeType||n)return e(t,r,o)}:function(t,r,a){var s,l,h=[k,o];if(a){for(;t=t[i];)if((1===t.nodeType||n)&&e(t,r,a))return!0}else for(;t=t[i];)if(1===t.nodeType||n){if(l=t[O]||(t[O]={}),(s=l[i])&&s[0]===k&&s[1]===o)return h[2]=s[2];if(l[i]=h,h[2]=e(t,r,a))return!0}}}function d(e){return e.length>1?function(t,r,i){for(var n=e.length;n--;)if(!e[n](t,r,i))return!1;return!0}:e[0]}function m(e,r,i){for(var n=0,o=r.length;o>n;n++)t(e,r[n],i);return i}function g(e,t,r,i,n){for(var o,a=[],s=0,l=e.length,h=null!=t;l>s;s++)(o=e[s])&&(!r||r(o,i,n))&&(a.push(o),h&&t.push(s));return a}function v(e,t,r,n,o,a){return n&&!n[O]&&(n=v(n)),o&&!o[O]&&(o=v(o,a)),i(function(i,a,s,l){var h,c,u,f=[],p=[],d=a.length,v=i||m(t||"*",s.nodeType?[s]:s,[]),y=!e||!i&&t?v:g(v,f,e,s,l),x=r?o||(i?e:d||n)?[]:a:y;if(r&&r(y,x,s,l),n)for(h=g(x,p),n(h,[],s,l),c=h.length;c--;)(u=h[c])&&(x[p[c]]=!(y[p[c]]=u));if(i){if(o||e){if(o){for(h=[],c=x.length;c--;)(u=x[c])&&h.push(y[c]=u);o(null,x=[],h,l)}for(c=x.length;c--;)(u=x[c])&&(h=o?ee(i,u):f[c])>-1&&(i[h]=!(a[h]=u))}}else x=g(x===a?x.splice(d,x.length):x),o?o(null,a,x,l):Z.apply(a,x)})}function y(e){for(var t,r,i,n=e.length,o=_.relative[e[0].type],a=o||_.relative[" "],s=o?1:0,l=p(function(e){return e===t},a,!0),h=p(function(e){return ee(t,e)>-1},a,!0),c=[function(e,r,i){var n=!o&&(i||r!==E)||((t=r).nodeType?l(e,r,i):h(e,r,i));return t=null,n}];n>s;s++)if(r=_.relative[e[s].type])c=[p(d(c),r)];else{if(r=_.filter[e[s].type].apply(null,e[s].matches),r[O]){for(i=++s;n>i&&!_.relative[e[i].type];i++);return v(s>1&&d(c),s>1&&f(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(le,"$1"),r,i>s&&y(e.slice(s,i)),n>i&&y(e=e.slice(i)),n>i&&f(e))}c.push(r)}return d(c)}function x(e,r){var n=r.length>0,o=e.length>0,a=function(i,a,s,l,h){var c,u,f,p=0,d="0",m=i&&[],v=[],y=E,x=i||o&&_.find.TAG("*",h),w=k+=null==y?1:Math.random()||.1,b=x.length;for(h&&(E=a!==D&&a);d!==b&&null!=(c=x[d]);d++){if(o&&c){for(u=0;f=e[u++];)if(f(c,a,s)){l.push(c);break}h&&(k=w)}n&&((c=!f&&c)&&p--,i&&m.push(c))}if(p+=d,n&&d!==p){for(u=0;f=r[u++];)f(m,v,a,s);if(i){if(p>0)for(;d--;)m[d]||v[d]||(v[d]=$.call(l));v=g(v)}Z.apply(l,v),h&&!i&&v.length>0&&p+r.length>1&&t.uniqueSort(l)}return h&&(k=w,E=y),m};return n?i(a):a}var w,b,_,S,M,T,C,A,E,L,P,R,D,F,N,U,z,V,B,O="sizzle"+1*new Date,I=e.document,k=0,H=0,G=r(),j=r(),W=r(),X=function(e,t){return e===t&&(P=!0),0},q=1<<31,Y={}.hasOwnProperty,K=[],$=K.pop,Q=K.push,Z=K.push,J=K.slice,ee=function(e,t){for(var r=0,i=e.length;i>r;r++)if(e[r]===t)return r;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",re="[\\x20\\t\\r\\n\\f]",ie="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ne=ie.replace("w","w#"),oe="\\["+re+"*("+ie+")(?:"+re+"*([*^$|!~]?=)"+re+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ne+"))|)"+re+"*\\]",ae=":("+ie+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+oe+")*)|.*)\\)|)",se=new RegExp(re+"+","g"),le=new RegExp("^"+re+"+|((?:^|[^\\\\])(?:\\\\.)*)"+re+"+$","g"),he=new RegExp("^"+re+"*,"+re+"*"),ce=new RegExp("^"+re+"*([>+~]|"+re+")"+re+"*"),ue=new RegExp("="+re+"*([^\\]'\"]*?)"+re+"*\\]","g"),fe=new RegExp(ae),pe=new RegExp("^"+ne+"$"),de={ID:new RegExp("^#("+ie+")"),CLASS:new RegExp("^\\.("+ie+")"),TAG:new RegExp("^("+ie.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+ae),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+re+"*(even|odd|(([+-]|)(\\d*)n|)"+re+"*(?:([+-]|)"+re+"*(\\d+)|))"+re+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+re+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+re+"*((?:-\\d)?\\d*)"+re+"*\\)|)(?=[^-]|$)","i")},me=/^(?:input|select|textarea|button)$/i,ge=/^h\d$/i,ve=/^[^{]+\{\s*\[native \w/,ye=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,xe=/[+~]/,we=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+re+"?|("+re+")|.)","ig"),_e=function(e,t,r){var i="0x"+t-65536;return i!==i||r?t:0>i?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},Se=function(){R()};try{Z.apply(K=J.call(I.childNodes),I.childNodes),K[I.childNodes.length].nodeType}catch(Me){Z={apply:K.length?function(e,t){Q.apply(e,J.call(t))}:function(e,t){for(var r=e.length,i=0;e[r++]=t[i++];);e.length=r-1}}}b=t.support={},M=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},R=t.setDocument=function(e){var t,r,i=e?e.ownerDocument||e:I;return i!==D&&9===i.nodeType&&i.documentElement?(D=i,F=i.documentElement,r=i.defaultView,r&&r!==r.top&&(r.addEventListener?r.addEventListener("unload",Se,!1):r.attachEvent&&r.attachEvent("onunload",Se)),N=!M(i),b.attributes=n(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=n(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=ve.test(i.getElementsByClassName),b.getById=n(function(e){return F.appendChild(e).id=O,!i.getElementsByName||!i.getElementsByName(O).length}),b.getById?(_.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&N){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}},_.filter.ID=function(e){var t=e.replace(be,_e);return function(e){return e.getAttribute("id")===t}}):(delete _.find.ID,_.filter.ID=function(e){var t=e.replace(be,_e);return function(e){var r="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return r&&r.value===t}}),_.find.TAG=b.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,i=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;r=o[n++];)1===r.nodeType&&i.push(r);return i}return o},_.find.CLASS=b.getElementsByClassName&&function(e,t){return N?t.getElementsByClassName(e):void 0},z=[],U=[],(b.qsa=ve.test(i.querySelectorAll))&&(n(function(e){F.appendChild(e).innerHTML="<a id='"+O+"'></a><select id='"+O+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&U.push("[*^$]="+re+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||U.push("\\["+re+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+O+"-]").length||U.push("~="),e.querySelectorAll(":checked").length||U.push(":checked"),e.querySelectorAll("a#"+O+"+*").length||U.push(".#.+[+~]")}),n(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&U.push("name"+re+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||U.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),U.push(",.*:")})),(b.matchesSelector=ve.test(V=F.matches||F.webkitMatchesSelector||F.mozMatchesSelector||F.oMatchesSelector||F.msMatchesSelector))&&n(function(e){b.disconnectedMatch=V.call(e,"div"),V.call(e,"[s!='']:x"),z.push("!=",ae)}),U=U.length&&new RegExp(U.join("|")),z=z.length&&new RegExp(z.join("|")),t=ve.test(F.compareDocumentPosition),B=t||ve.test(F.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(r.contains?r.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},X=t?function(e,t){if(e===t)return P=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!b.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===I&&B(I,e)?-1:t===i||t.ownerDocument===I&&B(I,t)?1:L?ee(L,e)-ee(L,t):0:4&r?-1:1)}:function(e,t){if(e===t)return P=!0,0;var r,n=0,o=e.parentNode,s=t.parentNode,l=[e],h=[t];if(!o||!s)return e===i?-1:t===i?1:o?-1:s?1:L?ee(L,e)-ee(L,t):0;if(o===s)return a(e,t);for(r=e;r=r.parentNode;)l.unshift(r);for(r=t;r=r.parentNode;)h.unshift(r);for(;l[n]===h[n];)n++;return n?a(l[n],h[n]):l[n]===I?-1:h[n]===I?1:0},i):D},t.matches=function(e,r){return t(e,null,null,r)},t.matchesSelector=function(e,r){if((e.ownerDocument||e)!==D&&R(e),r=r.replace(ue,"='$1']"),b.matchesSelector&&N&&(!z||!z.test(r))&&(!U||!U.test(r)))try{var i=V.call(e,r);if(i||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(n){}return t(r,D,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==D&&R(e),B(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==D&&R(e);var r=_.attrHandle[t.toLowerCase()],i=r&&Y.call(_.attrHandle,t.toLowerCase())?r(e,t,!N):void 0;return void 0!==i?i:b.attributes||!N?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,r=[],i=0,n=0;if(P=!b.detectDuplicates,L=!b.sortStable&&e.slice(0),e.sort(X),P){for(;t=e[n++];)t===e[n]&&(i=r.push(n));for(;i--;)e.splice(r[i],1)}return L=null,e},S=t.getText=function(e){var t,r="",i=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=S(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[i++];)r+=S(t);return r},_=t.selectors={cacheLength:50,createPseudo:i,match:de,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,_e),e[3]=(e[3]||e[4]||e[5]||"").replace(be,_e),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return de.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&fe.test(r)&&(t=T(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,_e).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+re+")"+e+"("+re+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,r,i){return function(n){var o=t.attr(n,e);return null==o?"!="===r:r?(o+="","="===r?o===i:"!="===r?o!==i:"^="===r?i&&0===o.indexOf(i):"*="===r?i&&o.indexOf(i)>-1:"$="===r?i&&o.slice(-i.length)===i:"~="===r?(" "+o.replace(se," ")+" ").indexOf(i)>-1:"|="===r?o===i||o.slice(0,i.length+1)===i+"-":!1):!0}},CHILD:function(e,t,r,i,n){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===n?function(e){return!!e.parentNode}:function(t,r,l){var h,c,u,f,p,d,m=o!==a?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!l&&!s;if(g){if(o){for(;m;){for(u=t;u=u[m];)if(s?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;d=m="only"===e&&!d&&"nextSibling"}return!0}if(d=[a?g.firstChild:g.lastChild],a&&y){for(c=g[O]||(g[O]={}),h=c[e]||[],p=h[0]===k&&h[1],f=h[0]===k&&h[2],u=p&&g.childNodes[p];u=++p&&u&&u[m]||(f=p=0)||d.pop();)if(1===u.nodeType&&++f&&u===t){c[e]=[k,p,f];break}}else if(y&&(h=(t[O]||(t[O]={}))[e])&&h[0]===k)f=h[1];else for(;(u=++p&&u&&u[m]||(f=p=0)||d.pop())&&((s?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++f||(y&&((u[O]||(u[O]={}))[e]=[k,f]),u!==t)););return f-=n,f===i||f%i===0&&f/i>=0}}},PSEUDO:function(e,r){var n,o=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[O]?o(r):o.length>1?(n=[e,e,"",r],_.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,n=o(e,r),a=n.length;a--;)i=ee(e,n[a]),e[i]=!(t[i]=n[a])}):function(e){return o(e,0,n)}):o}},pseudos:{not:i(function(e){var t=[],r=[],n=C(e.replace(le,"$1"));return n[O]?i(function(e,t,r,i){for(var o,a=n(e,null,i,[]),s=e.length;s--;)(o=a[s])&&(e[s]=!(t[s]=o))}):function(e,i,o){return t[0]=e,n(t,null,o,r),t[0]=null,!r.pop()}}),has:i(function(e){return function(r){return t(e,r).length>0}}),contains:i(function(e){return e=e.replace(be,_e),function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:i(function(e){return pe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,_e).toLowerCase(),function(t){var r;do if(r=N?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return r=r.toLowerCase(),r===e||0===r.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===F},focus:function(e){return e===D.activeElement&&(!D.hasFocus||D.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return ge.test(e.nodeName)},input:function(e){return me.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:h(function(){return[0]}),last:h(function(e,t){return[t-1]}),eq:h(function(e,t,r){return[0>r?r+t:r]}),even:h(function(e,t){for(var r=0;t>r;r+=2)e.push(r);return e}),odd:h(function(e,t){for(var r=1;t>r;r+=2)e.push(r);return e}),lt:h(function(e,t,r){for(var i=0>r?r+t:r;--i>=0;)e.push(i);return e}),gt:h(function(e,t,r){for(var i=0>r?r+t:r;++i<t;)e.push(i);return e})}},_.pseudos.nth=_.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[w]=s(w);for(w in{submit:!0,reset:!0})_.pseudos[w]=l(w);return u.prototype=_.filters=_.pseudos,_.setFilters=new u,T=t.tokenize=function(e,r){var i,n,o,a,s,l,h,c=j[e+" "];if(c)return r?0:c.slice(0);for(s=e,l=[],h=_.preFilter;s;){(!i||(n=he.exec(s)))&&(n&&(s=s.slice(n[0].length)||s),l.push(o=[])),i=!1,(n=ce.exec(s))&&(i=n.shift(),o.push({value:i,type:n[0].replace(le," ")}),s=s.slice(i.length));for(a in _.filter)!(n=de[a].exec(s))||h[a]&&!(n=h[a](n))||(i=n.shift(),o.push({value:i,type:a,matches:n}),s=s.slice(i.length));if(!i)break}return r?s.length:s?t.error(e):j(e,l).slice(0)},C=t.compile=function(e,t){var r,i=[],n=[],o=W[e+" "];if(!o){for(t||(t=T(e)),r=t.length;r--;)o=y(t[r]),o[O]?i.push(o):n.push(o);o=W(e,x(n,i)),o.selector=e}return o},A=t.select=function(e,t,r,i){var n,o,a,s,l,h="function"==typeof e&&e,u=!i&&T(e=h.selector||e);if(r=r||[],1===u.length){if(o=u[0]=u[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&b.getById&&9===t.nodeType&&N&&_.relative[o[1].type]){if(t=(_.find.ID(a.matches[0].replace(be,_e),t)||[])[0],!t)return r;h&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(n=de.needsContext.test(e)?0:o.length;n--&&(a=o[n],!_.relative[s=a.type]);)if((l=_.find[s])&&(i=l(a.matches[0].replace(be,_e),xe.test(o[0].type)&&c(t.parentNode)||t))){if(o.splice(n,1),e=i.length&&f(o),!e)return Z.apply(r,i),r;break}}return(h||C(e,u))(i,t,!N,r,xe.test(e)&&c(t.parentNode)||t),r},b.sortStable=O.split("").sort(X).join("")===O,b.detectDuplicates=!!P,R(),b.sortDetached=n(function(e){return 1&e.compareDocumentPosition(D.createElement("div"))}),n(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,r){return r?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&n(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,r){return r||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),n(function(e){return null==e.getAttribute("disabled")})||o(te,function(e,t,r){var i;return r?void 0:e[t]===!0?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);J.find=ne,J.expr=ne.selectors,J.expr[":"]=J.expr.pseudos,J.unique=ne.uniqueSort,J.text=ne.getText,J.isXMLDoc=ne.isXML,J.contains=ne.contains;var oe=J.expr.match.needsContext,ae=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,se=/^.[^:#\[\.,]*$/;J.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?J.find.matchesSelector(i,e)?[i]:[]:J.find.matches(e,J.grep(t,function(e){return 1===e.nodeType}))},J.fn.extend({find:function(e){var t,r=this.length,i=[],n=this;if("string"!=typeof e)return this.pushStack(J(e).filter(function(){for(t=0;r>t;t++)if(J.contains(n[t],this))return!0}));for(t=0;r>t;t++)J.find(e,n[t],i);return i=this.pushStack(r>1?J.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(i(this,e||[],!1))},not:function(e){return this.pushStack(i(this,e||[],!0))},is:function(e){return!!i(this,"string"==typeof e&&oe.test(e)?J(e):e||[],!1).length}});var le,he=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ce=J.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:he.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||le).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof J?t[0]:t,J.merge(this,J.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:Q,!0)),ae.test(r[1])&&J.isPlainObject(t))for(r in t)J.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=Q.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=Q,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):J.isFunction(e)?"undefined"!=typeof le.ready?le.ready(e):e(J):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),J.makeArray(e,this))};ce.prototype=J.fn,le=J(Q);var ue=/^(?:parents|prev(?:Until|All))/,fe={children:!0,contents:!0,next:!0,prev:!0};J.extend({dir:function(e,t,r){for(var i=[],n=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&J(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}}),J.fn.extend({has:function(e){var t=J(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(J.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,n=this.length,o=[],a=oe.test(e)||"string"!=typeof e?J(e,t||this.context):0;n>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&J.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?J.unique(o):o)},index:function(e){return e?"string"==typeof e?X.call(J(e),this[0]):X.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(J.unique(J.merge(this.get(),J(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),J.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return J.dir(e,"parentNode")},parentsUntil:function(e,t,r){return J.dir(e,"parentNode",r)},next:function(e){return n(e,"nextSibling")},prev:function(e){return n(e,"previousSibling")},nextAll:function(e){return J.dir(e,"nextSibling")},prevAll:function(e){return J.dir(e,"previousSibling")},nextUntil:function(e,t,r){return J.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return J.dir(e,"previousSibling",r)},siblings:function(e){return J.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return J.sibling(e.firstChild)},contents:function(e){return e.contentDocument||J.merge([],e.childNodes)}},function(e,t){J.fn[e]=function(r,i){var n=J.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(n=J.filter(i,n)),this.length>1&&(fe[e]||J.unique(n),ue.test(e)&&n.reverse()),this.pushStack(n)}});var pe=/\S+/g,de={};J.Callbacks=function(e){e="string"==typeof e?de[e]||o(e):J.extend({},e);var t,r,i,n,a,s,l=[],h=!e.once&&[],c=function(o){for(t=e.memory&&o,r=!0,s=n||0,n=0,a=l.length,i=!0;l&&a>s;s++)if(l[s].apply(o[0],o[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,l&&(h?h.length&&c(h.shift()):t?l=[]:u.disable())},u={add:function(){if(l){var r=l.length;!function o(t){J.each(t,function(t,r){var i=J.type(r);"function"===i?e.unique&&u.has(r)||l.push(r):r&&r.length&&"string"!==i&&o(r)})}(arguments),i?a=l.length:t&&(n=r,c(t))}return this},remove:function(){return l&&J.each(arguments,function(e,t){for(var r;(r=J.inArray(t,l,r))>-1;)l.splice(r,1),i&&(a>=r&&a--,s>=r&&s--)}),this},has:function(e){return e?J.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],a=0,this},disable:function(){return l=h=t=void 0,this},disabled:function(){return!l},lock:function(){return h=void 0,t||u.disable(),this},locked:function(){return!h},fireWith:function(e,t){return!l||r&&!h||(t=t||[],t=[e,t.slice?t.slice():t],i?h.push(t):c(t)),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},J.extend({Deferred:function(e){var t=[["resolve","done",J.Callbacks("once memory"),"resolved"],["reject","fail",J.Callbacks("once memory"),"rejected"],["notify","progress",J.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var e=arguments;return J.Deferred(function(r){J.each(t,function(t,o){var a=J.isFunction(e[t])&&e[t];n[o[1]](function(){var e=a&&a.apply(this,arguments);e&&J.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?J.extend(e,i):i}},n={};return i.pipe=i.then,J.each(t,function(e,o){var a=o[2],s=o[3];i[o[1]]=a.add,s&&a.add(function(){r=s},t[1^e][2].disable,t[2][2].lock),n[o[0]]=function(){return n[o[0]+"With"](this===n?i:this,arguments),this},n[o[0]+"With"]=a.fireWith}),i.promise(n),e&&e.call(n,n),n},when:function(e){var t,r,i,n=0,o=G.call(arguments),a=o.length,s=1!==a||e&&J.isFunction(e.promise)?a:0,l=1===s?e:J.Deferred(),h=function(e,r,i){return function(n){r[e]=this,i[e]=arguments.length>1?G.call(arguments):n,i===t?l.notifyWith(r,i):--s||l.resolveWith(r,i)}};if(a>1)for(t=new Array(a),r=new Array(a),i=new Array(a);a>n;n++)o[n]&&J.isFunction(o[n].promise)?o[n].promise().done(h(n,i,o)).fail(l.reject).progress(h(n,r,t)):--s;return s||l.resolveWith(i,o),l.promise()}});var me;J.fn.ready=function(e){return J.ready.promise().done(e),this},J.extend({isReady:!1,readyWait:1,holdReady:function(e){e?J.readyWait++:J.ready(!0)},ready:function(e){(e===!0?--J.readyWait:J.isReady)||(J.isReady=!0,e!==!0&&--J.readyWait>0||(me.resolveWith(Q,[J]),J.fn.triggerHandler&&(J(Q).triggerHandler("ready"),J(Q).off("ready"))))}}),J.ready.promise=function(t){return me||(me=J.Deferred(),"complete"===Q.readyState?setTimeout(J.ready):(Q.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1))),me.promise(t)},J.ready.promise();var ge=J.access=function(e,t,r,i,n,o,a){var s=0,l=e.length,h=null==r;if("object"===J.type(r)){n=!0;for(s in r)J.access(e,t,s,r[s],!0,o,a)}else if(void 0!==i&&(n=!0,J.isFunction(i)||(a=!0),h&&(a?(t.call(e,i),t=null):(h=t,t=function(e,t,r){return h.call(J(e),r)})),t))for(;l>s;s++)t(e[s],r,a?i:i.call(e[s],s,t(e[s],r)));return n?e:h?t.call(e):l?t(e[0],r):o};J.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},s.uid=1,s.accepts=J.acceptData,s.prototype={key:function(e){if(!s.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=s.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,J.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,n=this.key(e),o=this.cache[n];if("string"==typeof t)o[t]=r;else if(J.isEmptyObject(o))J.extend(this.cache[n],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var r=this.cache[this.key(e)];return void 0===t?r:r[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,J.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,n,o=this.key(e),a=this.cache[o];if(void 0===t)this.cache[o]={};else{J.isArray(t)?i=t.concat(t.map(J.camelCase)):(n=J.camelCase(t),t in a?i=[t,n]:(i=n,i=i in a?[i]:i.match(pe)||[])),r=i.length;for(;r--;)delete a[i[r]]}},hasData:function(e){return!J.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var ve=new s,ye=new s,xe=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,we=/([A-Z])/g;J.extend({hasData:function(e){return ye.hasData(e)||ve.hasData(e)},data:function(e,t,r){return ye.access(e,t,r)},removeData:function(e,t){ye.remove(e,t)},_data:function(e,t,r){return ve.access(e,t,r)},_removeData:function(e,t){ve.remove(e,t)}}),J.fn.extend({data:function(e,t){var r,i,n,o=this[0],a=o&&o.attributes;if(void 0===e){if(this.length&&(n=ye.get(o),1===o.nodeType&&!ve.get(o,"hasDataAttrs"))){for(r=a.length;r--;)a[r]&&(i=a[r].name,0===i.indexOf("data-")&&(i=J.camelCase(i.slice(5)),l(o,i,n[i])));ve.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){ye.set(this,e)}):ge(this,function(t){var r,i=J.camelCase(e);if(o&&void 0===t){if(r=ye.get(o,e),void 0!==r)return r;if(r=ye.get(o,i),void 0!==r)return r;if(r=l(o,i,void 0),void 0!==r)return r}else this.each(function(){var r=ye.get(this,i);ye.set(this,i,t),-1!==e.indexOf("-")&&void 0!==r&&ye.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ye.remove(this,e);
})}}),J.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=ve.get(e,t),r&&(!i||J.isArray(r)?i=ve.access(e,t,J.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=J.queue(e,t),i=r.length,n=r.shift(),o=J._queueHooks(e,t),a=function(){J.dequeue(e,t)};"inprogress"===n&&(n=r.shift(),i--),n&&("fx"===t&&r.unshift("inprogress"),delete o.stop,n.call(e,a,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return ve.get(e,r)||ve.access(e,r,{empty:J.Callbacks("once memory").add(function(){ve.remove(e,[t+"queue",r])})})}}),J.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?J.queue(this[0],e):void 0===t?this:this.each(function(){var r=J.queue(this,e,t);J._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&J.dequeue(this,e)})},dequeue:function(e){return this.each(function(){J.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,n=J.Deferred(),o=this,a=this.length,s=function(){--i||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";a--;)r=ve.get(o[a],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(s));return s(),n.promise(t)}});var be=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_e=["Top","Right","Bottom","Left"],Se=function(e,t){return e=t||e,"none"===J.css(e,"display")||!J.contains(e.ownerDocument,e)},Me=/^(?:checkbox|radio)$/i;!function(){var e=Q.createDocumentFragment(),t=e.appendChild(Q.createElement("div")),r=Q.createElement("input");r.setAttribute("type","radio"),r.setAttribute("checked","checked"),r.setAttribute("name","t"),t.appendChild(r),$.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",$.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Te="undefined";$.focusinBubbles="onfocusin"in e;var Ce=/^key/,Ae=/^(?:mouse|pointer|contextmenu)|click/,Ee=/^(?:focusinfocus|focusoutblur)$/,Le=/^([^.]*)(?:\.(.+)|)$/;J.event={global:{},add:function(e,t,r,i,n){var o,a,s,l,h,c,u,f,p,d,m,g=ve.get(e);if(g)for(r.handler&&(o=r,r=o.handler,n=o.selector),r.guid||(r.guid=J.guid++),(l=g.events)||(l=g.events={}),(a=g.handle)||(a=g.handle=function(t){return typeof J!==Te&&J.event.triggered!==t.type?J.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(pe)||[""],h=t.length;h--;)s=Le.exec(t[h])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p&&(u=J.event.special[p]||{},p=(n?u.delegateType:u.bindType)||p,u=J.event.special[p]||{},c=J.extend({type:p,origType:m,data:i,handler:r,guid:r.guid,selector:n,needsContext:n&&J.expr.match.needsContext.test(n),namespace:d.join(".")},o),(f=l[p])||(f=l[p]=[],f.delegateCount=0,u.setup&&u.setup.call(e,i,d,a)!==!1||e.addEventListener&&e.addEventListener(p,a,!1)),u.add&&(u.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),n?f.splice(f.delegateCount++,0,c):f.push(c),J.event.global[p]=!0)},remove:function(e,t,r,i,n){var o,a,s,l,h,c,u,f,p,d,m,g=ve.hasData(e)&&ve.get(e);if(g&&(l=g.events)){for(t=(t||"").match(pe)||[""],h=t.length;h--;)if(s=Le.exec(t[h])||[],p=m=s[1],d=(s[2]||"").split(".").sort(),p){for(u=J.event.special[p]||{},p=(i?u.delegateType:u.bindType)||p,f=l[p]||[],s=s[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=f.length;o--;)c=f[o],!n&&m!==c.origType||r&&r.guid!==c.guid||s&&!s.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(f.splice(o,1),c.selector&&f.delegateCount--,u.remove&&u.remove.call(e,c));a&&!f.length&&(u.teardown&&u.teardown.call(e,d,g.handle)!==!1||J.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)J.event.remove(e,p+t[h],r,i,!0);J.isEmptyObject(l)&&(delete g.handle,ve.remove(e,"events"))}},trigger:function(t,r,i,n){var o,a,s,l,h,c,u,f=[i||Q],p=K.call(t,"type")?t.type:t,d=K.call(t,"namespace")?t.namespace.split("."):[];if(a=s=i=i||Q,3!==i.nodeType&&8!==i.nodeType&&!Ee.test(p+J.event.triggered)&&(p.indexOf(".")>=0&&(d=p.split("."),p=d.shift(),d.sort()),h=p.indexOf(":")<0&&"on"+p,t=t[J.expando]?t:new J.Event(p,"object"==typeof t&&t),t.isTrigger=n?2:3,t.namespace=d.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),r=null==r?[t]:J.makeArray(r,[t]),u=J.event.special[p]||{},n||!u.trigger||u.trigger.apply(i,r)!==!1)){if(!n&&!u.noBubble&&!J.isWindow(i)){for(l=u.delegateType||p,Ee.test(l+p)||(a=a.parentNode);a;a=a.parentNode)f.push(a),s=a;s===(i.ownerDocument||Q)&&f.push(s.defaultView||s.parentWindow||e)}for(o=0;(a=f[o++])&&!t.isPropagationStopped();)t.type=o>1?l:u.bindType||p,c=(ve.get(a,"events")||{})[t.type]&&ve.get(a,"handle"),c&&c.apply(a,r),c=h&&a[h],c&&c.apply&&J.acceptData(a)&&(t.result=c.apply(a,r),t.result===!1&&t.preventDefault());return t.type=p,n||t.isDefaultPrevented()||u._default&&u._default.apply(f.pop(),r)!==!1||!J.acceptData(i)||h&&J.isFunction(i[p])&&!J.isWindow(i)&&(s=i[h],s&&(i[h]=null),J.event.triggered=p,i[p](),J.event.triggered=void 0,s&&(i[h]=s)),t.result}},dispatch:function(e){e=J.event.fix(e);var t,r,i,n,o,a=[],s=G.call(arguments),l=(ve.get(this,"events")||{})[e.type]||[],h=J.event.special[e.type]||{};if(s[0]=e,e.delegateTarget=this,!h.preDispatch||h.preDispatch.call(this,e)!==!1){for(a=J.event.handlers.call(this,e,l),t=0;(n=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=n.elem,r=0;(o=n.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((J.event.special[o.origType]||{}).handle||o.handler).apply(n.elem,s),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()));return h.postDispatch&&h.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,n,o,a=[],s=t.delegateCount,l=e.target;if(s&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(i=[],r=0;s>r;r++)o=t[r],n=o.selector+" ",void 0===i[n]&&(i[n]=o.needsContext?J(n,this).index(l)>=0:J.find(n,this,null,[l]).length),i[n]&&i.push(o);i.length&&a.push({elem:l,handlers:i})}return s<t.length&&a.push({elem:this,handlers:t.slice(s)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var r,i,n,o=t.button;return null==e.pageX&&null!=t.clientX&&(r=e.target.ownerDocument||Q,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[J.expando])return e;var t,r,i,n=e.type,o=e,a=this.fixHooks[n];for(a||(this.fixHooks[n]=a=Ae.test(n)?this.mouseHooks:Ce.test(n)?this.keyHooks:{}),i=a.props?this.props.concat(a.props):this.props,e=new J.Event(o),t=i.length;t--;)r=i[t],e[r]=o[r];return e.target||(e.target=Q),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==u()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===u()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&J.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return J.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var n=J.extend(new J.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?J.event.trigger(n,null,t):J.event.dispatch.call(t,n),n.isDefaultPrevented()&&r.preventDefault()}},J.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)},J.Event=function(e,t){return this instanceof J.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?h:c):this.type=e,t&&J.extend(this,t),this.timeStamp=e&&e.timeStamp||J.now(),void(this[J.expando]=!0)):new J.Event(e,t)},J.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=h,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=h,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=h,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},J.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){J.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,n=e.relatedTarget,o=e.handleObj;return(!n||n!==i&&!J.contains(i,n))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),$.focusinBubbles||J.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){J.event.simulate(t,e.target,J.event.fix(e),!0)};J.event.special[t]={setup:function(){var i=this.ownerDocument||this,n=ve.access(i,t);n||i.addEventListener(e,r,!0),ve.access(i,t,(n||0)+1)},teardown:function(){var i=this.ownerDocument||this,n=ve.access(i,t)-1;n?ve.access(i,t,n):(i.removeEventListener(e,r,!0),ve.remove(i,t))}}}),J.fn.extend({on:function(e,t,r,i,n){var o,a;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(a in e)this.on(a,t,r,e[a],n);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=c;else if(!i)return this;return 1===n&&(o=i,i=function(e){return J().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=J.guid++)),this.each(function(){J.event.add(this,e,i,r,t)})},one:function(e,t,r,i){return this.on(e,t,r,i,1)},off:function(e,t,r){var i,n;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,J(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=c),this.each(function(){J.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){J.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?J.event.trigger(e,t,r,!0):void 0}});var Pe=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Re=/<([\w:]+)/,De=/<|&#?\w+;/,Fe=/<(?:script|style|link)/i,Ne=/checked\s*(?:[^=]|=\s*.checked.)/i,Ue=/^$|\/(?:java|ecma)script/i,ze=/^true\/(.*)/,Ve=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Be={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Be.optgroup=Be.option,Be.tbody=Be.tfoot=Be.colgroup=Be.caption=Be.thead,Be.th=Be.td,J.extend({clone:function(e,t,r){var i,n,o,a,s=e.cloneNode(!0),l=J.contains(e.ownerDocument,e);if(!($.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||J.isXMLDoc(e)))for(a=v(s),o=v(e),i=0,n=o.length;n>i;i++)y(o[i],a[i]);if(t)if(r)for(o=o||v(e),a=a||v(s),i=0,n=o.length;n>i;i++)g(o[i],a[i]);else g(e,s);return a=v(s,"script"),a.length>0&&m(a,!l&&v(e,"script")),s},buildFragment:function(e,t,r,i){for(var n,o,a,s,l,h,c=t.createDocumentFragment(),u=[],f=0,p=e.length;p>f;f++)if(n=e[f],n||0===n)if("object"===J.type(n))J.merge(u,n.nodeType?[n]:n);else if(De.test(n)){for(o=o||c.appendChild(t.createElement("div")),a=(Re.exec(n)||["",""])[1].toLowerCase(),s=Be[a]||Be._default,o.innerHTML=s[1]+n.replace(Pe,"<$1></$2>")+s[2],h=s[0];h--;)o=o.lastChild;J.merge(u,o.childNodes),o=c.firstChild,o.textContent=""}else u.push(t.createTextNode(n));for(c.textContent="",f=0;n=u[f++];)if((!i||-1===J.inArray(n,i))&&(l=J.contains(n.ownerDocument,n),o=v(c.appendChild(n),"script"),l&&m(o),r))for(h=0;n=o[h++];)Ue.test(n.type||"")&&r.push(n);return c},cleanData:function(e){for(var t,r,i,n,o=J.event.special,a=0;void 0!==(r=e[a]);a++){if(J.acceptData(r)&&(n=r[ve.expando],n&&(t=ve.cache[n]))){if(t.events)for(i in t.events)o[i]?J.event.remove(r,i):J.removeEvent(r,i,t.handle);ve.cache[n]&&delete ve.cache[n]}delete ye.cache[r[ye.expando]]}}}),J.fn.extend({text:function(e){return ge(this,function(e){return void 0===e?J.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?J.filter(e,this):this,n=0;null!=(r=i[n]);n++)t||1!==r.nodeType||J.cleanData(v(r)),r.parentNode&&(t&&J.contains(r.ownerDocument,r)&&m(v(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(J.cleanData(v(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return J.clone(this,e,t)})},html:function(e){return ge(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Fe.test(e)&&!Be[(Re.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Pe,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(J.cleanData(v(t,!1)),t.innerHTML=e);t=0}catch(n){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,J.cleanData(v(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=j.apply([],e);var r,i,n,o,a,s,l=0,h=this.length,c=this,u=h-1,f=e[0],m=J.isFunction(f);if(m||h>1&&"string"==typeof f&&!$.checkClone&&Ne.test(f))return this.each(function(r){var i=c.eq(r);m&&(e[0]=f.call(this,r,i.html())),i.domManip(e,t)});if(h&&(r=J.buildFragment(e,this[0].ownerDocument,!1,this),i=r.firstChild,1===r.childNodes.length&&(r=i),i)){for(n=J.map(v(r,"script"),p),o=n.length;h>l;l++)a=r,l!==u&&(a=J.clone(a,!0,!0),o&&J.merge(n,v(a,"script"))),t.call(this[l],a,l);if(o)for(s=n[n.length-1].ownerDocument,J.map(n,d),l=0;o>l;l++)a=n[l],Ue.test(a.type||"")&&!ve.access(a,"globalEval")&&J.contains(s,a)&&(a.src?J._evalUrl&&J._evalUrl(a.src):J.globalEval(a.textContent.replace(Ve,"")))}return this}}),J.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){J.fn[e]=function(e){for(var r,i=[],n=J(e),o=n.length-1,a=0;o>=a;a++)r=a===o?this:this.clone(!0),J(n[a])[t](r),W.apply(i,r.get());return this.pushStack(i)}});var Oe,Ie={},ke=/^margin/,He=new RegExp("^("+be+")(?!px)[a-z%]+$","i"),Ge=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};!function(){function t(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",a.innerHTML="",n.appendChild(o);var t=e.getComputedStyle(a,null);r="1%"!==t.top,i="4px"===t.width,n.removeChild(o)}var r,i,n=Q.documentElement,o=Q.createElement("div"),a=Q.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",$.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",o.appendChild(a),e.getComputedStyle&&J.extend($,{pixelPosition:function(){return t(),r},boxSizingReliable:function(){return null==i&&t(),i},reliableMarginRight:function(){var t,r=a.appendChild(Q.createElement("div"));return r.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",r.style.marginRight=r.style.width="0",a.style.width="1px",n.appendChild(o),t=!parseFloat(e.getComputedStyle(r,null).marginRight),n.removeChild(o),a.removeChild(r),t}}))}(),J.swap=function(e,t,r,i){var n,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];n=r.apply(e,i||[]);for(o in t)e.style[o]=a[o];return n};var je=/^(none|table(?!-c[ea]).+)/,We=new RegExp("^("+be+")(.*)$","i"),Xe=new RegExp("^([+-])=("+be+")","i"),qe={position:"absolute",visibility:"hidden",display:"block"},Ye={letterSpacing:"0",fontWeight:"400"},Ke=["Webkit","O","Moz","ms"];J.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=b(e,"opacity");return""===r?"1":r}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,a,s=J.camelCase(t),l=e.style;return t=J.cssProps[s]||(J.cssProps[s]=S(l,s)),a=J.cssHooks[t]||J.cssHooks[s],void 0===r?a&&"get"in a&&void 0!==(n=a.get(e,!1,i))?n:l[t]:(o=typeof r,"string"===o&&(n=Xe.exec(r))&&(r=(n[1]+1)*n[2]+parseFloat(J.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||J.cssNumber[s]||(r+="px"),$.clearCloneStyle||""!==r||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(r=a.set(e,r,i))||(l[t]=r)),void 0)}},css:function(e,t,r,i){var n,o,a,s=J.camelCase(t);return t=J.cssProps[s]||(J.cssProps[s]=S(e.style,s)),a=J.cssHooks[t]||J.cssHooks[s],a&&"get"in a&&(n=a.get(e,!0,r)),void 0===n&&(n=b(e,t,i)),"normal"===n&&t in Ye&&(n=Ye[t]),""===r||r?(o=parseFloat(n),r===!0||J.isNumeric(o)?o||0:n):n}}),J.each(["height","width"],function(e,t){J.cssHooks[t]={get:function(e,r,i){return r?je.test(J.css(e,"display"))&&0===e.offsetWidth?J.swap(e,qe,function(){return C(e,t,i)}):C(e,t,i):void 0},set:function(e,r,i){var n=i&&Ge(e);return M(e,r,i?T(e,t,i,"border-box"===J.css(e,"boxSizing",!1,n),n):0)}}}),J.cssHooks.marginRight=_($.reliableMarginRight,function(e,t){return t?J.swap(e,{display:"inline-block"},b,[e,"marginRight"]):void 0}),J.each({margin:"",padding:"",border:"Width"},function(e,t){J.cssHooks[e+t]={expand:function(r){for(var i=0,n={},o="string"==typeof r?r.split(" "):[r];4>i;i++)n[e+_e[i]+t]=o[i]||o[i-2]||o[0];return n}},ke.test(e)||(J.cssHooks[e+t].set=M)}),J.fn.extend({css:function(e,t){return ge(this,function(e,t,r){var i,n,o={},a=0;if(J.isArray(t)){for(i=Ge(e),n=t.length;n>a;a++)o[t[a]]=J.css(e,t[a],!1,i);return o}return void 0!==r?J.style(e,t,r):J.css(e,t)},e,t,arguments.length>1)},show:function(){return A(this,!0)},hide:function(){return A(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Se(this)?J(this).show():J(this).hide()})}}),J.Tween=E,E.prototype={constructor:E,init:function(e,t,r,i,n,o){this.elem=e,this.prop=r,this.easing=n||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(J.cssNumber[r]?"":"px")},cur:function(){var e=E.propHooks[this.prop];return e&&e.get?e.get(this):E.propHooks._default.get(this)},run:function(e){var t,r=E.propHooks[this.prop];return this.options.duration?this.pos=t=J.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):E.propHooks._default.set(this),this}},E.prototype.init.prototype=E.prototype,E.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=J.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){J.fx.step[e.prop]?J.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[J.cssProps[e.prop]]||J.cssHooks[e.prop])?J.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},E.propHooks.scrollTop=E.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},J.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},J.fx=E.prototype.init,J.fx.step={};var $e,Qe,Ze=/^(?:toggle|show|hide)$/,Je=new RegExp("^(?:([+-])=|)("+be+")([a-z%]*)$","i"),et=/queueHooks$/,tt=[D],rt={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),n=Je.exec(t),o=n&&n[3]||(J.cssNumber[e]?"":"px"),a=(J.cssNumber[e]||"px"!==o&&+i)&&Je.exec(J.css(r.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],n=n||[],a=+i||1;do s=s||".5",a/=s,J.style(r.elem,e,a+o);while(s!==(s=r.cur()/i)&&1!==s&&--l)}return n&&(a=r.start=+a||+i||0,r.unit=o,r.end=n[1]?a+(n[1]+1)*n[2]:+n[2]),r}]};J.Animation=J.extend(N,{tweener:function(e,t){J.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,n=e.length;n>i;i++)r=e[i],rt[r]=rt[r]||[],rt[r].unshift(t)},prefilter:function(e,t){t?tt.unshift(e):tt.push(e)}}),J.speed=function(e,t,r){var i=e&&"object"==typeof e?J.extend({},e):{complete:r||!r&&t||J.isFunction(e)&&e,duration:e,easing:r&&t||t&&!J.isFunction(t)&&t};return i.duration=J.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in J.fx.speeds?J.fx.speeds[i.duration]:J.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){J.isFunction(i.old)&&i.old.call(this),i.queue&&J.dequeue(this,i.queue)},i},J.fn.extend({fadeTo:function(e,t,r,i){return this.filter(Se).css("opacity",0).show().end().animate({opacity:t},e,r,i)},animate:function(e,t,r,i){var n=J.isEmptyObject(e),o=J.speed(t,r,i),a=function(){var t=N(this,J.extend({},e),o);(n||ve.get(this,"finish"))&&t.stop(!0)};return a.finish=a,n||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=J.timers,a=ve.get(this);if(n)a[n]&&a[n].stop&&i(a[n]);else for(n in a)a[n]&&a[n].stop&&et.test(n)&&i(a[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1));(t||!r)&&J.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=ve.get(this),i=r[e+"queue"],n=r[e+"queueHooks"],o=J.timers,a=i?i.length:0;for(r.finish=!0,J.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;a>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),J.each(["toggle","show","hide"],function(e,t){var r=J.fn[t];J.fn[t]=function(e,i,n){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(P(t,!0),e,i,n)}}),J.each({slideDown:P("show"),slideUp:P("hide"),slideToggle:P("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){J.fn[e]=function(e,r,i){return this.animate(t,e,r,i)}}),J.timers=[],J.fx.tick=function(){var e,t=0,r=J.timers;for($e=J.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||J.fx.stop(),$e=void 0},J.fx.timer=function(e){J.timers.push(e),e()?J.fx.start():J.timers.pop()},J.fx.interval=13,J.fx.start=function(){Qe||(Qe=setInterval(J.fx.tick,J.fx.interval))},J.fx.stop=function(){clearInterval(Qe),Qe=null},J.fx.speeds={slow:600,fast:200,_default:400},J.fn.delay=function(e,t){return e=J.fx?J.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,r){var i=setTimeout(t,e);r.stop=function(){clearTimeout(i)}})},function(){var e=Q.createElement("input"),t=Q.createElement("select"),r=t.appendChild(Q.createElement("option"));e.type="checkbox",$.checkOn=""!==e.value,$.optSelected=r.selected,t.disabled=!0,$.optDisabled=!r.disabled,e=Q.createElement("input"),e.value="t",e.type="radio",$.radioValue="t"===e.value}();var it,nt,ot=J.expr.attrHandle;J.fn.extend({attr:function(e,t){return ge(this,J.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){J.removeAttr(this,e)})}}),J.extend({attr:function(e,t,r){var i,n,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===Te?J.prop(e,t,r):(1===o&&J.isXMLDoc(e)||(t=t.toLowerCase(),i=J.attrHooks[t]||(J.expr.match.bool.test(t)?nt:it)),void 0===r?i&&"get"in i&&null!==(n=i.get(e,t))?n:(n=J.find.attr(e,t),null==n?void 0:n):null!==r?i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:(e.setAttribute(t,r+""),r):void J.removeAttr(e,t))},removeAttr:function(e,t){var r,i,n=0,o=t&&t.match(pe);if(o&&1===e.nodeType)for(;r=o[n++];)i=J.propFix[r]||r,J.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!$.radioValue&&"radio"===t&&J.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),nt={set:function(e,t,r){return t===!1?J.removeAttr(e,r):e.setAttribute(r,r),r}},J.each(J.expr.match.bool.source.match(/\w+/g),function(e,t){var r=ot[t]||J.find.attr;ot[t]=function(e,t,i){var n,o;return i||(o=ot[t],ot[t]=n,n=null!=r(e,t,i)?t.toLowerCase():null,ot[t]=o),n}});var at=/^(?:input|select|textarea|button)$/i;J.fn.extend({prop:function(e,t){return ge(this,J.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[J.propFix[e]||e]})}}),J.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,r){var i,n,o,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return o=1!==a||!J.isXMLDoc(e),o&&(t=J.propFix[t]||t,n=J.propHooks[t]),void 0!==r?n&&"set"in n&&void 0!==(i=n.set(e,r,t))?i:e[t]=r:n&&"get"in n&&null!==(i=n.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||at.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),$.optSelected||(J.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),J.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){J.propFix[this.toLowerCase()]=this});var st=/[\t\r\n\f]/g;J.fn.extend({addClass:function(e){var t,r,i,n,o,a,s="string"==typeof e&&e,l=0,h=this.length;if(J.isFunction(e))return this.each(function(t){J(this).addClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pe)||[];h>l;l++)if(r=this[l],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(st," "):" ")){for(o=0;n=t[o++];)i.indexOf(" "+n+" ")<0&&(i+=n+" ");a=J.trim(i),r.className!==a&&(r.className=a)}return this},removeClass:function(e){var t,r,i,n,o,a,s=0===arguments.length||"string"==typeof e&&e,l=0,h=this.length;if(J.isFunction(e))return this.each(function(t){J(this).removeClass(e.call(this,t,this.className))});if(s)for(t=(e||"").match(pe)||[];h>l;l++)if(r=this[l],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(st," "):"")){for(o=0;n=t[o++];)for(;i.indexOf(" "+n+" ")>=0;)i=i.replace(" "+n+" "," ");a=e?J.trim(i):"",r.className!==a&&(r.className=a)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):J.isFunction(e)?this.each(function(r){J(this).toggleClass(e.call(this,r,this.className,t),t)}):this.each(function(){if("string"===r)for(var t,i=0,n=J(this),o=e.match(pe)||[];t=o[i++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else(r===Te||"boolean"===r)&&(this.className&&ve.set(this,"__className__",this.className),this.className=this.className||e===!1?"":ve.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",r=0,i=this.length;i>r;r++)if(1===this[r].nodeType&&(" "+this[r].className+" ").replace(st," ").indexOf(t)>=0)return!0;return!1}});var lt=/\r/g;J.fn.extend({val:function(e){var t,r,i,n=this[0];{if(arguments.length)return i=J.isFunction(e),this.each(function(r){var n;1===this.nodeType&&(n=i?e.call(this,r,J(this).val()):e,null==n?n="":"number"==typeof n?n+="":J.isArray(n)&&(n=J.map(n,function(e){return null==e?"":e+""})),t=J.valHooks[this.type]||J.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))});if(n)return t=J.valHooks[n.type]||J.valHooks[n.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(n,"value"))?r:(r=n.value,"string"==typeof r?r.replace(lt,""):null==r?"":r)}}}),J.extend({valHooks:{option:{get:function(e){var t=J.find.attr(e,"value");return null!=t?t:J.trim(J.text(e))}},select:{get:function(e){for(var t,r,i=e.options,n=e.selectedIndex,o="select-one"===e.type||0>n,a=o?null:[],s=o?n+1:i.length,l=0>n?s:o?n:0;s>l;l++)if(r=i[l],(r.selected||l===n)&&($.optDisabled?!r.disabled:null===r.getAttribute("disabled"))&&(!r.parentNode.disabled||!J.nodeName(r.parentNode,"optgroup"))){if(t=J(r).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var r,i,n=e.options,o=J.makeArray(t),a=n.length;a--;)i=n[a],(i.selected=J.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),J.each(["radio","checkbox"],function(){J.valHooks[this]={set:function(e,t){return J.isArray(t)?e.checked=J.inArray(J(e).val(),t)>=0:void 0}},$.checkOn||(J.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),J.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){J.fn[t]=function(e,r){return arguments.length>0?this.on(t,null,e,r):this.trigger(t)}}),J.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,i){return this.on(t,e,r,i)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)}});var ht=J.now(),ct=/\?/;J.parseJSON=function(e){return JSON.parse(e+"")},J.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&J.error("Invalid XML: "+e),t};var ut=/#.*$/,ft=/([?&])_=[^&]*/,pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,dt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mt=/^(?:GET|HEAD)$/,gt=/^\/\//,vt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,yt={},xt={},wt="*/".concat("*"),bt=e.location.href,_t=vt.exec(bt.toLowerCase())||[];J.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:bt,type:"GET",isLocal:dt.test(_t[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":J.parseJSON,"text xml":J.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?V(V(e,J.ajaxSettings),t):V(J.ajaxSettings,e)},ajaxPrefilter:U(yt),ajaxTransport:U(xt),ajax:function(e,t){function r(e,t,r,a){var l,c,v,y,w,_=t;2!==x&&(x=2,s&&clearTimeout(s),i=void 0,o=a||"",b.readyState=e>0?4:0,l=e>=200&&300>e||304===e,r&&(y=B(u,b,r)),y=O(u,y,b,l),l?(u.ifModified&&(w=b.getResponseHeader("Last-Modified"),w&&(J.lastModified[n]=w),w=b.getResponseHeader("etag"),w&&(J.etag[n]=w)),204===e||"HEAD"===u.type?_="nocontent":304===e?_="notmodified":(_=y.state,c=y.data,v=y.error,l=!v)):(v=_,(e||!_)&&(_="error",0>e&&(e=0))),
b.status=e,b.statusText=(t||_)+"",l?d.resolveWith(f,[c,_,b]):d.rejectWith(f,[b,_,v]),b.statusCode(g),g=void 0,h&&p.trigger(l?"ajaxSuccess":"ajaxError",[b,u,l?c:v]),m.fireWith(f,[b,_]),h&&(p.trigger("ajaxComplete",[b,u]),--J.active||J.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var i,n,o,a,s,l,h,c,u=J.ajaxSetup({},t),f=u.context||u,p=u.context&&(f.nodeType||f.jquery)?J(f):J.event,d=J.Deferred(),m=J.Callbacks("once memory"),g=u.statusCode||{},v={},y={},x=0,w="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!a)for(a={};t=pt.exec(o);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?o:null},setRequestHeader:function(e,t){var r=e.toLowerCase();return x||(e=y[r]=y[r]||e,v[e]=t),this},overrideMimeType:function(e){return x||(u.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>x)for(t in e)g[t]=[g[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||w;return i&&i.abort(t),r(0,t),this}};if(d.promise(b).complete=m.add,b.success=b.done,b.error=b.fail,u.url=((e||u.url||bt)+"").replace(ut,"").replace(gt,_t[1]+"//"),u.type=t.method||t.type||u.method||u.type,u.dataTypes=J.trim(u.dataType||"*").toLowerCase().match(pe)||[""],null==u.crossDomain&&(l=vt.exec(u.url.toLowerCase()),u.crossDomain=!(!l||l[1]===_t[1]&&l[2]===_t[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(_t[3]||("http:"===_t[1]?"80":"443")))),u.data&&u.processData&&"string"!=typeof u.data&&(u.data=J.param(u.data,u.traditional)),z(yt,u,t,b),2===x)return b;h=J.event&&u.global,h&&0===J.active++&&J.event.trigger("ajaxStart"),u.type=u.type.toUpperCase(),u.hasContent=!mt.test(u.type),n=u.url,u.hasContent||(u.data&&(n=u.url+=(ct.test(n)?"&":"?")+u.data,delete u.data),u.cache===!1&&(u.url=ft.test(n)?n.replace(ft,"$1_="+ht++):n+(ct.test(n)?"&":"?")+"_="+ht++)),u.ifModified&&(J.lastModified[n]&&b.setRequestHeader("If-Modified-Since",J.lastModified[n]),J.etag[n]&&b.setRequestHeader("If-None-Match",J.etag[n])),(u.data&&u.hasContent&&u.contentType!==!1||t.contentType)&&b.setRequestHeader("Content-Type",u.contentType),b.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+("*"!==u.dataTypes[0]?", "+wt+"; q=0.01":""):u.accepts["*"]);for(c in u.headers)b.setRequestHeader(c,u.headers[c]);if(u.beforeSend&&(u.beforeSend.call(f,b,u)===!1||2===x))return b.abort();w="abort";for(c in{success:1,error:1,complete:1})b[c](u[c]);if(i=z(xt,u,t,b)){b.readyState=1,h&&p.trigger("ajaxSend",[b,u]),u.async&&u.timeout>0&&(s=setTimeout(function(){b.abort("timeout")},u.timeout));try{x=1,i.send(v,r)}catch(_){if(!(2>x))throw _;r(-1,_)}}else r(-1,"No Transport");return b},getJSON:function(e,t,r){return J.get(e,t,r,"json")},getScript:function(e,t){return J.get(e,void 0,t,"script")}}),J.each(["get","post"],function(e,t){J[t]=function(e,r,i,n){return J.isFunction(r)&&(n=n||i,i=r,r=void 0),J.ajax({url:e,type:t,dataType:n,data:r,success:i})}}),J._evalUrl=function(e){return J.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},J.fn.extend({wrapAll:function(e){var t;return J.isFunction(e)?this.each(function(t){J(this).wrapAll(e.call(this,t))}):(this[0]&&(t=J(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return J.isFunction(e)?this.each(function(t){J(this).wrapInner(e.call(this,t))}):this.each(function(){var t=J(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=J.isFunction(e);return this.each(function(r){J(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){J.nodeName(this,"body")||J(this).replaceWith(this.childNodes)}).end()}}),J.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},J.expr.filters.visible=function(e){return!J.expr.filters.hidden(e)};var St=/%20/g,Mt=/\[\]$/,Tt=/\r?\n/g,Ct=/^(?:submit|button|image|reset|file)$/i,At=/^(?:input|select|textarea|keygen)/i;J.param=function(e,t){var r,i=[],n=function(e,t){t=J.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=J.ajaxSettings&&J.ajaxSettings.traditional),J.isArray(e)||e.jquery&&!J.isPlainObject(e))J.each(e,function(){n(this.name,this.value)});else for(r in e)I(r,e[r],t,n);return i.join("&").replace(St,"+")},J.fn.extend({serialize:function(){return J.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=J.prop(this,"elements");return e?J.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!J(this).is(":disabled")&&At.test(this.nodeName)&&!Ct.test(e)&&(this.checked||!Me.test(e))}).map(function(e,t){var r=J(this).val();return null==r?null:J.isArray(r)?J.map(r,function(e){return{name:t.name,value:e.replace(Tt,"\r\n")}}):{name:t.name,value:r.replace(Tt,"\r\n")}}).get()}}),J.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Et=0,Lt={},Pt={0:200,1223:204},Rt=J.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Lt)Lt[e]()}),$.cors=!!Rt&&"withCredentials"in Rt,$.ajax=Rt=!!Rt,J.ajaxTransport(function(e){var t;return $.cors||Rt&&!e.crossDomain?{send:function(r,i){var n,o=e.xhr(),a=++Et;if(o.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(n in e.xhrFields)o[n]=e.xhrFields[n];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),e.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");for(n in r)o.setRequestHeader(n,r[n]);t=function(e){return function(){t&&(delete Lt[a],t=o.onload=o.onerror=null,"abort"===e?o.abort():"error"===e?i(o.status,o.statusText):i(Pt[o.status]||o.status,o.statusText,"string"==typeof o.responseText?{text:o.responseText}:void 0,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=Lt[a]=t("abort");try{o.send(e.hasContent&&e.data||null)}catch(s){if(t)throw s}},abort:function(){t&&t()}}:void 0}),J.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return J.globalEval(e),e}}}),J.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),J.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,n){t=J("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&n("error"===e.type?404:200,e.type)}),Q.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Dt=[],Ft=/(=)\?(?=&|$)|\?\?/;J.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Dt.pop()||J.expando+"_"+ht++;return this[e]=!0,e}}),J.ajaxPrefilter("json jsonp",function(t,r,i){var n,o,a,s=t.jsonp!==!1&&(Ft.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ft.test(t.data)&&"data");return s||"jsonp"===t.dataTypes[0]?(n=t.jsonpCallback=J.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,s?t[s]=t[s].replace(Ft,"$1"+n):t.jsonp!==!1&&(t.url+=(ct.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return a||J.error(n+" was not called"),a[0]},t.dataTypes[0]="json",o=e[n],e[n]=function(){a=arguments},i.always(function(){e[n]=o,t[n]&&(t.jsonpCallback=r.jsonpCallback,Dt.push(n)),a&&J.isFunction(o)&&o(a[0]),a=o=void 0}),"script"):void 0}),J.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||Q;var i=ae.exec(e),n=!r&&[];return i?[t.createElement(i[1])]:(i=J.buildFragment([e],t,n),n&&n.length&&J(n).remove(),J.merge([],i.childNodes))};var Nt=J.fn.load;J.fn.load=function(e,t,r){if("string"!=typeof e&&Nt)return Nt.apply(this,arguments);var i,n,o,a=this,s=e.indexOf(" ");return s>=0&&(i=J.trim(e.slice(s)),e=e.slice(0,s)),J.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(n="POST"),a.length>0&&J.ajax({url:e,type:n,dataType:"html",data:t}).done(function(e){o=arguments,a.html(i?J("<div>").append(J.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){a.each(r,o||[e.responseText,t,e])}),this},J.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){J.fn[t]=function(e){return this.on(t,e)}}),J.expr.filters.animated=function(e){return J.grep(J.timers,function(t){return e===t.elem}).length};var Ut=e.document.documentElement;J.offset={setOffset:function(e,t,r){var i,n,o,a,s,l,h,c=J.css(e,"position"),u=J(e),f={};"static"===c&&(e.style.position="relative"),s=u.offset(),o=J.css(e,"top"),l=J.css(e,"left"),h=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,h?(i=u.position(),a=i.top,n=i.left):(a=parseFloat(o)||0,n=parseFloat(l)||0),J.isFunction(t)&&(t=t.call(e,r,s)),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+n),"using"in t?t.using.call(e,f):u.css(f)}},J.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){J.offset.setOffset(this,e,t)});var t,r,i=this[0],n={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,J.contains(t,i)?(typeof i.getBoundingClientRect!==Te&&(n=i.getBoundingClientRect()),r=k(o),{top:n.top+r.pageYOffset-t.clientTop,left:n.left+r.pageXOffset-t.clientLeft}):n},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===J.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),J.nodeName(e[0],"html")||(i=e.offset()),i.top+=J.css(e[0],"borderTopWidth",!0),i.left+=J.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-J.css(r,"marginTop",!0),left:t.left-i.left-J.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Ut;e&&!J.nodeName(e,"html")&&"static"===J.css(e,"position");)e=e.offsetParent;return e||Ut})}}),J.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,r){var i="pageYOffset"===r;J.fn[t]=function(n){return ge(this,function(t,n,o){var a=k(t);return void 0===o?a?a[r]:t[n]:void(a?a.scrollTo(i?e.pageXOffset:o,i?o:e.pageYOffset):t[n]=o)},t,n,arguments.length,null)}}),J.each(["top","left"],function(e,t){J.cssHooks[t]=_($.pixelPosition,function(e,r){return r?(r=b(e,t),He.test(r)?J(e).position()[t]+"px":r):void 0})}),J.each({Height:"height",Width:"width"},function(e,t){J.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){J.fn[i]=function(i,n){var o=arguments.length&&(r||"boolean"!=typeof i),a=r||(i===!0||n===!0?"margin":"border");return ge(this,function(t,r,i){var n;return J.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])):void 0===i?J.css(t,r,a):J.style(t,r,i,a)},t,o?i:void 0,o,null)}})}),J.fn.size=function(){return this.length},J.fn.andSelf=J.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return J});var zt=e.jQuery,Vt=e.$;return J.noConflict=function(t){return e.$===J&&(e.$=Vt),t&&e.jQuery===J&&(e.jQuery=zt),J},typeof t===Te&&(e.jQuery=e.$=J),J}),function(e,t,r){"use strict";var i=i||{};i.now=function(){return i.now||i.mozNow||i.msNow||i.oNow||i.webkitNow||function(){return(new Date).getTime()}}();var n=function(e,r,n){var o,a,s,l=n||0,h=0,c=!0;this.startAnimation=function(){c&&(s=i.now(),a=s+l,c=!1,u())},this.clearAnimation=function(){d(o),c=!0},this.updateFrameDelay=function(e){l=Number(e),a=i.now()+l},this.getFrameDelay=function(){return l},this.getFramerate=function(){return h};var u=function(){c||(f(i.now()),o=p(u,r))},f=function(t){var r=a-t;0>=r&&(r=l,a=t+l,t+1e3>s&&(h=Math.round(1e3/(t-s)),s=t,e()))},p=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,r){return t.setTimeout(e,1e3/60+l)}}(),d=function(){return t.cancelAnimationFrame||t.webkitCancelRequestAnimationFrame||clearTimeout}();return this};t.EasyAnimationFrame=t.EAF=n}(document,window),i=function(e,t){var r={CONST:{$document:$(document),$window:$(window)},init:function(){this.mouse=new t,this.mouse.offsetCentered=!0,this.viewport=new e({$el:$("#Viewport"),width:this.CONST.$window.width(),height:this.CONST.$window.height()}),this.viewport.createParticles(),this.Animator=new EAF($.proxy(this.animate,this)),this.Animator.startAnimation(),this.bindEvents(),this.setViewport()},animate:function(){this.viewport.camera.position.x+=.03*(this.mouse.x-this.viewport.camera.position.x),this.viewport.camera.position.y+=.03*(-this.mouse.y-this.viewport.camera.position.y),this.viewport.camera.lookAt(this.viewport.scene.position),this.viewport.update.call(this.viewport)},setViewport:function(){this.viewport.setSize(this.CONST.$window.width(),this.CONST.$window.height())},bindEvents:function(){this.CONST.$window.on("resize orientationchange",$.proxy(this.setViewport,this)),$(".otherLinks a").on("touchstart click",function(e){var t=$(this).attr("href");t&&(window.location.href=t)})},debug:function(){}};return r}(t,r);var o=o||{REVISION:"56"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},self.Int32Array=self.Int32Array||Array,self.Float32Array=self.Float32Array||Array,String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},o.extend=function(e,t){if(Object.keys)for(var r=Object.keys(t),i=0,n=r.length;n>i;i++){var o=r[i];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else{var a={}.hasOwnProperty;for(var o in t)a.call(t,o)&&(e[o]=t[o])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],r=0;r<t.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"];void 0===window.requestAnimationFrame&&(window.requestAnimationFrame=function(t){var r=Date.now(),i=Math.max(0,16-(r-e)),n=window.setTimeout(function(){t(r+i)},i);return e=r+i,n}),window.cancelAnimationFrame=window.cancelAnimationFrame||function(e){window.clearTimeout(e)}}(),o.CullFaceNone=0,o.CullFaceBack=1,o.CullFaceFront=2,o.CullFaceFrontBack=3,o.FrontFaceDirectionCW=0,o.FrontFaceDirectionCCW=1,o.BasicShadowMap=0,o.PCFShadowMap=1,o.PCFSoftShadowMap=2,o.FrontSide=0,o.BackSide=1,o.DoubleSide=2,o.NoShading=0,o.FlatShading=1,o.SmoothShading=2,o.NoColors=0,o.FaceColors=1,o.VertexColors=2,o.NoBlending=0,o.NormalBlending=1,o.AdditiveBlending=2,o.SubtractiveBlending=3,o.MultiplyBlending=4,o.CustomBlending=5,o.AddEquation=100,o.SubtractEquation=101,o.ReverseSubtractEquation=102,o.ZeroFactor=200,o.OneFactor=201,o.SrcColorFactor=202,o.OneMinusSrcColorFactor=203,o.SrcAlphaFactor=204,o.OneMinusSrcAlphaFactor=205,o.DstAlphaFactor=206,o.OneMinusDstAlphaFactor=207,o.DstColorFactor=208,o.OneMinusDstColorFactor=209,o.SrcAlphaSaturateFactor=210,o.MultiplyOperation=0,o.MixOperation=1,o.AddOperation=2,o.UVMapping=function(){},o.CubeReflectionMapping=function(){},o.CubeRefractionMapping=function(){},o.SphericalReflectionMapping=function(){},o.SphericalRefractionMapping=function(){},o.RepeatWrapping=1e3,o.ClampToEdgeWrapping=1001,o.MirroredRepeatWrapping=1002,o.NearestFilter=1003,o.NearestMipMapNearestFilter=1004,o.NearestMipMapLinearFilter=1005,o.LinearFilter=1006,o.LinearMipMapNearestFilter=1007,o.LinearMipMapLinearFilter=1008,o.UnsignedByteType=1009,o.ByteType=1010,o.ShortType=1011,o.UnsignedShortType=1012,o.IntType=1013,o.UnsignedIntType=1014,o.FloatType=1015,o.UnsignedShort4444Type=1016,o.UnsignedShort5551Type=1017,o.UnsignedShort565Type=1018,o.AlphaFormat=1019,o.RGBFormat=1020,o.RGBAFormat=1021,o.LuminanceFormat=1022,o.LuminanceAlphaFormat=1023,o.RGB_S3TC_DXT1_Format=2001,o.RGBA_S3TC_DXT1_Format=2002,o.RGBA_S3TC_DXT3_Format=2003,o.RGBA_S3TC_DXT5_Format=2004,o.Color=function(e){return void 0!==e&&this.set(e),this},o.extend(o.Color.prototype,{r:1,g:1,b:1,set:function(e){switch(typeof e){case"number":this.setHex(e);break;case"string":this.setStyle(e)}},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSV:function(e,t,r){return console.log("DEPRECATED: Color's .setHSV() will be removed. Use .setHSL( h, s, l ) instead."),this.setHSL(e,t*r/((e=(2-t)*r)<1?e:2-e),e/2)},setHSL:function(e,t,r){if(0===t)this.r=this.g=this.b=r;else{var i=function(e,t,r){return 0>r&&(r+=1),r>1&&(r-=1),1/6>r?e+6*(t-e)*r:.5>r?t:2/3>r?e+6*(t-e)*(2/3-r):e},n=.5>=r?r*(1+t):r+t-r*t,o=2*r-n;this.r=i(o,n,e+1/3),this.g=i(o,n,e),this.b=i(o,n,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+),(\d+),(\d+)\)$/i.test(e)){var t=/^rgb\((\d+),(\d+),(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%,(\d+)\%,(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(o.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,r=this.b;return this.r=e*e,this.g=t*t,this.b=r*r,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var e={h:0,s:0,l:0};return function(){var t,r,i=this.r,n=this.g,o=this.b,a=Math.max(i,n,o),s=Math.min(i,n,o),l=(s+a)/2;if(s===a)t=0,r=0;else{var h=a-s;switch(r=.5>=l?h/(a+s):h/(2-a-s),a){case i:t=(n-o)/h+(o>n?6:0);break;case n:t=(o-i)/h+2;break;case o:t=(i-n)/h+4}t/=6}return e.h=t,e.s=r,e.l=l,e}}(),getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=r,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},clone:function(){return(new o.Color).setRGB(this.r,this.g,this.b)}}),o.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},o.Quaternion=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},o.extend(o.Quaternion.prototype,{set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},setFromEuler:function(e,t){var r=Math.cos(e.x/2),i=Math.cos(e.y/2),n=Math.cos(e.z/2),o=Math.sin(e.x/2),a=Math.sin(e.y/2),s=Math.sin(e.z/2);return void 0===t||"XYZ"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n-o*a*s):"YXZ"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n+o*a*s):"ZXY"===t?(this.x=o*i*n-r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n-o*a*s):"ZYX"===t?(this.x=o*i*n-r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n+o*a*s):"YZX"===t?(this.x=o*i*n+r*a*s,this.y=r*a*n+o*i*s,this.z=r*i*s-o*a*n,this.w=r*i*n-o*a*s):"XZY"===t&&(this.x=o*i*n-r*a*s,this.y=r*a*n-o*i*s,this.z=r*i*s+o*a*n,this.w=r*i*n+o*a*s),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(r),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],n=r[4],o=r[8],a=r[1],s=r[5],l=r[9],h=r[2],c=r[6],u=r[10],f=i+s+u;return f>0?(t=.5/Math.sqrt(f+1),this.w=.25/t,this.x=(c-l)*t,this.y=(o-h)*t,this.z=(a-n)*t):i>s&&i>u?(t=2*Math.sqrt(1+i-s-u),this.w=(c-l)/t,this.x=.25*t,this.y=(n+a)/t,this.z=(o+h)/t):s>u?(t=2*Math.sqrt(1+s-i-u),this.w=(o-h)/t,this.x=(n+a)/t,this.y=.25*t,this.z=(l+c)/t):(t=2*Math.sqrt(1+u-i-s),this.w=(a-n)/t,this.x=(o+h)/t,this.y=(l+c)/t,this.z=.25*t),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=this.length();return 0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var r=e.x,i=e.y,n=e.z,o=e.w,a=t.x,s=t.y,l=t.z,h=t.w;return this.x=r*h+o*a+i*l-n*s,this.y=i*h+o*s+n*a-r*l,this.z=n*h+o*l+r*s-i*a,this.w=o*h-r*a-i*s-n*l,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var r=this.x,i=this.y,n=this.z,o=this.w,a=o*e.w+r*e.x+i*e.y+n*e.z;if(0>a?(this.w=-e.w,this.x=-e.x,this.y=-e.y,this.z=-e.z,a=-a):this.copy(e),a>=1)return this.w=o,this.x=r,this.y=i,this.z=n,this;var s=Math.acos(a),l=Math.sqrt(1-a*a);if(Math.abs(l)<.001)return this.w=.5*(o+this.w),this.x=.5*(r+this.x),this.y=.5*(i+this.y),this.z=.5*(n+this.z),this;var h=Math.sin((1-t)*s)/l,c=Math.sin(t*s)/l;return this.w=o*h+this.w*c,this.x=r*h+this.x*c,this.y=i*h+this.y*c,this.z=n*h+this.z*c,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},clone:function(){return new o.Quaternion(this.x,this.y,this.z,this.w)}}),o.Quaternion.slerp=function(e,t,r,i){return r.copy(e).slerp(t,i)},o.Vector2=function(e,t){this.x=e||0,this.y=t||0},o.extend(o.Vector2.prototype,{set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e):this.set(0,0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new o.Vector2(this.x,this.y)}}),o.Vector3=function(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0},o.extend(o.Vector3.prototype,{set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i+n[12],this.y=n[1]*t+n[5]*r+n[9]*i+n[13],this.z=n[2]*t+n[6]*r+n[10]*i+n[14],this},applyProjection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements,o=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*o,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*o,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*o,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,n=e.x,o=e.y,a=e.z,s=e.w,l=s*t+o*i-a*r,h=s*r+a*t-n*i,c=s*i+n*r-o*t,u=-n*t-o*r-a*i;return this.x=l*s+u*-n+h*-a-c*-o,this.y=h*s+u*-o+c*-n-l*-a,this.z=c*s+u*-a+l*-o-h*-n,this},applyEuler:function(){var e=new o.Quaternion;return function(t,r){var i=e.setFromEuler(t,r);return this.applyQuaternion(i),this}}(),applyAxisAngle:function(){var e=new o.Quaternion;return function(t,r){var i=e.setFromAxisAngle(t,r);return this.applyQuaternion(i),this}}(),transformDirection:function(e){var t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e):(this.x=0,this.y=0,this.z=0),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var r=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,
this.y=n*e.x-r*e.z,this.z=r*e.y-i*e.x,this},crossVectors:function(e,t){return this.x=e.y*t.z-e.z*t.y,this.y=e.z*t.x-e.x*t.z,this.z=e.x*t.y-e.y*t.x,this},projectOnVector:function(){var e=new o.Vector3;return function(t){e.copy(t).normalize();var r=this.dot(e);return this.copy(e).multiplyScalar(r)}}(),projectOnPlane:function(){var e=new o.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new o.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}(),angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(o.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},getPositionFromMatrix:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setEulerFromRotationMatrix:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.elements,n=i[0],o=i[4],a=i[8],s=i[1],l=i[5],h=i[9],c=i[2],u=i[6],f=i[10];return void 0===t||"XYZ"===t?(this.y=Math.asin(r(a)),Math.abs(a)<.99999?(this.x=Math.atan2(-h,f),this.z=Math.atan2(-o,n)):(this.x=Math.atan2(u,l),this.z=0)):"YXZ"===t?(this.x=Math.asin(-r(h)),Math.abs(h)<.99999?(this.y=Math.atan2(a,f),this.z=Math.atan2(s,l)):(this.y=Math.atan2(-c,n),this.z=0)):"ZXY"===t?(this.x=Math.asin(r(u)),Math.abs(u)<.99999?(this.y=Math.atan2(-c,f),this.z=Math.atan2(-o,l)):(this.y=0,this.z=Math.atan2(s,n))):"ZYX"===t?(this.y=Math.asin(-r(c)),Math.abs(c)<.99999?(this.x=Math.atan2(u,f),this.z=Math.atan2(s,n)):(this.x=0,this.z=Math.atan2(-o,l))):"YZX"===t?(this.z=Math.asin(r(s)),Math.abs(s)<.99999?(this.x=Math.atan2(-h,l),this.y=Math.atan2(-c,n)):(this.x=0,this.y=Math.atan2(a,f))):"XZY"===t&&(this.z=Math.asin(-r(o)),Math.abs(o)<.99999?(this.x=Math.atan2(u,l),this.y=Math.atan2(a,n)):(this.x=Math.atan2(-h,f),this.y=0)),this},setEulerFromQuaternion:function(e,t){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,n=e.y*e.y,o=e.z*e.z,a=e.w*e.w;return void 0===t||"XYZ"===t?(this.x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-i-n+o),this.y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+i-n-o)):"YXZ"===t?(this.x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-i-n+o),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-i+n-o)):"ZXY"===t?(this.x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this.y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-i-n+o),this.z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-i+n-o)):"ZYX"===t?(this.x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-i-n+o),this.y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this.z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+i-n-o)):"YZX"===t?(this.x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-i+n-o),this.y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+i-n-o),this.z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t&&(this.x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-i+n-o),this.y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+i-n-o),this.z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))),this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),r=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),i=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=r,this.z=i,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new o.Vector3(this.x,this.y,this.z)}}),o.Vector4=function(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=void 0!==i?i:1},o.extend(o.Vector4.prototype,{set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*n,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*n,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*n,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*n,this},divideScalar:function(e){return 0!==e?(this.x/=e,this.y/=e,this.z/=e,this.w/=e):(this.x=0,this.y=0,this.z=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,n,o=.01,a=.1,s=e.elements,l=s[0],h=s[4],c=s[8],u=s[1],f=s[5],p=s[9],d=s[2],m=s[6],g=s[10];if(Math.abs(h-u)<o&&Math.abs(c-d)<o&&Math.abs(p-m)<o){if(Math.abs(h+u)<a&&Math.abs(c+d)<a&&Math.abs(p+m)<a&&Math.abs(l+f+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(f+1)/2,x=(g+1)/2,w=(h+u)/4,b=(c+d)/4,_=(p+m)/4;return v>y&&v>x?o>v?(r=0,i=.707106781,n=.707106781):(r=Math.sqrt(v),i=w/r,n=b/r):y>x?o>y?(r=.707106781,i=0,n=.707106781):(i=Math.sqrt(y),r=w/i,n=_/i):o>x?(r=.707106781,i=.707106781,n=0):(n=Math.sqrt(x),r=b/n,i=_/n),this.set(r,i,n,t),this}var S=Math.sqrt((m-p)*(m-p)+(c-d)*(c-d)+(u-h)*(u-h));return Math.abs(S)<.001&&(S=1),this.x=(m-p)/S,this.y=(c-d)/S,this.z=(u-h)/S,this.w=Math.acos((l+f+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new o.Vector4(this.x,this.y,this.z,this.w)}}),o.Line3=function(e,t){this.start=void 0!==e?e:new o.Vector3,this.end=void 0!==t?t:new o.Vector3},o.extend(o.Line3.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new o.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new o.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var r=t||new o.Vector3;return this.delta(r).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new o.Vector3,t=new o.Vector3;return function(r,i){e.subVectors(r,this.start),t.subVectors(this.end,this.start);var n=t.dot(t),a=t.dot(e),s=a/n;return i&&(s=o.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t),n=r||new o.Vector3;return this.delta(n).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new o.Line3).copy(this)}}),o.Box2=function(e,t){this.min=void 0!==e?e:new o.Vector2(1/0,1/0),this.max=void 0!==t?t:new o.Vector2(-(1/0),-(1/0))},o.extend(o.Box2.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;i>r;r++)t=e[r],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new o.Vector2;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new o.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new o.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e){return new o.Vector2((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var r=t||new o.Vector2;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector2;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new o.Box2).copy(this)}}),o.Box3=function(e,t){this.min=void 0!==e?e:new o.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new o.Vector3(-(1/0),-(1/0),-(1/0))},o.extend(o.Box3.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var r=1,i=e.length;i>r;r++)t=e[r],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y),t.z<this.min.z?this.min.z=t.z:t.z>this.max.z&&(this.max.z=t.z)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new o.Vector3;return function(t,r){var i=e.copy(r).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-(1/0),this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new o.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new o.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e){return new o.Vector3((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var r=t||new o.Vector3;return r.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new o.Vector3;return function(t){var r=e.copy(t).clamp(this.min,this.max);return r.sub(t).length()}}(),getBoundingSphere:function(){var e=new o.Vector3;return function(t){var r=t||new o.Sphere;return r.center=this.center(),r.radius=.5*this.size(e).length(),r}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new o.Box3).copy(this)}}),o.Matrix3=function(e,t,r,i,n,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,r||0,i||0,void 0!==n?n:1,o||0,a||0,s||0,void 0!==l?l:1)},o.extend(o.Matrix3.prototype,{set:function(e,t,r,i,n,o,a,s,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=r,h[1]=i,h[4]=n,h[7]=o,h[2]=a,h[5]=s,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new o.Vector3;return function(t){for(var r=0,i=t.length;i>r;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyMatrix3(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],o=e[4],a=e[5],s=e[6],l=e[7],h=e[8];return t*o*h-t*a*l-r*n*h+r*a*s+i*n*l-i*o*s},getInverse:function(e,t){var r=e.elements,i=this.elements;i[0]=r[10]*r[5]-r[6]*r[9],i[1]=-r[10]*r[1]+r[2]*r[9],i[2]=r[6]*r[1]-r[2]*r[5],i[3]=-r[10]*r[4]+r[6]*r[8],i[4]=r[10]*r[0]-r[2]*r[8],i[5]=-r[6]*r[0]+r[2]*r[4],i[6]=r[9]*r[4]-r[5]*r[8],i[7]=-r[9]*r[0]+r[1]*r[8],i[8]=r[5]*r[0]-r[1]*r[4];var n=r[0]*i[0]+r[1]*i[3]+r[2]*i[6];if(0===n){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new o.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}}),o.Matrix4=function(e,t,r,i,n,o,a,s,l,h,c,u,f,p,d,m){var g=this.elements=new Float32Array(16);g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=r||0,g[12]=i||0,g[1]=n||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=h||0,g[10]=void 0!==c?c:1,g[14]=u||0,g[3]=f||0,g[7]=p||0,g[11]=d||0,g[15]=void 0!==m?m:1},o.extend(o.Matrix4.prototype,{set:function(e,t,r,i,n,o,a,s,l,h,c,u,f,p,d,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=f,g[7]=p,g[11]=d,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15]),this},setRotationFromEuler:function(e,t){var r=this.elements,i=e.x,n=e.y,o=e.z,a=Math.cos(i),s=Math.sin(i),l=Math.cos(n),h=Math.sin(n),c=Math.cos(o),u=Math.sin(o);if(void 0===t||"XYZ"===t){var f=a*c,p=a*u,d=s*c,m=s*u;r[0]=l*c,r[4]=-l*u,r[8]=h,r[1]=p+d*h,r[5]=f-m*h,r[9]=-s*l,r[2]=m-f*h,r[6]=d+p*h,r[10]=a*l}else if("YXZ"===t){var g=l*c,v=l*u,y=h*c,x=h*u;r[0]=g+x*s,r[4]=y*s-v,r[8]=a*h,r[1]=a*u,r[5]=a*c,r[9]=-s,r[2]=v*s-y,r[6]=x+g*s,r[10]=a*l}else if("ZXY"===t){var g=l*c,v=l*u,y=h*c,x=h*u;r[0]=g-x*s,r[4]=-a*u,r[8]=y+v*s,r[1]=v+y*s,r[5]=a*c,r[9]=x-g*s,r[2]=-a*h,r[6]=s,r[10]=a*l}else if("ZYX"===t){var f=a*c,p=a*u,d=s*c,m=s*u;r[0]=l*c,r[4]=d*h-p,r[8]=f*h+m,r[1]=l*u,r[5]=m*h+f,r[9]=p*h-d,r[2]=-h,r[6]=s*l,r[10]=a*l}else if("YZX"===t){var w=a*l,b=a*h,_=s*l,S=s*h;r[0]=l*c,r[4]=S-w*u,r[8]=_*u+b,r[1]=u,r[5]=a*c,r[9]=-s*c,r[2]=-h*c,r[6]=b*u+_,r[10]=w-S*u}else if("XZY"===t){var w=a*l,b=a*h,_=s*l,S=s*h;r[0]=l*c,r[4]=-u,r[8]=h*c,r[1]=w*u+S,r[5]=a*c,r[9]=b*u-_,r[2]=_*u-b,r[6]=s*c,r[10]=S*u+w}return this},setRotationFromQuaternion:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z,o=e.w,a=r+r,s=i+i,l=n+n,h=r*a,c=r*s,u=r*l,f=i*s,p=i*l,d=n*l,m=o*a,g=o*s,v=o*l;return t[0]=1-(f+d),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+d),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+f),this},lookAt:function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3;return function(i,n,o){var a=this.elements;return r.subVectors(i,n).normalize(),0===r.length()&&(r.z=1),e.crossVectors(o,r).normalize(),0===e.length()&&(r.x+=1e-4,e.crossVectors(o,r).normalize()),t.crossVectors(r,e),a[0]=e.x,a[4]=t.x,a[8]=r.x,a[1]=e.y,a[5]=t.y,a[9]=r.y,a[2]=e.z,a[6]=t.z,a[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,n=this.elements,o=r[0],a=r[4],s=r[8],l=r[12],h=r[1],c=r[5],u=r[9],f=r[13],p=r[2],d=r[6],m=r[10],g=r[14],v=r[3],y=r[7],x=r[11],w=r[15],b=i[0],_=i[4],S=i[8],M=i[12],T=i[1],C=i[5],A=i[9],E=i[13],L=i[2],P=i[6],R=i[10],D=i[14],F=i[3],N=i[7],U=i[11],z=i[15];return n[0]=o*b+a*T+s*L+l*F,n[4]=o*_+a*C+s*P+l*N,n[8]=o*S+a*A+s*R+l*U,n[12]=o*M+a*E+s*D+l*z,n[1]=h*b+c*T+u*L+f*F,n[5]=h*_+c*C+u*P+f*N,n[9]=h*S+c*A+u*R+f*U,n[13]=h*M+c*E+u*D+f*z,n[2]=p*b+d*T+m*L+g*F,n[6]=p*_+d*C+m*P+g*N,n[10]=p*S+d*A+m*R+g*U,n[14]=p*M+d*E+m*D+g*z,n[3]=v*b+y*T+x*L+w*F,n[7]=v*_+y*C+x*P+w*N,n[11]=v*S+y*A+x*R+w*U,n[15]=v*M+y*E+x*D+w*z,this},multiplyToArray:function(e,t,r){var i=this.elements;return this.multiplyMatrices(e,t),r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r[4]=i[4],r[5]=i[5],r[6]=i[6],r[7]=i[7],r[8]=i[8],r[9]=i[9],r[10]=i[10],r[11]=i[11],r[12]=i[12],r[13]=i[13],r[14]=i[14],r[15]=i[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new o.Vector3;return function(t){for(var r=0,i=t.length;i>r;r+=3)e.x=t[r],e.y=t[r+1],e.z=t[r+2],e.applyProjection(this),t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z;return t}}(),rotateAxis:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return e.x=r*t[0]+i*t[4]+n*t[8],e.y=r*t[1]+i*t[5]+n*t[9],e.z=r*t[2]+i*t[6]+n*t[10],e.normalize(),e},crossVector:function(e){var t=this.elements,r=new o.Vector4;return r.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w,r.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w,r.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w,r.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1,r},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],o=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],u=e[10],f=e[14],p=e[3],d=e[7],m=e[11],g=e[15];return p*(+n*s*c-i*l*c-n*a*u+r*l*u+i*a*f-r*s*f)+d*(+t*s*f-t*l*u+n*o*u-i*o*f+i*l*h-n*s*h)+m*(+t*l*c-t*a*f-n*o*c+r*o*f+n*a*h-r*l*h)+g*(-i*a*h-t*s*c+t*a*u+i*o*c-r*o*u+r*s*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e},getPosition:function(){var e=new o.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var r=this.elements,i=e.elements,n=i[0],o=i[4],a=i[8],s=i[12],l=i[1],h=i[5],c=i[9],u=i[13],f=i[2],p=i[6],d=i[10],m=i[14],g=i[3],v=i[7],y=i[11],x=i[15];r[0]=c*m*v-u*d*v+u*p*y-h*m*y-c*p*x+h*d*x,r[4]=s*d*v-a*m*v-s*p*y+o*m*y+a*p*x-o*d*x,r[8]=a*u*v-s*c*v+s*h*y-o*u*y-a*h*x+o*c*x,r[12]=s*c*p-a*u*p-s*h*d+o*u*d+a*h*m-o*c*m,r[1]=u*d*g-c*m*g-u*f*y+l*m*y+c*f*x-l*d*x,r[5]=a*m*g-s*d*g+s*f*y-n*m*y-a*f*x+n*d*x,r[9]=s*c*g-a*u*g-s*l*y+n*u*y+a*l*x-n*c*x,r[13]=a*u*f-s*c*f+s*l*d-n*u*d-a*l*m+n*c*m,r[2]=h*m*g-u*p*g+u*f*v-l*m*v-h*f*x+l*p*x,r[6]=s*p*g-o*m*g-s*f*v+n*m*v+o*f*x-n*p*x,r[10]=o*u*g-s*h*g+s*l*v-n*u*v-o*l*x+n*h*x,r[14]=s*h*f-o*u*f-s*l*p+n*u*p+o*l*m-n*h*m,r[3]=c*p*g-h*d*g-c*f*v+l*d*v+h*f*y-l*p*y,r[7]=o*d*g-a*p*g+a*f*v-n*d*v-o*f*y+n*p*y,r[11]=a*h*g-o*c*g-a*l*v+n*c*v+o*l*y-n*h*y,r[15]=o*c*f-a*h*f+a*l*p-n*c*p-o*l*d+n*h*d;var w=i[0]*r[0]+i[1]*r[4]+i[2]*r[8]+i[3]*r[12];if(0==w){var b="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(b);return console.warn(b),this.identity(),this}return this.multiplyScalar(1/w),this},compose:function(){var e=new o.Matrix4,t=new o.Matrix4;return function(r,i,n){var o=this.elements;return e.identity(),e.setRotationFromQuaternion(i),t.makeScale(n.x,n.y,n.z),this.multiplyMatrices(e,t),o[12]=r.x,o[13]=r.y,o[14]=r.z,this}}(),decompose:function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3,i=new o.Matrix4;return function(n,a,s){var l=this.elements;return e.set(l[0],l[1],l[2]),t.set(l[4],l[5],l[6]),r.set(l[8],l[9],l[10]),n=n instanceof o.Vector3?n:new o.Vector3,a=a instanceof o.Quaternion?a:new o.Quaternion,s=s instanceof o.Vector3?s:new o.Vector3,s.x=e.length(),s.y=t.length(),s.z=r.length(),n.x=l[12],n.y=l[13],n.z=l[14],i.copy(this),i.elements[0]/=s.x,i.elements[1]/=s.x,i.elements[2]/=s.x,i.elements[4]/=s.y,i.elements[5]/=s.y,i.elements[6]/=s.y,i.elements[8]/=s.z,i.elements[9]/=s.z,i.elements[10]/=s.z,a.setFromRotationMatrix(i),[n,a,s]}}(),extractPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractRotation:function(){var e=new o.Vector3;return function(t){var r=this.elements,i=t.elements,n=1/e.set(i[0],i[1],i[2]).length(),o=1/e.set(i[4],i[5],i[6]).length(),a=1/e.set(i[8],i[9],i[10]).length();return r[0]=i[0]*n,r[1]=i[1]*n,r[2]=i[2]*n,r[4]=i[4]*o,r[5]=i[5]*o,r[6]=i[6]*o,r[8]=i[8]*a,r[9]=i[9]*a,r[10]=i[10]*a,this}}(),translate:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[12]=t[0]*r+t[4]*i+t[8]*n+t[12],t[13]=t[1]*r+t[5]*i+t[9]*n+t[13],t[14]=t[2]*r+t[6]*i+t[10]*n+t[14],t[15]=t[3]*r+t[7]*i+t[11]*n+t[15],this},rotateX:function(e){var t=this.elements,r=t[4],i=t[5],n=t[6],o=t[7],a=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[4]=c*r+u*a,t[5]=c*i+u*s,t[6]=c*n+u*l,t[7]=c*o+u*h,t[8]=c*a-u*r,t[9]=c*s-u*i,t[10]=c*l-u*n,t[11]=c*h-u*o,this},rotateY:function(e){var t=this.elements,r=t[0],i=t[1],n=t[2],o=t[3],a=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),u=Math.sin(e);return t[0]=c*r-u*a,t[1]=c*i-u*s,t[2]=c*n-u*l,t[3]=c*o-u*h,t[8]=c*a+u*r,t[9]=c*s+u*i,t[10]=c*l+u*n,t[11]=c*h+u*o,this},rotateZ:function(e){var t=this.elements,r=t[0],i=t[1],n=t[2],o=t[3],a=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),u=Math.sin(e);return t[0]=c*r+u*a,t[1]=c*i+u*s,t[2]=c*n+u*l,t[3]=c*o+u*h,t[4]=c*a-u*r,t[5]=c*s-u*i,t[6]=c*l-u*n,t[7]=c*h-u*o,this},rotateByAxis:function(e,t){var r=this.elements;if(1===e.x&&0===e.y&&0===e.z)return this.rotateX(t);if(0===e.x&&1===e.y&&0===e.z)return this.rotateY(t);if(0===e.x&&0===e.y&&1===e.z)return this.rotateZ(t);var i=e.x,n=e.y,o=e.z,a=Math.sqrt(i*i+n*n+o*o);i/=a,n/=a,o/=a;var s=i*i,l=n*n,h=o*o,c=Math.cos(t),u=Math.sin(t),f=1-c,p=i*n*f,d=i*o*f,m=n*o*f,g=i*u,v=n*u,y=o*u,x=s+(1-s)*c,w=p+y,b=d-v,_=p-y,S=l+(1-l)*c,M=m+g,T=d+v,C=m-g,A=h+(1-h)*c,E=r[0],L=r[1],P=r[2],R=r[3],D=r[4],F=r[5],N=r[6],U=r[7],z=r[8],V=r[9],B=r[10],O=r[11];return r[0]=x*E+w*D+b*z,r[1]=x*L+w*F+b*V,r[2]=x*P+w*N+b*B,r[3]=x*R+w*U+b*O,r[4]=_*E+S*D+M*z,r[5]=_*L+S*F+M*V,r[6]=_*P+S*N+M*B,r[7]=_*R+S*U+M*O,r[8]=T*E+C*D+A*z,r[9]=T*L+C*F+A*V,r[10]=T*P+C*N+A*B,r[11]=T*R+C*U+A*O,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(r,i)))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),n=1-r,o=e.x,a=e.y,s=e.z,l=n*o,h=n*a;return this.set(l*o+r,l*a-i*s,l*s+i*a,0,l*a+i*s,h*a+r,h*s-i*o,0,l*s-i*a,h*s+i*o,n*s*s+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeFrustum:function(e,t,r,i,n,o){var a=this.elements,s=2*n/(t-e),l=2*n/(i-r),h=(t+e)/(t-e),c=(i+r)/(i-r),u=-(o+n)/(o-n),f=-2*o*n/(o-n);return a[0]=s,a[4]=0,a[8]=h,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(e,t,r,i){var n=r*Math.tan(o.Math.degToRad(.5*e)),a=-n,s=a*t,l=n*t;return this.makeFrustum(s,l,a,n,r,i)},makeOrthographic:function(e,t,r,i,n,o){var a=this.elements,s=t-e,l=r-i,h=o-n,c=(t+e)/s,u=(r+i)/l,f=(o+n)/h;return a[0]=2/s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2/l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2/h,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},clone:function(){var e=this.elements;return new o.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}}),o.Ray=function(e,t){this.origin=void 0!==e?e:new o.Vector3,this.direction=void 0!==t?t:new o.Vector3},o.extend(o.Ray.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var r=t||new o.Vector3;return r.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new o.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var r=t||new o.Vector3;r.subVectors(e,this.origin);var i=r.dot(this.direction);return r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var e=new o.Vector3;return function(t){var r=e.subVectors(t,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(r).add(this.origin),e.distanceTo(t)}}(),isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.normal.dot(this.direction);return 0!=t?!0:0==e.distanceToPoint(this.origin)?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);{if(0!=t){var r=-(this.origin.dot(e.normal)+e.constant)/t;return r}if(0==e.distanceToPoint(this.origin))return 0}},intersectPlane:function(e,t){var r=this.distanceToPlane(e);if(void 0!==r)return this.at(r,t)},applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new o.Ray).copy(this)}}),o.Sphere=function(e,t){this.center=void 0!==e?e:new o.Vector3,this.radius=void 0!==t?t:0},o.extend(o.Sphere.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromCenterAndPoints:function(e,t){for(var r=0,i=0,n=t.length;n>i;i++){var o=e.distanceToSquared(t[i]);r=Math.max(r,o)}return this.center=e,this.radius=Math.sqrt(r),this},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var r=this.center.distanceToSquared(e),i=t||new o.Vector3;return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new o.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new o.Sphere).copy(this)}}),o.Frustum=function(e,t,r,i,n,a){this.planes=[void 0!==e?e:new o.Plane,void 0!==t?t:new o.Plane,void 0!==r?r:new o.Plane,void 0!==i?i:new o.Plane,void 0!==n?n:new o.Plane,void 0!==a?a:new o.Plane];
},o.extend(o.Frustum.prototype,{set:function(e,t,r,i,n,o){var a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(o),this},copy:function(e){for(var t=this.planes,r=0;6>r;r++)t[r].copy(e.planes[r]);return this},setFromMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],n=r[1],o=r[2],a=r[3],s=r[4],l=r[5],h=r[6],c=r[7],u=r[8],f=r[9],p=r[10],d=r[11],m=r[12],g=r[13],v=r[14],y=r[15];return t[0].setComponents(a-i,c-s,d-u,y-m).normalize(),t[1].setComponents(a+i,c+s,d+u,y+m).normalize(),t[2].setComponents(a+n,c+l,d+f,y+g).normalize(),t[3].setComponents(a-n,c-l,d-f,y-g).normalize(),t[4].setComponents(a-o,c-h,d-p,y-v).normalize(),t[5].setComponents(a+o,c+h,d+p,y+v).normalize(),this},intersectsObject:function(){var e=new o.Vector3;return function(t){var r=t.matrixWorld,i=this.planes,n=-t.geometry.boundingSphere.radius*r.getMaxScaleOnAxis();e.getPositionFromMatrix(r);for(var o=0;6>o;o++){var a=i[o].distanceToPoint(e);if(n>a)return!1}return!0}}(),intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,n=0;6>n;n++){var o=t[n].distanceToPoint(r);if(i>o)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;6>r;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new o.Frustum).copy(this)}}),o.Plane=function(e,t){this.normal=void 0!==e?e:new o.Vector3(1,0,0),this.constant=void 0!==t?t:0},o.extend(o.Plane.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new o.Vector3,t=new o.Vector3;return function(r,i,n){var o=e.subVectors(n,i).cross(t.subVectors(r,i)).normalize();return this.setFromNormalAndCoplanarPoint(o,r),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var r=this.distanceToPoint(e),i=t||new o.Vector3;return i.copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return 0>t&&r>0||0>r&&t>0},intersectLine:function(){var e=new o.Vector3;return function(t,r){var i=r||new o.Vector3,n=t.delta(e),a=this.normal.dot(n);if(0!=a){var s=-(t.start.dot(this.normal)+this.constant)/a;if(!(0>s||s>1))return i.copy(n).multiplyScalar(s).add(t.start)}else if(0==this.distanceToPoint(t.start))return i.copy(t.start)}}(),coplanarPoint:function(e){var t=e||new o.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new o.Vector3,t=new o.Vector3;return function(r,i){i=i||(new o.Matrix3).getInverse(r).transpose();var n=e.copy(this.normal).applyMatrix3(i),a=this.coplanarPoint(t);return a.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(n,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new o.Plane).copy(this)}}),o.Math={clamp:function(e,t,r){return t>e?t:e>r?r:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,r,i,n){return i+(e-t)*(n-i)/(r-t)},smoothstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*(3-2*e))},smootherstep:function(e,t,r){return t>=e?0:e>=r?1:(e=(e-t)/(r-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},o.Spline=function(e){function t(e,t,r,i,n,o,a){var s=.5*(r-e),l=.5*(i-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*n+t}this.points=e;var r,i,n,a,s,l,h,c,u,f=[],p={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return r=(this.points.length-1)*e,i=Math.floor(r),n=r-i,f[0]=0===i?i:i-1,f[1]=i,f[2]=i>this.points.length-2?this.points.length-1:i+1,f[3]=i>this.points.length-3?this.points.length-1:i+2,l=this.points[f[0]],h=this.points[f[1]],c=this.points[f[2]],u=this.points[f[3]],a=n*n,s=n*a,p.x=t(l.x,h.x,c.x,u.x,n,a,s),p.y=t(l.y,h.y,c.y,u.y,n,a,s),p.z=t(l.z,h.z,c.z,u.z,n,a,s),p},this.getControlPointsArray=function(){var e,t,r=this.points.length,i=[];for(e=0;r>e;e++)t=this.points[e],i[e]=[t.x,t.y,t.z];return i},this.getLength=function(e){var t,r,i,n,a=0,s=0,l=0,h=new o.Vector3,c=new o.Vector3,u=[],f=0;for(u[0]=0,e||(e=100),i=this.points.length*e,h.copy(this.points[0]),t=1;i>t;t++)r=t/i,n=this.getPoint(r),c.copy(n),f+=c.distanceTo(h),h.copy(n),a=(this.points.length-1)*r,s=Math.floor(a),s!=l&&(u[s]=f,l=s);return u[u.length]=f,{chunks:u,total:f}},this.reparametrizeByArcLength=function(e){var t,r,i,n,a,s,l,h,c=[],u=new o.Vector3,f=this.getLength();for(c.push(u.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=f.chunks[t]-f.chunks[t-1],l=Math.ceil(e*s/f.total),n=(t-1)/(this.points.length-1),a=t/(this.points.length-1),r=1;l-1>r;r++)i=n+r*(1/l)*(a-n),h=this.getPoint(i),c.push(u.copy(h).clone());c.push(u.copy(this.points[t]).clone())}this.points=c}},o.Triangle=function(e,t,r){this.a=void 0!==e?e:new o.Vector3,this.b=void 0!==t?t:new o.Vector3,this.c=void 0!==r?r:new o.Vector3},o.Triangle.normal=function(){var e=new o.Vector3;return function(t,r,i,n){var a=n||new o.Vector3;a.subVectors(i,r),e.subVectors(t,r),a.cross(e);var s=a.lengthSq();return s>0?a.multiplyScalar(1/Math.sqrt(s)):a.set(0,0,0)}}(),o.Triangle.barycoordFromPoint=function(){var e=new o.Vector3,t=new o.Vector3,r=new o.Vector3;return function(i,n,a,s,l){e.subVectors(s,n),t.subVectors(a,n),r.subVectors(i,n);var h=e.dot(e),c=e.dot(t),u=e.dot(r),f=t.dot(t),p=t.dot(r),d=h*f-c*c,m=l||new o.Vector3;if(0==d)return m.set(-2,-1,-1);var g=1/d,v=(f*u-c*p)*g,y=(h*p-c*u)*g;return m.set(1-v-y,y,v)}}(),o.Triangle.containsPoint=function(){var e=new o.Vector3;return function(t,r,i,n){var a=o.Triangle.barycoordFromPoint(t,r,i,n,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}(),o.extend(o.Triangle.prototype,{constructor:o.Triangle,set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new o.Vector3,t=new o.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new o.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return o.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new o.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return o.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return o.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new o.Triangle).copy(this)}}),o.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},o.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new o.Vector2(e,t)},o.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},o.extend(o.Clock.prototype,{start:function(){this.startTime=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}}),o.EventDispatcher=function(){var e={};this.addEventListener=function(t,r){void 0===e[t]&&(e[t]=[]),-1===e[t].indexOf(r)&&e[t].push(r)},this.removeEventListener=function(t,r){var i=e[t].indexOf(r);-1!==i&&e[t].splice(i,1)},this.dispatchEvent=function(t){var r=e[t.type];if(void 0!==r){t.target=this;for(var i=0,n=r.length;n>i;i++)r[i].call(this,t)}}},function(e){e.Raycaster=function(t,r,i,n){this.ray=new e.Ray(t,r),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=n||1/0};var t=new e.Sphere,r=new e.Ray,i=new e.Plane,n=new e.Vector3,o=new e.Vector3,a=new e.Matrix4,s=function(e,t){return e.distance-t.distance},l=function(s,l,h){if(s instanceof e.Particle){o.getPositionFromMatrix(s.matrixWorld);var c=l.ray.distanceToPoint(o);if(c>s.scale.x)return h;h.push({distance:c,point:s.position,face:null,object:s})}else if(s instanceof e.Mesh){if(o.getPositionFromMatrix(s.matrixWorld),t.set(o,s.geometry.boundingSphere.radius*s.matrixWorld.getMaxScaleOnAxis()),!l.ray.isIntersectionSphere(t))return h;var u,f,p,d,m=s.geometry,g=m.vertices,v=s.material instanceof e.MeshFaceMaterial,y=v===!0?s.material.materials:null,x=s.material.side,w=l.precision;s.matrixRotationWorld.extractRotation(s.matrixWorld),a.getInverse(s.matrixWorld),r.copy(l.ray).applyMatrix4(a);for(var b=0,_=m.faces.length;_>b;b++){var S=m.faces[b],M=v===!0?y[S.materialIndex]:s.material;if(void 0!==M){i.setFromNormalAndCoplanarPoint(S.normal,g[S.a]);var T=r.distanceToPlane(i);if(!(Math.abs(T)<w||0>T)){if(x=M.side,x!==e.DoubleSide){var C=r.direction.dot(i.normal);if(!(x===e.FrontSide?0>C:C>0))continue}if(!(T<l.near||T>l.far)){if(n=r.at(T,n),S instanceof e.Face3){if(u=g[S.a],f=g[S.b],p=g[S.c],!e.Triangle.containsPoint(n,u,f,p))continue}else{if(!(S instanceof e.Face4))throw Error("face type not supported");if(u=g[S.a],f=g[S.b],p=g[S.c],d=g[S.d],!e.Triangle.containsPoint(n,u,f,d)&&!e.Triangle.containsPoint(n,f,p,d))continue}h.push({distance:T,point:l.ray.at(T),face:S,faceIndex:b,object:s})}}}}}},h=function(e,t,r){for(var i=e.getDescendants(),n=0,o=i.length;o>n;n++)l(i[n],t,r)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t),this.ray.direction.length()>0&&this.ray.direction.normalize()},e.Raycaster.prototype.intersectObject=function(e,t){var r=[];return t===!0&&h(e,this,r),l(e,this,r),r.sort(s),r},e.Raycaster.prototype.intersectObjects=function(e,t){for(var r=[],i=0,n=e.length;n>i;i++)l(e[i],this,r),t===!0&&h(e[i],this,r);return r.sort(s),r}}(o),o.Object3D=function(){this.id=o.Object3DIdCount++,this.name="",this.properties={},this.parent=void 0,this.children=[],this.up=new o.Vector3(0,1,0),this.position=new o.Vector3,this.rotation=new o.Vector3,this.eulerOrder=o.Object3D.defaultEulerOrder,this.scale=new o.Vector3(1,1,1),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new o.Matrix4,this.matrixWorld=new o.Matrix4,this.matrixRotationWorld=new o.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.quaternion=new o.Quaternion,this.useQuaternion=!1,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this._vector=new o.Vector3},o.Object3D.prototype={constructor:o.Object3D,applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.scale.getScaleFromMatrix(this.matrix);var t=(new o.Matrix4).extractRotation(this.matrix);this.rotation.setEulerFromRotationMatrix(t,this.eulerOrder),this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t),this.position.add(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(o.Object3D.__m1.getInverse(this.matrixWorld))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},add:function(e){if(e===this)return void console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");if(e instanceof o.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof o.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,this.children.splice(t,1);for(var r=this;void 0!==r.parent;)r=r.parent;void 0!==r&&r instanceof o.Scene&&r.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,r=this.children.length;r>t;t++)this.children[t].traverse(e)},getChildByName:function(e,t){for(var r=0,i=this.children.length;i>r;r++){var n=this.children[r];if(n.name===e)return n;if(t===!0&&(n=n.getChildByName(e,t),void 0!==n))return n}},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,r=this.children.length;r>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(1!==this.scale.x||1!==this.scale.y||1!==this.scale.z)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e){void 0===e&&(e=new o.Object3D),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.rotation instanceof o.Vector3&&e.rotation.copy(this.rotation),e.eulerOrder=this.eulerOrder,e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixRotationWorld.copy(this.matrixRotationWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.quaternion.copy(this.quaternion),e.useQuaternion=this.useQuaternion,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled;for(var t=0;t<this.children.length;t++){var r=this.children[t];e.add(r.clone())}return e}},o.Object3D.__m1=new o.Matrix4,o.Object3D.defaultEulerOrder="XYZ",o.Object3DIdCount=0,o.Projector=function(){function e(){if(c===_){var e=new o.RenderableObject;return b.push(e),_++,c++,e}return b[c++]}function t(){if(f===M){var e=new o.RenderableVertex;return S.push(e),M++,f++,e}return S[f++]}function r(){if(d===C){var e=new o.RenderableFace3;return T.push(e),C++,d++,e}return T[d++]}function i(){if(m===E){var e=new o.RenderableFace4;return A.push(e),E++,m++,e}return A[m++]}function n(){if(v===P){var e=new o.RenderableLine;return L.push(e),P++,v++,e}return L[v++]}function a(){if(x===D){var e=new o.RenderableParticle;return R.push(e),D++,x++,e}return R[x++]}function s(e,t){return t.z-e.z}function l(e,t){var r=0,i=1,n=e.z+e.w,o=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;return n>=0&&o>=0&&a>=0&&s>=0?!0:0>n&&0>o||0>a&&0>s?!1:(0>n?r=Math.max(r,n/(n-o)):0>o&&(i=Math.min(i,n/(n-o))),0>a?r=Math.max(r,a/(a-s)):0>s&&(i=Math.min(i,a/(a-s))),r>i?!1:(e.lerp(t,r),t.lerp(e,1-i),!0))}var h,c,u,f,p,d,m,g,v,y,x,w,b=[],_=0,S=[],M=0,T=[],C=0,A=[],E=0,L=[],P=0,R=[],D=0,F={objects:[],sprites:[],lights:[],elements:[]},N=new o.Vector3,U=new o.Vector4,z=new o.Box3(new o.Vector3(-1,-1,-1),new o.Vector3(1,1,1)),V=new o.Box3,B=new Array(3),O=new Array(4),I=new o.Matrix4,k=new o.Matrix4,H=new o.Matrix4,G=new o.Matrix3,j=new o.Matrix3,W=new o.Vector3,X=new o.Frustum,q=new o.Vector4,Y=new o.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),k.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(k)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),k.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(k)},this.pickingRay=function(e,t){e.z=-1;var r=new o.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(r,t),r.sub(e).normalize(),new o.Raycaster(e,r)};var K=function(t,r){c=0,F.objects.length=0,F.sprites.length=0,F.lights.length=0;var i=function(t){for(var r=0,n=t.children.length;n>r;r++){var a=t.children[r];a.visible!==!1&&(a instanceof o.Light?F.lights.push(a):a instanceof o.Mesh||a instanceof o.Line?(a.frustumCulled===!1||X.intersectsObject(a)===!0)&&(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(N.getPositionFromMatrix(a.matrixWorld),N.applyProjection(k),h.z=N.z),F.objects.push(h)):a instanceof o.Sprite||a instanceof o.Particle?(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(N.getPositionFromMatrix(a.matrixWorld),N.applyProjection(k),h.z=N.z),F.sprites.push(h)):(h=e(),h.object=a,null!==a.renderDepth?h.z=a.renderDepth:(N.getPositionFromMatrix(a.matrixWorld),N.applyProjection(k),h.z=N.z),F.objects.push(h)),i(a))}};return i(t),r===!0&&F.objects.sort(s),F};this.projectScene=function(e,h,c,b){var _,M,T,C,A,E,L,P,R,D,N,$,Q,Z,J,ee,te,re,ie,ne,oe,ae,se,le,he,ce,ue=!1;for(d=0,m=0,v=0,x=0,F.elements.length=0,e.updateMatrixWorld(),void 0===h.parent&&h.updateMatrixWorld(),I.copy(h.matrixWorldInverse.getInverse(h.matrixWorld)),k.multiplyMatrices(h.projectionMatrix,I),j.getInverse(I),j.transpose(),X.setFromMatrix(k),F=K(e,c),_=0,M=F.objects.length;M>_;_++)if(Q=F.objects[_].object,w=Q.matrixWorld,f=0,Q instanceof o.Mesh){for(Z=Q.geometry,J=Z.vertices,ee=Z.faces,ie=Z.faceVertexUvs,G.getInverse(w),G.transpose(),he=Q.material instanceof o.MeshFaceMaterial,ce=he===!0?Q.material:null,T=0,C=J.length;C>T;T++)u=t(),u.positionWorld.copy(J[T]).applyMatrix4(w),u.positionScreen.copy(u.positionWorld).applyMatrix4(k),u.positionScreen.x/=u.positionScreen.w,u.positionScreen.y/=u.positionScreen.w,u.positionScreen.z/=u.positionScreen.w,u.visible=!(u.positionScreen.x<-1||u.positionScreen.x>1||u.positionScreen.y<-1||u.positionScreen.y>1||u.positionScreen.z<-1||u.positionScreen.z>1);for(A=0,E=ee.length;E>A;A++){te=ee[A];var fe=he===!0?ce.materials[te.materialIndex]:Q.material;if(void 0!==fe){var pe=fe.side;if(te instanceof o.Face3){if(oe=S[te.a],ae=S[te.b],se=S[te.c],B[0]=oe.positionScreen,B[1]=ae.positionScreen,B[2]=se.positionScreen,oe.visible!==!0&&ae.visible!==!0&&se.visible!==!0&&!z.isIntersectionBox(V.setFromPoints(B)))continue;if(ue=(se.positionScreen.x-oe.positionScreen.x)*(ae.positionScreen.y-oe.positionScreen.y)-(se.positionScreen.y-oe.positionScreen.y)*(ae.positionScreen.x-oe.positionScreen.x)<0,pe!==o.DoubleSide&&ue!==(pe===o.FrontSide))continue;p=r(),p.v1.copy(oe),p.v2.copy(ae),p.v3.copy(se)}else if(te instanceof o.Face4){if(oe=S[te.a],ae=S[te.b],se=S[te.c],le=S[te.d],O[0]=oe.positionScreen,O[1]=ae.positionScreen,O[2]=se.positionScreen,O[3]=le.positionScreen,oe.visible!==!0&&ae.visible!==!0&&se.visible!==!0&&le.visible!==!0&&!z.isIntersectionBox(V.setFromPoints(O)))continue;if(ue=(le.positionScreen.x-oe.positionScreen.x)*(ae.positionScreen.y-oe.positionScreen.y)-(le.positionScreen.y-oe.positionScreen.y)*(ae.positionScreen.x-oe.positionScreen.x)<0||(ae.positionScreen.x-se.positionScreen.x)*(le.positionScreen.y-se.positionScreen.y)-(ae.positionScreen.y-se.positionScreen.y)*(le.positionScreen.x-se.positionScreen.x)<0,pe!==o.DoubleSide&&ue!==(pe===o.FrontSide))continue;p=i(),p.v1.copy(oe),p.v2.copy(ae),p.v3.copy(se),p.v4.copy(le)}for(p.normalModel.copy(te.normal),ue!==!1||pe!==o.BackSide&&pe!==o.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(G).normalize(),p.normalModelView.copy(p.normalModel).applyMatrix3(j),p.centroidModel.copy(te.centroid).applyMatrix4(w),re=te.vertexNormals,L=0,P=re.length;P>L;L++){var de=p.vertexNormalsModel[L];de.copy(re[L]),ue!==!1||pe!==o.BackSide&&pe!==o.DoubleSide||de.negate(),de.applyMatrix3(G).normalize();var me=p.vertexNormalsModelView[L];me.copy(de).applyMatrix3(j)}for(p.vertexNormalsLength=re.length,R=0,D=ie.length;D>R;R++)if(ne=ie[R][A],void 0!==ne)for(N=0,$=ne.length;$>N;N++)p.uvs[R][N]=ne[N];p.color=te.color,p.material=fe,W.copy(p.centroidModel).applyProjection(k),p.z=W.z,F.elements.push(p)}}}else if(Q instanceof o.Line){H.multiplyMatrices(k,w),J=Q.geometry.vertices,oe=t(),oe.positionScreen.copy(J[0]).applyMatrix4(H);var ge=Q.type===o.LinePieces?2:1;for(T=1,C=J.length;C>T;T++)oe=t(),oe.positionScreen.copy(J[T]).applyMatrix4(H),(T+1)%ge>0||(ae=S[f-2],q.copy(oe.positionScreen),Y.copy(ae.positionScreen),l(q,Y)===!0&&(q.multiplyScalar(1/q.w),Y.multiplyScalar(1/Y.w),g=n(),g.v1.positionScreen.copy(q),g.v2.positionScreen.copy(Y),g.z=Math.max(q.z,Y.z),g.material=Q.material,F.elements.push(g)))}for(_=0,M=F.sprites.length;M>_;_++)Q=F.sprites[_].object,w=Q.matrixWorld,Q instanceof o.Particle&&(U.set(w.elements[12],w.elements[13],w.elements[14],1),U.applyMatrix4(k),U.z/=U.w,U.z>0&&U.z<1&&(y=a(),y.object=Q,y.x=U.x/U.w,y.y=U.y/U.w,y.z=U.z,y.rotation=Q.rotation.z,y.scale.x=Q.scale.x*Math.abs(y.x-(U.x+h.projectionMatrix.elements[0])/(U.w+h.projectionMatrix.elements[12])),y.scale.y=Q.scale.y*Math.abs(y.y-(U.y+h.projectionMatrix.elements[5])/(U.w+h.projectionMatrix.elements[13])),y.material=Q.material,F.elements.push(y)));return b===!0&&F.elements.sort(s),F}},o.Face3=function(e,t,r,i,n,a){this.a=e,this.b=t,this.c=r,this.normal=i instanceof o.Vector3?i:new o.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=n instanceof o.Color?n:new o.Color,this.vertexColors=n instanceof Array?n:[],this.vertexTangents=[],this.materialIndex=void 0!==a?a:0,this.centroid=new o.Vector3},o.Face3.prototype={constructor:o.Face3,clone:function(){var e=new o.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},o.Face4=function(e,t,r,i,n,a,s){this.a=e,this.b=t,this.c=r,this.d=i,this.normal=n instanceof o.Vector3?n:new o.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=a instanceof o.Color?a:new o.Color,this.vertexColors=a instanceof Array?a:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new o.Vector3},o.Face4.prototype={constructor:o.Face4,clone:function(){var e=new o.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,r;for(t=0,r=this.vertexNormals.length;r>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,r=this.vertexColors.length;r>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,r=this.vertexTangents.length;r>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},o.Geometry=function(){o.EventDispatcher.call(this),this.id=o.GeometryIdCount++,this.name="",this.vertices=[],this.colors=[],this.normals=[],this.faces=[],this.faceUvs=[[]],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},o.Geometry.prototype={constructor:o.Geometry,applyMatrix:function(e){for(var t=(new o.Matrix3).getInverse(e).transpose(),r=0,i=this.vertices.length;i>r;r++){var n=this.vertices[r];n.applyMatrix4(e)}for(var r=0,i=this.faces.length;i>r;r++){var a=this.faces[r];a.normal.applyMatrix3(t).normalize();for(var s=0,l=a.vertexNormals.length;l>s;s++)a.vertexNormals[s].applyMatrix3(t).normalize();a.centroid.applyMatrix4(e)}},computeCentroids:function(){var e,t,r;for(e=0,t=this.faces.length;t>e;e++)r=this.faces[e],r.centroid.set(0,0,0),r instanceof o.Face3?(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.divideScalar(3)):r instanceof o.Face4&&(r.centroid.add(this.vertices[r.a]),r.centroid.add(this.vertices[r.b]),r.centroid.add(this.vertices[r.c]),r.centroid.add(this.vertices[r.d]),r.centroid.divideScalar(4))},computeFaceNormals:function(){for(var e=new o.Vector3,t=new o.Vector3,r=0,i=this.faces.length;i>r;r++){var n=this.faces[r],a=this.vertices[n.a],s=this.vertices[n.b],l=this.vertices[n.c];e.subVectors(l,s),t.subVectors(a,s),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,n,a,s;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),s=this.__tmpVertices,t=0,r=this.vertices.length;r>t;t++)s[t]=new o.Vector3;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],a instanceof o.Face3?a.vertexNormals=[new o.Vector3,new o.Vector3,new o.Vector3]:a instanceof o.Face4&&(a.vertexNormals=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3])}else for(s=this.__tmpVertices,t=0,r=this.vertices.length;r>t;t++)s[t].set(0,0,0);if(e){var l,h,c,u,f=new o.Vector3,p=new o.Vector3,d=new o.Vector3,m=new o.Vector3,g=new o.Vector3;for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],a instanceof o.Face3?(l=this.vertices[a.a],h=this.vertices[a.b],c=this.vertices[a.c],f.subVectors(c,h),p.subVectors(l,h),f.cross(p),s[a.a].add(f),s[a.b].add(f),s[a.c].add(f)):a instanceof o.Face4&&(l=this.vertices[a.a],h=this.vertices[a.b],c=this.vertices[a.c],u=this.vertices[a.d],d.subVectors(u,h),p.subVectors(l,h),d.cross(p),s[a.a].add(d),s[a.b].add(d),s[a.d].add(d),m.subVectors(u,c),g.subVectors(h,c),m.cross(g),s[a.b].add(m),s[a.c].add(m),s[a.d].add(m))}else for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],a instanceof o.Face3?(s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal)):a instanceof o.Face4&&(s[a.a].add(a.normal),s[a.b].add(a.normal),s[a.c].add(a.normal),s[a.d].add(a.normal));for(t=0,r=this.vertices.length;r>t;t++)s[t].normalize();for(i=0,n=this.faces.length;n>i;i++)a=this.faces[i],a instanceof o.Face3?(a.vertexNormals[0].copy(s[a.a]),a.vertexNormals[1].copy(s[a.b]),a.vertexNormals[2].copy(s[a.c])):a instanceof o.Face4&&(a.vertexNormals[0].copy(s[a.a]),a.vertexNormals[1].copy(s[a.b]),a.vertexNormals[2].copy(s[a.c]),a.vertexNormals[3].copy(s[a.d]))},computeMorphNormals:function(){var e,t,r,i,n;for(r=0,i=this.faces.length;i>r;r++)for(n=this.faces[r],n.__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;t>e;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var a=new o.Geometry;for(a.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,l,h=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],s=new o.Vector3,l=n instanceof o.Face3?{a:new o.Vector3,b:new o.Vector3,c:new o.Vector3}:{a:new o.Vector3,b:new o.Vector3,c:new o.Vector3,d:new o.Vector3},h.push(s),c.push(l)}var u=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var s,l;for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],s=u.faceNormals[r],l=u.vertexNormals[r],s.copy(n.normal),n instanceof o.Face3?(l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2])):(l.a.copy(n.vertexNormals[0]),l.b.copy(n.vertexNormals[1]),l.c.copy(n.vertexNormals[2]),l.d.copy(n.vertexNormals[3]))}for(r=0,i=this.faces.length;i>r;r++)n=this.faces[r],n.normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeTangents:function(){function e(e,t,r,i,n,o,a){c=e.vertices[t],u=e.vertices[r],f=e.vertices[i],p=h[n],d=h[o],m=h[a],g=u.x-c.x,v=f.x-c.x,y=u.y-c.y,x=f.y-c.y,w=u.z-c.z,b=f.z-c.z,_=d.x-p.x,S=m.x-p.x,M=d.y-p.y,T=m.y-p.y,C=1/(_*T-S*M),D.set((T*g-M*v)*C,(T*y-M*x)*C,(T*w-M*b)*C),F.set((_*v-S*g)*C,(_*x-S*y)*C,(_*b-S*w)*C),P[t].add(D),P[r].add(D),P[i].add(D),R[t].add(F),R[r].add(F),R[i].add(F)}var t,r,i,n,a,s,l,h,c,u,f,p,d,m,g,v,y,x,w,b,_,S,M,T,C,A,E,L,P=[],R=[],D=new o.Vector3,F=new o.Vector3,N=new o.Vector3,U=new o.Vector3,z=new o.Vector3;for(i=0,n=this.vertices.length;n>i;i++)P[i]=new o.Vector3,R[i]=new o.Vector3;for(t=0,r=this.faces.length;r>t;t++)l=this.faces[t],h=this.faceVertexUvs[0][t],l instanceof o.Face3?e(this,l.a,l.b,l.c,0,1,2):l instanceof o.Face4&&(e(this,l.a,l.b,l.d,0,1,3),e(this,l.b,l.c,l.d,1,2,3));var V=["a","b","c","d"];for(t=0,r=this.faces.length;r>t;t++)for(l=this.faces[t],a=0;a<l.vertexNormals.length;a++)z.copy(l.vertexNormals[a]),s=l[V[a]],A=P[s],N.copy(A),N.sub(z.multiplyScalar(z.dot(A))).normalize(),U.crossVectors(l.vertexNormals[a],A),E=U.dot(R[s]),L=0>E?-1:1,l.vertexTangents[a]=new o.Vector4(N.x,N.y,N.z,L);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,r=0,i=t.length;i>r;r++)r>0&&(e+=t[r].distanceTo(t[r-1])),this.lineDistances[r]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere),this.boundingSphere.setFromCenterAndPoints(this.boundingSphere.center,this.vertices)},mergeVertices:function(){var e,t,r,i,n,a,s,l,h,c={},u=[],f=[],p=4,d=Math.pow(10,p);for(this.__tmpVertices=void 0,r=0,i=this.vertices.length;i>r;r++)e=this.vertices[r],t=[Math.round(e.x*d),Math.round(e.y*d),Math.round(e.z*d)].join("_"),void 0===c[t]?(c[t]=r,u.push(this.vertices[r]),f[r]=u.length-1):f[r]=f[c[t]];var m=[];for(r=0,i=this.faces.length;i>r;r++)if(n=this.faces[r],n instanceof o.Face3){n.a=f[n.a],n.b=f[n.b],n.c=f[n.c],a=[n.a,n.b,n.c];for(var g=-1,v=0;3>v;v++)if(a[v]==a[(v+1)%3]){g=v,m.push(r);break}}else if(n instanceof o.Face4){n.a=f[n.a],n.b=f[n.b],n.c=f[n.c],n.d=f[n.d],a=[n.a,n.b,n.c,n.d];for(var g=-1,v=0;4>v;v++)a[v]==a[(v+1)%4]&&(g>=0&&m.push(r),g=v);if(g>=0){a.splice(g,1);var y=new o.Face3(a[0],a[1],a[2],n.normal,n.color,n.materialIndex);for(s=0,l=this.faceVertexUvs.length;l>s;s++)h=this.faceVertexUvs[s][r],h&&h.splice(g,1);n.vertexNormals&&n.vertexNormals.length>0&&(y.vertexNormals=n.vertexNormals,y.vertexNormals.splice(g,1)),n.vertexColors&&n.vertexColors.length>0&&(y.vertexColors=n.vertexColors,y.vertexColors.splice(g,1)),this.faces[r]=y}}for(r=m.length-1;r>=0;r--)for(this.faces.splice(r,1),s=0,l=this.faceVertexUvs.length;l>s;s++)this.faceVertexUvs[s].splice(r,1);var x=this.vertices.length-u.length;return this.vertices=u,x},clone:function(){for(var e=new o.Geometry,t=this.vertices,r=0,i=t.length;i>r;r++)e.vertices.push(t[r].clone());
for(var n=this.faces,r=0,i=n.length;i>r;r++)e.faces.push(n[r].clone());for(var a=this.faceVertexUvs[0],r=0,i=a.length;i>r;r++){for(var s=a[r],l=[],h=0,c=s.length;c>h;h++)l.push(new o.Vector2(s[h].x,s[h].y));e.faceVertexUvs[0].push(l)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.GeometryIdCount=0,o.BufferGeometry=function(){o.EventDispatcher.call(this),this.id=o.GeometryIdCount++,this.attributes={},this.dynamic=!1,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},o.BufferGeometry.prototype={constructor:o.BufferGeometry,applyMatrix:function(e){var t,r;if(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(r=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==r){var i=new o.Matrix3;i.getInverse(e).transpose(),i.multiplyVector3Array(r),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new o.Box3);var e=this.attributes.position.array;if(e){var t,r,i,n=this.boundingBox;e.length>=3&&(n.min.x=n.max.x=e[0],n.min.y=n.max.y=e[1],n.min.z=n.max.z=e[2]);for(var a=3,s=e.length;s>a;a+=3)t=e[a],r=e[a+1],i=e[a+2],t<n.min.x?n.min.x=t:t>n.max.x&&(n.max.x=t),r<n.min.y?n.min.y=r:r>n.max.y&&(n.max.y=r),i<n.min.z?n.min.z=i:i>n.max.z&&(n.max.z=i)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new o.Sphere);var e=this.attributes.position.array;if(e){for(var t,r,i,n,a=0,s=0,l=e.length;l>s;s+=3)r=e[s],i=e[s+1],n=e[s+2],t=r*r+i*i+n*n,t>a&&(a=t);this.boundingSphere.radius=Math.sqrt(a)}},computeVertexNormals:function(){if(this.attributes.position){var e,t,r,i,n=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(n),numItems:n};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var a,s,l,h,c,u,f=this.attributes.position.array,p=this.attributes.normal.array,d=new o.Vector3,m=new o.Vector3,g=new o.Vector3,v=new o.Vector3,y=new o.Vector3;if(this.attributes.index){var x=this.attributes.index.array,w=this.offsets;for(r=0,i=w.length;i>r;++r){var b=w[r].start,_=w[r].count,S=w[r].index;for(e=b,t=b+_;t>e;e+=3)a=S+x[e],s=S+x[e+1],l=S+x[e+2],h=f[3*a],c=f[3*a+1],u=f[3*a+2],d.set(h,c,u),h=f[3*s],c=f[3*s+1],u=f[3*s+2],m.set(h,c,u),h=f[3*l],c=f[3*l+1],u=f[3*l+2],g.set(h,c,u),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),p[3*a]+=v.x,p[3*a+1]+=v.y,p[3*a+2]+=v.z,p[3*s]+=v.x,p[3*s+1]+=v.y,p[3*s+2]+=v.z,p[3*l]+=v.x,p[3*l+1]+=v.y,p[3*l+2]+=v.z}}else for(e=0,t=f.length;t>e;e+=9)h=f[e],c=f[e+1],u=f[e+2],d.set(h,c,u),h=f[e+3],c=f[e+4],u=f[e+5],m.set(h,c,u),h=f[e+6],c=f[e+7],u=f[e+8],g.set(h,c,u),v.subVectors(g,m),y.subVectors(d,m),v.cross(y),p[e]=v.x,p[e+1]=v.y,p[e+2]=v.z,p[e+3]=v.x,p[e+4]=v.y,p[e+5]=v.z,p[e+6]=v.x,p[e+7]=v.y,p[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,r,i,n=this.attributes.normal.array,o=0,a=n.length;a>o;o+=3)e=n[o],t=n[o+1],r=n[o+2],i=1/Math.sqrt(e*e+t*t+r*r),n[o]*=i,n[o+1]*=i,n[o+2]*=i},computeTangents:function(){function e(e,t,r){p=i[3*e],d=i[3*e+1],m=i[3*e+2],g=i[3*t],v=i[3*t+1],y=i[3*t+2],x=i[3*r],w=i[3*r+1],b=i[3*r+2],_=a[2*e],S=a[2*e+1],M=a[2*t],T=a[2*t+1],C=a[2*r],A=a[2*r+1],E=g-p,L=x-p,P=v-d,R=w-d,D=y-m,F=b-m,N=M-_,U=C-_,z=T-S,V=A-S,B=1/(N*V-U*z),X.set((V*E-z*L)*B,(V*P-z*R)*B,(V*D-z*F)*B),q.set((N*L-U*E)*B,(N*R-U*P)*B,(N*F-U*D)*B),c[e].add(X),c[t].add(X),c[r].add(X),u[e].add(q),u[t].add(q),u[r].add(q)}function t(e){ie.x=n[3*e],ie.y=n[3*e+1],ie.z=n[3*e+2],ne.copy(ie),J=c[e],te.copy(J),te.sub(ie.multiplyScalar(ie.dot(J))).normalize(),re.crossVectors(ne,J),ee=re.dot(u[e]),Z=0>ee?-1:1,h[4*e]=te.x,h[4*e+1]=te.y,h[4*e+2]=te.z,h[4*e+3]=Z}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return void console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");var r=this.attributes.index.array,i=this.attributes.position.array,n=this.attributes.normal.array,a=this.attributes.uv.array,s=i.length/3;if(void 0===this.attributes.tangent){var l=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(l),numItems:l}}for(var h=this.attributes.tangent.array,c=[],u=[],f=0;s>f;f++)c[f]=new o.Vector3,u[f]=new o.Vector3;var p,d,m,g,v,y,x,w,b,_,S,M,T,C,A,E,L,P,R,D,F,N,U,z,V,B,O,I,k,H,G,j,W,X=new o.Vector3,q=new o.Vector3,Y=this.offsets;for(k=0,H=Y.length;H>k;++k){var K=Y[k].start,$=Y[k].count,Q=Y[k].index;for(O=K,I=K+$;I>O;O+=3)G=Q+r[O],j=Q+r[O+1],W=Q+r[O+2],e(G,j,W)}var Z,J,ee,te=new o.Vector3,re=new o.Vector3,ie=new o.Vector3,ne=new o.Vector3;for(k=0,H=Y.length;H>k;++k){var K=Y[k].start,$=Y[k].count,Q=Y[k].index;for(O=K,I=K+$;I>O;O+=3)G=Q+r[O],j=Q+r[O+1],W=Q+r[O+2],t(G),t(j),t(W)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.Camera=function(){o.Object3D.call(this),this.matrixWorldInverse=new o.Matrix4,this.projectionMatrix=new o.Matrix4,this.projectionMatrixInverse=new o.Matrix4},o.Camera.prototype=Object.create(o.Object3D.prototype),o.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up),this.rotationAutoUpdate===!0&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},o.OrthographicCamera=function(e,t,r,i,n,a){o.Camera.call(this),this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=void 0!==n?n:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()},o.OrthographicCamera.prototype=Object.create(o.Camera.prototype),o.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},o.PerspectiveCamera=function(e,t,r,i){o.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype=Object.create(o.Camera.prototype),o.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*o.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.setViewOffset=function(e,t,r,i,n,o){this.fullWidth=e,this.fullHeight=t,this.x=r,this.y=i,this.width=n,this.height=o,this.updateProjectionMatrix()},o.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(o.Math.degToRad(.5*this.fov))*this.near,r=-t,i=e*r,n=e*t,a=Math.abs(n-i),s=Math.abs(t-r);this.projectionMatrix.makeFrustum(i+this.x*a/this.fullWidth,i+(this.x+this.width)*a/this.fullWidth,t-(this.y+this.height)*s/this.fullHeight,t-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},o.Light=function(e){o.Object3D.call(this),this.color=new o.Color(e)},o.Light.prototype=Object.create(o.Object3D.prototype),o.AmbientLight=function(e){o.Light.call(this,e)},o.AmbientLight.prototype=Object.create(o.Light.prototype),o.AreaLight=function(e,t){o.Light.call(this,e),this.normal=new o.Vector3(0,-1,0),this.right=new o.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},o.AreaLight.prototype=Object.create(o.Light.prototype),o.DirectionalLight=function(e,t){o.Light.call(this,e),this.position=new o.Vector3(0,1,0),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new o.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},o.DirectionalLight.prototype=Object.create(o.Light.prototype),o.HemisphereLight=function(e,t,r){o.Light.call(this,e),this.groundColor=new o.Color(t),this.position=new o.Vector3(0,100,0),this.intensity=void 0!==r?r:1},o.HemisphereLight.prototype=Object.create(o.Light.prototype),o.PointLight=function(e,t,r){o.Light.call(this,e),this.position=new o.Vector3(0,0,0),this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0},o.PointLight.prototype=Object.create(o.Light.prototype),o.SpotLight=function(e,t,r,i,n){o.Light.call(this,e),this.position=new o.Vector3(0,1,0),this.target=new o.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/2,this.exponent=void 0!==n?n:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},o.SpotLight.prototype=Object.create(o.Light.prototype),o.Loader=function(e){this.showStatus=e,this.statusDomElement=e?o.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},o.Loader.prototype={constructor:o.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var r=[],i=0;i<e.length;++i)r[i]=o.Loader.prototype.createMaterial(e[i],t);return r},needsTangents:function(e){for(var t=0,r=e.length;r>t;t++){var i=e[t];if(i instanceof o.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function r(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function i(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function n(e,t){var n=new Image;n.onload=function(){if(r(this.width)&&r(this.height))e.image=this;else{var t=i(this.width),n=i(this.height);e.image.width=t,e.image.height=n,e.image.getContext("2d").drawImage(this,0,0,t,n)}e.needsUpdate=!0},n.crossOrigin=l.crossOrigin,n.src=t}function a(e,r,i,a,s,l,h){var c=/\.dds$/i.test(i),u=t+"/"+i;if(c){var f=o.ImageUtils.loadCompressedTexture(u);e[r]=f}else{var f=document.createElement("canvas");e[r]=new o.Texture(f)}if(e[r].sourceFile=i,a&&(e[r].repeat.set(a[0],a[1]),1!==a[0]&&(e[r].wrapS=o.RepeatWrapping),1!==a[1]&&(e[r].wrapT=o.RepeatWrapping)),s&&e[r].offset.set(s[0],s[1]),l){var p={repeat:o.RepeatWrapping,mirror:o.MirroredRepeatWrapping};void 0!==p[l[0]]&&(e[r].wrapS=p[l[0]]),void 0!==p[l[1]]&&(e[r].wrapT=p[l[1]])}h&&(e[r].anisotropy=h),c||n(e[r],u)}function s(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var l=this,h="MeshLambertMaterial",c={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var u=e.shading.toLowerCase();"phong"===u?h="MeshPhongMaterial":"basic"===u&&(h="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==o[e.blending]&&(c.blending=o[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(c.transparent=e.transparent),void 0!==e.depthTest&&(c.depthTest=e.depthTest),void 0!==e.depthWrite&&(c.depthWrite=e.depthWrite),void 0!==e.visible&&(c.visible=e.visible),void 0!==e.flipSided&&(c.side=o.BackSide),void 0!==e.doubleSided&&(c.side=o.DoubleSide),void 0!==e.wireframe&&(c.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?c.vertexColors=o.FaceColors:e.vertexColors&&(c.vertexColors=o.VertexColors)),e.colorDiffuse?c.color=s(e.colorDiffuse):e.DbgColor&&(c.color=e.DbgColor),e.colorSpecular&&(c.specular=s(e.colorSpecular)),e.colorAmbient&&(c.ambient=s(e.colorAmbient)),e.transparency&&(c.opacity=e.transparency),e.specularCoef&&(c.shininess=e.specularCoef),e.mapDiffuse&&t&&a(c,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&a(c,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&a(c,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&a(c,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&a(c,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(c.bumpScale=e.mapBumpScale),e.mapNormal){var f=o.ShaderLib.normalmap,p=o.UniformsUtils.clone(f.uniforms);p.tNormal.value=c.normalMap,e.mapNormalFactor&&p.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),c.map&&(p.tDiffuse.value=c.map,p.enableDiffuse.value=!0),c.specularMap&&(p.tSpecular.value=c.specularMap,p.enableSpecular.value=!0),c.lightMap&&(p.tAO.value=c.lightMap,p.enableAO.value=!0),p.uDiffuseColor.value.setHex(c.color),p.uSpecularColor.value.setHex(c.specular),p.uAmbientColor.value.setHex(c.ambient),p.uShininess.value=c.shininess,void 0!==c.opacity&&(p.uOpacity.value=c.opacity);var d={fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:p,lights:!0,fog:!0},m=new o.ShaderMaterial(d);c.transparent&&(m.transparent=!0)}else var m=new o[h](c);return void 0!==e.DbgName&&(m.name=e.DbgName),m}},o.ImageLoader=function(){o.EventDispatcher.call(this),this.crossOrigin=null},o.ImageLoader.prototype={constructor:o.ImageLoader,load:function(e,t){var r=this;void 0===t&&(t=new Image),t.addEventListener("load",function(){r.dispatchEvent({type:"load",content:t})},!1),t.addEventListener("error",function(){r.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),r.crossOrigin&&(t.crossOrigin=r.crossOrigin),t.src=e}},o.JSONLoader=function(e){o.Loader.call(this,e),this.withCredentials=!1},o.JSONLoader.prototype=Object.create(o.Loader.prototype),o.JSONLoader.prototype.load=function(e,t,r){r=r&&"string"==typeof r?r:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,r)},o.JSONLoader.prototype.loadAjaxJSON=function(e,t,r,i,n){var o=new XMLHttpRequest,a=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var s=JSON.parse(o.responseText);e.createModel(s,r,i)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?n&&(0===a&&(a=o.getResponseHeader("Content-Length")),n({total:a,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&(a=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},o.JSONLoader.prototype.createModel=function(e,t,r){function i(t){function r(e,t){return e&1<<t}var i,n,a,l,h,c,u,f,p,d,m,g,v,y,x,w,b,_,S,M,T,C,A,E,L,P,R,D=e.faces,F=e.vertices,N=e.normals,U=e.colors,z=0;for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&z++;for(i=0;z>i;i++)s.faceUvs[i]=[],s.faceVertexUvs[i]=[];for(l=0,h=F.length;h>l;)M=new o.Vector3,M.x=F[l++]*t,M.y=F[l++]*t,M.z=F[l++]*t,s.vertices.push(M);for(l=0,h=D.length;h>l;){if(m=D[l++],g=r(m,0),v=r(m,1),y=r(m,2),x=r(m,3),w=r(m,4),b=r(m,5),_=r(m,6),S=r(m,7),g?(T=new o.Face4,T.a=D[l++],T.b=D[l++],T.c=D[l++],T.d=D[l++],c=4):(T=new o.Face3,T.a=D[l++],T.b=D[l++],T.c=D[l++],c=3),v&&(d=D[l++],T.materialIndex=d),a=s.faces.length,y)for(i=0;z>i;i++)E=e.uvs[i],p=D[l++],P=E[2*p],R=E[2*p+1],s.faceUvs[i][a]=new o.Vector2(P,R);if(x)for(i=0;z>i;i++){for(E=e.uvs[i],L=[],n=0;c>n;n++)p=D[l++],P=E[2*p],R=E[2*p+1],L[n]=new o.Vector2(P,R);s.faceVertexUvs[i][a]=L}if(w&&(f=3*D[l++],A=new o.Vector3,A.x=N[f++],A.y=N[f++],A.z=N[f],T.normal=A),b)for(i=0;c>i;i++)f=3*D[l++],A=new o.Vector3,A.x=N[f++],A.y=N[f++],A.z=N[f],T.vertexNormals.push(A);if(_&&(u=D[l++],C=new o.Color(U[u]),T.color=C),S)for(i=0;c>i;i++)u=D[l++],C=new o.Color(U[u]),T.vertexColors.push(C);s.faces.push(T)}}function n(){var t,r,i,n,a,l,h,c,u,f;if(e.skinWeights)for(t=0,r=e.skinWeights.length;r>t;t+=2)i=e.skinWeights[t],n=e.skinWeights[t+1],a=0,l=0,s.skinWeights.push(new o.Vector4(i,n,a,l));if(e.skinIndices)for(t=0,r=e.skinIndices.length;r>t;t+=2)h=e.skinIndices[t],c=e.skinIndices[t+1],u=0,f=0,s.skinIndices.push(new o.Vector4(h,c,u,f));s.bones=e.bones,s.animation=e.animation}function a(t){if(void 0!==e.morphTargets){var r,i,n,a,l,h;for(r=0,i=e.morphTargets.length;i>r;r++)for(s.morphTargets[r]={},s.morphTargets[r].name=e.morphTargets[r].name,s.morphTargets[r].vertices=[],l=s.morphTargets[r].vertices,h=e.morphTargets[r].vertices,n=0,a=h.length;a>n;n+=3){var c=new o.Vector3;c.x=h[n]*t,c.y=h[n+1]*t,c.z=h[n+2]*t,l.push(c)}}if(void 0!==e.morphColors){var r,i,u,f,p,d,m;for(r=0,i=e.morphColors.length;i>r;r++)for(s.morphColors[r]={},s.morphColors[r].name=e.morphColors[r].name,s.morphColors[r].colors=[],p=s.morphColors[r].colors,d=e.morphColors[r].colors,u=0,f=d.length;f>u;u+=3)m=new o.Color(16755200),m.setRGB(d[u],d[u+1],d[u+2]),p.push(m)}}var s=new o.Geometry,l=void 0!==e.scale?1/e.scale:1;i(l),n(),a(l),s.computeCentroids(),s.computeFaceNormals();var h=this.initMaterials(e.materials,r);this.needsTangents(h)&&s.computeTangents(),t(s,h)},o.LoadingMonitor=function(){o.EventDispatcher.call(this);var e=this,t=0,r=0,i=function(i){t++,e.dispatchEvent({type:"progress",loaded:t,total:r}),t===r&&e.dispatchEvent({type:"load"})};this.add=function(e){r++,e.addEventListener("load",i,!1)}},o.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlerMap={},this.hierarchyHandlerMap={},this.addGeometryHandler("ascii",o.JSONLoader)},o.SceneLoader.prototype.constructor=o.SceneLoader,o.SceneLoader.prototype.load=function(e,t){var r=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0===i.status){var n=JSON.parse(i.responseText);r.parse(n,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+i.status+"]")},i.open("GET",e,!0),i.send(null)},o.SceneLoader.prototype.addGeometryHandler=function(e,t){this.geometryHandlerMap[e]={loaderClass:t}},o.SceneLoader.prototype.addHierarchyHandler=function(e,t){this.hierarchyHandlerMap[e]={loaderClass:t}},o.SceneLoader.prototype.parse=function(e,t,r){function i(e,t){return"relativeToHTML"==t?e:L+"/"+e}function n(){a(A.scene,R.objects)}function a(e,t){var r,n,s,l,h,u;for(var f in t)if(void 0===A.objects[f]){var p=t[f],v=null;if(p.type&&p.type in E.hierarchyHandlerMap){if(void 0===p.loading){var y={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,properties:1,skin:1,morph:1,mirroredLoop:1,duration:1},x={};for(var S in p)S in y||(x[S]=p[S]);m=A.materials[p.material],p.loading=!0;var M=E.hierarchyHandlerMap[p.type].loaderObject;M.options?M.load(i(p.url,R.urlBaseType),c(f,e,m,p)):M.load(i(p.url,R.urlBaseType),c(f,e,m,p),x)}}else if(void 0!==p.geometry){if(d=A.geometries[p.geometry]){var T=!1;if(m=A.materials[p.material],T=m instanceof o.ShaderMaterial,s=p.position,l=p.rotation,h=p.scale,r=p.matrix,u=p.quaternion,p.material||(m=new o.MeshFaceMaterial(A.face_materials[p.geometry])),m instanceof o.MeshFaceMaterial&&0===m.materials.length&&(m=new o.MeshFaceMaterial(A.face_materials[p.geometry])),m instanceof o.MeshFaceMaterial)for(var C=0;C<m.materials.length;C++)T=T||m.materials[C]instanceof o.ShaderMaterial;T&&d.computeTangents(),p.skin?v=new o.SkinnedMesh(d,m):p.morph?(v=new o.MorphAnimMesh(d,m),void 0!==p.duration&&(v.duration=p.duration),void 0!==p.time&&(v.time=p.time),void 0!==p.mirroredLoop&&(v.mirroredLoop=p.mirroredLoop),m.morphNormals&&d.computeMorphNormals()):v=new o.Mesh(d,m),v.name=f,r?(v.matrixAutoUpdate=!1,v.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(v.position.set(s[0],s[1],s[2]),u?(v.quaternion.set(u[0],u[1],u[2],u[3]),v.useQuaternion=!0):v.rotation.set(l[0],l[1],l[2]),v.scale.set(h[0],h[1],h[2])),v.visible=p.visible,v.castShadow=p.castShadow,v.receiveShadow=p.receiveShadow,e.add(v),A.objects[f]=v}}else"DirectionalLight"===p.type||"PointLight"===p.type||"AmbientLight"===p.type?(b=void 0!==p.color?p.color:16777215,_=void 0!==p.intensity?p.intensity:1,"DirectionalLight"===p.type?(s=p.direction,w=new o.DirectionalLight(b,_),w.position.set(s[0],s[1],s[2]),p.target&&(P.push({object:w,targetName:p.target}),w.target=null)):"PointLight"===p.type?(s=p.position,n=p.distance,w=new o.PointLight(b,_,n),w.position.set(s[0],s[1],s[2])):"AmbientLight"===p.type&&(w=new o.AmbientLight(b)),e.add(w),w.name=f,A.lights[f]=w,A.objects[f]=w):"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?("PerspectiveCamera"===p.type?g=new o.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(g=new o.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),s=p.position,g.position.set(s[0],s[1],s[2]),e.add(g),g.name=f,A.cameras[f]=g,A.objects[f]=g):(s=p.position,l=p.rotation,h=p.scale,u=p.quaternion,v=new o.Object3D,v.name=f,v.position.set(s[0],s[1],s[2]),u?(v.quaternion.set(u[0],u[1],u[2],u[3]),v.useQuaternion=!0):v.rotation.set(l[0],l[1],l[2]),v.scale.set(h[0],h[1],h[2]),v.visible=void 0!==p.visible?p.visible:!1,e.add(v),A.objects[f]=v,A.empties[f]=v);if(v){if(void 0!==p.properties)for(var L in p.properties){var D=p.properties[L];v.properties[L]=D}if(void 0!==p.groups)for(var C=0;C<p.groups.length;C++){var F=p.groups[C];void 0===A.groups[F]&&(A.groups[F]=[]),A.groups[F].push(f)}void 0!==p.children&&a(v,p.children)}}}function s(e,t,r){A.geometries[r]=e,A.face_materials[r]=t,n()}function l(e,t,r,i,o){var a=o.position,s=o.rotation,l=o.quaternion,h=o.scale;e.position.set(a[0],a[1],a[2]),l?(e.quaternion.set(l[0],l[1],l[2],l[3]),e.useQuaternion=!0):e.rotation.set(s[0],s[1],s[2]),e.scale.set(h[0],h[1],h[2]),i&&e.traverse(function(e){e.material=i});var c=void 0!==o.visible?o.visible:!0;e.traverse(function(e){e.visible=c}),r.add(e),e.name=t,A.objects[t]=e,n()}function h(e){return function(t,r){s(t,r,e),S-=1,E.onLoadComplete(),f()}}function c(e,t,r,i){return function(n){var o;o=n.content?n.content:n.dae?n.scene:n,l(o,e,t,r,i),S-=1,E.onLoadComplete(),f()}}function u(e){return function(t,r){A.geometries[e]=t,A.face_materials[e]=r}}function f(){var e={totalModels:T,totalTextures:C,loadedModels:T-S,loadedTextures:C-M};E.callbackProgress(e,A),E.onLoadProgress(),0===S&&0===M&&(p(),t(A))}function p(){for(var e=0;e<P.length;e++){var t=P[e],r=A.objects[t.targetName];r?t.object.target=r:(t.object.target=new o.Object3D,A.scene.add(t.object.target)),t.object.target.properties.targetInverse=t.object}}var d,m,g,v,y,x,w,b,_,S,M,T,C,A,E=this,L=o.Loader.prototype.extractUrlBase(r),P=[],R=e;for(var D in this.geometryHandlerMap){var F=this.geometryHandlerMap[D].loaderClass;this.geometryHandlerMap[D].loaderObject=new F}for(var D in this.hierarchyHandlerMap){var F=this.hierarchyHandlerMap[D].loaderClass;this.hierarchyHandlerMap[D].loaderObject=new F}if(S=0,M=0,A={scene:new o.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},R.transform){var N=R.transform.position,U=R.transform.rotation,z=R.transform.scale;N&&A.scene.position.set(N[0],N[1],N[2]),U&&A.scene.rotation.set(U[0],U[1],U[2]),z&&A.scene.scale.set(z[0],z[1],z[2]),(N||U||z)&&(A.scene.updateMatrix(),A.scene.updateMatrixWorld())}var V,B,O=function(e){M-=e,f(),E.onLoadComplete()},I=function(e){return function(){O(e)}};for(V in R.fogs)B=R.fogs[V],"linear"===B.type?v=new o.Fog(0,B.near,B.far):"exp2"===B.type&&(v=new o.FogExp2(0,B.density)),x=B.color,v.color.setRGB(x[0],x[1],x[2]),A.fogs[V]=v;var k,H;for(k in R.geometries)H=R.geometries[k],H.type in this.geometryHandlerMap&&(S+=1,E.onLoadStart());var G,j;for(G in R.objects)j=R.objects[G],j.type&&j.type in this.hierarchyHandlerMap&&(S+=1,E.onLoadStart());T=S;for(k in R.geometries)if(H=R.geometries[k],"cube"===H.type)d=new o.CubeGeometry(H.width,H.height,H.depth,H.widthSegments,H.heightSegments,H.depthSegments),A.geometries[k]=d;else if("plane"===H.type)d=new o.PlaneGeometry(H.width,H.height,H.widthSegments,H.heightSegments),A.geometries[k]=d;else if("sphere"===H.type)d=new o.SphereGeometry(H.radius,H.widthSegments,H.heightSegments),A.geometries[k]=d;else if("cylinder"===H.type)d=new o.CylinderGeometry(H.topRad,H.botRad,H.height,H.radSegs,H.heightSegs),A.geometries[k]=d;else if("torus"===H.type)d=new o.TorusGeometry(H.radius,H.tube,H.segmentsR,H.segmentsT),A.geometries[k]=d;else if("icosahedron"===H.type)d=new o.IcosahedronGeometry(H.radius,H.subdivisions),A.geometries[k]=d;else if(H.type in this.geometryHandlerMap){var W={};for(var X in H)"type"!==X&&"url"!==X&&(W[X]=H[X]);var q=this.geometryHandlerMap[H.type].loaderObject;q.load(i(H.url,R.urlBaseType),h(k),W)}else if("embedded"===H.type){var Y=R.embeds[H.id],K="";if(Y.metadata=R.metadata,Y){var $=this.geometryHandlerMap.ascii.loaderObject;$.createModel(Y,u(k),K)}}var Q,Z;for(Q in R.textures)if(Z=R.textures[Q],Z.url instanceof Array){M+=Z.url.length;for(var J=0;J<Z.url.length;J++)E.onLoadStart()}else M+=1,E.onLoadStart();C=M;for(Q in R.textures){if(Z=R.textures[Q],void 0!==Z.mapping&&void 0!==o[Z.mapping]&&(Z.mapping=new o[Z.mapping]),Z.url instanceof Array){for(var ee=Z.url.length,te=[],re=0;ee>re;re++)te[re]=i(Z.url[re],R.urlBaseType);var ie=/\.dds$/i.test(te[0]);y=ie?o.ImageUtils.loadCompressedTextureCube(te,Z.mapping,I(ee)):o.ImageUtils.loadTextureCube(te,Z.mapping,I(ee))}else{var ie=/\.dds$/i.test(Z.url),ne=i(Z.url,R.urlBaseType),oe=I(1);if(y=ie?o.ImageUtils.loadCompressedTexture(ne,Z.mapping,oe):o.ImageUtils.loadTexture(ne,Z.mapping,oe),void 0!==o[Z.minFilter]&&(y.minFilter=o[Z.minFilter]),void 0!==o[Z.magFilter]&&(y.magFilter=o[Z.magFilter]),Z.anisotropy&&(y.anisotropy=Z.anisotropy),Z.repeat&&(y.repeat.set(Z.repeat[0],Z.repeat[1]),1!==Z.repeat[0]&&(y.wrapS=o.RepeatWrapping),1!==Z.repeat[1]&&(y.wrapT=o.RepeatWrapping)),Z.offset&&y.offset.set(Z.offset[0],Z.offset[1]),Z.wrap){var ae={repeat:o.RepeatWrapping,mirror:o.MirroredRepeatWrapping};void 0!==ae[Z.wrap[0]]&&(y.wrapS=ae[Z.wrap[0]]),void 0!==ae[Z.wrap[1]]&&(y.wrapT=ae[Z.wrap[1]])}}A.textures[Q]=y}var se,le,he;for(se in R.materials){le=R.materials[se];for(he in le.parameters)if("envMap"===he||"map"===he||"lightMap"===he||"bumpMap"===he)le.parameters[he]=A.textures[le.parameters[he]];else if("shading"===he)le.parameters[he]="flat"===le.parameters[he]?o.FlatShading:o.SmoothShading;else if("side"===he)"double"==le.parameters[he]?le.parameters[he]=o.DoubleSide:"back"==le.parameters[he]?le.parameters[he]=o.BackSide:le.parameters[he]=o.FrontSide;else if("blending"===he)le.parameters[he]=le.parameters[he]in o?o[le.parameters[he]]:o.NormalBlending;else if("combine"===he)le.parameters[he]=le.parameters[he]in o?o[le.parameters[he]]:o.MultiplyOperation;else if("vertexColors"===he)"face"==le.parameters[he]?le.parameters[he]=o.FaceColors:le.parameters[he]&&(le.parameters[he]=o.VertexColors);else if("wrapRGB"===he){var ce=le.parameters[he];le.parameters[he]=new o.Vector3(ce[0],ce[1],ce[2])}if(void 0!==le.parameters.opacity&&le.parameters.opacity<1&&(le.parameters.transparent=!0),le.parameters.normalMap){var ue=o.ShaderLib.normalmap,fe=o.UniformsUtils.clone(ue.uniforms),pe=le.parameters.color,de=le.parameters.specular,me=le.parameters.ambient,ge=le.parameters.shininess;fe.tNormal.value=A.textures[le.parameters.normalMap],le.parameters.normalScale&&fe.uNormalScale.value.set(le.parameters.normalScale[0],le.parameters.normalScale[1]),le.parameters.map&&(fe.tDiffuse.value=le.parameters.map,fe.enableDiffuse.value=!0),le.parameters.envMap&&(fe.tCube.value=le.parameters.envMap,fe.enableReflection.value=!0,fe.uReflectivity.value=le.parameters.reflectivity),le.parameters.lightMap&&(fe.tAO.value=le.parameters.lightMap,fe.enableAO.value=!0),le.parameters.specularMap&&(fe.tSpecular.value=A.textures[le.parameters.specularMap],fe.enableSpecular.value=!0),le.parameters.displacementMap&&(fe.tDisplacement.value=A.textures[le.parameters.displacementMap],fe.enableDisplacement.value=!0,fe.uDisplacementBias.value=le.parameters.displacementBias,fe.uDisplacementScale.value=le.parameters.displacementScale),fe.uDiffuseColor.value.setHex(pe),fe.uSpecularColor.value.setHex(de),fe.uAmbientColor.value.setHex(me),fe.uShininess.value=ge,le.parameters.opacity&&(fe.uOpacity.value=le.parameters.opacity);var ve={fragmentShader:ue.fragmentShader,vertexShader:ue.vertexShader,uniforms:fe,lights:!0,fog:!0};m=new o.ShaderMaterial(ve)}else m=new o[le.type](le.parameters);A.materials[se]=m}for(se in R.materials)if(le=R.materials[se],le.parameters.materials){for(var ye=[],re=0;re<le.parameters.materials.length;re++){var xe=le.parameters.materials[re];ye.push(A.materials[xe])}A.materials[se].materials=ye}n(),A.cameras&&R.defaults.camera&&(A.currentCamera=A.cameras[R.defaults.camera]),A.fogs&&R.defaults.fog&&(A.scene.fog=A.fogs[R.defaults.fog]),E.callbackSync(A),f()},o.TextureLoader=function(){o.EventDispatcher.call(this),this.crossOrigin=null},o.TextureLoader.prototype={constructor:o.TextureLoader,load:function(e){var t=this,r=new Image;r.addEventListener("load",function(){var e=new o.Texture(r);e.needsUpdate=!0,t.dispatchEvent({type:"load",content:e})},!1),r.addEventListener("error",function(){t.dispatchEvent({type:"error",message:"Couldn't load URL ["+e+"]"})},!1),t.crossOrigin&&(r.crossOrigin=t.crossOrigin),r.src=e}},o.Material=function(){o.EventDispatcher.call(this),this.id=o.MaterialIdCount++,this.name="",this.side=o.FrontSide,this.opacity=1,this.transparent=!1,this.blending=o.NormalBlending,this.blendSrc=o.SrcAlphaFactor,this.blendDst=o.OneMinusSrcAlphaFactor,this.blendEquation=o.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=!1,this.visible=!0,this.needsUpdate=!0},o.Material.prototype.setValues=function(e){if(void 0!==e)for(var t in e){var r=e[t];if(void 0!==r){if(t in this){var i=this[t];i instanceof o.Color&&r instanceof o.Color?i.copy(r):i instanceof o.Color?i.set(r):i instanceof o.Vector3&&r instanceof o.Vector3?i.copy(r):this[t]=r}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},o.Material.prototype.clone=function(e){return void 0===e&&(e=new o.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},o.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},o.MaterialIdCount=0,o.LineBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineBasicMaterial.prototype=Object.create(o.Material.prototype),
o.LineBasicMaterial.prototype.clone=function(){var e=new o.LineBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.LineDashedMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.LineDashedMaterial.prototype=Object.create(o.Material.prototype),o.LineDashedMaterial.prototype.clone=function(){var e=new o.LineDashedMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.MeshBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},o.MeshBasicMaterial.prototype=Object.create(o.Material.prototype),o.MeshBasicMaterial.prototype.clone=function(){var e=new o.MeshBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},o.MeshLambertMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.ambient=new o.Color(16777215),this.emissive=new o.Color(0),this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshLambertMaterial.prototype=Object.create(o.Material.prototype),o.MeshLambertMaterial.prototype.clone=function(){var e=new o.MeshLambertMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.MeshPhongMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.ambient=new o.Color(16777215),this.emissive=new o.Color(0),this.specular=new o.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new o.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=o.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.MeshPhongMaterial.prototype=Object.create(o.Material.prototype),o.MeshPhongMaterial.prototype.clone=function(){var e=new o.MeshPhongMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.MeshDepthMaterial=function(e){o.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshDepthMaterial.prototype=Object.create(o.Material.prototype),o.MeshDepthMaterial.prototype.clone=function(){var e=new o.LineBasicMaterial;return o.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},o.MeshNormalMaterial=function(e){o.Material.call(this,e),this.shading=o.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},o.MeshNormalMaterial.prototype=Object.create(o.Material.prototype),o.MeshNormalMaterial.prototype.clone=function(){var e=new o.MeshNormalMaterial;return o.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},o.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},o.MeshFaceMaterial.prototype.clone=function(){return new o.MeshFaceMaterial(this.materials.slice(0))},o.ParticleBasicMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},o.ParticleBasicMaterial.prototype=Object.create(o.Material.prototype),o.ParticleBasicMaterial.prototype.clone=function(){var e=new o.ParticleBasicMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},o.ParticleCanvasMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.program=function(e,t){},this.setValues(e)},o.ParticleCanvasMaterial.prototype=Object.create(o.Material.prototype),o.ParticleCanvasMaterial.prototype.clone=function(){var e=new o.ParticleCanvasMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},o.ShaderMaterial=function(e){o.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=o.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=o.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},o.ShaderMaterial.prototype=Object.create(o.Material.prototype),o.ShaderMaterial.prototype.clone=function(){var e=new o.ShaderMaterial;return o.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=o.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},o.SpriteMaterial=function(e){o.Material.call(this),this.color=new o.Color(16777215),this.map=new o.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewport=!this.sizeAttenuation,this.alignment=o.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new o.Vector2(0,0),this.uvScale=new o.Vector2(1,1),this.setValues(e),e=e||{},void 0===e.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===e.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===e.scaleByViewport&&(this.scaleByViewport=!this.sizeAttenuation)},o.SpriteMaterial.prototype=Object.create(o.Material.prototype),o.SpriteMaterial.prototype.clone=function(){var e=new o.SpriteMaterial;return o.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.useScreenCoordinates=this.useScreenCoordinates,e.sizeAttenuation=this.sizeAttenuation,e.scaleByViewport=this.scaleByViewport,e.alignment.copy(this.alignment),e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},o.SpriteAlignment={},o.SpriteAlignment.topLeft=new o.Vector2(1,-1),o.SpriteAlignment.topCenter=new o.Vector2(0,-1),o.SpriteAlignment.topRight=new o.Vector2(-1,-1),o.SpriteAlignment.centerLeft=new o.Vector2(1,0),o.SpriteAlignment.center=new o.Vector2(0,0),o.SpriteAlignment.centerRight=new o.Vector2(-1,0),o.SpriteAlignment.bottomLeft=new o.Vector2(1,1),o.SpriteAlignment.bottomCenter=new o.Vector2(0,1),o.SpriteAlignment.bottomRight=new o.Vector2(-1,1),o.Texture=function(e,t,r,i,n,a,s,l,h){o.EventDispatcher.call(this),this.id=o.TextureIdCount++,this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new o.UVMapping,this.wrapS=void 0!==r?r:o.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:o.ClampToEdgeWrapping,this.magFilter=void 0!==n?n:o.LinearFilter,this.minFilter=void 0!==a?a:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==h?h:1,this.format=void 0!==s?s:o.RGBAFormat,this.type=void 0!==l?l:o.UnsignedByteType,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},o.Texture.prototype={constructor:o.Texture,clone:function(e){return void 0===e&&(e=new o.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},o.TextureIdCount=0,o.CompressedTexture=function(e,t,r,i,n,a,s,l,h,c,u){o.Texture.call(this,null,a,s,l,h,c,i,n,u),this.image={width:t,height:r},this.mipmaps=e,this.generateMipmaps=!1},o.CompressedTexture.prototype=Object.create(o.Texture.prototype),o.CompressedTexture.prototype.clone=function(){var e=new o.CompressedTexture;return o.Texture.prototype.clone.call(this,e),e},o.DataTexture=function(e,t,r,i,n,a,s,l,h,c,u){o.Texture.call(this,null,a,s,l,h,c,i,n,u),this.image={data:e,width:t,height:r}},o.DataTexture.prototype=Object.create(o.Texture.prototype),o.DataTexture.prototype.clone=function(){var e=new o.DataTexture;return o.Texture.prototype.clone.call(this,e),e},o.Particle=function(e){o.Object3D.call(this),this.material=e},o.Particle.prototype=Object.create(o.Object3D.prototype),o.Particle.prototype.clone=function(e){return void 0===e&&(e=new o.Particle(this.material)),o.Object3D.prototype.clone.call(this,e),e},o.ParticleSystem=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.ParticleBasicMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.geometry&&null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.frustumCulled=!1},o.ParticleSystem.prototype=Object.create(o.Object3D.prototype),o.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new o.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,o.Object3D.prototype.clone.call(this,e),e},o.Line=function(e,t,r){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:o.LineStrip,this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())},o.LineStrip=0,o.LinePieces=1,o.Line.prototype=Object.create(o.Object3D.prototype),o.Line.prototype.clone=function(e){return void 0===e&&(e=new o.Line(this.geometry,this.material,this.type)),o.Object3D.prototype.clone.call(this,e),e},o.Mesh=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new o.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0}),void 0!==this.geometry&&(null===this.geometry.boundingSphere&&this.geometry.computeBoundingSphere(),this.updateMorphTargets())},o.Mesh.prototype=Object.create(o.Object3D.prototype),o.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},o.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},o.Mesh.prototype.clone=function(e){return void 0===e&&(e=new o.Mesh(this.geometry,this.material)),o.Object3D.prototype.clone.call(this,e),e},o.Bone=function(e){o.Object3D.call(this),this.skin=e,this.skinMatrix=new o.Matrix4},o.Bone.prototype=Object.create(o.Object3D.prototype),o.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var r,i=this.children.length;for(r=0;i>r;r++)this.children[r].update(this.skinMatrix,t)},o.SkinnedMesh=function(e,t,r){o.Mesh.call(this,e,t),this.useVertexTexture=void 0!==r?r:!0,this.identityMatrix=new o.Matrix4,this.bones=[],this.boneMatrices=[];var i,n,a,s,l,h;if(this.geometry&&void 0!==this.geometry.bones){for(i=0;i<this.geometry.bones.length;i++)a=this.geometry.bones[i],s=a.pos,l=a.rotq,h=a.scl,n=this.addBone(),n.name=a.name,n.position.set(s[0],s[1],s[2]),n.quaternion.set(l[0],l[1],l[2],l[3]),n.useQuaternion=!0,void 0!==h?n.scale.set(h[0],h[1],h[2]):n.scale.set(1,1,1);for(i=0;i<this.bones.length;i++)a=this.geometry.bones[i],n=this.bones[i],-1===a.parent?this.add(n):this.bones[a.parent].add(n);var c=this.bones.length;if(this.useVertexTexture){var u;u=c>256?64:c>64?32:c>16?16:8,this.boneTextureWidth=u,this.boneTextureHeight=u,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new o.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,o.RGBAFormat,o.FloatType),this.boneTexture.minFilter=o.NearestFilter,this.boneTexture.magFilter=o.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*c);this.pose()}},o.SkinnedMesh.prototype=Object.create(o.Mesh.prototype),o.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new o.Bone(this)),this.bones.push(e),e},o.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++){var i=this.children[t];i instanceof o.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var n=0,a=this.bones.length;a>n;n++){var s=new o.Matrix4;s.getInverse(this.bones[n].skinMatrix),this.boneInverses.push(s)}}for(var n=0,a=this.bones.length;a>n;n++)o.SkinnedMesh.offsetMatrix.multiplyMatrices(this.bones[n].skinMatrix,this.boneInverses[n]),o.SkinnedMesh.offsetMatrix.flattenToArrayOffset(this.boneMatrices,16*n);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)},o.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0);for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],r=1/t.lengthManhattan();r!==1/0?t.multiplyScalar(r):t.set(1)}},o.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new o.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),o.Mesh.prototype.clone.call(this,e),e},o.SkinnedMesh.offsetMatrix=new o.Matrix4,o.MorphAnimMesh=function(e,t){o.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},o.MorphAnimMesh.prototype=Object.create(o.Mesh.prototype),o.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},o.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},o.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},o.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,r=e.animations,i=/([a-z]+)(\d+)/,n=0,o=e.morphTargets.length;o>n;n++){var a=e.morphTargets[n],s=a.name.match(i);if(s&&s.length>1){var l=s[1];s[2];r[l]||(r[l]={start:1/0,end:-(1/0)});var h=r[l];n<h.start&&(h.start=n),n>h.end&&(h.end=n),t||(t=l)}}e.firstAnimation=t},o.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,r){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:r}},o.MorphAnimMesh.prototype.playAnimation=function(e,t){var r=this.geometry.animations[e];r?(this.setFrameRange(r.start,r.end),this.duration=1e3*((r.end-r.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},o.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var r=this.startKeyframe+o.Math.clamp(Math.floor(this.time/t),0,this.length-1);r!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[r]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=r);var i=this.time%t/t;this.directionBackwards&&(i=1-i),this.morphTargetInfluences[this.currentKeyframe]=i,this.morphTargetInfluences[this.lastKeyframe]=1-i},o.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new o.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,o.Mesh.prototype.clone.call(this,e),e},o.Ribbon=function(e,t){o.Object3D.call(this),this.geometry=e,this.material=t},o.Ribbon.prototype=Object.create(o.Object3D.prototype),o.Ribbon.prototype.clone=function(e){return void 0===e&&(e=new o.Ribbon(this.geometry,this.material)),o.Object3D.prototype.clone.call(this,e),e},o.LOD=function(){o.Object3D.call(this),this.LODs=[]},o.LOD.prototype=Object.create(o.Object3D.prototype),o.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var r=0;r<this.LODs.length&&!(t<this.LODs[r].visibleAtDistance);r++);this.LODs.splice(r,0,{visibleAtDistance:t,object3D:e}),this.add(e)},o.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld);var t=e.matrixWorldInverse,r=-(t.elements[2]*this.matrixWorld.elements[12]+t.elements[6]*this.matrixWorld.elements[13]+t.elements[10]*this.matrixWorld.elements[14]+t.elements[14]);this.LODs[0].object3D.visible=!0;for(var i=1;i<this.LODs.length&&r>=this.LODs[i].visibleAtDistance;i++)this.LODs[i-1].object3D.visible=!1,this.LODs[i].object3D.visible=!0;for(;i<this.LODs.length;i++)this.LODs[i].object3D.visible=!1}},o.LOD.prototype.clone=function(){},o.Sprite=function(e){o.Object3D.call(this),this.material=void 0!==e?e:new o.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},o.Sprite.prototype=Object.create(o.Object3D.prototype),o.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(1!==this.scale.x||1!==this.scale.y)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},o.Sprite.prototype.clone=function(e){return void 0===e&&(e=new o.Sprite(this.material)),o.Object3D.prototype.clone.call(this,e),e},o.Scene=function(){o.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},o.Scene.prototype=Object.create(o.Object3D.prototype),o.Scene.prototype.__addObject=function(e){if(e instanceof o.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof o.Camera||e instanceof o.Bone)&&-1===this.__objects.indexOf(e)){this.__objects.push(e),this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var r=0;r<e.children.length;r++)this.__addObject(e.children[r])},o.Scene.prototype.__removeObject=function(e){if(e instanceof o.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1)}else if(!(e instanceof o.Camera)){var t=this.__objects.indexOf(e);if(-1!==t){this.__objects.splice(t,1),this.__objectsRemoved.push(e);var r=this.__objectsAdded.indexOf(e);-1!==r&&this.__objectsAdded.splice(r,1)}}for(var i=0;i<e.children.length;i++)this.__removeObject(e.children[i])},o.Fog=function(e,t,r){this.name="",this.color=new o.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==r?r:1e3},o.Fog.prototype.clone=function(){return new o.Fog(this.color.getHex(),this.near,this.far)},o.FogExp2=function(e,t){this.name="",this.color=new o.Color(e),this.density=void 0!==t?t:25e-5},o.FogExp2.prototype.clone=function(){return new o.FogExp2(this.color.getHex(),this.density)},o.CanvasRenderer=function(e){function t(e){re!==e&&(J.globalAlpha=e,re=e)}function r(e){ie!==e&&(e===o.NormalBlending?J.globalCompositeOperation="source-over":e===o.AdditiveBlending?J.globalCompositeOperation="lighter":e===o.SubtractiveBlending&&(J.globalCompositeOperation="darker"),ie=e)}function i(e){ae!==e&&(J.lineWidth=e,ae=e)}function n(e){se!==e&&(J.lineCap=e,se=e)}function a(e){le!==e&&(J.lineJoin=e,le=e)}function s(e){ne!==e&&(J.strokeStyle=e,ne=e)}function l(e){oe!==e&&(J.fillStyle=e,oe=e)}function h(e,t){(he!==e||ce!==t)&&(J.setLineDash([e,t]),he=e,ce=t)}console.log("THREE.CanvasRenderer",o.REVISION);var c=o.Math.smoothstep;e=e||{};var u,f,p,d,m,g,v,y,x,w,b,_,S,M,T,C,A,E,L,P,R,D,F,N,U,z,V,B,O,I,k,H,G,j,W,X,q,Y,K,$=this,Q=new o.Projector,Z=void 0!==e.canvas?e.canvas:document.createElement("canvas"),J=Z.getContext("2d"),ee=new o.Color(0),te=0,re=1,ie=0,ne=null,oe=null,ae=null,se=null,le=null,he=null,ce=0,ue=new o.RenderableVertex,fe=new o.RenderableVertex,pe=new o.Color,de=new o.Color,me=new o.Color,ge=new o.Color,ve=new o.Color,ye=new o.Color,xe=new o.Color,we=new o.Color,be={},_e={},Se=new o.Box2,Me=new o.Box2,Te=new o.Box2,Ce=!1,Ae=new o.Color,Ee=new o.Color,Le=new o.Color,Pe=new o.Vector3,Re=16;j=document.createElement("canvas"),j.width=j.height=2,W=j.getContext("2d"),W.fillStyle="rgba(0,0,0,1)",W.fillRect(0,0,2,2),X=W.getImageData(0,0,2,2),q=X.data,Y=document.createElement("canvas"),Y.width=Y.height=Re,K=Y.getContext("2d"),K.translate(-Re/2,-Re/2),K.scale(Re,Re),Re--,void 0===J.setLineDash&&(void 0!==J.mozDash?J.setLineDash=function(e){J.mozDash=null!==e[0]?e:null}:J.setLineDash=function(){}),this.domElement=Z,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t){d=e*this.devicePixelRatio,m=t*this.devicePixelRatio,g=Math.floor(d/2),v=Math.floor(m/2),Z.width=d,Z.height=m,Z.style.width=e+"px",Z.style.height=t+"px",Se.set(new o.Vector2(-g,-v),new o.Vector2(g,v)),Me.set(new o.Vector2(-g,-v),new o.Vector2(g,v)),re=1,ie=0,ne=null,oe=null,ae=null,se=null,le=null},this.setClearColor=function(e,t){ee.copy(e),te=void 0!==t?t:1,Me.set(new o.Vector2(-g,-v),new o.Vector2(g,v))},this.setClearColorHex=function(e,t){ee.setHex(e),te=void 0!==t?t:1,Me.set(new o.Vector2(-g,-v),new o.Vector2(g,v))},this.getMaxAnisotropy=function(){return 0},this.clear=function(){J.setTransform(1,0,0,-1,g,v),Me.empty()===!1&&(Me.intersect(Se),Me.expandByScalar(2),1>te&&J.clearRect(0|Me.min.x,0|Me.min.y,Me.max.x-Me.min.x|0,Me.max.y-Me.min.y|0),te>0&&(r(o.NormalBlending),t(1),l("rgba("+Math.floor(255*ee.r)+","+Math.floor(255*ee.g)+","+Math.floor(255*ee.b)+","+te+")"),J.fillRect(0|Me.min.x,0|Me.min.y,Me.max.x-Me.min.x|0,Me.max.y-Me.min.y|0)),Me.makeEmpty())},this.render=function(e,d){function m(){Ae.setRGB(0,0,0),Ee.setRGB(0,0,0),Le.setRGB(0,0,0);for(var e=0,t=p.length;t>e;e++){var r=p[e],i=r.color;r instanceof o.AmbientLight?Ae.add(i):r instanceof o.DirectionalLight?Ee.add(i):r instanceof o.PointLight&&Le.add(i)}}function Z(e,t,r){for(var i=0,n=p.length;n>i;i++){var a=p[i];if(we.copy(a.color),a instanceof o.DirectionalLight){var s=Pe.getPositionFromMatrix(a.matrixWorld).normalize(),l=t.dot(s);if(0>=l)continue;l*=a.intensity,r.add(we.multiplyScalar(l))}else if(a instanceof o.PointLight){var s=Pe.getPositionFromMatrix(a.matrixWorld),l=t.dot(Pe.subVectors(s,e).normalize());if(0>=l)continue;if(l*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1),0==l)continue;l*=a.intensity,r.add(we.multiplyScalar(l))}}}function ee(e,i,n){t(n.opacity),r(n.blending);var a,h,c,u,f,p,d;if(n instanceof o.ParticleBasicMaterial)if(null===n.map){if(c=i.object.scale.x,u=i.object.scale.y,c*=i.scale.x*g,u*=i.scale.y*v,Te.min.set(e.x-c,e.y-u),Te.max.set(e.x+c,e.y+u),Se.isIntersectionBox(Te)===!1)return;l(n.color.getStyle()),J.save(),J.translate(e.x,e.y),J.rotate(-i.rotation),J.scale(c,u),J.fillRect(-1,-1,2,2),J.restore()}else{if(f=n.map.image,p=f.width>>1,d=f.height>>1,c=i.scale.x*g,u=i.scale.y*v,a=c*p,h=u*d,Te.min.set(e.x-a,e.y-h),Te.max.set(e.x+a,e.y+h),Se.isIntersectionBox(Te)===!1)return;J.save(),J.translate(e.x,e.y),J.rotate(-i.rotation),J.scale(c,-u),J.translate(-p,-d),J.drawImage(f,0,0),J.restore()}else if(n instanceof o.ParticleCanvasMaterial){if(a=i.scale.x*g,h=i.scale.y*v,Te.min.set(e.x-a,e.y-h),Te.max.set(e.x+a,e.y+h),Se.isIntersectionBox(Te)===!1)return;s(n.color.getStyle()),l(n.color.getStyle()),J.save(),J.translate(e.x,e.y),J.rotate(-i.rotation),J.scale(a,h),n.program(J),J.restore()}}function te(e,l,c,u){t(u.opacity),r(u.blending),J.beginPath(),J.moveTo(e.positionScreen.x,e.positionScreen.y),J.lineTo(l.positionScreen.x,l.positionScreen.y),u instanceof o.LineBasicMaterial?(i(u.linewidth),n(u.linecap),a(u.linejoin),s(u.color.getStyle()),h(null,null),J.stroke(),Te.expandByScalar(2*u.linewidth)):u instanceof o.LineDashedMaterial&&(i(u.linewidth),n(u.linecap),a(u.linejoin),s(u.color.getStyle()),h(u.dashSize,u.gapSize),J.stroke(),Te.expandByScalar(2*u.linewidth))}function re(e,i,n,a,s,l,h,u){if($.info.render.vertices+=3,$.info.render.faces++,t(u.opacity),r(u.blending),_=e.positionScreen.x,S=e.positionScreen.y,M=i.positionScreen.x,T=i.positionScreen.y,C=n.positionScreen.x,A=n.positionScreen.y,ne(_,S,M,T,C,A),(u instanceof o.MeshLambertMaterial||u instanceof o.MeshPhongMaterial)&&null===u.map)ye.copy(u.color),xe.copy(u.emissive),u.vertexColors===o.FaceColors&&ye.multiply(h.color),Ce===!0?u.wireframe===!1&&u.shading==o.SmoothShading&&3==h.vertexNormalsLength?(de.copy(Ae),me.copy(Ae),ge.copy(Ae),Z(h.v1.positionWorld,h.vertexNormalsModel[0],de),Z(h.v2.positionWorld,h.vertexNormalsModel[1],me),Z(h.v3.positionWorld,h.vertexNormalsModel[2],ge),de.multiply(ye).add(xe),me.multiply(ye).add(xe),ge.multiply(ye).add(xe),ve.addColors(me,ge).multiplyScalar(.5),z=ce(de,me,ge,ve),he(_,S,M,T,C,A,0,0,1,0,0,1,z)):(pe.copy(Ae),Z(h.centroidModel,h.normalModel,pe),pe.multiply(ye).add(xe),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe)):u.wireframe===!0?ae(u.color,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(u.color);else if(u instanceof o.MeshBasicMaterial||u instanceof o.MeshLambertMaterial||u instanceof o.MeshPhongMaterial)null!==u.map?u.map.mapping instanceof o.UVMapping&&(V=h.uvs[0],le(_,S,M,T,C,A,V[a].x,V[a].y,V[s].x,V[s].y,V[l].x,V[l].y,u.map)):null!==u.envMap?u.envMap.mapping instanceof o.SphericalReflectionMapping&&(Pe.copy(h.vertexNormalsModelView[a]),B=.5*Pe.x+.5,O=.5*Pe.y+.5,Pe.copy(h.vertexNormalsModelView[s]),I=.5*Pe.x+.5,k=.5*Pe.y+.5,Pe.copy(h.vertexNormalsModelView[l]),H=.5*Pe.x+.5,G=.5*Pe.y+.5,le(_,S,M,T,C,A,B,O,I,k,H,G,u.envMap)):(pe.copy(u.color),u.vertexColors===o.FaceColors&&pe.multiply(h.color),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe));else if(u instanceof o.MeshDepthMaterial)N=d.near,U=d.far,de.r=de.g=de.b=1-c(e.positionScreen.z*e.positionScreen.w,N,U),me.r=me.g=me.b=1-c(i.positionScreen.z*i.positionScreen.w,N,U),ge.r=ge.g=ge.b=1-c(n.positionScreen.z*n.positionScreen.w,N,U),ve.addColors(me,ge).multiplyScalar(.5),z=ce(de,me,ge,ve),he(_,S,M,T,C,A,0,0,1,0,0,1,z);else if(u instanceof o.MeshNormalMaterial){var f;u.shading==o.FlatShading?(f=h.normalModelView,pe.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe)):u.shading==o.SmoothShading&&(f=h.vertexNormalsModelView[a],de.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),f=h.vertexNormalsModelView[s],me.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),f=h.vertexNormalsModelView[l],ge.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),ve.addColors(me,ge).multiplyScalar(.5),z=ce(de,me,ge,ve),he(_,S,M,T,C,A,0,0,1,0,0,1,z))}}function ie(e,i,n,a,s,l,h,u){if($.info.render.vertices+=4,$.info.render.faces++,t(u.opacity),r(u.blending),void 0!==u.map&&null!==u.map||void 0!==u.envMap&&null!==u.envMap)return re(e,i,a,0,1,3,h,u),void re(s,n,l,1,2,3,h,u);if(_=e.positionScreen.x,S=e.positionScreen.y,M=i.positionScreen.x,T=i.positionScreen.y,C=n.positionScreen.x,A=n.positionScreen.y,E=a.positionScreen.x,L=a.positionScreen.y,P=s.positionScreen.x,R=s.positionScreen.y,D=l.positionScreen.x,F=l.positionScreen.y,u instanceof o.MeshLambertMaterial||u instanceof o.MeshPhongMaterial)ye.copy(u.color),xe.copy(u.emissive),u.vertexColors===o.FaceColors&&ye.multiply(h.color),Ce===!0?u.wireframe===!1&&u.shading==o.SmoothShading&&4==h.vertexNormalsLength?(de.copy(Ae),me.copy(Ae),ge.copy(Ae),ve.copy(Ae),Z(h.v1.positionWorld,h.vertexNormalsModel[0],de),Z(h.v2.positionWorld,h.vertexNormalsModel[1],me),Z(h.v4.positionWorld,h.vertexNormalsModel[3],ge),Z(h.v3.positionWorld,h.vertexNormalsModel[2],ve),de.multiply(ye).add(xe),
me.multiply(ye).add(xe),ge.multiply(ye).add(xe),ve.multiply(ye).add(xe),z=ce(de,me,ge,ve),ne(_,S,M,T,E,L),he(_,S,M,T,E,L,0,0,1,0,0,1,z),ne(P,R,C,A,D,F),he(P,R,C,A,D,F,1,0,1,1,0,1,z)):(pe.copy(Ae),Z(h.centroidModel,h.normalModel,pe),pe.multiply(ye).add(xe),oe(_,S,M,T,C,A,E,L),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe)):(pe.addColors(ye,xe),oe(_,S,M,T,C,A,E,L),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe));else if(u instanceof o.MeshBasicMaterial)pe.copy(u.color),u.vertexColors===o.FaceColors&&pe.multiply(h.color),oe(_,S,M,T,C,A,E,L),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe);else if(u instanceof o.MeshNormalMaterial){var f;u.shading==o.FlatShading?(f=h.normalModelView,pe.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),oe(_,S,M,T,C,A,E,L),u.wireframe===!0?ae(pe,u.wireframeLinewidth,u.wireframeLinecap,u.wireframeLinejoin):se(pe)):u.shading==o.SmoothShading&&(f=h.vertexNormalsModelView[0],de.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),f=h.vertexNormalsModelView[1],me.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),f=h.vertexNormalsModelView[3],ge.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),f=h.vertexNormalsModelView[2],ve.setRGB(f.x,f.y,f.z).multiplyScalar(.5).addScalar(.5),z=ce(de,me,ge,ve),ne(_,S,M,T,E,L),he(_,S,M,T,E,L,0,0,1,0,0,1,z),ne(P,R,C,A,D,F),he(P,R,C,A,D,F,1,0,1,1,0,1,z))}else u instanceof o.MeshDepthMaterial&&(N=d.near,U=d.far,de.r=de.g=de.b=1-c(e.positionScreen.z*e.positionScreen.w,N,U),me.r=me.g=me.b=1-c(i.positionScreen.z*i.positionScreen.w,N,U),ge.r=ge.g=ge.b=1-c(a.positionScreen.z*a.positionScreen.w,N,U),ve.r=ve.g=ve.b=1-c(n.positionScreen.z*n.positionScreen.w,N,U),z=ce(de,me,ge,ve),ne(_,S,M,T,E,L),he(_,S,M,T,E,L,0,0,1,0,0,1,z),ne(P,R,C,A,D,F),he(P,R,C,A,D,F,1,0,1,1,0,1,z))}function ne(e,t,r,i,n,o){J.beginPath(),J.moveTo(e,t),J.lineTo(r,i),J.lineTo(n,o),J.closePath()}function oe(e,t,r,i,n,o,a,s){J.beginPath(),J.moveTo(e,t),J.lineTo(r,i),J.lineTo(n,o),J.lineTo(a,s),J.closePath()}function ae(e,t,r,o){i(t),n(r),a(o),s(e.getStyle()),J.stroke(),Te.expandByScalar(2*t)}function se(e){l(e.getStyle()),J.fill()}function le(e,t,r,i,n,a,s,h,c,u,f,p,d){if(!(d instanceof o.DataTexture||void 0===d.image||0==d.image.width)){if(d.needsUpdate===!0){var m=d.wrapS==o.RepeatWrapping,g=d.wrapT==o.RepeatWrapping;be[d.id]=J.createPattern(d.image,m===!0&&g===!0?"repeat":m===!0&&g===!1?"repeat-x":m===!1&&g===!0?"repeat-y":"no-repeat"),d.needsUpdate=!1}l(void 0===be[d.id]?"rgba(0,0,0,1)":be[d.id]);var v,y,x,w,b,_,S,M,T=d.offset.x/d.repeat.x,C=d.offset.y/d.repeat.y,A=d.image.width*d.repeat.x,E=d.image.height*d.repeat.y;if(s=(s+T)*A,h=(1-h+C)*E,c=(c+T)*A,u=(1-u+C)*E,f=(f+T)*A,p=(1-p+C)*E,r-=e,i-=t,n-=e,a-=t,c-=s,u-=h,f-=s,p-=h,S=c*p-f*u,0===S){if(void 0===_e[d.id]){var L=document.createElement("canvas");L.width=d.image.width,L.height=d.image.height;var P=L.getContext("2d");P.drawImage(d.image,0,0),_e[d.id]=P.getImageData(0,0,d.image.width,d.image.height).data}var R=_e[d.id],D=4*(Math.floor(s)+Math.floor(h)*d.image.width);return pe.setRGB(R[D]/255,R[D+1]/255,R[D+2]/255),void se(pe)}M=1/S,v=(p*r-u*n)*M,y=(p*i-u*a)*M,x=(c*n-f*r)*M,w=(c*a-f*i)*M,b=e-v*s-x*h,_=t-y*s-w*h,J.save(),J.transform(v,y,x,w,b,_),J.fill(),J.restore()}}function he(e,t,r,i,n,o,a,s,l,h,c,u,f){var p,d,m,g,v,y,x,w,b=f.width-1,_=f.height-1;a*=b,s*=_,l*=b,h*=_,c*=b,u*=_,r-=e,i-=t,n-=e,o-=t,l-=a,h-=s,c-=a,u-=s,x=l*u-c*h,w=1/x,p=(u*r-h*n)*w,d=(u*i-h*o)*w,m=(l*n-c*r)*w,g=(l*o-c*i)*w,v=e-p*a-m*s,y=t-d*a-g*s,J.save(),J.transform(p,d,m,g,v,y),J.clip(),J.drawImage(f,0,0),J.restore()}function ce(e,t,r,i){return q[0]=255*e.r|0,q[1]=255*e.g|0,q[2]=255*e.b|0,q[4]=255*t.r|0,q[5]=255*t.g|0,q[6]=255*t.b|0,q[8]=255*r.r|0,q[9]=255*r.g|0,q[10]=255*r.b|0,q[12]=255*i.r|0,q[13]=255*i.g|0,q[14]=255*i.b|0,W.putImageData(X,0,0),K.drawImage(j,0,0),Y}function Re(e,t){var r,i=t.x-e.x,n=t.y-e.y,o=i*i+n*n;0!==o&&(r=1/Math.sqrt(o),i*=r,n*=r,t.x+=i,t.y+=n,e.x-=i,e.y-=n)}if(d instanceof o.Camera==!1)return void console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");this.autoClear===!0&&this.clear(),J.setTransform(1,0,0,-1,g,v),$.info.render.vertices=0,$.info.render.faces=0,u=Q.projectScene(e,d,this.sortObjects,this.sortElements),f=u.elements,p=u.lights,Ce=p.length>0,Ce===!0&&m();for(var De=0,Fe=f.length;Fe>De;De++){var Ne=f[De],Ue=Ne.material;if(void 0!==Ue&&Ue.visible!==!1){if(Te.makeEmpty(),Ne instanceof o.RenderableParticle)y=Ne,y.x*=g,y.y*=v,ee(y,Ne,Ue);else if(Ne instanceof o.RenderableLine)y=Ne.v1,x=Ne.v2,y.positionScreen.x*=g,y.positionScreen.y*=v,x.positionScreen.x*=g,x.positionScreen.y*=v,Te.setFromPoints([y.positionScreen,x.positionScreen]),Se.isIntersectionBox(Te)===!0&&te(y,x,Ne,Ue);else if(Ne instanceof o.RenderableFace3){if(y=Ne.v1,x=Ne.v2,w=Ne.v3,y.positionScreen.z<-1||y.positionScreen.z>1)continue;if(x.positionScreen.z<-1||x.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;y.positionScreen.x*=g,y.positionScreen.y*=v,x.positionScreen.x*=g,x.positionScreen.y*=v,w.positionScreen.x*=g,w.positionScreen.y*=v,Ue.overdraw===!0&&(Re(y.positionScreen,x.positionScreen),Re(x.positionScreen,w.positionScreen),Re(w.positionScreen,y.positionScreen)),Te.setFromPoints([y.positionScreen,x.positionScreen,w.positionScreen]),re(y,x,w,0,1,2,Ne,Ue)}else if(Ne instanceof o.RenderableFace4){if(y=Ne.v1,x=Ne.v2,w=Ne.v3,b=Ne.v4,y.positionScreen.z<-1||y.positionScreen.z>1)continue;if(x.positionScreen.z<-1||x.positionScreen.z>1)continue;if(w.positionScreen.z<-1||w.positionScreen.z>1)continue;if(b.positionScreen.z<-1||b.positionScreen.z>1)continue;y.positionScreen.x*=g,y.positionScreen.y*=v,x.positionScreen.x*=g,x.positionScreen.y*=v,w.positionScreen.x*=g,w.positionScreen.y*=v,b.positionScreen.x*=g,b.positionScreen.y*=v,ue.positionScreen.copy(x.positionScreen),fe.positionScreen.copy(b.positionScreen),Ue.overdraw===!0&&(Re(y.positionScreen,x.positionScreen),Re(x.positionScreen,b.positionScreen),Re(b.positionScreen,y.positionScreen),Re(w.positionScreen,ue.positionScreen),Re(w.positionScreen,fe.positionScreen)),Te.setFromPoints([y.positionScreen,x.positionScreen,w.positionScreen,b.positionScreen]),ie(y,x,w,b,ue,fe,Ne,Ue,e)}Me.union(Te)}}J.setTransform(1,0,0,1,0,0)}},o.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -viewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, opacity );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, N_BONE_PIXEL_X );","float y = floor( j / N_BONE_PIXEL_X );","const float dx = 1.0 / N_BONE_PIXEL_X;","const float dy = 1.0 / N_BONE_PIXEL_Y;","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),
default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( depthKernel[0][0] < shadowCoord.z ) shadowKernel[0][0] = 0.25;","else shadowKernel[0][0] = 0.0;","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( depthKernel[0][1] < shadowCoord.z ) shadowKernel[0][1] = 0.25;","else shadowKernel[0][1] = 0.0;","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( depthKernel[0][2] < shadowCoord.z ) shadowKernel[0][2] = 0.25;","else shadowKernel[0][2] = 0.0;","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( depthKernel[1][0] < shadowCoord.z ) shadowKernel[1][0] = 0.25;","else shadowKernel[1][0] = 0.0;","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( depthKernel[1][1] < shadowCoord.z ) shadowKernel[1][1] = 0.25;","else shadowKernel[1][1] = 0.0;","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( depthKernel[1][2] < shadowCoord.z ) shadowKernel[1][2] = 0.25;","else shadowKernel[1][2] = 0.0;","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( depthKernel[2][0] < shadowCoord.z ) shadowKernel[2][0] = 0.25;","else shadowKernel[2][0] = 0.0;","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( depthKernel[2][1] < shadowCoord.z ) shadowKernel[2][1] = 0.25;","else shadowKernel[2][1] = 0.0;","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( depthKernel[2][2] < shadowCoord.z ) shadowKernel[2][2] = 0.25;","else shadowKernel[2][2] = 0.0;","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},o.UniformsUtils={merge:function(e){var t,r,i,n={};for(t=0;t<e.length;t++){i=this.clone(e[t]);for(r in i)n[r]=i[r]}return n},clone:function(e){var t,r,i,n={};for(t in e){n[t]={};for(r in e[t])i=e[t][r],i instanceof o.Color||i instanceof o.Vector2||i instanceof o.Vector3||i instanceof o.Vector4||i instanceof o.Matrix4||i instanceof o.Texture?n[t][r]=i.clone():i instanceof Array?n[t][r]=i.slice():n[t][r]=i}return n}},o.UniformsLib={common:{diffuse:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new o.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new o.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new o.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new o.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},o.ShaderLib={basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,o.UniformsLib.shadowmap]),vertexShader:[o.ShaderChunk.map_pars_vertex,o.ShaderChunk.lightmap_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,"void main() {",o.ShaderChunk.map_vertex,o.ShaderChunk.lightmap_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"#endif",o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.default_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.lightmap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",o.ShaderChunk.map_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.lightmap_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.envmap_fragment,o.ShaderChunk.shadowmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{ambient:{type:"c",value:new o.Color(16777215)},emissive:{type:"c",value:new o.Color(0)},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",o.ShaderChunk.map_pars_vertex,o.ShaderChunk.lightmap_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_lambert_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,"void main() {",o.ShaderChunk.map_vertex,o.ShaderChunk.lightmap_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.default_vertex,o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_lambert_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.lightmap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",o.ShaderChunk.map_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",o.ShaderChunk.lightmap_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.envmap_fragment,o.ShaderChunk.shadowmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.bump,o.UniformsLib.normalmap,o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{ambient:{type:"c",value:new o.Color(16777215)},emissive:{type:"c",value:new o.Color(0)},specular:{type:"c",value:new o.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",o.ShaderChunk.map_pars_vertex,o.ShaderChunk.lightmap_pars_vertex,o.ShaderChunk.envmap_pars_vertex,o.ShaderChunk.lights_phong_pars_vertex,o.ShaderChunk.color_pars_vertex,o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,"void main() {",o.ShaderChunk.map_vertex,o.ShaderChunk.lightmap_vertex,o.ShaderChunk.color_vertex,o.ShaderChunk.morphnormal_vertex,o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,o.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",o.ShaderChunk.worldpos_vertex,o.ShaderChunk.envmap_vertex,o.ShaderChunk.lights_phong_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_pars_fragment,o.ShaderChunk.lightmap_pars_fragment,o.ShaderChunk.envmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.lights_phong_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.bumpmap_pars_fragment,o.ShaderChunk.normalmap_pars_fragment,o.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",o.ShaderChunk.map_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.specularmap_fragment,o.ShaderChunk.lights_phong_fragment,o.ShaderChunk.lightmap_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.envmap_fragment,o.ShaderChunk.shadowmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:o.UniformsUtils.merge([o.UniformsLib.particle,o.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",o.ShaderChunk.color_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",o.ShaderChunk.worldpos_vertex,o.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",o.ShaderChunk.color_pars_fragment,o.ShaderChunk.map_particle_pars_fragment,o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",o.ShaderChunk.map_particle_fragment,o.ShaderChunk.alphatest_fragment,o.ShaderChunk.color_fragment,o.ShaderChunk.shadowmap_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",o.ShaderChunk.color_pars_vertex,"void main() {",o.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",o.ShaderChunk.color_pars_fragment,o.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",o.ShaderChunk.color_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;","void main() {","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:o.UniformsUtils.merge([o.UniformsLib.fog,o.UniformsLib.lights,o.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new o.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new o.Color(16777215)},uSpecularColor:{type:"c",value:new o.Color(1118481)},uAmbientColor:{type:"c",value:new o.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new o.Vector2(0,0)},uRepeat:{type:"v2",value:new o.Vector2(1,1)},wrapRGB:{type:"v3",value:new o.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",o.ShaderChunk.shadowmap_pars_fragment,o.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",o.ShaderChunk.shadowmap_fragment,o.ShaderChunk.linear_to_gamma_fragment,o.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",o.ShaderChunk.skinning_pars_vertex,o.ShaderChunk.shadowmap_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")
},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[o.ShaderChunk.morphtarget_pars_vertex,o.ShaderChunk.skinning_pars_vertex,"void main() {",o.ShaderChunk.skinbase_vertex,o.ShaderChunk.morphtarget_vertex,o.ShaderChunk.skinning_vertex,o.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},o.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Oe.createBuffer(),e.__webglColorBuffer=Oe.createBuffer(),je.info.memory.geometries++}function r(e){e.__webglVertexBuffer=Oe.createBuffer(),e.__webglColorBuffer=Oe.createBuffer(),e.__webglLineDistanceBuffer=Oe.createBuffer(),je.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Oe.createBuffer(),e.__webglColorBuffer=Oe.createBuffer(),e.__webglNormalBuffer=Oe.createBuffer(),je.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Oe.createBuffer(),e.__webglNormalBuffer=Oe.createBuffer(),e.__webglTangentBuffer=Oe.createBuffer(),e.__webglColorBuffer=Oe.createBuffer(),e.__webglUVBuffer=Oe.createBuffer(),e.__webglUV2Buffer=Oe.createBuffer(),e.__webglSkinIndicesBuffer=Oe.createBuffer(),e.__webglSkinWeightsBuffer=Oe.createBuffer(),e.__webglFaceBuffer=Oe.createBuffer(),e.__webglLineBuffer=Oe.createBuffer();var t,r;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,r=e.numMorphTargets;r>t;t++)e.__webglMorphTargetsBuffers.push(Oe.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,r=e.numMorphNormals;r>t;t++)e.__webglMorphNormalsBuffers.push(Oe.createBuffer());je.info.memory.geometries++}function a(e){if(e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Oe.deleteBuffer(e.__webglCustomAttributesList[t].buffer)}function s(e,t){var r=e.vertices.length,i=t.material;if(i.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var n in i.attributes){var o=i.attributes[n];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var a=1;"v2"===o.type?a=2:"v3"===o.type?a=3:"v4"===o.type?a=4:"c"===o.type&&(a=3),o.size=a,o.array=new Float32Array(r*a),o.buffer=Oe.createBuffer(),o.buffer.belongsToAttribute=n,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function l(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__sortArray=[],e.__webglParticleCount=r,s(e,t)}function h(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__lineDistanceArray=new Float32Array(1*r),e.__webglLineCount=r,s(e,t)}function c(e,t){var r=e.vertices.length;e.__vertexArray=new Float32Array(3*r),e.__colorArray=new Float32Array(3*r),e.__normalArray=new Float32Array(3*r),e.__webglVertexCount=r,s(e,t)}function u(e,t){var r=t.geometry,i=e.faces3,n=e.faces4,o=3*i.length+4*n.length,a=1*i.length+2*n.length,s=3*i.length+4*n.length,l=f(t,e),h=g(l),c=d(l),u=m(l);e.__vertexArray=new Float32Array(3*o),c&&(e.__normalArray=new Float32Array(3*o)),r.hasTangents&&(e.__tangentArray=new Float32Array(4*o)),u&&(e.__colorArray=new Float32Array(3*o)),h&&((r.faceUvs.length>0||r.faceVertexUvs.length>0)&&(e.__uvArray=new Float32Array(2*o)),(r.faceUvs.length>1||r.faceVertexUvs.length>1)&&(e.__uv2Array=new Float32Array(2*o))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*o),e.__skinWeightArray=new Float32Array(4*o)),e.__faceArray=new Uint16Array(3*a),e.__lineArray=new Uint16Array(2*s);var p,v;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],p=0,v=e.numMorphTargets;v>p;p++)e.__morphTargetsArrays.push(new Float32Array(3*o));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],p=0,v=e.numMorphNormals;v>p;p++)e.__morphNormalsArrays.push(new Float32Array(3*o));if(e.__webglFaceCount=3*a,e.__webglLineCount=2*s,l.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var y in l.attributes){var x=l.attributes[y],w={};for(var b in x)w[b]=x[b];if(!w.__webglInitialized||w.createUniqueBuffers){w.__webglInitialized=!0;var _=1;"v2"===w.type?_=2:"v3"===w.type?_=3:"v4"===w.type?_=4:"c"===w.type&&(_=3),w.size=_,w.array=new Float32Array(o*_),w.buffer=Oe.createBuffer(),w.buffer.belongsToAttribute=y,x.needsUpdate=!0,w.__original=x}e.__webglCustomAttributesList.push(w)}}e.__inittedArrays=!0}function f(e,t){return e.material instanceof o.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function p(e){return e&&void 0!==e.shading&&e.shading===o.SmoothShading}function d(e){return e instanceof o.MeshBasicMaterial&&!e.envMap||e instanceof o.MeshDepthMaterial?!1:p(e)?o.SmoothShading:o.FlatShading}function m(e){return e.vertexColors?e.vertexColors:!1}function g(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof o.ShaderMaterial?!0:!1}function v(e){var t,r,i;for(t in e.attributes)i="index"===t?Oe.ELEMENT_ARRAY_BUFFER:Oe.ARRAY_BUFFER,r=e.attributes[t],r.buffer=Oe.createBuffer(),Oe.bindBuffer(i,r.buffer),Oe.bufferData(i,r.array,Oe.STATIC_DRAW)}function y(e,t,r){var i,n,o,a,s,l,h,c,u,f,p,d,m=e.vertices,g=m.length,v=e.colors,y=v.length,x=e.__vertexArray,w=e.__colorArray,b=e.__sortArray,_=e.verticesNeedUpdate,S=(e.elementsNeedUpdate,e.colorsNeedUpdate),M=e.__webglCustomAttributesList;if(r.sortParticles){for(bt.copy(wt),bt.multiply(r.matrixWorld),i=0;g>i;i++)o=m[i],_t.copy(o),_t.applyProjection(bt),b[i]=[_t.z,i];for(b.sort(A),i=0;g>i;i++)o=m[b[i][1]],a=3*i,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;for(n=0;y>n;n++)a=3*n,l=v[b[n][1]],w[a]=l.r,w[a+1]=l.g,w[a+2]=l.b;if(M)for(h=0,c=M.length;c>h;h++)if(d=M[h],void 0===d.boundTo||"vertices"===d.boundTo)if(a=0,f=d.value.length,1===d.size)for(u=0;f>u;u++)s=b[u][1],d.array[u]=d.value[s];else if(2===d.size)for(u=0;f>u;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(u=0;f>u;u++)s=b[u][1],p=d.value[s],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(u=0;f>u;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(u=0;f>u;u++)s=b[u][1],p=d.value[s],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}else{if(_)for(i=0;g>i;i++)o=m[i],a=3*i,x[a]=o.x,x[a+1]=o.y,x[a+2]=o.z;if(S)for(n=0;y>n;n++)l=v[n],a=3*n,w[a]=l.r,w[a+1]=l.g,w[a+2]=l.b;if(M)for(h=0,c=M.length;c>h;h++)if(d=M[h],d.needsUpdate&&(void 0===d.boundTo||"vertices"===d.boundTo))if(f=d.value.length,a=0,1===d.size)for(u=0;f>u;u++)d.array[u]=d.value[u];else if(2===d.size)for(u=0;f>u;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,a+=2;else if(3===d.size)if("c"===d.type)for(u=0;f>u;u++)p=d.value[u],d.array[a]=p.r,d.array[a+1]=p.g,d.array[a+2]=p.b,a+=3;else for(u=0;f>u;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,a+=3;else if(4===d.size)for(u=0;f>u;u++)p=d.value[u],d.array[a]=p.x,d.array[a+1]=p.y,d.array[a+2]=p.z,d.array[a+3]=p.w,a+=4}if((_||r.sortParticles)&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglVertexBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,x,t)),(S||r.sortParticles)&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglColorBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,w,t)),M)for(h=0,c=M.length;c>h;h++)d=M[h],(d.needsUpdate||r.sortParticles)&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,d.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,d.array,t))}function x(e,t){var r,i,n,o,a,s,l,h,c,u,f,p,d=e.vertices,m=e.colors,g=e.lineDistances,v=d.length,y=m.length,x=g.length,w=e.__vertexArray,b=e.__colorArray,_=e.__lineDistanceArray,S=e.verticesNeedUpdate,M=e.colorsNeedUpdate,T=e.lineDistancesNeedUpdate,C=e.__webglCustomAttributesList;if(S){for(r=0;v>r;r++)o=d[r],a=3*r,w[a]=o.x,w[a+1]=o.y,w[a+2]=o.z;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglVertexBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,w,t)}if(M){for(i=0;y>i;i++)s=m[i],a=3*i,b[a]=s.r,b[a+1]=s.g,b[a+2]=s.b;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglColorBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,b,t)}if(T){for(n=0;x>n;n++)_[n]=g[n];Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,_,t)}if(C)for(l=0,h=C.length;h>l;l++)if(p=C[l],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,u=p.value.length,1===p.size)for(c=0;u>c;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;u>c;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,a+=2;else if(3===p.size)if("c"===p.type)for(c=0;u>c;c++)f=p.value[c],p.array[a]=f.r,p.array[a+1]=f.g,p.array[a+2]=f.b,a+=3;else for(c=0;u>c;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,a+=3;else if(4===p.size)for(c=0;u>c;c++)f=p.value[c],p.array[a]=f.x,p.array[a+1]=f.y,p.array[a+2]=f.z,p.array[a+3]=f.w,a+=4;Oe.bindBuffer(Oe.ARRAY_BUFFER,p.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,p.array,t)}}function w(e,t){var r,i,n,o,a,s,l,h,c,u,f,p,d,m=e.vertices,g=e.colors,v=e.normals,y=m.length,x=g.length,w=v.length,b=e.__vertexArray,_=e.__colorArray,S=e.__normalArray,M=e.verticesNeedUpdate,T=e.colorsNeedUpdate,C=e.normalsNeedUpdate,A=e.__webglCustomAttributesList;if(M){for(r=0;y>r;r++)o=m[r],a=3*r,b[a]=o.x,b[a+1]=o.y,b[a+2]=o.z;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglVertexBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,b,t)}if(T){for(i=0;x>i;i++)s=g[i],a=3*i,_[a]=s.r,_[a+1]=s.g,_[a+2]=s.b;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglColorBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,_,t)}if(C){for(n=0;w>n;n++)l=v[n],a=3*n,S[a]=l.x,S[a+1]=l.y,S[a+2]=l.z;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglNormalBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,S,t)}if(A)for(h=0,c=A.length;c>h;h++)if(p=A[h],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(a=0,f=p.value.length,1===p.size)for(u=0;f>u;u++)p.array[u]=p.value[u];else if(2===p.size)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,a+=2;else if(3===p.size)if("c"===p.type)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.r,p.array[a+1]=d.g,p.array[a+2]=d.b,a+=3;else for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,a+=3;else if(4===p.size)for(u=0;f>u;u++)d=p.value[u],p.array[a]=d.x,p.array[a+1]=d.y,p.array[a+2]=d.z,p.array[a+3]=d.w,a+=4;Oe.bindBuffer(Oe.ARRAY_BUFFER,p.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,p.array,t)}}function b(e,t,r,i,n){if(e.__inittedArrays){var a,s,l,h,c,u,f,p,v,y,x,w,b,_,S,M,T,C,A,E,L,P,R,D,F,N,U,z,V,B,O,I,k,H,G,j,W,X,q,Y,K,$,Q,Z,J,ee,te,re,ie=d(n),ne=m(n),oe=g(n),ae=ie===o.SmoothShading,se=0,le=0,he=0,ce=0,ue=0,fe=0,pe=0,de=0,me=0,ge=0,ve=0,ye=0,xe=0,we=e.__vertexArray,be=e.__uvArray,_e=e.__uv2Array,Se=e.__normalArray,Me=e.__tangentArray,Te=e.__colorArray,Ce=e.__skinIndexArray,Ae=e.__skinWeightArray,Ee=e.__morphTargetsArrays,Le=e.__morphNormalsArrays,Pe=e.__webglCustomAttributesList,Re=e.__faceArray,De=e.__lineArray,Fe=t.geometry,Ne=Fe.verticesNeedUpdate,Ue=Fe.elementsNeedUpdate,ze=Fe.uvsNeedUpdate,Ve=Fe.normalsNeedUpdate,Be=Fe.tangentsNeedUpdate,Ie=Fe.colorsNeedUpdate,ke=Fe.morphTargetsNeedUpdate,He=Fe.vertices,Ge=e.faces3,je=e.faces4,We=Fe.faces,Xe=Fe.faceVertexUvs[0],qe=Fe.faceVertexUvs[1],Ye=(Fe.colors,Fe.skinIndices),Ke=Fe.skinWeights,$e=Fe.morphTargets,Qe=Fe.morphNormals;if(Ne){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],w=He[h.a],b=He[h.b],_=He[h.c],we[le]=w.x,we[le+1]=w.y,we[le+2]=w.z,we[le+3]=b.x,we[le+4]=b.y,we[le+5]=b.z,we[le+6]=_.x,we[le+7]=_.y,we[le+8]=_.z,le+=9;for(a=0,s=je.length;s>a;a++)h=We[je[a]],w=He[h.a],b=He[h.b],_=He[h.c],S=He[h.d],we[le]=w.x,we[le+1]=w.y,we[le+2]=w.z,we[le+3]=b.x,we[le+4]=b.y,we[le+5]=b.z,we[le+6]=_.x,we[le+7]=_.y,we[le+8]=_.z,we[le+9]=S.x,we[le+10]=S.y,we[le+11]=S.z,le+=12;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglVertexBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,we,r)}if(ke)for(K=0,$=$e.length;$>K;K++){for(ve=0,a=0,s=Ge.length;s>a;a++)J=Ge[a],h=We[J],w=$e[K].vertices[h.a],b=$e[K].vertices[h.b],_=$e[K].vertices[h.c],Q=Ee[K],Q[ve]=w.x,Q[ve+1]=w.y,Q[ve+2]=w.z,Q[ve+3]=b.x,Q[ve+4]=b.y,Q[ve+5]=b.z,Q[ve+6]=_.x,Q[ve+7]=_.y,Q[ve+8]=_.z,n.morphNormals&&(ae?(ee=Qe[K].vertexNormals[J],E=ee.a,L=ee.b,P=ee.c):(E=Qe[K].faceNormals[J],L=E,P=E),Z=Le[K],Z[ve]=E.x,Z[ve+1]=E.y,Z[ve+2]=E.z,Z[ve+3]=L.x,Z[ve+4]=L.y,Z[ve+5]=L.z,Z[ve+6]=P.x,Z[ve+7]=P.y,Z[ve+8]=P.z),ve+=9;for(a=0,s=je.length;s>a;a++)J=je[a],h=We[J],w=$e[K].vertices[h.a],b=$e[K].vertices[h.b],_=$e[K].vertices[h.c],S=$e[K].vertices[h.d],Q=Ee[K],Q[ve]=w.x,Q[ve+1]=w.y,Q[ve+2]=w.z,Q[ve+3]=b.x,Q[ve+4]=b.y,Q[ve+5]=b.z,Q[ve+6]=_.x,Q[ve+7]=_.y,Q[ve+8]=_.z,Q[ve+9]=S.x,Q[ve+10]=S.y,Q[ve+11]=S.z,n.morphNormals&&(ae?(ee=Qe[K].vertexNormals[J],E=ee.a,L=ee.b,P=ee.c,R=ee.d):(E=Qe[K].faceNormals[J],L=E,P=E,R=E),Z=Le[K],Z[ve]=E.x,Z[ve+1]=E.y,Z[ve+2]=E.z,Z[ve+3]=L.x,Z[ve+4]=L.y,Z[ve+5]=L.z,Z[ve+6]=P.x,Z[ve+7]=P.y,Z[ve+8]=P.z,Z[ve+9]=R.x,Z[ve+10]=R.y,Z[ve+11]=R.z),ve+=12;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[K]),Oe.bufferData(Oe.ARRAY_BUFFER,Ee[K],r),n.morphNormals&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[K]),Oe.bufferData(Oe.ARRAY_BUFFER,Le[K],r))}if(Ke.length){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],z=Ke[h.a],V=Ke[h.b],B=Ke[h.c],Ae[ge]=z.x,Ae[ge+1]=z.y,Ae[ge+2]=z.z,Ae[ge+3]=z.w,Ae[ge+4]=V.x,Ae[ge+5]=V.y,Ae[ge+6]=V.z,Ae[ge+7]=V.w,Ae[ge+8]=B.x,Ae[ge+9]=B.y,Ae[ge+10]=B.z,Ae[ge+11]=B.w,I=Ye[h.a],k=Ye[h.b],H=Ye[h.c],Ce[ge]=I.x,Ce[ge+1]=I.y,Ce[ge+2]=I.z,Ce[ge+3]=I.w,Ce[ge+4]=k.x,Ce[ge+5]=k.y,Ce[ge+6]=k.z,Ce[ge+7]=k.w,Ce[ge+8]=H.x,Ce[ge+9]=H.y,Ce[ge+10]=H.z,Ce[ge+11]=H.w,ge+=12;for(a=0,s=je.length;s>a;a++)h=We[je[a]],z=Ke[h.a],V=Ke[h.b],B=Ke[h.c],O=Ke[h.d],Ae[ge]=z.x,Ae[ge+1]=z.y,Ae[ge+2]=z.z,Ae[ge+3]=z.w,Ae[ge+4]=V.x,Ae[ge+5]=V.y,Ae[ge+6]=V.z,Ae[ge+7]=V.w,Ae[ge+8]=B.x,Ae[ge+9]=B.y,Ae[ge+10]=B.z,Ae[ge+11]=B.w,Ae[ge+12]=O.x,Ae[ge+13]=O.y,Ae[ge+14]=O.z,Ae[ge+15]=O.w,I=Ye[h.a],k=Ye[h.b],H=Ye[h.c],G=Ye[h.d],Ce[ge]=I.x,Ce[ge+1]=I.y,Ce[ge+2]=I.z,Ce[ge+3]=I.w,Ce[ge+4]=k.x,Ce[ge+5]=k.y,Ce[ge+6]=k.z,Ce[ge+7]=k.w,Ce[ge+8]=H.x,Ce[ge+9]=H.y,Ce[ge+10]=H.z,Ce[ge+11]=H.w,Ce[ge+12]=G.x,Ce[ge+13]=G.y,Ce[ge+14]=G.z,Ce[ge+15]=G.w,ge+=16;ge>0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,Ce,r),Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,Ae,r))}if(Ie&&ne){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],f=h.vertexColors,p=h.color,3===f.length&&ne===o.VertexColors?(D=f[0],F=f[1],N=f[2]):(D=p,F=p,N=p),Te[me]=D.r,Te[me+1]=D.g,Te[me+2]=D.b,Te[me+3]=F.r,Te[me+4]=F.g,Te[me+5]=F.b,Te[me+6]=N.r,Te[me+7]=N.g,Te[me+8]=N.b,me+=9;for(a=0,s=je.length;s>a;a++)h=We[je[a]],f=h.vertexColors,p=h.color,4===f.length&&ne===o.VertexColors?(D=f[0],F=f[1],N=f[2],U=f[3]):(D=p,F=p,N=p,U=p),Te[me]=D.r,Te[me+1]=D.g,Te[me+2]=D.b,Te[me+3]=F.r,Te[me+4]=F.g,Te[me+5]=F.b,Te[me+6]=N.r,Te[me+7]=N.g,Te[me+8]=N.b,Te[me+9]=U.r,Te[me+10]=U.g,Te[me+11]=U.b,me+=12;me>0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglColorBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,Te,r))}if(Be&&Fe.hasTangents){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],v=h.vertexTangents,M=v[0],T=v[1],C=v[2],Me[pe]=M.x,Me[pe+1]=M.y,Me[pe+2]=M.z,Me[pe+3]=M.w,Me[pe+4]=T.x,Me[pe+5]=T.y,Me[pe+6]=T.z,Me[pe+7]=T.w,Me[pe+8]=C.x,Me[pe+9]=C.y,Me[pe+10]=C.z,Me[pe+11]=C.w,pe+=12;for(a=0,s=je.length;s>a;a++)h=We[je[a]],v=h.vertexTangents,M=v[0],T=v[1],C=v[2],A=v[3],Me[pe]=M.x,Me[pe+1]=M.y,Me[pe+2]=M.z,Me[pe+3]=M.w,Me[pe+4]=T.x,Me[pe+5]=T.y,Me[pe+6]=T.z,Me[pe+7]=T.w,Me[pe+8]=C.x,Me[pe+9]=C.y,Me[pe+10]=C.z,Me[pe+11]=C.w,Me[pe+12]=A.x,Me[pe+13]=A.y,Me[pe+14]=A.z,Me[pe+15]=A.w,pe+=16;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglTangentBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,Me,r)}if(Ve&&ie){for(a=0,s=Ge.length;s>a;a++)if(h=We[Ge[a]],c=h.vertexNormals,u=h.normal,3===c.length&&ae)for(j=0;3>j;j++)X=c[j],Se[fe]=X.x,Se[fe+1]=X.y,Se[fe+2]=X.z,fe+=3;else for(j=0;3>j;j++)Se[fe]=u.x,Se[fe+1]=u.y,Se[fe+2]=u.z,fe+=3;for(a=0,s=je.length;s>a;a++)if(h=We[je[a]],c=h.vertexNormals,u=h.normal,4===c.length&&ae)for(j=0;4>j;j++)X=c[j],Se[fe]=X.x,Se[fe+1]=X.y,Se[fe+2]=X.z,fe+=3;else for(j=0;4>j;j++)Se[fe]=u.x,Se[fe+1]=u.y,Se[fe+2]=u.z,fe+=3;Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglNormalBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,Se,r)}if(ze&&Xe&&oe){for(a=0,s=Ge.length;s>a;a++)if(l=Ge[a],y=Xe[l],void 0!==y)for(j=0;3>j;j++)q=y[j],be[he]=q.x,be[he+1]=q.y,he+=2;for(a=0,s=je.length;s>a;a++)if(l=je[a],y=Xe[l],void 0!==y)for(j=0;4>j;j++)q=y[j],be[he]=q.x,be[he+1]=q.y,he+=2;he>0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglUVBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,be,r))}if(ze&&qe&&oe){for(a=0,s=Ge.length;s>a;a++)if(l=Ge[a],x=qe[l],void 0!==x)for(j=0;3>j;j++)Y=x[j],_e[ce]=Y.x,_e[ce+1]=Y.y,ce+=2;for(a=0,s=je.length;s>a;a++)if(l=je[a],x=qe[l],void 0!==x)for(j=0;4>j;j++)Y=x[j],_e[ce]=Y.x,_e[ce+1]=Y.y,ce+=2;ce>0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglUV2Buffer),Oe.bufferData(Oe.ARRAY_BUFFER,_e,r))}if(Ue){for(a=0,s=Ge.length;s>a;a++)Re[ue]=se,Re[ue+1]=se+1,Re[ue+2]=se+2,ue+=3,De[de]=se,De[de+1]=se+1,De[de+2]=se,De[de+3]=se+2,De[de+4]=se+1,De[de+5]=se+2,de+=6,se+=3;for(a=0,s=je.length;s>a;a++)Re[ue]=se,Re[ue+1]=se+1,Re[ue+2]=se+3,Re[ue+3]=se+1,Re[ue+4]=se+2,Re[ue+5]=se+3,ue+=6,De[de]=se,De[de+1]=se+1,De[de+2]=se,De[de+3]=se+3,De[de+4]=se+1,De[de+5]=se+2,De[de+6]=se+2,De[de+7]=se+3,de+=8,se+=4;Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Oe.bufferData(Oe.ELEMENT_ARRAY_BUFFER,Re,r),Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Oe.bufferData(Oe.ELEMENT_ARRAY_BUFFER,De,r)}if(Pe)for(j=0,W=Pe.length;W>j;j++)if(re=Pe[j],re.__original.needsUpdate){if(ye=0,xe=0,1===re.size){if(void 0===re.boundTo||"vertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],re.array[ye]=re.value[h.a],re.array[ye+1]=re.value[h.b],re.array[ye+2]=re.value[h.c],ye+=3;for(a=0,s=je.length;s>a;a++)h=We[je[a]],re.array[ye]=re.value[h.a],re.array[ye+1]=re.value[h.b],re.array[ye+2]=re.value[h.c],re.array[ye+3]=re.value[h.d],ye+=4}else if("faces"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],re.array[ye]=te,re.array[ye+1]=te,re.array[ye+2]=te,ye+=3;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],re.array[ye]=te,re.array[ye+1]=te,re.array[ye+2]=te,re.array[ye+3]=te,ye+=4}}else if(2===re.size){if(void 0===re.boundTo||"vertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=b.x,re.array[ye+3]=b.y,re.array[ye+4]=_.x,re.array[ye+5]=_.y,ye+=6;for(a=0,s=je.length;s>a;a++)h=We[je[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],S=re.value[h.d],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=b.x,re.array[ye+3]=b.y,re.array[ye+4]=_.x,re.array[ye+5]=_.y,re.array[ye+6]=S.x,re.array[ye+7]=S.y,ye+=8}else if("faces"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],w=te,b=te,_=te,re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=b.x,re.array[ye+3]=b.y,re.array[ye+4]=_.x,re.array[ye+5]=_.y,ye+=6;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],w=te,b=te,_=te,S=te,re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=b.x,re.array[ye+3]=b.y,re.array[ye+4]=_.x,re.array[ye+5]=_.y,re.array[ye+6]=S.x,re.array[ye+7]=S.y,ye+=8}}else if(3===re.size){var Ze;if(Ze="c"===re.type?["r","g","b"]:["x","y","z"],void 0===re.boundTo||"vertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],ye+=9;for(a=0,s=je.length;s>a;a++)h=We[je[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],S=re.value[h.d],re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],re.array[ye+9]=S[Ze[0]],re.array[ye+10]=S[Ze[1]],re.array[ye+11]=S[Ze[2]],ye+=12}else if("faces"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],w=te,b=te,_=te,re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],ye+=9;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],w=te,b=te,_=te,S=te,re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],re.array[ye+9]=S[Ze[0]],re.array[ye+10]=S[Ze[1]],re.array[ye+11]=S[Ze[2]],ye+=12}else if("faceVertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],w=te[0],b=te[1],_=te[2],re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],ye+=9;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],w=te[0],b=te[1],_=te[2],S=te[3],re.array[ye]=w[Ze[0]],re.array[ye+1]=w[Ze[1]],re.array[ye+2]=w[Ze[2]],re.array[ye+3]=b[Ze[0]],re.array[ye+4]=b[Ze[1]],re.array[ye+5]=b[Ze[2]],re.array[ye+6]=_[Ze[0]],re.array[ye+7]=_[Ze[1]],re.array[ye+8]=_[Ze[2]],re.array[ye+9]=S[Ze[0]],re.array[ye+10]=S[Ze[1]],re.array[ye+11]=S[Ze[2]],ye+=12}}else if(4===re.size)if(void 0===re.boundTo||"vertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)h=We[Ge[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,ye+=12;for(a=0,s=je.length;s>a;a++)h=We[je[a]],w=re.value[h.a],b=re.value[h.b],_=re.value[h.c],S=re.value[h.d],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,re.array[ye+12]=S.x,re.array[ye+13]=S.y,re.array[ye+14]=S.z,re.array[ye+15]=S.w,ye+=16}else if("faces"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],w=te,b=te,_=te,re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,ye+=12;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],w=te,b=te,_=te,S=te,re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,re.array[ye+12]=S.x,re.array[ye+13]=S.y,re.array[ye+14]=S.z,re.array[ye+15]=S.w,ye+=16}else if("faceVertices"===re.boundTo){for(a=0,s=Ge.length;s>a;a++)te=re.value[Ge[a]],w=te[0],b=te[1],_=te[2],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,ye+=12;for(a=0,s=je.length;s>a;a++)te=re.value[je[a]],w=te[0],b=te[1],_=te[2],S=te[3],re.array[ye]=w.x,re.array[ye+1]=w.y,re.array[ye+2]=w.z,re.array[ye+3]=w.w,re.array[ye+4]=b.x,re.array[ye+5]=b.y,re.array[ye+6]=b.z,re.array[ye+7]=b.w,re.array[ye+8]=_.x,re.array[ye+9]=_.y,re.array[ye+10]=_.z,re.array[ye+11]=_.w,re.array[ye+12]=S.x,re.array[ye+13]=S.y,re.array[ye+14]=S.z,re.array[ye+15]=S.w,ye+=16}Oe.bindBuffer(Oe.ARRAY_BUFFER,re.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,re.array,r)}i&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function _(e,t,r){var i=e.attributes,n=i.index,o=i.position,a=i.normal,s=i.uv,l=i.color,h=i.tangent;if(e.elementsNeedUpdate&&void 0!==n&&(Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,n.buffer),Oe.bufferData(Oe.ELEMENT_ARRAY_BUFFER,n.array,t)),e.verticesNeedUpdate&&void 0!==o&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,o.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,o.array,t)),e.normalsNeedUpdate&&void 0!==a&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,a.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,a.array,t)),e.uvsNeedUpdate&&void 0!==s&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,s.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,s.array,t)),e.colorsNeedUpdate&&void 0!==l&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,l.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,l.array,t)),e.tangentsNeedUpdate&&void 0!==h&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,h.buffer),Oe.bufferData(Oe.ARRAY_BUFFER,h.array,t)),r)for(var c in e.attributes)delete e.attributes[c].array}function S(e){yt[e]||(Oe.enableVertexAttribArray(e),yt[e]=!0)}function M(){for(var e in yt)yt[e]&&(Oe.disableVertexAttribArray(e),yt[e]=!1)}function T(e,t,r){var i=e.program.attributes;if(-1!==r.morphTargetBase&&i.position>=0?(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[r.morphTargetBase]),S(i.position),Oe.vertexAttribPointer(i.position,3,Oe.FLOAT,!1,0,0)):i.position>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglVertexBuffer),S(i.position),Oe.vertexAttribPointer(i.position,3,Oe.FLOAT,!1,0,0)),r.morphTargetForcedOrder.length)for(var n=0,o=r.morphTargetForcedOrder,a=r.morphTargetInfluences;n<e.numSupportedMorphTargets&&n<o.length;)i["morphTarget"+n]>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[n]]),S(i["morphTarget"+n]),Oe.vertexAttribPointer(i["morphTarget"+n],3,Oe.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[n]]),S(i["morphNormal"+n]),Oe.vertexAttribPointer(i["morphNormal"+n],3,Oe.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[o[n]],n++;else{var s,l,h=[],a=r.morphTargetInfluences,c=a.length;for(l=0;c>l;l++)s=a[l],s>0&&h.push([s,l]);h.length>e.numSupportedMorphTargets?(h.sort(A),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(A):0===h.length&&h.push([0,0]);for(var u,n=0;n<e.numSupportedMorphTargets;)h[n]?(u=h[n][1],i["morphTarget"+n]>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),S(i["morphTarget"+n]),Oe.vertexAttribPointer(i["morphTarget"+n],3,Oe.FLOAT,!1,0,0)),i["morphNormal"+n]>=0&&e.morphNormals&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),S(i["morphNormal"+n]),Oe.vertexAttribPointer(i["morphNormal"+n],3,Oe.FLOAT,!1,0,0)),r.__webglMorphTargetInfluences[n]=a[u]):r.__webglMorphTargetInfluences[n]=0,n++}null!==e.program.uniforms.morphTargetInfluences&&Oe.uniform1fv(e.program.uniforms.morphTargetInfluences,r.__webglMorphTargetInfluences)}function C(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}function A(e,t){return t[0]-e[0]}function E(e,t,r){if(e.length)for(var i=0,n=e.length;n>i;i++)qe=null,Qe=null,rt=-1,at=-1,st=-1,et=-1,tt=-1,$e=-1,Ke=-1,Mt=!0,e[i].render(t,r,gt,vt),qe=null,Qe=null,rt=-1,at=-1,st=-1,et=-1,tt=-1,$e=-1,Ke=-1,Mt=!0}function L(e,t,r,i,n,a,s,l){var h,c,u,f,p,d,m;t?(p=e.length-1,d=-1,m=-1):(p=0,d=e.length,m=1);for(var g=p;g!==d;g+=m)if(h=e[g],h.render){if(c=h.object,u=h.buffer,l)f=l;else{if(f=h[r],!f)continue;s&&je.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),je.setDepthTest(f.depthTest),je.setDepthWrite(f.depthWrite),le(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}je.setMaterialFaces(f),u instanceof o.BufferGeometry?je.renderBufferDirect(i,n,a,f,u,c):je.renderBuffer(i,n,a,f,u,c)}}function P(e,t,r,i,n,o,a){for(var s,l,h,c=0,u=e.length;u>c;c++)if(s=e[c],l=s.object,l.visible){if(a)h=a;else{if(h=s[t],!h)continue;o&&je.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),je.setDepthTest(h.depthTest),je.setDepthWrite(h.depthWrite),le(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}je.renderImmediateObject(r,i,n,h,l)}}function R(e){var t=e.object,r=t.material;r.transparent?(e.transparent=r,e.opaque=null):(e.opaque=r,e.transparent=null)}function D(e){var t,r,i,n=e.object,a=e.buffer;i=n.material,i instanceof o.MeshFaceMaterial?(r=a.materialIndex,t=i.materials[r],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=i,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function F(e,t){var r,i,n,a,s,l,h={},c=e.morphTargets.length,u=e.morphNormals.length,f=t instanceof o.MeshFaceMaterial;for(e.geometryGroups={},r=0,i=e.faces.length;i>r;r++)n=e.faces[r],a=f?n.materialIndex:0,void 0===h[a]&&(h[a]={hash:a,counter:0}),l=h[a].hash+"_"+h[a].counter,void 0===e.geometryGroups[l]&&(e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:a,vertices:0,numMorphTargets:c,numMorphNormals:u}),s=n instanceof o.Face3?3:4,e.geometryGroups[l].vertices+s>65535&&(h[a].counter+=1,l=h[a].hash+"_"+h[a].counter,void 0===e.geometryGroups[l]&&(e.geometryGroups[l]={faces3:[],faces4:[],materialIndex:a,vertices:0,numMorphTargets:c,numMorphNormals:u})),n instanceof o.Face3?e.geometryGroups[l].faces3.push(r):e.geometryGroups[l].faces4.push(r),e.geometryGroups[l].vertices+=s;e.geometryGroupsList=[];for(var p in e.geometryGroups)e.geometryGroups[p].id=Ze++,e.geometryGroupsList.push(e.geometryGroups[p])}function N(e,a){var s,f,p,d;if(!e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new o.Matrix4,e._normalMatrix=new o.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Bt)),e instanceof o.Mesh)if(f=e.geometry,p=e.material,f instanceof o.Geometry){void 0===f.geometryGroups&&F(f,p);for(s in f.geometryGroups)d=f.geometryGroups[s],d.__webglVertexBuffer||(n(d),u(d,e),f.verticesNeedUpdate=!0,f.morphTargetsNeedUpdate=!0,f.elementsNeedUpdate=!0,f.uvsNeedUpdate=!0,f.normalsNeedUpdate=!0,f.tangentsNeedUpdate=!0,f.colorsNeedUpdate=!0)}else f instanceof o.BufferGeometry&&v(f);else e instanceof o.Ribbon?(f=e.geometry,f.__webglVertexBuffer||(i(f),c(f,e),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.normalsNeedUpdate=!0)):e instanceof o.Line?(f=e.geometry,f.__webglVertexBuffer||(f instanceof o.Geometry?(r(f),h(f,e),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0,f.lineDistancesNeedUpdate=!0):f instanceof o.BufferGeometry&&v(f))):e instanceof o.ParticleSystem&&(f=e.geometry,f.__webglVertexBuffer||(f instanceof o.Geometry?(t(f),l(f,e),f.verticesNeedUpdate=!0,f.colorsNeedUpdate=!0):f instanceof o.BufferGeometry&&v(f)));if(!e.__webglActive){if(e instanceof o.Mesh){if(f=e.geometry,f instanceof o.BufferGeometry)U(a.__webglObjects,f,e);else if(f instanceof o.Geometry)for(s in f.geometryGroups)d=f.geometryGroups[s],U(a.__webglObjects,d,e)}else e instanceof o.Ribbon||e instanceof o.Line||e instanceof o.ParticleSystem?(f=e.geometry,U(a.__webglObjects,f,e)):e instanceof o.ImmediateRenderObject||e.immediateRenderCallback?z(a.__webglObjectsImmediate,e):e instanceof o.Sprite?a.__webglSprites.push(e):e instanceof o.LensFlare&&a.__webglFlares.push(e);e.__webglActive=!0}}function U(e,t,r){e.push({buffer:t,object:r,opaque:null,transparent:null})}function z(e,t){e.push({object:t,opaque:null,transparent:null})}function V(e){var t,r,i,n=e.geometry;if(e instanceof o.Mesh)if(n instanceof o.BufferGeometry)(n.verticesNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate)&&_(n,Oe.DYNAMIC_DRAW,!n.dynamic),n.verticesNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1;else{for(var a=0,s=n.geometryGroupsList.length;s>a;a++)t=n.geometryGroupsList[a],
i=f(e,t),n.buffersNeedUpdate&&u(t,e),r=i.attributes&&B(i),(n.verticesNeedUpdate||n.morphTargetsNeedUpdate||n.elementsNeedUpdate||n.uvsNeedUpdate||n.normalsNeedUpdate||n.colorsNeedUpdate||n.tangentsNeedUpdate||r)&&b(t,e,Oe.DYNAMIC_DRAW,!n.dynamic,i);n.verticesNeedUpdate=!1,n.morphTargetsNeedUpdate=!1,n.elementsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.tangentsNeedUpdate=!1,n.buffersNeedUpdate=!1,i.attributes&&O(i)}else e instanceof o.Ribbon?(i=f(e,n),r=i.attributes&&B(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate||r)&&w(n,Oe.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.normalsNeedUpdate=!1,i.attributes&&O(i)):e instanceof o.Line?n instanceof o.BufferGeometry?((n.verticesNeedUpdate||n.colorsNeedUpdate)&&_(n,Oe.DYNAMIC_DRAW,!n.dynamic),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1):(i=f(e,n),r=i.attributes&&B(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||n.lineDistancesNeedUpdate||r)&&x(n,Oe.DYNAMIC_DRAW),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,n.lineDistancesNeedUpdate=!1,i.attributes&&O(i)):e instanceof o.ParticleSystem&&(n instanceof o.BufferGeometry?((n.verticesNeedUpdate||n.colorsNeedUpdate)&&_(n,Oe.DYNAMIC_DRAW,!n.dynamic),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1):(i=f(e,n),r=i.attributes&&B(i),(n.verticesNeedUpdate||n.colorsNeedUpdate||e.sortParticles||r)&&y(n,Oe.DYNAMIC_DRAW,e),n.verticesNeedUpdate=!1,n.colorsNeedUpdate=!1,i.attributes&&O(i)))}function B(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function O(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function I(e,t){e instanceof o.Mesh||e instanceof o.ParticleSystem||e instanceof o.Ribbon||e instanceof o.Line?k(t.__webglObjects,e):e instanceof o.Sprite?H(t.__webglSprites,e):e instanceof o.LensFlare?H(t.__webglFlares,e):(e instanceof o.ImmediateRenderObject||e.immediateRenderCallback)&&k(t.__webglObjectsImmediate,e),e.__webglActive=!1}function k(e,t){for(var r=e.length-1;r>=0;r--)e[r].object===t&&e.splice(r,1)}function H(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)}function G(e,t){e.uniforms=o.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function j(e,t,r,i,n){Je=0,i.needsUpdate&&(i.program&&Wt(i),je.initMaterial(i,t,r,n),i.needsUpdate=!1),i.morphTargets&&(n.__webglMorphTargetInfluences||(n.__webglMorphTargetInfluences=new Float32Array(je.maxMorphTargets)));var a=!1,s=i.program,l=s.uniforms,h=i.uniforms;if(s!==qe&&(Oe.useProgram(s),qe=s,a=!0),i.id!==Ke&&(Ke=i.id,a=!0),(a||e!==Qe)&&(Oe.uniformMatrix4fv(l.projectionMatrix,!1,e.projectionMatrix.elements),e!==Qe&&(Qe=e)),i.skinning)if(Rt&&n.useVertexTexture){if(null!==l.boneTexture){var c=te();Oe.uniform1i(l.boneTexture,c),je.setTexture(n.boneTexture,c)}}else null!==l.boneGlobalMatrices&&Oe.uniformMatrix4fv(l.boneGlobalMatrices,!1,n.boneMatrices);return a&&(r&&i.fog&&K(h,r),(i instanceof o.MeshPhongMaterial||i instanceof o.MeshLambertMaterial||i.lights)&&(Mt&&(ae(s,t),Mt=!1),Z(h,Tt)),(i instanceof o.MeshBasicMaterial||i instanceof o.MeshLambertMaterial||i instanceof o.MeshPhongMaterial)&&W(h,i),i instanceof o.LineBasicMaterial?X(h,i):i instanceof o.LineDashedMaterial?(X(h,i),q(h,i)):i instanceof o.ParticleBasicMaterial?Y(h,i):i instanceof o.MeshPhongMaterial?$(h,i):i instanceof o.MeshLambertMaterial?Q(h,i):i instanceof o.MeshDepthMaterial?(h.mNear.value=e.near,h.mFar.value=e.far,h.opacity.value=i.opacity):i instanceof o.MeshNormalMaterial&&(h.opacity.value=i.opacity),n.receiveShadow&&!i._shadowPass&&J(h,t),re(s,i.uniformsList),(i instanceof o.ShaderMaterial||i instanceof o.MeshPhongMaterial||i.envMap)&&null!==l.cameraPosition&&(_t.getPositionFromMatrix(e.matrixWorld),Oe.uniform3f(l.cameraPosition,_t.x,_t.y,_t.z)),(i instanceof o.MeshPhongMaterial||i instanceof o.MeshLambertMaterial||i instanceof o.ShaderMaterial||i.skinning)&&null!==l.viewMatrix&&Oe.uniformMatrix4fv(l.viewMatrix,!1,e.matrixWorldInverse.elements)),ee(l,n),null!==l.modelMatrix&&Oe.uniformMatrix4fv(l.modelMatrix,!1,n.matrixWorld.elements),s}function W(e,t){e.opacity.value=t.opacity,je.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var r;if(t.map?r=t.map:t.specularMap?r=t.specularMap:t.normalMap?r=t.normalMap:t.bumpMap&&(r=t.bumpMap),void 0!==r){var i=r.offset,n=r.repeat;e.offsetRepeat.value.set(i.x,i.y,n.x,n.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof o.WebGLRenderTargetCube?1:-1,je.gammaInput?e.reflectivity.value=t.reflectivity:e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof o.CubeRefractionMapping}function X(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function q(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function Y(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Pe.height/2,e.map.value=t.map}function K(e,t){e.fogColor.value=t.color,t instanceof o.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof o.FogExp2&&(e.fogDensity.value=t.density)}function $(e,t){e.shininess.value=t.shininess,je.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Q(e,t){je.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function Z(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function J(e,t){if(e.shadowMatrix)for(var r=0,i=0,n=t.length;n>i;i++){var a=t[i];a.castShadow&&(a instanceof o.SpotLight||a instanceof o.DirectionalLight&&!a.shadowCascade)&&(e.shadowMap.value[r]=a.shadowMap,e.shadowMapSize.value[r]=a.shadowMapSize,e.shadowMatrix.value[r]=a.shadowMatrix,e.shadowDarkness.value[r]=a.shadowDarkness,e.shadowBias.value[r]=a.shadowBias,r++)}}function ee(e,t){Oe.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Oe.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function te(){var e=Je;return e>=Ct&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ct),Je+=1,e}function re(e,t){var r,i,n,a,s,l,h,c,u,f,p;for(u=0,f=t.length;f>u;u++)if(a=e.uniforms[t[u][1]])if(r=t[u][0],n=r.type,i=r.value,"i"===n)Oe.uniform1i(a,i);else if("f"===n)Oe.uniform1f(a,i);else if("v2"===n)Oe.uniform2f(a,i.x,i.y);else if("v3"===n)Oe.uniform3f(a,i.x,i.y,i.z);else if("v4"===n)Oe.uniform4f(a,i.x,i.y,i.z,i.w);else if("c"===n)Oe.uniform3f(a,i.r,i.g,i.b);else if("iv1"===n)Oe.uniform1iv(a,i);else if("iv"===n)Oe.uniform3iv(a,i);else if("fv1"===n)Oe.uniform1fv(a,i);else if("fv"===n)Oe.uniform3fv(a,i);else if("v2v"===n){for(void 0===r._array&&(r._array=new Float32Array(2*i.length)),h=0,c=i.length;c>h;h++)p=2*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y;Oe.uniform2fv(a,r._array)}else if("v3v"===n){for(void 0===r._array&&(r._array=new Float32Array(3*i.length)),h=0,c=i.length;c>h;h++)p=3*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y,r._array[p+2]=i[h].z;Oe.uniform3fv(a,r._array)}else if("v4v"===n){for(void 0===r._array&&(r._array=new Float32Array(4*i.length)),h=0,c=i.length;c>h;h++)p=4*h,r._array[p]=i[h].x,r._array[p+1]=i[h].y,r._array[p+2]=i[h].z,r._array[p+3]=i[h].w;Oe.uniform4fv(a,r._array)}else if("m4"===n)void 0===r._array&&(r._array=new Float32Array(16)),i.flattenToArray(r._array),Oe.uniformMatrix4fv(a,!1,r._array);else if("m4v"===n){for(void 0===r._array&&(r._array=new Float32Array(16*i.length)),h=0,c=i.length;c>h;h++)i[h].flattenToArrayOffset(r._array,16*h);Oe.uniformMatrix4fv(a,!1,r._array)}else if("t"===n){if(s=i,l=te(),Oe.uniform1i(a,l),!s)continue;s.image instanceof Array&&6===s.image.length?ye(s,l):s instanceof o.WebGLRenderTargetCube?xe(s,l):je.setTexture(s,l)}else if("tv"===n){for(void 0===r._array&&(r._array=[]),h=0,c=r.value.length;c>h;h++)r._array[h]=te();for(Oe.uniform1iv(a,r._array),h=0,c=r.value.length;c>h;h++)s=r.value[h],l=r._array[h],s&&je.setTexture(s,l)}}function ie(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getInverse(e._modelViewMatrix),e._normalMatrix.transpose()}function ne(e,t,r,i){e[t]=r.r*r.r*i,e[t+1]=r.g*r.g*i,e[t+2]=r.b*r.b*i}function oe(e,t,r,i){e[t]=r.r*i,e[t+1]=r.g*i,e[t+2]=r.b*i}function ae(e,t){var r,i,n,a,s,l,h,c,u,f=0,p=0,d=0,m=Tt,g=m.directional.colors,v=m.directional.positions,y=m.point.colors,x=m.point.positions,w=m.point.distances,b=m.spot.colors,_=m.spot.positions,S=m.spot.distances,M=m.spot.directions,T=m.spot.anglesCos,C=m.spot.exponents,A=m.hemi.skyColors,E=m.hemi.groundColors,L=m.hemi.positions,P=0,R=0,D=0,F=0,N=0,U=0,z=0,V=0,B=0,O=0,I=0,k=0;for(r=0,i=t.length;i>r;r++)if(n=t[r],!n.onlyShadow)if(a=n.color,h=n.intensity,u=n.distance,n instanceof o.AmbientLight){if(!n.visible)continue;je.gammaInput?(f+=a.r*a.r,p+=a.g*a.g,d+=a.b*a.b):(f+=a.r,p+=a.g,d+=a.b)}else if(n instanceof o.DirectionalLight){if(N+=1,!n.visible)continue;if(St.getPositionFromMatrix(n.matrixWorld),_t.getPositionFromMatrix(n.target.matrixWorld),St.sub(_t),St.normalize(),0===St.x&&0===St.y&&0===St.z)continue;B=3*P,v[B]=St.x,v[B+1]=St.y,v[B+2]=St.z,je.gammaInput?ne(g,B,a,h*h):oe(g,B,a,h),P+=1}else if(n instanceof o.PointLight){if(U+=1,!n.visible)continue;O=3*R,je.gammaInput?ne(y,O,a,h*h):oe(y,O,a,h),_t.getPositionFromMatrix(n.matrixWorld),x[O]=_t.x,x[O+1]=_t.y,x[O+2]=_t.z,w[R]=u,R+=1}else if(n instanceof o.SpotLight){if(z+=1,!n.visible)continue;I=3*D,je.gammaInput?ne(b,I,a,h*h):oe(b,I,a,h),_t.getPositionFromMatrix(n.matrixWorld),_[I]=_t.x,_[I+1]=_t.y,_[I+2]=_t.z,S[D]=u,St.copy(_t),_t.getPositionFromMatrix(n.target.matrixWorld),St.sub(_t),St.normalize(),M[I]=St.x,M[I+1]=St.y,M[I+2]=St.z,T[D]=Math.cos(n.angle),C[D]=n.exponent,D+=1}else if(n instanceof o.HemisphereLight){if(V+=1,!n.visible)continue;if(St.getPositionFromMatrix(n.matrixWorld),St.normalize(),0===St.x&&0===St.y&&0===St.z)continue;k=3*F,L[k]=St.x,L[k+1]=St.y,L[k+2]=St.z,s=n.color,l=n.groundColor,je.gammaInput?(c=h*h,ne(A,k,s,c),ne(E,k,l,c)):(oe(A,k,s,h),oe(E,k,l,h)),F+=1}for(r=3*P,i=Math.max(g.length,3*N);i>r;r++)g[r]=0;for(r=3*R,i=Math.max(y.length,3*U);i>r;r++)y[r]=0;for(r=3*D,i=Math.max(b.length,3*z);i>r;r++)b[r]=0;for(r=3*F,i=Math.max(A.length,3*V);i>r;r++)A[r]=0;for(r=3*F,i=Math.max(E.length,3*V);i>r;r++)E[r]=0;m.directional.length=P,m.point.length=R,m.spot.length=D,m.hemi.length=F,m.ambient[0]=f,m.ambient[1]=p,m.ambient[2]=d}function se(e){e!==ut&&(Oe.lineWidth(e),ut=e)}function le(e,t,r){lt!==e&&(e?Oe.enable(Oe.POLYGON_OFFSET_FILL):Oe.disable(Oe.POLYGON_OFFSET_FILL),lt=e),!e||ht===t&&ct===r||(Oe.polygonOffset(t,r),ht=t,ct=r)}function he(e){var t,r,i=[];for(var n in e)t=e[n],t!==!1&&(r="#define "+n+" "+t,i.push(r));return i.join("\n")}function ce(e,t,r,i,n,a,s){var l,h,c,u,f,p=[];e?p.push(e):(p.push(t),p.push(r));for(c in a)p.push(c),p.push(a[c]);for(l in s)p.push(l),p.push(s[l]);for(f=p.join(),l=0,h=We.length;h>l;l++){var d=We[l];if(d.code===f)return d.usedTimes++,d.program}var m="SHADOWMAP_TYPE_BASIC";s.shadowMapType===o.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":s.shadowMapType===o.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var g=he(a);u=Oe.createProgram();var v=["precision "+Re+" float;",g,Pt?"#define VERTEX_TEXTURES":"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"",je.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.boneTextureWidth?"#define N_BONE_PIXEL_X "+s.boneTextureWidth.toFixed(1):"",s.boneTextureHeight?"#define N_BONE_PIXEL_Y "+s.boneTextureHeight.toFixed(1):"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+m:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),y=["precision "+Re+" float;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",g,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",je.gammaInput?"#define GAMMA_INPUT":"",je.gammaOutput?"#define GAMMA_OUTPUT":"",je.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.metal?"#define METAL":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+m:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),x=de("fragment",y+t),w=de("vertex",v+r);Oe.attachShader(u,w),Oe.attachShader(u,x),Oe.linkProgram(u),Oe.getProgramParameter(u,Oe.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+Oe.getProgramParameter(u,Oe.VALIDATE_STATUS)+", gl error ["+Oe.getError()+"]"),Oe.deleteShader(x),Oe.deleteShader(w),u.uniforms={},u.attributes={};var b,_,S,M;b=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],s.useVertexTexture?b.push("boneTexture"):b.push("boneGlobalMatrices");for(_ in i)b.push(_);for(ue(u,b),b=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],M=0;M<s.maxMorphTargets;M++)b.push("morphTarget"+M);for(M=0;M<s.maxMorphNormals;M++)b.push("morphNormal"+M);for(S in n)b.push(S);return fe(u,b),u.id=Xe++,We.push({program:u,code:f,usedTimes:1}),je.info.memory.programs=We.length,u}function ue(e,t){var r,i,n;for(r=0,i=t.length;i>r;r++)n=t[r],e.uniforms[n]=Oe.getUniformLocation(e,n)}function fe(e,t){var r,i,n;for(r=0,i=t.length;i>r;r++)n=t[r],e.attributes[n]=Oe.getAttribLocation(e,n)}function pe(e){for(var t=e.split("\n"),r=0,i=t.length;i>r;r++)t[r]=r+1+": "+t[r];return t.join("\n")}function de(e,t){var r;return"fragment"===e?r=Oe.createShader(Oe.FRAGMENT_SHADER):"vertex"===e&&(r=Oe.createShader(Oe.VERTEX_SHADER)),Oe.shaderSource(r,t),Oe.compileShader(r),Oe.getShaderParameter(r,Oe.COMPILE_STATUS)?r:(console.error(Oe.getShaderInfoLog(r)),console.error(pe(t)),null)}function me(e){return 0===(e&e-1)}function ge(e,t,r){r?(Oe.texParameteri(e,Oe.TEXTURE_WRAP_S,Me(t.wrapS)),Oe.texParameteri(e,Oe.TEXTURE_WRAP_T,Me(t.wrapT)),Oe.texParameteri(e,Oe.TEXTURE_MAG_FILTER,Me(t.magFilter)),Oe.texParameteri(e,Oe.TEXTURE_MIN_FILTER,Me(t.minFilter))):(Oe.texParameteri(e,Oe.TEXTURE_WRAP_S,Oe.CLAMP_TO_EDGE),Oe.texParameteri(e,Oe.TEXTURE_WRAP_T,Oe.CLAMP_TO_EDGE),Oe.texParameteri(e,Oe.TEXTURE_MAG_FILTER,Se(t.magFilter)),Oe.texParameteri(e,Oe.TEXTURE_MIN_FILTER,Se(t.minFilter))),He&&t.type!==o.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Oe.texParameterf(e,He.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Lt)),t.__oldAnisotropy=t.anisotropy)}function ve(e,t){if(e.width<=t&&e.height<=t)return e;var r=Math.max(e.width,e.height),i=Math.floor(e.width*t/r),n=Math.floor(e.height*t/r),o=document.createElement("canvas");o.width=i,o.height=n;var a=o.getContext("2d");return a.drawImage(e,0,0,e.width,e.height,0,0,i,n),o}function ye(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.image.__webglTextureCube=Oe.createTexture(),je.info.memory.textures++),Oe.activeTexture(Oe.TEXTURE0+t),Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var r=e instanceof o.CompressedTexture,i=[],n=0;6>n;n++)je.autoScaleCubemaps&&!r?i[n]=ve(e.image[n],Et):i[n]=e.image[n];var a=i[0],s=me(a.width)&&me(a.height),l=Me(e.format),h=Me(e.type);ge(Oe.TEXTURE_CUBE_MAP,e,s);for(var n=0;6>n;n++)if(r)for(var c,u=i[n].mipmaps,f=0,p=u.length;p>f;f++)c=u[f],Oe.compressedTexImage2D(Oe.TEXTURE_CUBE_MAP_POSITIVE_X+n,f,l,c.width,c.height,0,c.data);else Oe.texImage2D(Oe.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,l,l,h,i[n]);e.generateMipmaps&&s&&Oe.generateMipmap(Oe.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Oe.activeTexture(Oe.TEXTURE0+t),Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function xe(e,t){Oe.activeTexture(Oe.TEXTURE0+t),Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,e.__webglTexture)}function we(e,t,r){Oe.bindFramebuffer(Oe.FRAMEBUFFER,e),Oe.framebufferTexture2D(Oe.FRAMEBUFFER,Oe.COLOR_ATTACHMENT0,r,t.__webglTexture,0)}function be(e,t){Oe.bindRenderbuffer(Oe.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Oe.renderbufferStorage(Oe.RENDERBUFFER,Oe.DEPTH_COMPONENT16,t.width,t.height),Oe.framebufferRenderbuffer(Oe.FRAMEBUFFER,Oe.DEPTH_ATTACHMENT,Oe.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Oe.renderbufferStorage(Oe.RENDERBUFFER,Oe.DEPTH_STENCIL,t.width,t.height),Oe.framebufferRenderbuffer(Oe.FRAMEBUFFER,Oe.DEPTH_STENCIL_ATTACHMENT,Oe.RENDERBUFFER,e)):Oe.renderbufferStorage(Oe.RENDERBUFFER,Oe.RGBA4,t.width,t.height)}function _e(e){e instanceof o.WebGLRenderTargetCube?(Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,e.__webglTexture),Oe.generateMipmap(Oe.TEXTURE_CUBE_MAP),Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,null)):(Oe.bindTexture(Oe.TEXTURE_2D,e.__webglTexture),Oe.generateMipmap(Oe.TEXTURE_2D),Oe.bindTexture(Oe.TEXTURE_2D,null))}function Se(e){return e===o.NearestFilter||e===o.NearestMipMapNearestFilter||e===o.NearestMipMapLinearFilter?Oe.NEAREST:Oe.LINEAR}function Me(e){if(e===o.RepeatWrapping)return Oe.REPEAT;if(e===o.ClampToEdgeWrapping)return Oe.CLAMP_TO_EDGE;if(e===o.MirroredRepeatWrapping)return Oe.MIRRORED_REPEAT;if(e===o.NearestFilter)return Oe.NEAREST;if(e===o.NearestMipMapNearestFilter)return Oe.NEAREST_MIPMAP_NEAREST;if(e===o.NearestMipMapLinearFilter)return Oe.NEAREST_MIPMAP_LINEAR;if(e===o.LinearFilter)return Oe.LINEAR;if(e===o.LinearMipMapNearestFilter)return Oe.LINEAR_MIPMAP_NEAREST;if(e===o.LinearMipMapLinearFilter)return Oe.LINEAR_MIPMAP_LINEAR;if(e===o.UnsignedByteType)return Oe.UNSIGNED_BYTE;if(e===o.UnsignedShort4444Type)return Oe.UNSIGNED_SHORT_4_4_4_4;if(e===o.UnsignedShort5551Type)return Oe.UNSIGNED_SHORT_5_5_5_1;if(e===o.UnsignedShort565Type)return Oe.UNSIGNED_SHORT_5_6_5;if(e===o.ByteType)return Oe.BYTE;if(e===o.ShortType)return Oe.SHORT;if(e===o.UnsignedShortType)return Oe.UNSIGNED_SHORT;if(e===o.IntType)return Oe.INT;if(e===o.UnsignedIntType)return Oe.UNSIGNED_INT;if(e===o.FloatType)return Oe.FLOAT;if(e===o.AlphaFormat)return Oe.ALPHA;if(e===o.RGBFormat)return Oe.RGB;if(e===o.RGBAFormat)return Oe.RGBA;if(e===o.LuminanceFormat)return Oe.LUMINANCE;if(e===o.LuminanceAlphaFormat)return Oe.LUMINANCE_ALPHA;if(e===o.AddEquation)return Oe.FUNC_ADD;if(e===o.SubtractEquation)return Oe.FUNC_SUBTRACT;if(e===o.ReverseSubtractEquation)return Oe.FUNC_REVERSE_SUBTRACT;if(e===o.ZeroFactor)return Oe.ZERO;if(e===o.OneFactor)return Oe.ONE;if(e===o.SrcColorFactor)return Oe.SRC_COLOR;if(e===o.OneMinusSrcColorFactor)return Oe.ONE_MINUS_SRC_COLOR;if(e===o.SrcAlphaFactor)return Oe.SRC_ALPHA;if(e===o.OneMinusSrcAlphaFactor)return Oe.ONE_MINUS_SRC_ALPHA;if(e===o.DstAlphaFactor)return Oe.DST_ALPHA;if(e===o.OneMinusDstAlphaFactor)return Oe.ONE_MINUS_DST_ALPHA;if(e===o.DstColorFactor)return Oe.DST_COLOR;if(e===o.OneMinusDstColorFactor)return Oe.ONE_MINUS_DST_COLOR;if(e===o.SrcAlphaSaturateFactor)return Oe.SRC_ALPHA_SATURATE;if(void 0!==Ge){if(e===o.RGB_S3TC_DXT1_Format)return Ge.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT1_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===o.RGBA_S3TC_DXT3_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===o.RGBA_S3TC_DXT5_Format)return Ge.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function Te(e){if(Rt&&e&&e.useVertexTexture)return 1024;var t=Oe.getParameter(Oe.MAX_VERTEX_UNIFORM_VECTORS),r=Math.floor((t-20)/4),i=r;return void 0!==e&&e instanceof o.SkinnedMesh&&(i=Math.min(e.bones.length,i),i<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+i+" (try OpenGL instead of ANGLE)")),i}function Ce(e){var t,r,i,n,a,s,l;for(n=a=s=l=0,t=0,r=e.length;r>t;t++)i=e[t],i.onlyShadow||(i instanceof o.DirectionalLight&&n++,i instanceof o.PointLight&&a++,i instanceof o.SpotLight&&s++,i instanceof o.HemisphereLight&&l++);return{directional:n,point:a,spot:s,hemi:l}}function Ae(e){var t,r,i,n=0;for(t=0,r=e.length;r>t;t++)i=e[t],i.castShadow&&(i instanceof o.SpotLight&&n++,i instanceof o.DirectionalLight&&!i.shadowCascade&&n++);return n}function Ee(){try{if(!(Oe=Pe.getContext("experimental-webgl",{alpha:De,premultipliedAlpha:Fe,antialias:Ne,stencil:Ue,preserveDrawingBuffer:ze})))throw"Error creating WebGL context."}catch(e){console.error(e)}Ie=Oe.getExtension("OES_texture_float"),ke=Oe.getExtension("OES_standard_derivatives"),He=Oe.getExtension("EXT_texture_filter_anisotropic")||Oe.getExtension("MOZ_EXT_texture_filter_anisotropic")||Oe.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ge=Oe.getExtension("WEBGL_compressed_texture_s3tc")||Oe.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Oe.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ie||console.log("THREE.WebGLRenderer: Float textures not supported."),ke||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),He||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Ge||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Oe.getShaderPrecisionFormat&&(Oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function Le(){Oe.clearColor(0,0,0,1),Oe.clearDepth(1),Oe.clearStencil(0),Oe.enable(Oe.DEPTH_TEST),Oe.depthFunc(Oe.LEQUAL),Oe.frontFace(Oe.CCW),Oe.cullFace(Oe.BACK),Oe.enable(Oe.CULL_FACE),Oe.enable(Oe.BLEND),Oe.blendEquation(Oe.FUNC_ADD),Oe.blendFunc(Oe.SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA),Oe.clearColor(Ve.r,Ve.g,Ve.b,Be)}console.log("THREE.WebGLRenderer",o.REVISION),e=e||{};var Pe=void 0!==e.canvas?e.canvas:document.createElement("canvas"),Re=void 0!==e.precision?e.precision:"highp",De=void 0!==e.alpha?e.alpha:!0,Fe=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Ne=void 0!==e.antialias?e.antialias:!1,Ue=void 0!==e.stencil?e.stencil:!0,ze=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Ve=void 0!==e.clearColor?new o.Color(e.clearColor):new o.Color(0),Be=void 0!==e.clearAlpha?e.clearAlpha:0;this.domElement=Pe,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==window.devicePixelRatio?window.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=o.PCFShadowMap,this.shadowMapCullFace=o.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Oe,Ie,ke,He,Ge,je=this,We=[],Xe=0,qe=null,Ye=null,Ke=-1,$e=null,Qe=null,Ze=0,Je=0,et=-1,tt=-1,rt=-1,it=-1,nt=-1,ot=-1,at=-1,st=-1,lt=null,ht=null,ct=null,ut=null,ft=0,pt=0,dt=0,mt=0,gt=0,vt=0,yt={},xt=new o.Frustum,wt=new o.Matrix4,bt=new o.Matrix4,_t=new o.Vector3,St=new o.Vector3,Mt=!0,Tt={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Ee(),Le(),this.context=Oe;var Ct=Oe.getParameter(Oe.MAX_TEXTURE_IMAGE_UNITS),At=Oe.getParameter(Oe.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Et=(Oe.getParameter(Oe.MAX_TEXTURE_SIZE),Oe.getParameter(Oe.MAX_CUBE_MAP_TEXTURE_SIZE)),Lt=He?Oe.getParameter(He.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Pt=At>0,Rt=Pt&&Ie,Dt=(Ge?Oe.getParameter(Oe.COMPRESSED_TEXTURE_FORMATS):[],Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.HIGH_FLOAT)),Ft=Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.MEDIUM_FLOAT),Nt=(Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.LOW_FLOAT),Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.HIGH_FLOAT)),Ut=Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.MEDIUM_FLOAT),zt=(Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.LOW_FLOAT),Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.HIGH_INT),Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.MEDIUM_INT),Oe.getShaderPrecisionFormat(Oe.VERTEX_SHADER,Oe.LOW_INT),Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.HIGH_INT),Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.MEDIUM_INT),Oe.getShaderPrecisionFormat(Oe.FRAGMENT_SHADER,Oe.LOW_INT),Dt.precision>0&&Nt.precision>0),Vt=Ft.precision>0&&Ut.precision>0;"highp"!==Re||zt||(Vt?(Re="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Re="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==Re||Vt||(Re="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Oe},this.supportsVertexTextures=function(){return Pt},this.supportsFloatTextures=function(){return Ie},this.supportsStandardDerivatives=function(){return ke},this.supportsCompressedTextureS3TC=function(){return Ge},this.getMaxAnisotropy=function(){return Lt},this.getPrecision=function(){return Re},this.setSize=function(e,t){Pe.width=e*this.devicePixelRatio,Pe.height=t*this.devicePixelRatio,Pe.style.width=e+"px",Pe.style.height=t+"px",this.setViewport(0,0,Pe.width,Pe.height)},this.setViewport=function(e,t,r,i){ft=void 0!==e?e:0,pt=void 0!==t?t:0,dt=void 0!==r?r:Pe.width,mt=void 0!==i?i:Pe.height,Oe.viewport(ft,pt,dt,mt)},this.setScissor=function(e,t,r,i){Oe.scissor(e,t,r,i)},this.enableScissorTest=function(e){e?Oe.enable(Oe.SCISSOR_TEST):Oe.disable(Oe.SCISSOR_TEST)},this.setClearColorHex=function(e,t){Ve.setHex(e),Be=t,Oe.clearColor(Ve.r,Ve.g,Ve.b,Be)},this.setClearColor=function(e,t){Ve.copy(e),Be=t,Oe.clearColor(Ve.r,Ve.g,Ve.b,Be)},this.getClearColor=function(){return Ve},this.getClearAlpha=function(){return Be},this.clear=function(e,t,r){var i=0;(void 0===e||e)&&(i|=Oe.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Oe.DEPTH_BUFFER_BIT),(void 0===r||r)&&(i|=Oe.STENCIL_BUFFER_BIT),Oe.clear(i)},this.clearTarget=function(e,t,r,i){this.setRenderTarget(e),this.clear(t,r,i)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){qe=null,rt=-1,at=-1,st=-1,$e=-1,Ke=-1,Mt=!0,et=-1,tt=-1,this.shadowMapPlugin.update(e,t)};var Bt=function(e){var t=e.target;t.removeEventListener("dispose",Bt),Ht(t),je.info.memory.geometries--},Ot=function(e){var t=e.target;t.removeEventListener("dispose",Ot),Gt(t),je.info.memory.textures--},It=function(e){var t=e.target;t.removeEventListener("dispose",It),jt(t),je.info.memory.textures--},kt=function(e){var t=e.target;t.removeEventListener("dispose",kt),Wt(t)},Ht=function(e){if(e.__webglInit=void 0,void 0!==e.__webglVertexBuffer&&Oe.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Oe.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Oe.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Oe.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Oe.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Oe.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Oe.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Oe.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Oe.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Oe.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Oe.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.geometryGroups)for(var t in e.geometryGroups){var r=e.geometryGroups[t];if(void 0!==r.numMorphTargets)for(var i=0,n=r.numMorphTargets;n>i;i++)Oe.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals)for(var i=0,n=r.numMorphNormals;n>i;i++)Oe.deleteBuffer(r.__webglMorphNormalsBuffers[i]);a(r)}a(e)},Gt=function(e){if(e.image&&e.image.__webglTextureCube)Oe.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Oe.deleteTexture(e.__webglTexture)}},jt=function(e){if(e&&e.__webglTexture)if(Oe.deleteTexture(e.__webglTexture),e instanceof o.WebGLRenderTargetCube)for(var t=0;6>t;t++)Oe.deleteFramebuffer(e.__webglFramebuffer[t]),Oe.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Oe.deleteFramebuffer(e.__webglFramebuffer),Oe.deleteRenderbuffer(e.__webglRenderbuffer)},Wt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var r,i,n,o=!1;for(r=0,i=We.length;i>r;r++)if(n=We[r],
n.program===t){n.usedTimes--,0===n.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(r=0,i=We.length;i>r;r++)n=We[r],n.program!==t&&a.push(n);We=a,Oe.deleteProgram(t),je.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,r){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Oe.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Oe.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Oe.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Oe.createBuffer()),e.hasPositions&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglVertexBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,e.positionArray,Oe.DYNAMIC_DRAW),Oe.enableVertexAttribArray(t.attributes.position),Oe.vertexAttribPointer(t.attributes.position,3,Oe.FLOAT,!1,0,0)),e.hasNormals){if(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglNormalBuffer),r.shading===o.FlatShading){var i,n,a,s,l,h,c,u,f,p,d,m,g,v,y=3*e.count;for(v=0;y>v;v+=9)g=e.normalArray,s=g[v],c=g[v+1],p=g[v+2],l=g[v+3],u=g[v+4],d=g[v+5],h=g[v+6],f=g[v+7],m=g[v+8],i=(s+l+h)/3,n=(c+u+f)/3,a=(p+d+m)/3,g[v]=i,g[v+1]=n,g[v+2]=a,g[v+3]=i,g[v+4]=n,g[v+5]=a,g[v+6]=i,g[v+7]=n,g[v+8]=a}Oe.bufferData(Oe.ARRAY_BUFFER,e.normalArray,Oe.DYNAMIC_DRAW),Oe.enableVertexAttribArray(t.attributes.normal),Oe.vertexAttribPointer(t.attributes.normal,3,Oe.FLOAT,!1,0,0)}e.hasUvs&&r.map&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglUvBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,e.uvArray,Oe.DYNAMIC_DRAW),Oe.enableVertexAttribArray(t.attributes.uv),Oe.vertexAttribPointer(t.attributes.uv,2,Oe.FLOAT,!1,0,0)),e.hasColors&&r.vertexColors!==o.NoColors&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,e.__webglColorBuffer),Oe.bufferData(Oe.ARRAY_BUFFER,e.colorArray,Oe.DYNAMIC_DRAW),Oe.enableVertexAttribArray(t.attributes.color),Oe.vertexAttribPointer(t.attributes.color,3,Oe.FLOAT,!1,0,0)),Oe.drawArrays(Oe.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,r,i,n,a){if(i.visible!==!1){var s,l;s=j(e,t,r,i,a),l=s.attributes;var h=!1,c=i.wireframe?1:0,u=16777215*n.id+2*s.id+c;if(u!==$e&&($e=u,h=!0),h&&M(),a instanceof o.Mesh){var f=n.attributes.index;if(f){var p=n.offsets;p.length>1&&(h=!0);for(var d=0,m=p.length;m>d;d++){var g=p[d].index;if(h){var v=n.attributes.position,y=v.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,v.buffer),S(l.position),Oe.vertexAttribPointer(l.position,y,Oe.FLOAT,!1,0,g*y*4);var x=n.attributes.normal;if(l.normal>=0&&x){var w=x.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,x.buffer),S(l.normal),Oe.vertexAttribPointer(l.normal,w,Oe.FLOAT,!1,0,g*w*4)}var b=n.attributes.uv;if(l.uv>=0&&b){var _=b.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,b.buffer),S(l.uv),Oe.vertexAttribPointer(l.uv,_,Oe.FLOAT,!1,0,g*_*4)}var T=n.attributes.color;if(l.color>=0&&T){var C=T.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,T.buffer),S(l.color),Oe.vertexAttribPointer(l.color,C,Oe.FLOAT,!1,0,g*C*4)}var A=n.attributes.tangent;if(l.tangent>=0&&A){var E=A.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,A.buffer),S(l.tangent),Oe.vertexAttribPointer(l.tangent,E,Oe.FLOAT,!1,0,g*E*4)}Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,f.buffer)}Oe.drawElements(Oe.TRIANGLES,p[d].count,Oe.UNSIGNED_SHORT,2*p[d].start),je.info.render.calls++,je.info.render.vertices+=p[d].count,je.info.render.faces+=p[d].count/3}}else{if(h){var v=n.attributes.position,y=v.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,v.buffer),S(l.position),Oe.vertexAttribPointer(l.position,y,Oe.FLOAT,!1,0,0);var x=n.attributes.normal;if(l.normal>=0&&x){var w=x.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,x.buffer),S(l.normal),Oe.vertexAttribPointer(l.normal,w,Oe.FLOAT,!1,0,0)}var b=n.attributes.uv;if(l.uv>=0&&b){var _=b.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,b.buffer),S(l.uv),Oe.vertexAttribPointer(l.uv,_,Oe.FLOAT,!1,0,0)}var T=n.attributes.color;if(l.color>=0&&T){var C=T.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,T.buffer),S(l.color),Oe.vertexAttribPointer(l.color,C,Oe.FLOAT,!1,0,0)}var A=n.attributes.tangent;if(l.tangent>=0&&A){var E=A.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,A.buffer),S(l.tangent),Oe.vertexAttribPointer(l.tangent,E,Oe.FLOAT,!1,0,0)}}Oe.drawArrays(Oe.TRIANGLES,0,v.numItems/3),je.info.render.calls++,je.info.render.vertices+=v.numItems/3,je.info.render.faces+=v.numItems/3/3}}else if(a instanceof o.ParticleSystem){if(h){var v=n.attributes.position,y=v.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,v.buffer),S(l.position),Oe.vertexAttribPointer(l.position,y,Oe.FLOAT,!1,0,0);var T=n.attributes.color;if(l.color>=0&&T){var C=T.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,T.buffer),S(l.color),Oe.vertexAttribPointer(l.color,C,Oe.FLOAT,!1,0,0)}Oe.drawArrays(Oe.POINTS,0,v.numItems/3),je.info.render.calls++,je.info.render.points+=v.numItems/3}}else if(a instanceof o.Line&&h){var v=n.attributes.position,y=v.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,v.buffer),S(l.position),Oe.vertexAttribPointer(l.position,y,Oe.FLOAT,!1,0,0);var T=n.attributes.color;if(l.color>=0&&T){var C=T.itemSize;Oe.bindBuffer(Oe.ARRAY_BUFFER,T.buffer),S(l.color),Oe.vertexAttribPointer(l.color,C,Oe.FLOAT,!1,0,0)}se(i.linewidth),Oe.drawArrays(Oe.LINE_STRIP,0,v.numItems/3),je.info.render.calls++,je.info.render.points+=v.numItems}}},this.renderBuffer=function(e,t,r,i,n,a){if(i.visible!==!1){var s,l,h,c,u,f;s=j(e,t,r,i,a),l=s.attributes;var p=!1,d=i.wireframe?1:0,m=16777215*n.id+2*s.id+d;if(m!==$e&&($e=m,p=!0),p&&M(),!i.morphTargets&&l.position>=0?p&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglVertexBuffer),S(l.position),Oe.vertexAttribPointer(l.position,3,Oe.FLOAT,!1,0,0)):a.morphTargetBase&&T(i,n,a),p){if(n.__webglCustomAttributesList)for(u=0,f=n.__webglCustomAttributesList.length;f>u;u++)c=n.__webglCustomAttributesList[u],l[c.buffer.belongsToAttribute]>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,c.buffer),S(l[c.buffer.belongsToAttribute]),Oe.vertexAttribPointer(l[c.buffer.belongsToAttribute],c.size,Oe.FLOAT,!1,0,0));l.color>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglColorBuffer),S(l.color),Oe.vertexAttribPointer(l.color,3,Oe.FLOAT,!1,0,0)),l.normal>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglNormalBuffer),S(l.normal),Oe.vertexAttribPointer(l.normal,3,Oe.FLOAT,!1,0,0)),l.tangent>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglTangentBuffer),S(l.tangent),Oe.vertexAttribPointer(l.tangent,4,Oe.FLOAT,!1,0,0)),l.uv>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglUVBuffer),S(l.uv),Oe.vertexAttribPointer(l.uv,2,Oe.FLOAT,!1,0,0)),l.uv2>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglUV2Buffer),S(l.uv2),Oe.vertexAttribPointer(l.uv2,2,Oe.FLOAT,!1,0,0)),i.skinning&&l.skinIndex>=0&&l.skinWeight>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglSkinIndicesBuffer),S(l.skinIndex),Oe.vertexAttribPointer(l.skinIndex,4,Oe.FLOAT,!1,0,0),Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglSkinWeightsBuffer),S(l.skinWeight),Oe.vertexAttribPointer(l.skinWeight,4,Oe.FLOAT,!1,0,0)),l.lineDistance>=0&&(Oe.bindBuffer(Oe.ARRAY_BUFFER,n.__webglLineDistanceBuffer),S(l.lineDistance),Oe.vertexAttribPointer(l.lineDistance,1,Oe.FLOAT,!1,0,0))}a instanceof o.Mesh?(i.wireframe?(se(i.wireframeLinewidth),p&&Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,n.__webglLineBuffer),Oe.drawElements(Oe.LINES,n.__webglLineCount,Oe.UNSIGNED_SHORT,0)):(p&&Oe.bindBuffer(Oe.ELEMENT_ARRAY_BUFFER,n.__webglFaceBuffer),Oe.drawElements(Oe.TRIANGLES,n.__webglFaceCount,Oe.UNSIGNED_SHORT,0)),je.info.render.calls++,je.info.render.vertices+=n.__webglFaceCount,je.info.render.faces+=n.__webglFaceCount/3):a instanceof o.Line?(h=a.type===o.LineStrip?Oe.LINE_STRIP:Oe.LINES,se(i.linewidth),Oe.drawArrays(h,0,n.__webglLineCount),je.info.render.calls++):a instanceof o.ParticleSystem?(Oe.drawArrays(Oe.POINTS,0,n.__webglParticleCount),je.info.render.calls++,je.info.render.points+=n.__webglParticleCount):a instanceof o.Ribbon&&(Oe.drawArrays(Oe.TRIANGLE_STRIP,0,n.__webglVertexCount),je.info.render.calls++)}},this.render=function(e,t,r,i){if(t instanceof o.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var n,a,s,l,h,c=e.__lights,u=e.fog;for(Ke=-1,Mt=!0,this.autoUpdateScene&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),wt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),xt.setFromMatrix(wt),this.autoUpdateObjects&&this.initWebGLObjects(e),E(this.renderPluginsPre,e,t),je.info.render.calls=0,je.info.render.vertices=0,je.info.render.faces=0,je.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),h=e.__webglObjects,n=0,a=h.length;a>n;n++)s=h[n],l=s.object,s.render=!1,l.visible&&((l instanceof o.Mesh||l instanceof o.ParticleSystem)&&l.frustumCulled&&!xt.intersectsObject(l)||(ie(l,t),D(s),s.render=!0,this.sortObjects===!0&&(null!==l.renderDepth?s.z=l.renderDepth:(_t.getPositionFromMatrix(l.matrixWorld),_t.applyProjection(wt),s.z=_t.z),s.id=l.id)));for(this.sortObjects&&h.sort(C),h=e.__webglObjectsImmediate,n=0,a=h.length;a>n;n++)s=h[n],l=s.object,l.visible&&(ie(l,t),R(s));if(e.overrideMaterial){var f=e.overrideMaterial;this.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),this.setDepthTest(f.depthTest),this.setDepthWrite(f.depthWrite),le(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits),L(e.__webglObjects,!1,"",t,c,u,!0,f),P(e.__webglObjectsImmediate,"",t,c,u,!1,f)}else{var f=null;this.setBlending(o.NoBlending),L(e.__webglObjects,!0,"opaque",t,c,u,!1,f),P(e.__webglObjectsImmediate,"opaque",t,c,u,!1,f),L(e.__webglObjects,!1,"transparent",t,c,u,!0,f),P(e.__webglObjectsImmediate,"transparent",t,c,u,!0,f)}E(this.renderPluginsPost,e,t),r&&r.generateMipmaps&&r.minFilter!==o.NearestFilter&&r.minFilter!==o.LinearFilter&&_e(r),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,r,i,n){var o=j(e,t,r,i,n);$e=-1,je.setMaterialFaces(i),n.immediateRenderCallback?n.immediateRenderCallback(o,Oe,xt):n.render(function(e){je.renderBufferImmediate(e,o,i)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)N(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)I(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,r=e.__webglObjects.length;r>t;t++)V(e.__webglObjects[t].object)},this.initMaterial=function(e,t,r,i){e.addEventListener("dispose",kt);var n,a,s,l,h,c,u;e instanceof o.MeshDepthMaterial?u="depth":e instanceof o.MeshNormalMaterial?u="normal":e instanceof o.MeshBasicMaterial?u="basic":e instanceof o.MeshLambertMaterial?u="lambert":e instanceof o.MeshPhongMaterial?u="phong":e instanceof o.LineBasicMaterial?u="basic":e instanceof o.LineDashedMaterial?u="dashed":e instanceof o.ParticleBasicMaterial&&(u="particle_basic"),u&&G(e,o.ShaderLib[u]),l=Ce(t),c=Ae(t),h=Te(i),s={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:r,useFog:e.fog,fogExp:r instanceof o.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:h,useVertexTexture:Rt&&i&&i.useVertexTexture,boneTextureWidth:i&&i.boneTextureWidth,boneTextureHeight:i&&i.boneTextureHeight,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:l.directional,maxPointLights:l.point,maxSpotLights:l.spot,maxHemiLights:l.hemi,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===o.DoubleSide,flipSided:e.side===o.BackSide},e.program=ce(u,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,s);var f=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var p,d="morphTarget";for(a=0;a<this.maxMorphTargets;a++)p=d+a,f[p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var p,d="morphNormal";for(a=0;a<this.maxMorphNormals;a++)p=d+a,f[p]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(n in e.uniforms)e.uniformsList.push([e.uniforms[n],n])},this.setFaceCulling=function(e,t){e===o.CullFaceNone?Oe.disable(Oe.CULL_FACE):(t===o.FrontFaceDirectionCW?Oe.frontFace(Oe.CW):Oe.frontFace(Oe.CCW),e===o.CullFaceBack?Oe.cullFace(Oe.BACK):e===o.CullFaceFront?Oe.cullFace(Oe.FRONT):Oe.cullFace(Oe.FRONT_AND_BACK),Oe.enable(Oe.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===o.DoubleSide,r=e.side===o.BackSide;et!==t&&(t?Oe.disable(Oe.CULL_FACE):Oe.enable(Oe.CULL_FACE),et=t),tt!==r&&(r?Oe.frontFace(Oe.CW):Oe.frontFace(Oe.CCW),tt=r)},this.setDepthTest=function(e){at!==e&&(e?Oe.enable(Oe.DEPTH_TEST):Oe.disable(Oe.DEPTH_TEST),at=e)},this.setDepthWrite=function(e){st!==e&&(Oe.depthMask(e),st=e)},this.setBlending=function(e,t,r,i){e!==rt&&(e===o.NoBlending?Oe.disable(Oe.BLEND):e===o.AdditiveBlending?(Oe.enable(Oe.BLEND),Oe.blendEquation(Oe.FUNC_ADD),Oe.blendFunc(Oe.SRC_ALPHA,Oe.ONE)):e===o.SubtractiveBlending?(Oe.enable(Oe.BLEND),Oe.blendEquation(Oe.FUNC_ADD),Oe.blendFunc(Oe.ZERO,Oe.ONE_MINUS_SRC_COLOR)):e===o.MultiplyBlending?(Oe.enable(Oe.BLEND),Oe.blendEquation(Oe.FUNC_ADD),Oe.blendFunc(Oe.ZERO,Oe.SRC_COLOR)):e===o.CustomBlending?Oe.enable(Oe.BLEND):(Oe.enable(Oe.BLEND),Oe.blendEquationSeparate(Oe.FUNC_ADD,Oe.FUNC_ADD),Oe.blendFuncSeparate(Oe.SRC_ALPHA,Oe.ONE_MINUS_SRC_ALPHA,Oe.ONE,Oe.ONE_MINUS_SRC_ALPHA)),rt=e),e===o.CustomBlending?(t!==it&&(Oe.blendEquation(Me(t)),it=t),(r!==nt||i!==ot)&&(Oe.blendFunc(Me(r),Me(i)),nt=r,ot=i)):(it=null,nt=null,ot=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Ot),e.__webglTexture=Oe.createTexture(),je.info.memory.textures++),Oe.activeTexture(Oe.TEXTURE0+t),Oe.bindTexture(Oe.TEXTURE_2D,e.__webglTexture),Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,e.flipY),Oe.pixelStorei(Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Oe.pixelStorei(Oe.UNPACK_ALIGNMENT,e.unpackAlignment);var r=e.image,i=me(r.width)&&me(r.height),n=Me(e.format),a=Me(e.type);ge(Oe.TEXTURE_2D,e,i);var s,l=e.mipmaps;if(e instanceof o.DataTexture)if(l.length>0&&i){for(var h=0,c=l.length;c>h;h++)s=l[h],Oe.texImage2D(Oe.TEXTURE_2D,h,n,s.width,s.height,0,n,a,s.data);e.generateMipmaps=!1}else Oe.texImage2D(Oe.TEXTURE_2D,0,n,r.width,r.height,0,n,a,r.data);else if(e instanceof o.CompressedTexture)for(var h=0,c=l.length;c>h;h++)s=l[h],Oe.compressedTexImage2D(Oe.TEXTURE_2D,h,n,s.width,s.height,0,s.data);else if(l.length>0&&i){for(var h=0,c=l.length;c>h;h++)s=l[h],Oe.texImage2D(Oe.TEXTURE_2D,h,n,n,a,s);e.generateMipmaps=!1}else Oe.texImage2D(Oe.TEXTURE_2D,0,n,n,a,e.image);e.generateMipmaps&&i&&Oe.generateMipmap(Oe.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Oe.activeTexture(Oe.TEXTURE0+t),Oe.bindTexture(Oe.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof o.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",It),e.__webglTexture=Oe.createTexture(),je.info.memory.textures++;var r=me(e.width)&&me(e.height),i=Me(e.format),n=Me(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,e.__webglTexture),ge(Oe.TEXTURE_CUBE_MAP,e,r);for(var a=0;6>a;a++)e.__webglFramebuffer[a]=Oe.createFramebuffer(),e.__webglRenderbuffer[a]=Oe.createRenderbuffer(),Oe.texImage2D(Oe.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,i,e.width,e.height,0,i,n,null),we(e.__webglFramebuffer[a],e,Oe.TEXTURE_CUBE_MAP_POSITIVE_X+a),be(e.__webglRenderbuffer[a],e);r&&Oe.generateMipmap(Oe.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Oe.createFramebuffer(),e.shareDepthFrom?e.__webglRenderbuffer=e.shareDepthFrom.__webglRenderbuffer:e.__webglRenderbuffer=Oe.createRenderbuffer(),Oe.bindTexture(Oe.TEXTURE_2D,e.__webglTexture),ge(Oe.TEXTURE_2D,e,r),Oe.texImage2D(Oe.TEXTURE_2D,0,i,e.width,e.height,0,i,n,null),we(e.__webglFramebuffer,e,Oe.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Oe.framebufferRenderbuffer(Oe.FRAMEBUFFER,Oe.DEPTH_ATTACHMENT,Oe.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Oe.framebufferRenderbuffer(Oe.FRAMEBUFFER,Oe.DEPTH_STENCIL_ATTACHMENT,Oe.RENDERBUFFER,e.__webglRenderbuffer):be(e.__webglRenderbuffer,e),r&&Oe.generateMipmap(Oe.TEXTURE_2D);t?Oe.bindTexture(Oe.TEXTURE_CUBE_MAP,null):Oe.bindTexture(Oe.TEXTURE_2D,null),Oe.bindRenderbuffer(Oe.RENDERBUFFER,null),Oe.bindFramebuffer(Oe.FRAMEBUFFER,null)}var s,l,h,c,u;e?(s=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,l=e.width,h=e.height,c=0,u=0):(s=null,l=dt,h=mt,c=ft,u=pt),s!==Ye&&(Oe.bindFramebuffer(Oe.FRAMEBUFFER,s),Oe.viewport(c,u,l,h),Ye=s),gt=l,vt=h},this.shadowMapPlugin=new o.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new o.SpritePlugin),this.addPostPlugin(new o.LensFlarePlugin)},o.WebGLRenderTarget=function(e,t,r){o.EventDispatcher.call(this),this.width=e,this.height=t,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:o.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:o.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:o.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:o.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new o.Vector2(0,0),this.repeat=new o.Vector2(1,1),this.format=void 0!==r.format?r.format:o.RGBAFormat,this.type=void 0!==r.type?r.type:o.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},o.WebGLRenderTarget.prototype.clone=function(){var e=new o.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},o.WebGLRenderTarget.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},o.WebGLRenderTargetCube=function(e,t,r){o.WebGLRenderTarget.call(this,e,t,r),this.activeCubeFace=0},o.WebGLRenderTargetCube.prototype=Object.create(o.WebGLRenderTarget.prototype),o.RenderableVertex=function(){this.positionWorld=new o.Vector3,this.positionScreen=new o.Vector4,this.visible=!0},o.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},o.RenderableFace3=function(){this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.v3=new o.RenderableVertex,this.centroidModel=new o.Vector3,this.normalModel=new o.Vector3,this.normalModelView=new o.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new o.Vector3,new o.Vector3,new o.Vector3],this.vertexNormalsModelView=[new o.Vector3,new o.Vector3,new o.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},o.RenderableFace4=function(){this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.v3=new o.RenderableVertex,this.v4=new o.RenderableVertex,this.centroidModel=new o.Vector3,this.normalModel=new o.Vector3,this.normalModelView=new o.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],this.vertexNormalsModelView=[new o.Vector3,new o.Vector3,new o.Vector3,new o.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=null},o.RenderableObject=function(){this.object=null,this.z=null},o.RenderableParticle=function(){this.object=null,this.x=null,this.y=null,this.z=null,this.rotation=null,this.scale=new o.Vector2,this.material=null},o.RenderableLine=function(){this.z=null,this.v1=new o.RenderableVertex,this.v2=new o.RenderableVertex,this.material=null},o.GeometryUtils={merge:function(e,t){var r,i,n=e.vertices.length,a=(e.faceVertexUvs[0].length,t instanceof o.Mesh?t.geometry:t),s=e.vertices,l=a.vertices,h=e.faces,c=a.faces,u=e.faceVertexUvs[0],f=a.faceVertexUvs[0];t instanceof o.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,i=new o.Matrix3,i.getInverse(r),i.transpose());for(var p=0,d=l.length;d>p;p++){var m=l[p],g=m.clone();r&&g.applyMatrix4(r),s.push(g)}for(p=0,d=c.length;d>p;p++){var v,y,x,w=c[p],b=w.vertexNormals,_=w.vertexColors;w instanceof o.Face3?v=new o.Face3(w.a+n,w.b+n,w.c+n):w instanceof o.Face4&&(v=new o.Face4(w.a+n,w.b+n,w.c+n,w.d+n)),v.normal.copy(w.normal),i&&v.normal.applyMatrix3(i).normalize();for(var S=0,M=b.length;M>S;S++)y=b[S].clone(),i&&y.applyMatrix3(i).normalize(),v.vertexNormals.push(y);v.color.copy(w.color);for(var S=0,M=_.length;M>S;S++)x=_[S],v.vertexColors.push(x.clone());v.materialIndex=w.materialIndex,v.centroid.copy(w.centroid),r&&v.centroid.applyMatrix4(r),h.push(v)}for(p=0,d=f.length;d>p;p++){for(var T=f[p],C=[],S=0,M=T.length;M>S;S++)C.push(new o.Vector2(T[S].x,T[S].y));u.push(C)}},removeMaterials:function(e,t){for(var r={},i=0,n=t.length;n>i;i++)r[t[i]]=!0;for(var o,a=[],i=0,n=e.faces.length;n>i;i++)o=e.faces[i],o.materialIndex in r||a.push(o);e.faces=a},randomPointInTriangle:function(e,t,r){var i,n,a,s=new o.Vector3,l=o.GeometryUtils.__v1;return i=o.GeometryUtils.random(),n=o.GeometryUtils.random(),i+n>1&&(i=1-i,n=1-n),a=1-i-n,s.copy(e),s.multiplyScalar(i),l.copy(t),l.multiplyScalar(n),s.add(l),l.copy(r),l.multiplyScalar(a),s.add(l),s},randomPointInFace:function(e,t,r){var i,n,a,s;if(e instanceof o.Face3)return i=t.vertices[e.a],n=t.vertices[e.b],a=t.vertices[e.c],o.GeometryUtils.randomPointInTriangle(i,n,a);if(e instanceof o.Face4){i=t.vertices[e.a],n=t.vertices[e.b],a=t.vertices[e.c],s=t.vertices[e.d];var l,h;r?e._area1&&e._area2?(l=e._area1,h=e._area2):(l=o.GeometryUtils.triangleArea(i,n,s),h=o.GeometryUtils.triangleArea(n,a,s),e._area1=l,e._area2=h):(l=o.GeometryUtils.triangleArea(i,n,s),h=o.GeometryUtils.triangleArea(n,a,s));var c=o.GeometryUtils.random()*(l+h);return l>c?o.GeometryUtils.randomPointInTriangle(i,n,s):o.GeometryUtils.randomPointInTriangle(n,a,s)}},randomPointsInGeometry:function(e,t){function r(e){function t(r,i){if(r>i)return r;var n=r+Math.floor((i-r)/2);return d[n]>e?t(r,n-1):d[n]<e?t(n+1,i):n}var r=t(0,d.length-1);return r}var i,n,a,s,l,h,c=e.faces,u=e.vertices,f=c.length,p=0,d=[];for(n=0;f>n;n++)i=c[n],i instanceof o.Face3?(a=u[i.a],s=u[i.b],l=u[i.c],i._area=o.GeometryUtils.triangleArea(a,s,l)):i instanceof o.Face4&&(a=u[i.a],s=u[i.b],l=u[i.c],h=u[i.d],i._area1=o.GeometryUtils.triangleArea(a,s,h),i._area2=o.GeometryUtils.triangleArea(s,l,h),i._area=i._area1+i._area2),p+=i._area,d[n]=p;var m,g,v=[],y={};for(n=0;t>n;n++)m=o.GeometryUtils.random()*p,g=r(m),v[n]=o.GeometryUtils.randomPointInFace(c[g],e,!0),y[g]?y[g]+=1:y[g]=1;return v},triangleArea:function(e,t,r){var i=o.GeometryUtils.__v1,n=o.GeometryUtils.__v2;return i.subVectors(t,e),n.subVectors(r,e),i.cross(n),.5*i.length()},center:function(e){e.computeBoundingBox();var t=e.boundingBox,r=new o.Vector3;return r.addVectors(t.min,t.max),r.multiplyScalar(-.5),e.applyMatrix((new o.Matrix4).makeTranslation(r.x,r.y,r.z)),e.computeBoundingBox(),r},normalizeUVs:function(e){for(var t=e.faceVertexUvs[0],r=0,i=t.length;i>r;r++)for(var n=t[r],o=0,a=n.length;a>o;o++)1!==n[o].x&&(n[o].x=n[o].x-Math.floor(n[o].x)),1!==n[o].y&&(n[o].y=n[o].y-Math.floor(n[o].y))},triangulateQuads:function(e){var t,r,i,n,a=[],s=[],l=[];for(t=0,r=e.faceUvs.length;r>t;t++)s[t]=[];for(t=0,r=e.faceVertexUvs.length;r>t;t++)l[t]=[];for(t=0,r=e.faces.length;r>t;t++){var h=e.faces[t];if(h instanceof o.Face4){var c=h.a,u=h.b,f=h.c,p=h.d,d=new o.Face3,m=new o.Face3;for(d.color.copy(h.color),m.color.copy(h.color),d.materialIndex=h.materialIndex,m.materialIndex=h.materialIndex,d.a=c,d.b=u,d.c=p,m.a=u,m.b=f,m.c=p,4===h.vertexColors.length&&(d.vertexColors[0]=h.vertexColors[0].clone(),d.vertexColors[1]=h.vertexColors[1].clone(),d.vertexColors[2]=h.vertexColors[3].clone(),m.vertexColors[0]=h.vertexColors[1].clone(),m.vertexColors[1]=h.vertexColors[2].clone(),m.vertexColors[2]=h.vertexColors[3].clone()),a.push(d,m),i=0,n=e.faceVertexUvs.length;n>i;i++)if(e.faceVertexUvs[i].length){var g=e.faceVertexUvs[i][t],v=g[0],y=g[1],x=g[2],w=g[3],b=[v.clone(),y.clone(),w.clone()],_=[y.clone(),x.clone(),w.clone()];l[i].push(b,_)}for(i=0,n=e.faceUvs.length;n>i;i++)if(e.faceUvs[i].length){var S=e.faceUvs[i][t];s[i].push(S,S)}}else{for(a.push(h),i=0,n=e.faceUvs.length;n>i;i++)s[i].push(e.faceUvs[i][t]);for(i=0,n=e.faceVertexUvs.length;n>i;i++)l[i].push(e.faceVertexUvs[i][t])}}e.faces=a,e.faceUvs=s,e.faceVertexUvs=l,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()},setMaterialIndex:function(e,t,r,i){for(var n=e.faces,o=r||0,a=i||n.length-1,s=o;a>=s;s++)n[s].materialIndex=t}},o.GeometryUtils.random=o.Math.random16,o.GeometryUtils.__v1=new o.Vector3,o.GeometryUtils.__v2=new o.Vector3,o.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,r,i){var n=new Image,a=new o.Texture(n,t),s=new o.ImageLoader;return s.addEventListener("load",function(e){a.image=e.content,a.needsUpdate=!0,r&&r(a)}),s.addEventListener("error",function(e){i&&i(e.message)}),s.crossOrigin=this.crossOrigin,s.load(e,n),a.sourceFile=e,a},loadCompressedTexture:function(e,t,r,i){var n=new o.CompressedTexture;n.mapping=t;var a=new XMLHttpRequest;return a.onload=function(){var e=a.response,t=o.ImageUtils.parseDDS(e,!0);n.format=t.format,n.mipmaps=t.mipmaps,n.image.width=t.width,n.image.height=t.height,n.generateMipmaps=!1,n.needsUpdate=!0,r&&r(n)},a.onerror=i,a.open("GET",e,!0),a.responseType="arraybuffer",a.send(null),n},loadTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var a=new o.Texture;a.image=n,void 0!==t&&(a.mapping=t),a.flipY=!1;for(var s=0,l=e.length;l>s;++s){var h=new Image;n[s]=h,h.onload=function(){n.loadCount+=1,6===n.loadCount&&(a.needsUpdate=!0,r&&r(a))},h.onerror=i,h.crossOrigin=this.crossOrigin,h.src=e[s]}return a},loadCompressedTextureCube:function(e,t,r,i){var n=[];n.loadCount=0;var a=new o.CompressedTexture;a.image=n,void 0!==t&&(a.mapping=t),a.flipY=!1,a.generateMipmaps=!1;var s=function(e,t){return function(){var i=e.response,s=o.ImageUtils.parseDDS(i,!0);t.format=s.format,t.mipmaps=s.mipmaps,t.width=s.width,t.height=s.height,n.loadCount+=1,6===n.loadCount&&(a.format=s.format,a.needsUpdate=!0,r&&r(a))}};if(e instanceof Array)for(var l=0,h=e.length;h>l;++l){var c={};n[l]=c;var u=new XMLHttpRequest;u.onload=s(u,c),u.onerror=i;var f=e[l];u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}else{var f=e,u=new XMLHttpRequest;u.onload=function(){var e=u.response,t=o.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var i=t.mipmaps.length/t.mipmapCount,s=0;i>s;s++){n[s]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)n[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+l]),n[s].format=t.format,n[s].width=t.width,n[s].height=t.height}a.format=t.format,a.needsUpdate=!0,r&&r(a)}},u.onerror=i,u.open("GET",f,!0),u.responseType="arraybuffer",u.send(null)}return a},parseDDS:function(e,t){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}var n={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},a=542327876,s=131072,l=512,h=4,c=r("DXT1"),u=r("DXT3"),f=r("DXT5"),p=31,d=0,m=1,g=2,v=3,y=4,x=7,w=20,b=21,_=28,S=new Int32Array(e,0,p);if(S[d]!==a)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),n;if(!S[w]&h)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),n;var M,T=S[b];switch(T){case c:M=8,n.format=o.RGB_S3TC_DXT1_Format;break;case u:M=16,n.format=o.RGBA_S3TC_DXT3_Format;break;case f:M=16,n.format=o.RGBA_S3TC_DXT5_Format;break;default:return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",i(T)),n}n.mipmapCount=1,S[g]&s&&t!==!1&&(n.mipmapCount=Math.max(1,S[x])),n.isCubemap=S[_]&l?!0:!1,n.width=S[y],n.height=S[v];for(var C=S[m]+4,A=n.width,E=n.height,L=n.isCubemap?6:1,P=0;L>P;P++){for(var R=0;R<n.mipmapCount;R++){var D=Math.max(4,A)/4*Math.max(4,E)/4*M,F=new Uint8Array(e,C,D),N={data:F,width:A,height:E};n.mipmaps.push(N),C+=D,A=Math.max(.5*A,1),E=Math.max(.5*E,1)}A=n.width,E=n.height}return n},getNormalMap:function(e,t){var r=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},i=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,a=e.height,s=document.createElement("canvas");s.width=o,s.height=a;var l=s.getContext("2d");l.drawImage(e,0,0);for(var h=l.getImageData(0,0,o,a).data,c=l.createImageData(o,a),u=c.data,f=0;o>f;f++)for(var p=0;a>p;p++){var d=0>p-1?0:p-1,m=p+1>a-1?a-1:p+1,g=0>f-1?0:f-1,v=f+1>o-1?o-1:f+1,y=[],x=[0,0,h[4*(p*o+f)]/255*t];y.push([-1,0,h[4*(p*o+g)]/255*t]),y.push([-1,-1,h[4*(d*o+g)]/255*t]),y.push([0,-1,h[4*(d*o+f)]/255*t]),y.push([1,-1,h[4*(d*o+v)]/255*t]),y.push([1,0,h[4*(p*o+v)]/255*t]),y.push([1,1,h[4*(m*o+v)]/255*t]),y.push([0,1,h[4*(m*o+f)]/255*t]),y.push([-1,1,h[4*(m*o+g)]/255*t]);for(var w=[],b=y.length,_=0;b>_;_++){var S=y[_],M=y[(_+1)%b];S=i(S,x),M=i(M,x),w.push(n(r(S,M)))}for(var T=[0,0,0],_=0;_<w.length;_++)T[0]+=w[_][0],T[1]+=w[_][1],T[2]+=w[_][2];T[0]/=w.length,T[1]/=w.length,T[2]/=w.length;var C=4*(p*o+f);u[C]=(T[0]+1)/2*255|0,u[C+1]=(T[1]+1)/2*255|0,u[C+2]=255*T[2]|0,u[C+3]=255}return l.putImageData(c,0,0),s},generateDataTexture:function(e,t,r){for(var i=e*t,n=new Uint8Array(3*i),a=Math.floor(255*r.r),s=Math.floor(255*r.g),l=Math.floor(255*r.b),h=0;i>h;h++)n[3*h]=a,n[3*h+1]=s,n[3*h+2]=l;var c=new o.DataTexture(n,e,t,o.RGBFormat);return c.needsUpdate=!0,c}},o.SceneUtils={createMultiMaterialObject:function(e,t){for(var r=new o.Object3D,i=0,n=t.length;n>i;i++)r.add(new o.Mesh(e,t[i]));return r},detach:function(e,t,r){e.applyMatrix(t.matrixWorld),t.remove(e),r.add(e)},attach:function(e,t,r){var i=new o.Matrix4;i.getInverse(r.matrixWorld),e.applyMatrix(i),t.remove(e),r.add(e)}},o.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),r=this;r.faces[t]=r.faces[t]||{},r.faces[t][e.cssFontWeight]=r.faces[t][e.cssFontWeight]||{},r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;r.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return e},drawText:function(e){var t,r=this.getFace(),i=this.size/r.resolution,n=0,a=String(e).split(""),s=a.length,l=[];for(t=0;s>t;t++){var h=new o.Path,c=this.extractGlyphPoints(a[t],r,i,n,h);n+=c.offset,l.push(c.path)}var u=n/2;return{paths:l,offset:u}},extractGlyphPoints:function(e,t,r,i,n){var a,s,l,h,c,u,f,p,d,m,g,v,y,x,w,b,_,S,M,T=[],C=t.glyphs[e]||t.glyphs["?"];if(C){if(C.o)for(h=C._cachedOutline||(C._cachedOutline=C.o.split(" ")),u=h.length,f=r,p=r,a=0;u>a;)switch(c=h[a++]){case"m":d=h[a++]*f+i,m=h[a++]*p,n.moveTo(d,m);break;case"l":d=h[a++]*f+i,m=h[a++]*p,n.lineTo(d,m);break;case"q":if(g=h[a++]*f+i,v=h[a++]*p,w=h[a++]*f+i,b=h[a++]*p,n.quadraticCurveTo(w,b,g,v),M=T[T.length-1])for(y=M.x,x=M.y,s=1,l=this.divisions;l>=s;s++){var A=s/l;o.Shape.Utils.b2(A,y,w,g),o.Shape.Utils.b2(A,x,b,v)}break;case"b":if(g=h[a++]*f+i,v=h[a++]*p,w=h[a++]*f+i,b=h[a++]*-p,_=h[a++]*f+i,S=h[a++]*-p,n.bezierCurveTo(g,v,w,b,_,S),M=T[T.length-1])for(y=M.x,x=M.y,s=1,l=this.divisions;l>=s;s++){var A=s/l;o.Shape.Utils.b3(A,y,w,_,g),o.Shape.Utils.b3(A,x,b,S,v)}}return{offset:C.ha*r,path:n}}}},o.FontUtils.generateShapes=function(e,t){t=t||{};var r=void 0!==t.size?t.size:100,i=void 0!==t.curveSegments?t.curveSegments:4,n=void 0!==t.font?t.font:"helvetiker",a=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";o.FontUtils.size=r,o.FontUtils.divisions=i,o.FontUtils.face=n,o.FontUtils.weight=a,o.FontUtils.style=s;for(var l=o.FontUtils.drawText(e),h=l.paths,c=[],u=0,f=h.length;f>u;u++)Array.prototype.push.apply(c,h[u].toShapes());
return c},function(e){var t=1e-10,r=function(e,t){var r=e.length;if(3>r)return null;var o,a,s,l=[],h=[],c=[];if(i(e)>0)for(a=0;r>a;a++)h[a]=a;else for(a=0;r>a;a++)h[a]=r-1-a;var u=r,f=2*u;for(a=u-1;u>2;){if(f--<=0)return console.log("Warning, unable to triangulate polygon!"),t?c:l;if(o=a,o>=u&&(o=0),a=o+1,a>=u&&(a=0),s=a+1,s>=u&&(s=0),n(e,o,a,s,u,h)){var p,d,m,g,v;for(p=h[o],d=h[a],m=h[s],l.push([e[p],e[d],e[m]]),c.push([h[o],h[a],h[s]]),g=a,v=a+1;u>v;g++,v++)h[g]=h[v];u--,f=2*u}}return t?c:l},i=function(e){for(var t=e.length,r=0,i=t-1,n=0;t>n;i=n++)r+=e[i].x*e[n].y-e[n].x*e[i].y;return.5*r},n=function(e,r,i,n,o,a){var s,l,h,c,u,f,p,d,m;if(l=e[a[r]].x,h=e[a[r]].y,c=e[a[i]].x,u=e[a[i]].y,f=e[a[n]].x,p=e[a[n]].y,t>(c-l)*(p-h)-(u-h)*(f-l))return!1;var g,v,y,x,w,b,_,S,M,T,C,A,E,L,P;for(g=f-c,v=p-u,y=l-f,x=h-p,w=c-l,b=u-h,s=0;o>s;s++)if(s!==r&&s!==i&&s!==n&&(d=e[a[s]].x,m=e[a[s]].y,_=d-l,S=m-h,M=d-c,T=m-u,C=d-f,A=m-p,P=g*T-v*M,E=w*S-b*_,L=y*A-x*C,P>=0&&L>=0&&E>=0))return!1;return!0};return e.Triangulate=r,e.Triangulate.area=i,e}(o.FontUtils),self._typeface_js={faces:o.FontUtils.faces,loadFace:o.FontUtils.loadFace},o.Curve=function(){},o.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},o.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},o.Curve.prototype.getPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPoint(t/e));return r},o.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,r=[];for(t=0;e>=t;t++)r.push(this.getPointAt(t/e));return r},o.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},o.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],n=this.getPoint(0),o=0;for(i.push(0),r=1;e>=r;r++)t=this.getPoint(r/e),o+=t.distanceTo(n),i.push(o),n=t;return this.cacheArcLengths=i,i},o.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},o.Curve.prototype.getUtoTmapping=function(e,t){var r,i=this.getLengths(),n=0,o=i.length;r=t?t:e*i[o-1];for(var a,s=0,l=o-1;l>=s;)if(n=Math.floor(s+(l-s)/2),a=i[n]-r,0>a)s=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]==r){var h=n/(o-1);return h}var c=i[n],u=i[n+1],f=u-c,p=(r-c)/f,h=(n+p)/(o-1);return h},o.Curve.prototype.getTangent=function(e){var t=1e-4,r=e-t,i=e+t;0>r&&(r=0),i>1&&(i=1);var n=this.getPoint(r),o=this.getPoint(i),a=o.clone().sub(n);return a.normalize()},o.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},o.LineCurve=function(e,t){this.v1=e,this.v2=t},o.LineCurve.prototype=Object.create(o.Curve.prototype),o.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},o.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},o.LineCurve.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},o.QuadraticBezierCurve=function(e,t,r){this.v0=e,this.v1=t,this.v2=r},o.QuadraticBezierCurve.prototype=Object.create(o.Curve.prototype),o.QuadraticBezierCurve.prototype.getPoint=function(e){var t,r;return t=o.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=o.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new o.Vector2(t,r)},o.QuadraticBezierCurve.prototype.getTangent=function(e){var t,r;t=o.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),r=o.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var i=new o.Vector2(t,r);return i.normalize(),i},o.CubicBezierCurve=function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},o.CubicBezierCurve.prototype=Object.create(o.Curve.prototype),o.CubicBezierCurve.prototype.getPoint=function(e){var t,r;return t=o.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=o.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new o.Vector2(t,r)},o.CubicBezierCurve.prototype.getTangent=function(e){var t,r;t=o.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=o.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var i=new o.Vector2(t,r);return i.normalize(),i},o.SplineCurve=function(e){this.points=void 0==e?[]:e},o.SplineCurve.prototype=Object.create(o.Curve.prototype),o.SplineCurve.prototype.getPoint=function(e){var t,r,i,n=new o.Vector2,a=[],s=this.points;return t=(s.length-1)*e,r=Math.floor(t),i=t-r,a[0]=0==r?r:r-1,a[1]=r,a[2]=r>s.length-2?s.length-1:r+1,a[3]=r>s.length-3?s.length-1:r+2,n.x=o.Curve.Utils.interpolate(s[a[0]].x,s[a[1]].x,s[a[2]].x,s[a[3]].x,i),n.y=o.Curve.Utils.interpolate(s[a[0]].y,s[a[1]].y,s[a[2]].y,s[a[3]].y,i),n},o.EllipseCurve=function(e,t,r,i,n,o,a){this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a},o.EllipseCurve.prototype=Object.create(o.Curve.prototype),o.EllipseCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);var r=this.aStartAngle+e*t,i=this.aX+this.xRadius*Math.cos(r),n=this.aY+this.yRadius*Math.sin(r);return new o.Vector2(i,n)},o.ArcCurve=function(e,t,r,i,n,a){o.EllipseCurve.call(this,e,t,r,r,i,n,a)},o.ArcCurve.prototype=Object.create(o.EllipseCurve.prototype),o.Curve.Utils={tangentQuadraticBezier:function(e,t,r,i){return 2*(1-e)*(r-t)+2*e*(i-r)},tangentCubicBezier:function(e,t,r,i,n){return-3*t*(1-e)*(1-e)+3*r*(1-e)*(1-e)-6*e*r*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*n},tangentSpline:function(e,t,r,i,n){var o=6*e*e-6*e,a=3*e*e-4*e+1,s=-6*e*e+6*e,l=3*e*e-2*e;return o+a+s+l},interpolate:function(e,t,r,i,n){var o=.5*(r-e),a=.5*(i-t),s=n*n,l=n*s;return(2*t-2*r+o+a)*l+(-3*t+3*r-2*o-a)*s+o*n+t}},o.Curve.create=function(e,t){return e.prototype=Object.create(o.Curve.prototype),e.prototype.getPoint=t,e},o.LineCurve3=o.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new o.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),o.QuadraticBezierCurve3=o.Curve.create(function(e,t,r){this.v0=e,this.v1=t,this.v2=r},function(e){var t,r,i;return t=o.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),r=o.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),i=o.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new o.Vector3(t,r,i)}),o.CubicBezierCurve3=o.Curve.create(function(e,t,r,i){this.v0=e,this.v1=t,this.v2=r,this.v3=i},function(e){var t,r,i;return t=o.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=o.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),i=o.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new o.Vector3(t,r,i)}),o.SplineCurve3=o.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,n=new o.Vector3,a=[],s=this.points;t=(s.length-1)*e,r=Math.floor(t),i=t-r,a[0]=0==r?r:r-1,a[1]=r,a[2]=r>s.length-2?s.length-1:r+1,a[3]=r>s.length-3?s.length-1:r+2;var l=s[a[0]],h=s[a[1]],c=s[a[2]],u=s[a[3]];return n.x=o.Curve.Utils.interpolate(l.x,h.x,c.x,u.x,i),n.y=o.Curve.Utils.interpolate(l.y,h.y,c.y,u.y,i),n.z=o.Curve.Utils.interpolate(l.z,h.z,c.z,u.z,i),n}),o.ClosedSplineCurve3=o.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,r,i,n=new o.Vector3,a=[],s=this.points;return t=(s.length-0)*e,r=Math.floor(t),i=t-r,r+=r>0?0:(Math.floor(Math.abs(r)/s.length)+1)*s.length,a[0]=(r-1)%s.length,a[1]=r%s.length,a[2]=(r+1)%s.length,a[3]=(r+2)%s.length,n.x=o.Curve.Utils.interpolate(s[a[0]].x,s[a[1]].x,s[a[2]].x,s[a[3]].x,i),n.y=o.Curve.Utils.interpolate(s[a[0]].y,s[a[1]].y,s[a[2]].y,s[a[3]].y,i),n.z=o.Curve.Utils.interpolate(s[a[0]].z,s[a[1]].z,s[a[2]].z,s[a[3]].z,i),n}),o.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},o.CurvePath.prototype=Object.create(o.Curve.prototype),o.CurvePath.prototype.add=function(e){this.curves.push(e)},o.CurvePath.prototype.checkConnection=function(){},o.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new o.LineCurve(t,e))},o.CurvePath.prototype.getPoint=function(e){for(var t,r,i=e*this.getLength(),n=this.getCurveLengths(),o=0;o<n.length;){if(n[o]>=i){t=n[o]-i,r=this.curves[o];var a=1-t/r.getLength();return r.getPointAt(a)}o++}return null},o.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},o.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],r=0,i=this.curves.length;for(e=0;i>e;e++)r+=this.curves[e].getLength(),t.push(r);return this.cacheLengths=t,t},o.CurvePath.prototype.getBoundingBox=function(){var e,t,r,i,n,a,s=this.getPoints();e=t=Number.NEGATIVE_INFINITY,i=n=Number.POSITIVE_INFINITY;var l,h,c,u,f=s[0]instanceof o.Vector3;for(u=f?new o.Vector3:new o.Vector2,h=0,c=s.length;c>h;h++)l=s[h],l.x>e?e=l.x:l.x<i&&(i=l.x),l.y>t?t=l.y:l.y<n&&(n=l.y),f&&(l.z>r?r=l.z:l.z<a&&(a=l.z)),u.add(l);var p={minX:i,minY:n,maxX:e,maxY:t,centroid:u.divideScalar(c)};return f&&(p.maxZ=r,p.minZ=a),p},o.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},o.CurvePath.prototype.createGeometry=function(e){for(var t=new o.Geometry,r=0;r<e.length;r++)t.vertices.push(new o.Vector3(e[r].x,e[r].y,e[r].z||0));return t},o.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},o.CurvePath.prototype.getTransformedPoints=function(e,t){var r,i,n=this.getPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)n=this.getWrapPoints(n,t[r]);return n},o.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var r,i,n=this.getSpacedPoints(e);for(t||(t=this.bends),r=0,i=t.length;i>r;r++)n=this.getWrapPoints(n,t[r]);return n},o.CurvePath.prototype.getWrapPoints=function(e,t){var r,i,n,o,a,s,l=this.getBoundingBox();for(r=0,i=e.length;i>r;r++){n=e[r],o=n.x,a=n.y,s=o/l.maxX,s=t.getUtoTmapping(s,o);var h=t.getPoint(s),c=t.getNormalVector(s).multiplyScalar(a);n.x=h.x+c.x,n.y=h.y+c.y}return e},o.Gyroscope=function(){o.Object3D.call(this)},o.Gyroscope.prototype=Object.create(o.Object3D.prototype),o.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,r=this.children.length;r>t;t++)this.children[t].updateMatrixWorld(e)},o.Gyroscope.prototype.translationWorld=new o.Vector3,o.Gyroscope.prototype.translationObject=new o.Vector3,o.Gyroscope.prototype.rotationWorld=new o.Quaternion,o.Gyroscope.prototype.rotationObject=new o.Quaternion,o.Gyroscope.prototype.scaleWorld=new o.Vector3,o.Gyroscope.prototype.scaleObject=new o.Vector3,o.Path=function(e){o.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},o.Path.prototype=Object.create(o.CurvePath.prototype),o.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},o.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;r>t;t++)this.lineTo(e[t].x,e[t].y)},o.Path.prototype.moveTo=function(e,t){var r=Array.prototype.slice.call(arguments);this.actions.push({action:o.PathActions.MOVE_TO,args:r})},o.Path.prototype.lineTo=function(e,t){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],a=i[i.length-1],s=new o.LineCurve(new o.Vector2(n,a),new o.Vector2(e,t));this.curves.push(s),this.actions.push({action:o.PathActions.LINE_TO,args:r})},o.Path.prototype.quadraticCurveTo=function(e,t,r,i){var n=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1],h=new o.QuadraticBezierCurve(new o.Vector2(s,l),new o.Vector2(e,t),new o.Vector2(r,i));this.curves.push(h),this.actions.push({action:o.PathActions.QUADRATIC_CURVE_TO,args:n})},o.Path.prototype.bezierCurveTo=function(e,t,r,i,n,a){var s=Array.prototype.slice.call(arguments),l=this.actions[this.actions.length-1].args,h=l[l.length-2],c=l[l.length-1],u=new o.CubicBezierCurve(new o.Vector2(h,c),new o.Vector2(e,t),new o.Vector2(r,i),new o.Vector2(n,a));this.curves.push(u),this.actions.push({action:o.PathActions.BEZIER_CURVE_TO,args:s})},o.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,i=r[r.length-2],n=r[r.length-1],a=[new o.Vector2(i,n)];Array.prototype.push.apply(a,e);var s=new o.SplineCurve(a);this.curves.push(s),this.actions.push({action:o.PathActions.CSPLINE_THRU,args:t})},o.Path.prototype.arc=function(e,t,r,i,n,o){var a=this.actions[this.actions.length-1].args,s=a[a.length-2],l=a[a.length-1];this.absarc(e+s,t+l,r,i,n,o)},o.Path.prototype.absarc=function(e,t,r,i,n,o){this.absellipse(e,t,r,r,i,n,o)},o.Path.prototype.ellipse=function(e,t,r,i,n,o,a){var s=this.actions[this.actions.length-1].args,l=s[s.length-2],h=s[s.length-1];this.absellipse(e+l,t+h,r,i,n,o,a)},o.Path.prototype.absellipse=function(e,t,r,i,n,a,s){var l=Array.prototype.slice.call(arguments),h=new o.EllipseCurve(e,t,r,i,n,a,s);this.curves.push(h);var c=h.getPoint(s?1:0);l.push(c.x),l.push(c.y),this.actions.push({action:o.PathActions.ELLIPSE,args:l})},o.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var r=[],i=0;e>i;i++)r.push(this.getPoint(i/e));return r},o.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var r,i,n,a,s,l,h,c,u,f,p,d,m,g,v,y,x,w,b=[];for(r=0,i=this.actions.length;i>r;r++)switch(n=this.actions[r],a=n.action,s=n.args,a){case o.PathActions.MOVE_TO:b.push(new o.Vector2(s[0],s[1]));break;case o.PathActions.LINE_TO:b.push(new o.Vector2(s[0],s[1]));break;case o.PathActions.QUADRATIC_CURVE_TO:for(l=s[2],h=s[3],f=s[0],p=s[1],b.length>0?(g=b[b.length-1],d=g.x,m=g.y):(g=this.actions[r-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;e>=v;v++)y=v/e,x=o.Shape.Utils.b2(y,d,f,l),w=o.Shape.Utils.b2(y,m,p,h),b.push(new o.Vector2(x,w));break;case o.PathActions.BEZIER_CURVE_TO:for(l=s[4],h=s[5],f=s[0],p=s[1],c=s[2],u=s[3],b.length>0?(g=b[b.length-1],d=g.x,m=g.y):(g=this.actions[r-1].args,d=g[g.length-2],m=g[g.length-1]),v=1;e>=v;v++)y=v/e,x=o.Shape.Utils.b3(y,d,f,c,l),w=o.Shape.Utils.b3(y,m,p,u,h),b.push(new o.Vector2(x,w));break;case o.PathActions.CSPLINE_THRU:g=this.actions[r-1].args;var _=new o.Vector2(g[g.length-2],g[g.length-1]),S=[_],M=e*s[0].length;S=S.concat(s[0]);var T=new o.SplineCurve(S);for(v=1;M>=v;v++)b.push(T.getPointAt(v/M));break;case o.PathActions.ARC:var C,A=s[0],E=s[1],L=s[2],P=s[3],R=s[4],D=!!s[5],F=R-P,N=2*e;for(v=1;N>=v;v++)y=v/N,D||(y=1-y),C=P+y*F,x=A+L*Math.cos(C),w=E+L*Math.sin(C),b.push(new o.Vector2(x,w));break;case o.PathActions.ELLIPSE:var C,A=s[0],E=s[1],U=s[2],z=s[3],P=s[4],R=s[5],D=!!s[6],F=R-P,N=2*e;for(v=1;N>=v;v++)y=v/N,D||(y=1-y),C=P+y*F,x=A+U*Math.cos(C),w=E+z*Math.sin(C),b.push(new o.Vector2(x,w))}var V=b[b.length-1],B=1e-10;return Math.abs(V.x-b[0].x)<B&&Math.abs(V.y-b[0].y)<B&&b.splice(b.length-1,1),t&&b.push(b[0]),b},o.Path.prototype.toShapes=function(){var e,t,r,i,n,a=[],s=new o.Path;for(e=0,t=this.actions.length;t>e;e++)r=this.actions[e],n=r.args,i=r.action,i==o.PathActions.MOVE_TO&&0!=s.actions.length&&(a.push(s),s=new o.Path),s[i].apply(s,n);if(0!=s.actions.length&&a.push(s),0==a.length)return[];var l,h,c=[],u=!o.Shape.Utils.isClockWise(a[0].getPoints());if(1==a.length)return l=a[0],h=new o.Shape,h.actions=l.actions,h.curves=l.curves,c.push(h),c;if(u)for(h=new o.Shape,e=0,t=a.length;t>e;e++)l=a[e],o.Shape.Utils.isClockWise(l.getPoints())?(h.actions=l.actions,h.curves=l.curves,c.push(h),h=new o.Shape):h.holes.push(l);else{for(e=0,t=a.length;t>e;e++)l=a[e],o.Shape.Utils.isClockWise(l.getPoints())?(h&&c.push(h),h=new o.Shape,h.actions=l.actions,h.curves=l.curves):h.holes.push(l);c.push(h)}return c},o.Shape=function(){o.Path.apply(this,arguments),this.holes=[]},o.Shape.prototype=Object.create(o.Path.prototype),o.Shape.prototype.extrude=function(e){var t=new o.ExtrudeGeometry(this,e);return t},o.Shape.prototype.makeGeometry=function(e){var t=new o.ShapeGeometry(this,e);return t},o.Shape.prototype.getPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedPoints(e,this.bends);return i},o.Shape.prototype.getSpacedPointsHoles=function(e){var t,r=this.holes.length,i=[];for(t=0;r>t;t++)i[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return i},o.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},o.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},o.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},o.Shape.Utils={removeHoles:function(e,t){var r,i,n,a,s,l,h,c,u,f,p,d,m,g,v,y,x=e.concat(),w=x.concat(),b=[];for(s=0;s<t.length;s++){for(h=t[s],Array.prototype.push.apply(w,h),c=Number.POSITIVE_INFINITY,l=0;l<h.length;l++){p=h[l];var _=[];for(f=0;f<x.length;f++)d=x[f],u=p.distanceToSquared(d),_.push(u),c>u&&(c=u,n=l,a=f)}r=a-1>=0?a-1:x.length-1,i=n-1>=0?n-1:h.length-1;var S=[h[n],x[a],x[r]],M=o.FontUtils.Triangulate.area(S),T=[h[n],h[i],x[a]],C=o.FontUtils.Triangulate.area(T),A=1,E=-1,L=a,P=n;a+=A,n+=E,0>a&&(a+=x.length),a%=x.length,0>n&&(n+=h.length),n%=h.length,r=a-1>=0?a-1:x.length-1,i=n-1>=0?n-1:h.length-1,S=[h[n],x[a],x[r]];var R=o.FontUtils.Triangulate.area(S);T=[h[n],h[i],x[a]];var D=o.FontUtils.Triangulate.area(T);M+C>R+D&&(a=L,n=P,0>a&&(a+=x.length),a%=x.length,0>n&&(n+=h.length),n%=h.length,r=a-1>=0?a-1:x.length-1,i=n-1>=0?n-1:h.length-1),m=x.slice(0,a),g=x.slice(a),v=h.slice(n),y=h.slice(0,n);var F=[h[n],x[a],x[r]],N=[h[n],h[i],x[a]];b.push(F),b.push(N),x=m.concat(v).concat(y).concat(g)}return{shape:x,isolatedPts:b,allpoints:w}},triangulateShape:function(e,t){var r,i,n,a,s,l,h=o.Shape.Utils.removeHoles(e,t),c=h.shape,u=h.allpoints,f=h.isolatedPts,p=o.FontUtils.Triangulate(c,!1),d={};for(r=0,i=u.length;i>r;r++)s=u[r].x+":"+u[r].y,void 0!==d[s]&&console.log("Duplicate point",s),d[s]=r;for(r=0,i=p.length;i>r;r++)for(a=p[r],n=0;3>n;n++)s=a[n].x+":"+a[n].y,l=d[s],void 0!==l&&(a[n]=l);for(r=0,i=f.length;i>r;r++)for(a=f[r],n=0;3>n;n++)s=a[n].x+":"+a[n].y,l=d[s],void 0!==l&&(a[n]=l);return p.concat(f)},isClockWise:function(e){return o.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var r=1-e;return r*r*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,r,i){return this.b2p0(e,t)+this.b2p1(e,r)+this.b2p2(e,i)},b3p0:function(e,t){var r=1-e;return r*r*r*t},b3p1:function(e,t){var r=1-e;return 3*r*r*e*t},b3p2:function(e,t){var r=1-e;return 3*r*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,r,i,n){return this.b3p0(e,t)+this.b3p1(e,r)+this.b3p2(e,i)+this.b3p3(e,n)}},o.AnimationHandler=function(){var e=[],t={},r={};r.update=function(t){for(var r=0;r<e.length;r++)e[r].update(t)},r.addToUpdate=function(t){-1===e.indexOf(t)&&e.push(t)},r.removeFromUpdate=function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},r.add=function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,n(e)},r.get=function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},r.parse=function(e){var t=[];if(e instanceof o.SkinnedMesh)for(var r=0;r<e.bones.length;r++)t.push(e.bones[r]);else i(e,t);return t};var i=function(e,t){t.push(e);for(var r=0;r<e.children.length;r++)i(e.children[r],t)},n=function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var r=0;r<e.hierarchy[t].keys.length;r++)if(e.hierarchy[t].keys[r].time<0&&(e.hierarchy[t].keys[r].time=0),void 0!==e.hierarchy[t].keys[r].rot&&!(e.hierarchy[t].keys[r].rot instanceof o.Quaternion)){var i=e.hierarchy[t].keys[r].rot;e.hierarchy[t].keys[r].rot=new o.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var n={},r=0;r<e.hierarchy[t].keys.length;r++)for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++){var s=e.hierarchy[t].keys[r].morphTargets[a];n[s]=-1}e.hierarchy[t].usedMorphTargets=n;for(var r=0;r<e.hierarchy[t].keys.length;r++){var l={};for(var s in n){for(var a=0;a<e.hierarchy[t].keys[r].morphTargets.length;a++)if(e.hierarchy[t].keys[r].morphTargets[a]===s){l[s]=e.hierarchy[t].keys[r].morphTargetsInfluences[a];break}a===e.hierarchy[t].keys[r].morphTargets.length&&(l[s]=0)}e.hierarchy[t].keys[r].morphTargetsInfluences=l}}for(var r=1;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].time===e.hierarchy[t].keys[r-1].time&&(e.hierarchy[t].keys.splice(r,1),r--);for(var r=0;r<e.hierarchy[t].keys.length;r++)e.hierarchy[t].keys[r].index=r}var h=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(var t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(h));e.initialized=!0}};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),o.Animation=function(e,t,r){this.root=e,this.data=o.AnimationHandler.get(t),this.hierarchy=o.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==r?r:o.AnimationHandler.LINEAR,this.points=[],this.target=new o.Vector3},o.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var r,i,n=this.hierarchy.length;for(r=0;n>r;r++){i=this.hierarchy[r],this.interpolationType!==o.AnimationHandler.CATMULLROM_FORWARD&&(i.useQuaternion=!0),i.matrixAutoUpdate=!0,void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey={pos:0,rot:0,scl:0},i.animationCache.nextKey={pos:0,rot:0,scl:0},i.animationCache.originalMatrix=i instanceof o.Bone?i.skinMatrix:i.matrix);var a=i.animationCache.prevKey,s=i.animationCache.nextKey;a.pos=this.data.hierarchy[r].keys[0],a.rot=this.data.hierarchy[r].keys[0],a.scl=this.data.hierarchy[r].keys[0],s.pos=this.getNextKeyWith("pos",r,1),s.rot=this.getNextKeyWith("rot",r,1),s.scl=this.getNextKeyWith("scl",r,1)}this.update(0)}this.isPaused=!1,o.AnimationHandler.addToUpdate(this)},o.Animation.prototype.pause=function(){this.isPaused===!0?o.AnimationHandler.addToUpdate(this):o.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},o.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,o.AnimationHandler.removeFromUpdate(this)},o.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,r,i,n,a,s,l,h,c,u,f,p,d,m,g,v=["pos","rot","scl"];this.data.JIT.hierarchy;this.currentTime+=e*this.timeScale,p=this.currentTime,f=this.currentTime=this.currentTime%this.data.length,u=parseInt(Math.min(f*this.data.fps,this.data.length*this.data.fps),10);for(var y=0,x=this.hierarchy.length;x>y;y++){h=this.hierarchy[y],c=h.animationCache;for(var w=0;3>w;w++){if(t=v[w],s=c.prevKey[t],l=c.nextKey[t],l.time<=p){if(p>f){if(!this.loop)return void this.stop();for(s=this.data.hierarchy[y].keys[0],l=this.getNextKeyWith(t,y,1);l.time<f;)s=l,l=this.getNextKeyWith(t,y,l.index+1)}else do s=l,l=this.getNextKeyWith(t,y,l.index+1);while(l.time<f);c.prevKey[t]=s,c.nextKey[t]=l}h.matrixAutoUpdate=!0,h.matrixWorldNeedsUpdate=!0,r=(f-s.time)/(l.time-s.time),n=s[t],a=l[t],(0>r||r>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+y),r=0>r?0:1),"pos"===t?(i=h.position,this.interpolationType===o.AnimationHandler.LINEAR?(i.x=n[0]+(a[0]-n[0])*r,i.y=n[1]+(a[1]-n[1])*r,i.z=n[2]+(a[2]-n[2])*r):(this.interpolationType===o.AnimationHandler.CATMULLROM||this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",y,s.index-1).pos,this.points[1]=n,this.points[2]=a,this.points[3]=this.getNextKeyWith("pos",y,l.index+1).pos,r=.33*r+.33,d=this.interpolateCatmullRom(this.points,r),i.x=d[0],i.y=d[1],i.z=d[2],this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD&&(m=this.interpolateCatmullRom(this.points,1.01*r),this.target.set(m[0],m[1],m[2]),this.target.sub(i),this.target.y=0,this.target.normalize(),g=Math.atan2(this.target.x,this.target.z),h.rotation.set(0,g,0)))):"rot"===t?o.Quaternion.slerp(n,a,h.quaternion,r):"scl"===t&&(i=h.scale,i.x=n[0]+(a[0]-n[0])*r,i.y=n[1]+(a[1]-n[1])*r,i.z=n[2]+(a[2]-n[2])*r)}}}},o.Animation.prototype.interpolateCatmullRom=function(e,t){var r,i,n,o,a,s,l,h,c,u=[],f=[];return r=(e.length-1)*t,i=Math.floor(r),n=r-i,u[0]=0===i?i:i-1,u[1]=i,u[2]=i>e.length-2?i:i+1,u[3]=i>e.length-3?i:i+2,s=e[u[0]],l=e[u[1]],h=e[u[2]],c=e[u[3]],o=n*n,a=n*o,f[0]=this.interpolate(s[0],l[0],h[0],c[0],n,o,a),f[1]=this.interpolate(s[1],l[1],h[1],c[1],n,o,a),f[2]=this.interpolate(s[2],l[2],h[2],c[2],n,o,a),f},o.Animation.prototype.interpolate=function(e,t,r,i,n,o,a){var s=.5*(r-e),l=.5*(i-t);return(2*(t-r)+s+l)*a+(-3*(t-r)-2*s-l)*o+s*n+t},o.Animation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(this.interpolationType===o.AnimationHandler.CATMULLROM||this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD?r=r<i.length-1?r:i.length-1:r%=i.length;r<i.length;r++)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[0]},o.Animation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=this.interpolationType===o.AnimationHandler.CATMULLROM||this.interpolationType===o.AnimationHandler.CATMULLROM_FORWARD?r>0?r:0:r>=0?r:r+i.length;r>=0;r--)if(void 0!==i[r][e])return i[r];return this.data.hierarchy[t].keys[i.length-1]},o.KeyFrameAnimation=function(e,t,r){this.root=e,this.data=o.AnimationHandler.get(t),this.hierarchy=o.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==r?r:!0;for(var i=0,n=this.hierarchy.length;n>i;i++){var a=this.data.hierarchy[i].keys,s=this.data.hierarchy[i].sids,l=this.hierarchy[i];if(a.length&&s){for(var h=0;h<s.length;h++){var c=s[h],u=this.getNextKeyWith(c,i,0);u&&u.apply(c)}l.matrixAutoUpdate=!1,this.data.hierarchy[i].node.updateMatrix(),l.matrixWorldNeedsUpdate=!0}}},o.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var r,i,n,a=this.hierarchy.length;for(r=0;a>r;r++){i=this.hierarchy[r],n=this.data.hierarchy[r],i.useQuaternion=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey=null,n.animationCache.nextKey=null,n.animationCache.originalMatrix=i instanceof o.Bone?i.skinMatrix:i.matrix);var s=this.data.hierarchy[r].keys;s.length&&(n.animationCache.prevKey=s[0],n.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,o.AnimationHandler.addToUpdate(this)},o.KeyFrameAnimation.prototype.pause=function(){this.isPaused?o.AnimationHandler.addToUpdate(this):o.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},o.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,o.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],r=this.data.hierarchy[e];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;t instanceof o.Bone?(i.copy(t.skinMatrix),t.skinMatrix=i):(i.copy(t.matrix),t.matrix=i),delete r.animationCache}}},o.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,r,i,n,a,s,l,h,c=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,l=this.currentTime,s=this.currentTime=this.currentTime%this.data.length,s<this.startTimeMs&&(s=this.currentTime=this.startTimeMs+s),a=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10),h=l>s,h&&!this.loop){for(var u=0,f=this.hierarchy.length;f>u;u++){var p=this.data.hierarchy[u].keys,d=this.data.hierarchy[u].sids,m=p.length-1,g=this.hierarchy[u];if(p.length){for(var v=0;v<d.length;v++){var y=d[v],x=this.getPrevKeyWith(y,u,m);x&&x.apply(y)}this.data.hierarchy[u].node.updateMatrix(),g.matrixWorldNeedsUpdate=!0}}return void this.stop()}if(!(s<this.startTime)){for(var u=0,f=this.hierarchy.length;f>u;u++){i=this.hierarchy[u],n=this.data.hierarchy[u];var p=n.keys,w=n.animationCache;if(this.JITCompile&&void 0!==c[u][a])i instanceof o.Bone?(i.skinMatrix=c[u][a],i.matrixWorldNeedsUpdate=!1):(i.matrix=c[u][a],i.matrixWorldNeedsUpdate=!0);else if(p.length){if(this.JITCompile&&w&&(i instanceof o.Bone?i.skinMatrix=w.originalMatrix:i.matrix=w.originalMatrix),t=w.prevKey,r=w.nextKey,t&&r){if(r.time<=l){if(h&&this.loop)for(t=p[0],r=p[1];r.time<s;)t=r,r=p[t.index+1];else if(!h)for(var b=p.length-1;r.time<s&&r.index!==b;)t=r,r=p[t.index+1];w.prevKey=t,w.nextKey=r}r.time>=s?t.interpolate(r,s):t.interpolate(r,r.time)}this.data.hierarchy[u].node.updateMatrix(),i.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===c[0][a]){this.hierarchy[0].updateMatrixWorld(!0);for(var u=0;u<this.hierarchy.length;u++)this.hierarchy[u]instanceof o.Bone?c[u][a]=this.hierarchy[u].skinMatrix.clone():c[u][a]=this.hierarchy[u].matrix.clone()}}}},o.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r%=i.length;r<i.length;r++)if(i[r].hasTarget(e))return i[r];return i[0]},o.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,r){var i=this.data.hierarchy[t].keys;for(r=r>=0?r:r+i.length;r>=0;r--)if(i[r].hasTarget(e))return i[r];return i[i.length-1]},o.CubeCamera=function(e,t,r){o.Object3D.call(this);var i=90,n=1,a=new o.PerspectiveCamera(i,n,e,t);a.up.set(0,-1,0),a.lookAt(new o.Vector3(1,0,0)),this.add(a);var s=new o.PerspectiveCamera(i,n,e,t);s.up.set(0,-1,0),s.lookAt(new o.Vector3(-1,0,0)),this.add(s);var l=new o.PerspectiveCamera(i,n,e,t);l.up.set(0,0,1),l.lookAt(new o.Vector3(0,1,0)),this.add(l);var h=new o.PerspectiveCamera(i,n,e,t);h.up.set(0,0,-1),h.lookAt(new o.Vector3(0,-1,0)),this.add(h);var c=new o.PerspectiveCamera(i,n,e,t);c.up.set(0,-1,0),c.lookAt(new o.Vector3(0,0,1)),this.add(c);var u=new o.PerspectiveCamera(i,n,e,t);u.up.set(0,-1,0),u.lookAt(new o.Vector3(0,0,-1)),this.add(u),this.renderTarget=new o.WebGLRenderTargetCube(r,r,{format:o.RGBFormat,magFilter:o.LinearFilter,minFilter:o.LinearFilter}),this.updateCubeMap=function(e,t){var r=this.renderTarget,i=r.generateMipmaps;r.generateMipmaps=!1,r.activeCubeFace=0,e.render(t,a,r),r.activeCubeFace=1,e.render(t,s,r),r.activeCubeFace=2,e.render(t,l,r),r.activeCubeFace=3,e.render(t,h,r),r.activeCubeFace=4,e.render(t,c,r),r.generateMipmaps=i,r.activeCubeFace=5,e.render(t,u,r)}},o.CubeCamera.prototype=Object.create(o.Object3D.prototype),o.CombinedCamera=function(e,t,r,i,n,a,s){o.Camera.call(this),this.fov=r,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new o.OrthographicCamera(e/-2,e/2,t/2,t/-2,a,s),this.cameraP=new o.PerspectiveCamera(r,e/t,i,n),this.zoom=1,this.toPerspective()},o.CombinedCamera.prototype=Object.create(o.Camera.prototype),o.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},o.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,r=this.cameraP.near,i=this.cameraP.far,n=(r+i)/2,o=Math.tan(e/2)*n,a=2*o,s=a*t,l=s/2;
o/=this.zoom,l/=this.zoom,this.cameraO.left=-l,this.cameraO.right=l,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},o.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},o.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},o.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},o.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var r=2*o.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(r),r},o.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},o.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},o.AsteriskGeometry=function(e,t){o.Geometry.call(this);for(var r=e,i=t,n=.707*r,a=.707*i,s=[[r,0,0],[i,0,0],[-r,0,0],[-i,0,0],[0,r,0],[0,i,0],[0,-r,0],[0,-i,0],[0,0,r],[0,0,i],[0,0,-r],[0,0,-i],[n,n,0],[a,a,0],[-n,-n,0],[-a,-a,0],[n,-n,0],[a,-a,0],[-n,n,0],[-a,a,0],[n,0,n],[a,0,a],[-n,0,-n],[-a,0,-a],[n,0,-n],[a,0,-a],[-n,0,n],[-a,0,a],[0,n,n],[0,a,a],[0,-n,-n],[0,-a,-a],[0,n,-n],[0,a,-a],[0,-n,n],[0,-a,a]],l=0,h=s.length;h>l;l++){var c=s[l][0],u=s[l][1],f=s[l][2];this.vertices.push(new o.Vector3(c,u,f))}},o.AsteriskGeometry.prototype=Object.create(o.Geometry.prototype),o.CircleGeometry=function(e,t,r,i){o.Geometry.call(this),e=e||50,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,t=void 0!==t?Math.max(3,t):8;var n,a=[],s=new o.Vector3,l=new o.Vector2(.5,.5);for(this.vertices.push(s),a.push(l),n=0;t>=n;n++){var h=new o.Vector3;h.x=e*Math.cos(r+n/t*i),h.y=e*Math.sin(r+n/t*i),this.vertices.push(h),a.push(new o.Vector2((h.x/e+1)/2,-(h.y/e+1)/2+1))}var c=new o.Vector3(0,0,-1);for(n=1;t>=n;n++){var u=n,f=n+1,p=0;this.faces.push(new o.Face3(u,f,p,[c,c,c])),this.faceVertexUvs[0].push([a[n],a[n+1],l])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.CircleGeometry.prototype=Object.create(o.Geometry.prototype),o.CubeGeometry=function(e,t,r,i,n,a){function s(e,t,r,i,n,a,s,h){var c,u,f,p=l.widthSegments,d=l.heightSegments,m=n/2,g=a/2,v=l.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?c="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(c="y",d=l.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(c="x",p=l.depthSegments);var y=p+1,x=d+1,w=n/p,b=a/d,_=new o.Vector3;for(_[c]=s>0?1:-1,f=0;x>f;f++)for(u=0;y>u;u++){var S=new o.Vector3;S[e]=(u*w-m)*r,S[t]=(f*b-g)*i,S[c]=s,l.vertices.push(S)}for(f=0;d>f;f++)for(u=0;p>u;u++){var M=u+y*f,T=u+y*(f+1),C=u+1+y*(f+1),A=u+1+y*f,E=new o.Face4(M+v,T+v,C+v,A+v);E.normal.copy(_),E.vertexNormals.push(_.clone(),_.clone(),_.clone(),_.clone()),E.materialIndex=h,l.faces.push(E),l.faceVertexUvs[0].push([new o.Vector2(u/p,1-f/d),new o.Vector2(u/p,1-(f+1)/d),new o.Vector2((u+1)/p,1-(f+1)/d),new o.Vector2((u+1)/p,1-f/d)])}}o.Geometry.call(this);var l=this;this.width=e,this.height=t,this.depth=r,this.widthSegments=i||1,this.heightSegments=n||1,this.depthSegments=a||1;var h=this.width/2,c=this.height/2,u=this.depth/2;s("z","y",-1,-1,this.depth,this.height,h,0),s("z","y",1,-1,this.depth,this.height,-h,1),s("x","z",1,1,this.width,this.depth,c,2),s("x","z",1,-1,this.width,this.depth,-c,3),s("x","y",1,-1,this.width,this.height,u,4),s("x","y",-1,-1,this.width,this.height,-u,5),this.computeCentroids(),this.mergeVertices()},o.CubeGeometry.prototype=Object.create(o.Geometry.prototype),o.CylinderGeometry=function(e,t,r,i,n,a){o.Geometry.call(this),e=void 0!==e?e:20,t=void 0!==t?t:20,r=void 0!==r?r:100;var s,l,h=r/2,c=i||8,u=n||1,f=[],p=[];for(l=0;u>=l;l++){var d=[],m=[],g=l/u,v=g*(t-e)+e;for(s=0;c>=s;s++){var y=s/c,x=new o.Vector3;x.x=v*Math.sin(y*Math.PI*2),x.y=-g*r+h,x.z=v*Math.cos(y*Math.PI*2),this.vertices.push(x),d.push(this.vertices.length-1),m.push(new o.Vector2(y,1-g))}f.push(d),p.push(m)}var w,b,_=(t-e)/r;for(s=0;c>s;s++)for(0!==e?(w=this.vertices[f[0][s]].clone(),b=this.vertices[f[0][s+1]].clone()):(w=this.vertices[f[1][s]].clone(),b=this.vertices[f[1][s+1]].clone()),w.setY(Math.sqrt(w.x*w.x+w.z*w.z)*_).normalize(),b.setY(Math.sqrt(b.x*b.x+b.z*b.z)*_).normalize(),l=0;u>l;l++){var S=f[l][s],M=f[l+1][s],T=f[l+1][s+1],C=f[l][s+1],A=w.clone(),E=w.clone(),L=b.clone(),P=b.clone(),R=p[l][s].clone(),D=p[l+1][s].clone(),F=p[l+1][s+1].clone(),N=p[l][s+1].clone();this.faces.push(new o.Face4(S,M,T,C,[A,E,L,P])),this.faceVertexUvs[0].push([R,D,F,N])}if(!a&&e>0)for(this.vertices.push(new o.Vector3(0,h,0)),s=0;c>s;s++){var S=f[0][s],M=f[0][s+1],T=this.vertices.length-1,A=new o.Vector3(0,1,0),E=new o.Vector3(0,1,0),L=new o.Vector3(0,1,0),R=p[0][s].clone(),D=p[0][s+1].clone(),F=new o.Vector2(D.u,0);this.faces.push(new o.Face3(S,M,T,[A,E,L])),this.faceVertexUvs[0].push([R,D,F])}if(!a&&t>0)for(this.vertices.push(new o.Vector3(0,-h,0)),s=0;c>s;s++){var S=f[l][s+1],M=f[l][s],T=this.vertices.length-1,A=new o.Vector3(0,-1,0),E=new o.Vector3(0,-1,0),L=new o.Vector3(0,-1,0),R=p[l][s+1].clone(),D=p[l][s].clone(),F=new o.Vector2(D.u,1);this.faces.push(new o.Face3(S,M,T,[A,E,L])),this.faceVertexUvs[0].push([R,D,F])}this.computeCentroids(),this.computeFaceNormals()},o.CylinderGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?void(e=[]):(o.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),void this.computeFaceNormals())},o.ExtrudeGeometry.prototype=Object.create(o.Geometry.prototype),o.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var r=e.length,i=0;r>i;i++){var n=e[i];this.addShape(n,t)}},o.ExtrudeGeometry.prototype.addShape=function(e,t){function r(e,t,r){return t||console.log("die"),t.clone().multiplyScalar(r).add(e)}function i(e,t,r){return a(e,t,r)}function n(e,t,r){var i=Math.atan2(t.y-e.y,t.x-e.x),n=Math.atan2(r.y-e.y,r.x-e.x);i>n&&(n+=2*Math.PI);var a=(i+n)/2,s=-Math.cos(a),l=-Math.sin(a),h=new o.Vector2(s,l);return h}function a(e,t,r){var i,a,s,l,h,c,u=o.ExtrudeGeometry.__v1,f=o.ExtrudeGeometry.__v2,p=o.ExtrudeGeometry.__v3,d=o.ExtrudeGeometry.__v4,m=o.ExtrudeGeometry.__v5,g=o.ExtrudeGeometry.__v6;return u.set(e.x-t.x,e.y-t.y),f.set(e.x-r.x,e.y-r.y),i=u.normalize(),a=f.normalize(),p.set(-i.y,i.x),d.set(a.y,-a.x),m.copy(e).add(p),g.copy(e).add(d),m.equals(g)?d.clone():(m.copy(t).add(p),g.copy(r).add(d),s=i.dot(d),l=g.sub(m).dot(d),0===s&&(console.log("Either infinite or no solutions!"),0===l?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),h=l/s,0>h?n(e,t,r):(c=i.multiplyScalar(h).add(m),c.sub(e).clone()))}function s(){if(_){var e=0,t=q*e;for($=0;Y>$;$++)X=O[$],u(X[2]+t,X[1]+t,X[0]+t,!0);for(e=M+2*b,t=q*e,$=0;Y>$;$++)X=O[$],u(X[0]+t,X[1]+t,X[2]+t,!1)}else{for($=0;Y>$;$++)X=O[$],u(X[2],X[1],X[0],!0);for($=0;Y>$;$++)X=O[$],u(X[0]+q*M,X[1]+q*M,X[2]+q*M,!1)}}function l(){var e=0;for(h(I,e),e+=I.length,R=0,D=V.length;D>R;R++)P=V[R],h(P,e),e+=P.length}function h(e,t){var r,i;for($=e.length;--$>=0;){r=$,i=$-1,0>i&&(i=e.length-1);var n=0,o=M+2*b;for(n=0;o>n;n++){var a=q*n,s=q*(n+1),l=t+r+a,h=t+i+a,c=t+i+s,u=t+r+s;f(l,h,c,u,e,n,o,r,i)}}}function c(e,t,r){F.vertices.push(new o.Vector3(e,t,r))}function u(r,i,n,a){r+=N,i+=N,n+=N,F.faces.push(new o.Face3(r,i,n,null,null,A));var s=a?L.generateBottomUV(F,e,t,r,i,n):L.generateTopUV(F,e,t,r,i,n);F.faceVertexUvs[0].push(s)}function f(r,i,n,a,s,l,h,c,u){r+=N,i+=N,n+=N,a+=N,F.faces.push(new o.Face4(r,i,n,a,null,null,E));var f=L.generateSideWallUV(F,e,s,t,r,i,n,a,l,h,c,u);F.faceVertexUvs[0].push(f)}var p,d,m,g,v,y=void 0!==t.amount?t.amount:100,x=void 0!==t.bevelThickness?t.bevelThickness:6,w=void 0!==t.bevelSize?t.bevelSize:x-2,b=void 0!==t.bevelSegments?t.bevelSegments:3,_=void 0!==t.bevelEnabled?t.bevelEnabled:!0,S=void 0!==t.curveSegments?t.curveSegments:12,M=void 0!==t.steps?t.steps:1,T=t.extrudePath,C=!1,A=t.material,E=t.extrudeMaterial,L=void 0!==t.UVGenerator?t.UVGenerator:o.ExtrudeGeometry.WorldUVGenerator;this.shapebb;T&&(p=T.getSpacedPoints(M),C=!0,_=!1,d=void 0!==t.frames?t.frames:new o.TubeGeometry.FrenetFrames(T,M,!1),m=new o.Vector3,g=new o.Vector3,v=new o.Vector3),_||(b=0,x=0,w=0);var P,R,D,F=this,N=this.vertices.length,U=e.extractPoints(S),z=U.shape,V=U.holes,B=!o.Shape.Utils.isClockWise(z);if(B){for(z=z.reverse(),R=0,D=V.length;D>R;R++)P=V[R],o.Shape.Utils.isClockWise(P)&&(V[R]=P.reverse());B=!1}var O=o.Shape.Utils.triangulateShape(z,V),I=z;for(R=0,D=V.length;D>R;R++)P=V[R],z=z.concat(P);for(var k,H,G,j,W,X,q=z.length,Y=O.length,K=(I.length,180/Math.PI,[]),$=0,Q=I.length,Z=Q-1,J=$+1;Q>$;$++,Z++,J++){Z===Q&&(Z=0),J===Q&&(J=0);I[$],I[Z],I[J];K[$]=i(I[$],I[Z],I[J])}var ee,te=[],re=K.concat();for(R=0,D=V.length;D>R;R++){for(P=V[R],ee=[],$=0,Q=P.length,Z=Q-1,J=$+1;Q>$;$++,Z++,J++)Z===Q&&(Z=0),J===Q&&(J=0),ee[$]=i(P[$],P[Z],P[J]);te.push(ee),re=re.concat(ee)}for(k=0;b>k;k++){for(G=k/b,j=x*(1-G),H=w*Math.sin(G*Math.PI/2),$=0,Q=I.length;Q>$;$++)W=r(I[$],K[$],H),c(W.x,W.y,-j);for(R=0,D=V.length;D>R;R++)for(P=V[R],ee=te[R],$=0,Q=P.length;Q>$;$++)W=r(P[$],ee[$],H),c(W.x,W.y,-j)}for(H=w,$=0;q>$;$++)W=_?r(z[$],re[$],H):z[$],C?(g.copy(d.normals[0]).multiplyScalar(W.x),m.copy(d.binormals[0]).multiplyScalar(W.y),v.copy(p[0]).add(g).add(m),c(v.x,v.y,v.z)):c(W.x,W.y,0);var ie;for(ie=1;M>=ie;ie++)for($=0;q>$;$++)W=_?r(z[$],re[$],H):z[$],C?(g.copy(d.normals[ie]).multiplyScalar(W.x),m.copy(d.binormals[ie]).multiplyScalar(W.y),v.copy(p[ie]).add(g).add(m),c(v.x,v.y,v.z)):c(W.x,W.y,y/M*ie);for(k=b-1;k>=0;k--){for(G=k/b,j=x*(1-G),H=w*Math.sin(G*Math.PI/2),$=0,Q=I.length;Q>$;$++)W=r(I[$],K[$],H),c(W.x,W.y,y+j);for(R=0,D=V.length;D>R;R++)for(P=V[R],ee=te[R],$=0,Q=P.length;Q>$;$++)W=r(P[$],ee[$],H),C?c(W.x,W.y+p[M-1].y,p[M-1].x+j):c(W.x,W.y,y+j)}s(),l()},o.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,r,i,n,a){var s=e.vertices[i].x,l=e.vertices[i].y,h=e.vertices[n].x,c=e.vertices[n].y,u=e.vertices[a].x,f=e.vertices[a].y;return[new o.Vector2(s,l),new o.Vector2(h,c),new o.Vector2(u,f)]},generateBottomUV:function(e,t,r,i,n,o){return this.generateTopUV(e,t,r,i,n,o)},generateSideWallUV:function(e,t,r,i,n,a,s,l,h,c,u,f){var p=e.vertices[n].x,d=e.vertices[n].y,m=e.vertices[n].z,g=e.vertices[a].x,v=e.vertices[a].y,y=e.vertices[a].z,x=e.vertices[s].x,w=e.vertices[s].y,b=e.vertices[s].z,_=e.vertices[l].x,S=e.vertices[l].y,M=e.vertices[l].z;return Math.abs(d-v)<.01?[new o.Vector2(p,1-m),new o.Vector2(g,1-y),new o.Vector2(x,1-b),new o.Vector2(_,1-M)]:[new o.Vector2(d,1-m),new o.Vector2(v,1-y),new o.Vector2(w,1-b),new o.Vector2(S,1-M)]}},o.ExtrudeGeometry.__v1=new o.Vector2,o.ExtrudeGeometry.__v2=new o.Vector2,o.ExtrudeGeometry.__v3=new o.Vector2,o.ExtrudeGeometry.__v4=new o.Vector2,o.ExtrudeGeometry.__v5=new o.Vector2,o.ExtrudeGeometry.__v6=new o.Vector2,o.ShapeGeometry=function(e,t){o.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},o.ShapeGeometry.prototype=Object.create(o.Geometry.prototype),o.ShapeGeometry.prototype.addShapeList=function(e,t){for(var r=0,i=e.length;i>r;r++)this.addShape(e[r],t);return this},o.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var r,i,n,a=void 0!==t.curveSegments?t.curveSegments:12,s=t.material,l=void 0===t.UVGenerator?o.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,h=(this.shapebb,this.vertices.length),c=e.extractPoints(a),u=c.shape,f=c.holes,p=!o.Shape.Utils.isClockWise(u);if(p){for(u=u.reverse(),r=0,i=f.length;i>r;r++)n=f[r],o.Shape.Utils.isClockWise(n)&&(f[r]=n.reverse());p=!1}var d=o.Shape.Utils.triangulateShape(u,f),m=u;for(r=0,i=f.length;i>r;r++)n=f[r],u=u.concat(n);var g,v,y=u.length,x=d.length;m.length;for(r=0;y>r;r++)g=u[r],this.vertices.push(new o.Vector3(g.x,g.y,0));for(r=0;x>r;r++){v=d[r];var w=v[0]+h,b=v[1]+h,_=v[2]+h;this.faces.push(new o.Face3(w,b,_,null,null,s)),this.faceVertexUvs[0].push(l.generateBottomUV(this,e,t,w,b,_))}},o.LatheGeometry=function(e,t,r,i){o.Geometry.call(this),t=t||12,r=r||0,i=i||2*Math.PI;for(var n=1/(e.length-1),a=1/t,s=0,l=t;l>=s;s++)for(var h=r+s*a*i,c=Math.cos(h),u=Math.sin(h),f=0,p=e.length;p>f;f++){var d=e[f],m=new o.Vector3;m.x=c*d.x-u*d.y,m.y=u*d.x+c*d.y,m.z=d.z,this.vertices.push(m)}for(var g=e.length,s=0,l=t;l>s;s++)for(var f=0,p=e.length-1;p>f;f++){var v=f+g*s,y=v,x=v+g,c=v+1+g,w=v+1;this.faces.push(new o.Face4(y,x,c,w));var b=s*a,_=f*n,S=b+a,M=_+n;this.faceVertexUvs[0].push([new o.Vector2(b,_),new o.Vector2(S,_),new o.Vector2(S,M),new o.Vector2(b,M)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.LatheGeometry.prototype=Object.create(o.Geometry.prototype),o.PlaneGeometry=function(e,t,r,i){o.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=r||1,this.heightSegments=i||1;var n,a,s=e/2,l=t/2,h=this.widthSegments,c=this.heightSegments,u=h+1,f=c+1,p=this.width/h,d=this.height/c,m=new o.Vector3(0,0,1);for(a=0;f>a;a++)for(n=0;u>n;n++){var g=n*p-s,v=a*d-l;this.vertices.push(new o.Vector3(g,-v,0))}for(a=0;c>a;a++)for(n=0;h>n;n++){var y=n+u*a,x=n+u*(a+1),w=n+1+u*(a+1),b=n+1+u*a,_=new o.Face4(y,x,w,b);_.normal.copy(m),_.vertexNormals.push(m.clone(),m.clone(),m.clone(),m.clone()),this.faces.push(_),this.faceVertexUvs[0].push([new o.Vector2(n/h,1-a/c),new o.Vector2(n/h,1-(a+1)/c),new o.Vector2((n+1)/h,1-(a+1)/c),new o.Vector2((n+1)/h,1-a/c)])}this.computeCentroids()},o.PlaneGeometry.prototype=Object.create(o.Geometry.prototype),o.SphereGeometry=function(e,t,r,i,n,a,s){o.Geometry.call(this),this.radius=e||50,this.widthSegments=Math.max(3,Math.floor(t)||8),this.heightSegments=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;var l,h,c=[],u=[];for(h=0;h<=this.heightSegments;h++){var f=[],p=[];for(l=0;l<=this.widthSegments;l++){var d=l/this.widthSegments,m=h/this.heightSegments,g=new o.Vector3;g.x=-this.radius*Math.cos(i+d*n)*Math.sin(a+m*s),g.y=this.radius*Math.cos(a+m*s),g.z=this.radius*Math.sin(i+d*n)*Math.sin(a+m*s),this.vertices.push(g),f.push(this.vertices.length-1),p.push(new o.Vector2(d,1-m))}c.push(f),u.push(p)}for(h=0;h<this.heightSegments;h++)for(l=0;l<this.widthSegments;l++){var v=c[h][l+1],y=c[h][l],x=c[h+1][l],w=c[h+1][l+1],b=this.vertices[v].clone().normalize(),_=this.vertices[y].clone().normalize(),S=this.vertices[x].clone().normalize(),M=this.vertices[w].clone().normalize(),T=u[h][l+1].clone(),C=u[h][l].clone(),A=u[h+1][l].clone(),E=u[h+1][l+1].clone();Math.abs(this.vertices[v].y)===this.radius?(this.faces.push(new o.Face3(v,x,w,[b,S,M])),this.faceVertexUvs[0].push([T,A,E])):Math.abs(this.vertices[x].y)===this.radius?(this.faces.push(new o.Face3(v,y,x,[b,_,S])),this.faceVertexUvs[0].push([T,C,A])):(this.faces.push(new o.Face4(v,y,x,w,[b,_,S,M])),this.faceVertexUvs[0].push([T,C,A,E]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new o.Sphere(new o.Vector3,e)},o.SphereGeometry.prototype=Object.create(o.Geometry.prototype),o.TextGeometry=function(e,t){var r=o.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),o.ExtrudeGeometry.call(this,r,t)},o.TextGeometry.prototype=Object.create(o.ExtrudeGeometry.prototype),o.TorusGeometry=function(e,t,r,i,n){o.Geometry.call(this);this.radius=e||100,this.tube=t||40,this.radialSegments=r||8,this.tubularSegments=i||6,this.arc=n||2*Math.PI;for(var a=new o.Vector3,s=[],l=[],h=0;h<=this.radialSegments;h++)for(var c=0;c<=this.tubularSegments;c++){var u=c/this.tubularSegments*this.arc,f=h/this.radialSegments*Math.PI*2;a.x=this.radius*Math.cos(u),a.y=this.radius*Math.sin(u);var p=new o.Vector3;p.x=(this.radius+this.tube*Math.cos(f))*Math.cos(u),p.y=(this.radius+this.tube*Math.cos(f))*Math.sin(u),p.z=this.tube*Math.sin(f),this.vertices.push(p),s.push(new o.Vector2(c/this.tubularSegments,h/this.radialSegments)),l.push(p.clone().sub(a).normalize())}for(var h=1;h<=this.radialSegments;h++)for(var c=1;c<=this.tubularSegments;c++){var d=(this.tubularSegments+1)*h+c-1,m=(this.tubularSegments+1)*(h-1)+c-1,g=(this.tubularSegments+1)*(h-1)+c,v=(this.tubularSegments+1)*h+c,y=new o.Face4(d,m,g,v,[l[d],l[m],l[g],l[v]]);y.normal.add(l[d]),y.normal.add(l[m]),y.normal.add(l[g]),y.normal.add(l[v]),y.normal.normalize(),this.faces.push(y),this.faceVertexUvs[0].push([s[d].clone(),s[m].clone(),s[g].clone(),s[v].clone()])}this.computeCentroids()},o.TorusGeometry.prototype=Object.create(o.Geometry.prototype),o.TorusKnotGeometry=function(e,t,r,i,n,a,s){function l(e,t,r){return c.vertices.push(new o.Vector3(e,t,r))-1}function h(e,t,r,i,n,a){var s=Math.cos(e),l=(Math.cos(t),Math.sin(e)),h=r/i*e,c=Math.cos(h),u=n*(2+c)*.5*s,f=n*(2+c)*l*.5,p=a*n*Math.sin(h)*.5;return new o.Vector3(u,f,p)}o.Geometry.call(this);var c=this;this.radius=e||100,this.tube=t||40,this.radialSegments=r||64,this.tubularSegments=i||8,this.p=n||2,this.q=a||3,this.heightScale=s||1,this.grid=new Array(this.radialSegments);for(var u=new o.Vector3,f=new o.Vector3,p=new o.Vector3,d=0;d<this.radialSegments;++d){this.grid[d]=new Array(this.tubularSegments);for(var m=0;m<this.tubularSegments;++m){var g,v,y=d/this.radialSegments*2*this.p*Math.PI,x=m/this.tubularSegments*2*Math.PI,w=h(y,x,this.q,this.p,this.radius,this.heightScale),b=h(y+.01,x,this.q,this.p,this.radius,this.heightScale);u.subVectors(b,w),f.addVectors(b,w),p.crossVectors(u,f),f.crossVectors(p,u),p.normalize(),f.normalize(),g=-this.tube*Math.cos(x),v=this.tube*Math.sin(x),w.x+=g*f.x+v*p.x,w.y+=g*f.y+v*p.y,w.z+=g*f.z+v*p.z,this.grid[d][m]=l(w.x,w.y,w.z)}}for(var d=0;d<this.radialSegments;++d)for(var m=0;m<this.tubularSegments;++m){var _=(d+1)%this.radialSegments,S=(m+1)%this.tubularSegments,M=this.grid[d][m],T=this.grid[_][m],C=this.grid[_][S],A=this.grid[d][S],E=new o.Vector2(d/this.radialSegments,m/this.tubularSegments),L=new o.Vector2((d+1)/this.radialSegments,m/this.tubularSegments),P=new o.Vector2((d+1)/this.radialSegments,(m+1)/this.tubularSegments),R=new o.Vector2(d/this.radialSegments,(m+1)/this.tubularSegments);this.faces.push(new o.Face4(M,T,C,A)),this.faceVertexUvs[0].push([E,L,P,R])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.TorusKnotGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry=function(e,t,r,i,n,a){function s(e,t,r){return E.vertices.push(new o.Vector3(e,t,r))-1}o.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=r||1,this.radiusSegments=i||8,this.closed=n||!1,a&&(this.debug=new o.Object3D),this.grid=[];var l,h,c,u,f,p,d,m,g,v,y,x,w,b,_,S,M,T,C,A,E=this,L=this.segments+1,P=new o.Vector3,R=new o.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),D=R.tangents,F=R.normals,N=R.binormals;for(this.tangents=D,this.normals=F,this.binormals=N,g=0;L>g;g++)for(this.grid[g]=[],u=g/(L-1),m=e.getPointAt(u),l=D[g],h=F[g],c=N[g],this.debug&&(this.debug.add(new o.ArrowHelper(l,m,r,255)),this.debug.add(new o.ArrowHelper(h,m,r,16711680)),this.debug.add(new o.ArrowHelper(c,m,r,65280))),v=0;v<this.radiusSegments;v++)f=v/this.radiusSegments*2*Math.PI,p=-this.radius*Math.cos(f),d=this.radius*Math.sin(f),P.copy(m),P.x+=p*h.x+d*c.x,P.y+=p*h.y+d*c.y,P.z+=p*h.z+d*c.z,this.grid[g][v]=s(P.x,P.y,P.z);for(g=0;g<this.segments;g++)for(v=0;v<this.radiusSegments;v++)y=this.closed?(g+1)%this.segments:g+1,x=(v+1)%this.radiusSegments,w=this.grid[g][v],b=this.grid[y][v],_=this.grid[y][x],S=this.grid[g][x],M=new o.Vector2(g/this.segments,v/this.radiusSegments),T=new o.Vector2((g+1)/this.segments,v/this.radiusSegments),C=new o.Vector2((g+1)/this.segments,(v+1)/this.radiusSegments),A=new o.Vector2(g/this.segments,(v+1)/this.radiusSegments),this.faces.push(new o.Face4(w,b,_,S)),this.faceVertexUvs[0].push([M,T,C,A]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.TubeGeometry.prototype=Object.create(o.Geometry.prototype),o.TubeGeometry.FrenetFrames=function(e,t,r){function i(){d[0]=new o.Vector3,m[0]=new o.Vector3,a=Number.MAX_VALUE,s=Math.abs(p[0].x),l=Math.abs(p[0].y),h=Math.abs(p[0].z),a>=s&&(a=s,f.set(1,0,0)),a>=l&&(a=l,f.set(0,1,0)),a>=h&&f.set(0,0,1),g.crossVectors(p[0],f).normalize(),d[0].crossVectors(p[0],g),m[0].crossVectors(p[0],d[0])}var n,a,s,l,h,c,u,f=(new o.Vector3,new o.Vector3),p=(new o.Vector3,[]),d=[],m=[],g=new o.Vector3,v=new o.Matrix4,y=t+1,x=1e-4;for(this.tangents=p,this.normals=d,this.binormals=m,c=0;y>c;c++)u=c/(y-1),p[c]=e.getTangentAt(u),p[c].normalize();for(i(),c=1;y>c;c++)d[c]=d[c-1].clone(),m[c]=m[c-1].clone(),g.crossVectors(p[c-1],p[c]),g.length()>x&&(g.normalize(),n=Math.acos(p[c-1].dot(p[c])),d[c].applyMatrix4(v.makeRotationAxis(g,n))),m[c].crossVectors(p[c],d[c]);if(r)for(n=Math.acos(d[0].dot(d[y-1])),n/=y-1,p[0].dot(g.crossVectors(d[0],d[y-1]))>0&&(n=-n),c=1;y>c;c++)d[c].applyMatrix4(v.makeRotationAxis(p[c],n*c)),m[c].crossVectors(p[c],d[c])},o.PolyhedronGeometry=function(e,t,r,i){function n(e){var t=e.normalize().clone();t.index=u.vertices.push(t)-1;var r=l(e)/2/Math.PI+.5,i=h(e)/Math.PI+.5;return t.uv=new o.Vector2(r,1-i),t}function a(e,t,r,i){if(1>i){var n=new o.Face3(e.index,t.index,r.index,[e.clone(),t.clone(),r.clone()]);n.centroid.add(e).add(t).add(r).divideScalar(3),n.normal=n.centroid.clone().normalize(),u.faces.push(n);var h=l(n.centroid);u.faceVertexUvs[0].push([c(e.uv,e,h),c(t.uv,t,h),c(r.uv,r,h)])}else i-=1,a(e,s(e,t),s(e,r),i),a(s(e,t),t,s(t,r),i),a(s(e,r),s(t,r),r,i),a(s(e,t),s(t,r),s(e,r),i)}function s(e,t){d[e.index]||(d[e.index]=[]),d[t.index]||(d[t.index]=[]);var r=d[e.index][t.index];return void 0===r&&(d[e.index][t.index]=d[t.index][e.index]=r=n((new o.Vector3).addVectors(e,t).divideScalar(2))),r}function l(e){return Math.atan2(e.z,-e.x)}function h(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function c(e,t,r){return 0>r&&1===e.x&&(e=new o.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new o.Vector2(r/2/Math.PI+.5,e.y)),e}o.Geometry.call(this),r=r||1,i=i||0;for(var u=this,f=0,p=e.length;p>f;f++)n(new o.Vector3(e[f][0],e[f][1],e[f][2]));for(var d=[],m=this.vertices,f=0,p=t.length;p>f;f++)a(m[t[f][0]],m[t[f][1]],m[t[f][2]],i);this.mergeVertices();for(var f=0,p=this.vertices.length;p>f;f++)this.vertices[f].multiplyScalar(r);this.computeCentroids(),this.boundingSphere=new o.Sphere(new o.Vector3,r)},o.PolyhedronGeometry.prototype=Object.create(o.Geometry.prototype),o.IcosahedronGeometry=function(e,t){var r=(1+Math.sqrt(5))/2,i=[[-1,r,0],[1,r,0],[-1,-r,0],[1,-r,0],[0,-1,r],[0,1,r],[0,-1,-r],[0,1,-r],[r,0,-1],[r,0,1],[-r,0,-1],[-r,0,1]],n=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];o.PolyhedronGeometry.call(this,i,n,e,t)},o.IcosahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.OctahedronGeometry=function(e,t){var r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],i=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];o.PolyhedronGeometry.call(this,r,i,e,t)},o.OctahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.TetrahedronGeometry=function(e,t){var r=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],i=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];o.PolyhedronGeometry.call(this,r,i,e,t)},o.TetrahedronGeometry.prototype=Object.create(o.Geometry.prototype),o.ParametricGeometry=function(e,t,r,i){o.Geometry.call(this);var n=this.vertices,a=this.faces,s=this.faceVertexUvs[0];i=void 0===i?!1:i;var l,h,c,u,f,p=t+1;for(l=0;r>=l;l++)for(f=l/r,h=0;t>=h;h++)u=h/t,c=e(u,f),n.push(c);var d,m,g,v,y,x,w,b;for(l=0;r>l;l++)for(h=0;t>h;h++)d=l*p+h,m=l*p+h+1,g=(l+1)*p+h,v=(l+1)*p+h+1,y=new o.Vector2(h/t,l/r),x=new o.Vector2((h+1)/t,l/r),w=new o.Vector2(h/t,(l+1)/r),b=new o.Vector2((h+1)/t,(l+1)/r),i?(a.push(new o.Face3(d,m,g)),a.push(new o.Face3(m,v,g)),s.push([y,x,w]),s.push([x,b,w])):(a.push(new o.Face4(d,m,v,g)),s.push([y,x,b,w]));this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.ParametricGeometry.prototype=Object.create(o.Geometry.prototype),o.ConvexGeometry=function(e){function t(t){var i=e[t].clone(),o=i.length();i.x+=o*a(),i.y+=o*a(),i.z+=o*a();for(var s=[],h=0;h<l.length;){var c=l[h];if(r(c,i)){for(var u=0;3>u;u++){for(var f=[c[u],c[(u+1)%3]],p=!0,d=0;d<s.length;d++)if(n(s[d],f)){s[d]=s[s.length-1],s.pop(),p=!1;break}p&&s.push(f)}l[h]=l[l.length-1],l.pop()}else h++}for(var d=0;d<s.length;d++)l.push([s[d][0],s[d][1],t])}function r(t,r){var n=e[t[0]],o=e[t[1]],a=e[t[2]],s=i(n,o,a),l=s.dot(n);return s.dot(r)>=l}function i(e,t,r){var i=new o.Vector3,n=new o.Vector3;return i.subVectors(r,t),n.subVectors(e,t),i.cross(n),i.normalize(),i}function n(e,t){return e[0]===t[1]&&e[1]===t[0]}function a(){return 2*(Math.random()-.5)*1e-6}function s(e){var t=e.length();return new o.Vector2(e.x/t,e.y/t)}o.Geometry.call(this);for(var l=[[0,1,2],[0,2,1]],h=3;h<e.length;h++)t(h);for(var c=0,u=new Array(e.length),h=0;h<l.length;h++)for(var f=l[h],p=0;3>p;p++)void 0===u[f[p]]&&(u[f[p]]=c++,this.vertices.push(e[f[p]])),f[p]=u[f[p]];for(var h=0;h<l.length;h++)this.faces.push(new o.Face3(l[h][0],l[h][1],l[h][2]));for(var h=0;h<this.faces.length;h++){var f=this.faces[h];this.faceVertexUvs[0].push([s(this.vertices[f.a]),s(this.vertices[f.b]),s(this.vertices[f.c])])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},o.ConvexGeometry.prototype=Object.create(o.Geometry.prototype),o.AxisHelper=function(e){var t=new o.Geometry;t.vertices.push(new o.Vector3,new o.Vector3(e||1,0,0),new o.Vector3,new o.Vector3(0,e||1,0),new o.Vector3,new o.Vector3(0,0,e||1)),t.colors.push(new o.Color(16711680),new o.Color(16755200),new o.Color(65280),new o.Color(11206400),new o.Color(255),new o.Color(43775));var r=new o.LineBasicMaterial({vertexColors:o.VertexColors});o.Line.call(this,t,r,o.LinePieces)},o.AxisHelper.prototype=Object.create(o.Line.prototype),o.ArrowHelper=function(e,t,r,i){o.Object3D.call(this),void 0===r&&(r=20),void 0===i&&(i=16776960);var n=new o.Geometry;n.vertices.push(new o.Vector3(0,0,0)),n.vertices.push(new o.Vector3(0,1,0)),this.line=new o.Line(n,new o.LineBasicMaterial({color:i})),this.add(this.line);var a=new o.CylinderGeometry(0,.05,.25,5,1);this.cone=new o.Mesh(a,new o.MeshBasicMaterial({color:i})),this.cone.position.set(0,1,0),this.add(this.cone),t instanceof o.Vector3&&(this.position=t),this.setDirection(e),this.setLength(r)},o.ArrowHelper.prototype=Object.create(o.Object3D.prototype),o.ArrowHelper.prototype.setDirection=function(e){var t=o.ArrowHelper.__v1.copy(e).normalize();if(t.y>.999)this.rotation.set(0,0,0);else if(t.y<-.999)this.rotation.set(Math.PI,0,0);else{var r=o.ArrowHelper.__v2.set(t.z,0,-t.x).normalize(),i=Math.acos(t.y),n=o.ArrowHelper.__q1.setFromAxisAngle(r,i);this.rotation.setEulerFromQuaternion(n,this.eulerOrder)}},o.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)},o.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},o.ArrowHelper.__v1=new o.Vector3,o.ArrowHelper.__v2=new o.Vector3,o.ArrowHelper.__q1=new o.Quaternion,o.CameraHelper=function(e){function t(e,t,i){r(e,i),r(t,i)}function r(e,t){i.geometry.vertices.push(new o.Vector3),i.geometry.colors.push(new o.Color(t)),void 0===i.pointMap[e]&&(i.pointMap[e]=[]),i.pointMap[e].push(i.geometry.vertices.length-1)}o.Line.call(this);var i=this;this.geometry=new o.Geometry,this.material=new o.LineBasicMaterial({color:16777215,vertexColors:o.FaceColors}),this.type=o.LinePieces,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap={};var n=16755200,a=16711680,s=43775,l=16777215,h=3355443;t("n1","n2",n),t("n2","n4",n),t("n4","n3",n),t("n3","n1",n),t("f1","f2",n),t("f2","f4",n),t("f4","f3",n),t("f3","f1",n),t("n1","f1",n),t("n2","f2",n),t("n3","f3",n),t("n4","f4",n),t("p","n1",a),t("p","n2",a),t("p","n3",a),t("p","n4",a),t("u1","u2",s),t("u2","u3",s),t("u3","u1",s),t("c","t",l),t("p","c",h),t("cn1","cn2",h),t("cn3","cn4",h),t("cf1","cf2",h),t("cf3","cf4",h),this.camera=e,this.update(e)},o.CameraHelper.prototype=Object.create(o.Line.prototype),o.CameraHelper.prototype.update=function(){function e(e,r,i,n){o.CameraHelper.__v.set(r,i,n),o.CameraHelper.__projector.unprojectVector(o.CameraHelper.__v,o.CameraHelper.__c);var a=t.pointMap[e];if(void 0!==a)for(var s=0,l=a.length;l>s;s++)t.geometry.vertices[a[s]].copy(o.CameraHelper.__v)}var t=this,r=1,i=1;o.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-r,-i,-1),e("n2",r,-i,-1),e("n3",-r,i,-1),e("n4",r,i,-1),e("f1",-r,-i,1),e("f2",r,-i,1),e("f3",-r,i,1),e("f4",r,i,1),e("u1",.7*r,1.1*i,-1),e("u2",.7*-r,1.1*i,-1),e("u3",0,2*i,-1),e("cf1",-r,0,1),e("cf2",r,0,1),e("cf3",0,-i,1),e("cf4",0,i,1),e("cn1",-r,0,-1),e("cn2",r,0,-1),e("cn3",0,-i,-1),e("cn4",0,i,-1),this.geometry.verticesNeedUpdate=!0},o.CameraHelper.__projector=new o.Projector,o.CameraHelper.__v=new o.Vector3,o.CameraHelper.__c=new o.Camera,o.DirectionalLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new o.Vector3,this.direction.subVectors(e.target.position,e.position);var r=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(r);var i=this.color.getHex(),n=new o.SphereGeometry(t,16,8),a=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.MeshBasicMaterial({color:i,fog:!1}),l=new o.LineBasicMaterial({color:i,fog:!1});if(this.lightSphere=new o.Mesh(n,s),this.lightRays=new o.Line(a,l,o.LinePieces),this.add(this.lightSphere),this.add(this.lightRays),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var h=new o.SphereGeometry(t,8,4),c=new o.MeshBasicMaterial({color:i,wireframe:!0,fog:!1});this.targetSphere=new o.Mesh(h,c),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var u=new o.LineDashedMaterial({color:i,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),f=new o.Geometry;f.vertices.push(this.position.clone()),f.vertices.push(this.targetSphere.position.clone()),f.computeLineDistances(),this.targetLine=new o.Line(f,u),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},o.DirectionalLightHelper.prototype=Object.create(o.Object3D.prototype),o.DirectionalLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position);var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),
this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},o.HemisphereLightHelper=function(e,t,r,i){o.Object3D.call(this),this.light=e,this.position=e.position;var n=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(n);var a=this.color.getHex();this.groundColor=e.groundColor.clone(),this.groundColor.multiplyScalar(n);for(var s=this.groundColor.getHex(),l=new o.SphereGeometry(t,16,8,0,2*Math.PI,0,.5*Math.PI),h=new o.SphereGeometry(t,16,8,0,2*Math.PI,.5*Math.PI,Math.PI),c=new o.MeshBasicMaterial({color:a,fog:!1}),u=new o.MeshBasicMaterial({color:s,fog:!1}),f=0,p=l.faces.length;p>f;f++)l.faces[f].materialIndex=0;for(var f=0,p=h.faces.length;p>f;f++)h.faces[f].materialIndex=1;o.GeometryUtils.merge(l,h),this.lightSphere=new o.Mesh(l,new o.MeshFaceMaterial([c,u])),this.lightArrow=new o.ArrowHelper(new o.Vector3(0,1,0),new o.Vector3(0,1.1*(t+r),0),r,a),this.lightArrow.rotation.x=Math.PI,this.lightArrowGround=new o.ArrowHelper(new o.Vector3(0,1,0),new o.Vector3(0,-1.1*(t+r),0),r,s);var d=new o.Object3D;d.rotation.x=.5*-Math.PI,d.add(this.lightSphere),d.add(this.lightArrow),d.add(this.lightArrowGround),this.add(d),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0,this.target=new o.Vector3,this.lookAt(this.target)},o.HemisphereLightHelper.prototype=Object.create(o.Object3D.prototype),o.HemisphereLightHelper.prototype.update=function(){var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.groundColor.copy(this.light.groundColor),this.groundColor.multiplyScalar(e),this.lightSphere.material.materials[0].color.copy(this.color),this.lightSphere.material.materials[1].color.copy(this.groundColor),this.lightArrow.setColor(this.color.getHex()),this.lightArrowGround.setColor(this.groundColor.getHex()),this.lookAt(this.target)},o.PointLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position;var r=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(r);var i=this.color.getHex(),n=new o.SphereGeometry(t,16,8),a=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.IcosahedronGeometry(1,2),l=new o.MeshBasicMaterial({color:i,fog:!1}),h=new o.LineBasicMaterial({color:i,fog:!1}),c=new o.MeshBasicMaterial({color:i,fog:!1,wireframe:!0,opacity:.1,transparent:!0});this.lightSphere=new o.Mesh(n,l),this.lightRays=new o.Line(a,h,o.LinePieces),this.lightDistance=new o.Mesh(s,c);var u=e.distance;0===u?this.lightDistance.visible=!1:this.lightDistance.scale.set(u,u,u),this.add(this.lightSphere),this.add(this.lightRays),this.add(this.lightDistance),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.properties.isGizmo=!0},o.PointLightHelper.prototype=Object.create(o.Object3D.prototype),o.PointLightHelper.prototype.update=function(){var e=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(e),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightDistance.material.color.copy(this.color);var t=this.light.distance;0===t?this.lightDistance.visible=!1:(this.lightDistance.visible=!0,this.lightDistance.scale.set(t,t,t))},o.SpotLightHelper=function(e,t){o.Object3D.call(this),this.light=e,this.position=e.position,this.direction=new o.Vector3,this.direction.subVectors(e.target.position,e.position);var r=o.Math.clamp(e.intensity,0,1);this.color=e.color.clone(),this.color.multiplyScalar(r);var i=this.color.getHex(),n=new o.SphereGeometry(t,16,8),a=new o.AsteriskGeometry(1.25*t,2.25*t),s=new o.CylinderGeometry(1e-4,1,1,8,1,!0),l=new o.Matrix4;l.rotateX(-Math.PI/2),l.translate(new o.Vector3(0,-.5,0)),s.applyMatrix(l);var h=new o.MeshBasicMaterial({color:i,fog:!1}),c=new o.LineBasicMaterial({color:i,fog:!1}),u=new o.MeshBasicMaterial({color:i,fog:!1,wireframe:!0,opacity:.3,transparent:!0});this.lightSphere=new o.Mesh(n,h),this.lightCone=new o.Mesh(s,u);var f=e.distance?e.distance:1e4,p=f*Math.tan(.5*e.angle)*2;if(this.lightCone.scale.set(p,p,f),this.lightRays=new o.Line(a,c,o.LinePieces),this.gyroscope=new o.Gyroscope,this.gyroscope.add(this.lightSphere),this.gyroscope.add(this.lightRays),this.add(this.gyroscope),this.add(this.lightCone),this.lookAt(e.target.position),this.lightSphere.properties.isGizmo=!0,this.lightSphere.properties.gizmoSubject=e,this.lightSphere.properties.gizmoRoot=this,this.targetSphere=null,void 0!==e.target.properties.targetInverse){var d=new o.SphereGeometry(t,8,4),m=new o.MeshBasicMaterial({color:i,wireframe:!0,fog:!1});this.targetSphere=new o.Mesh(d,m),this.targetSphere.position=e.target.position,this.targetSphere.properties.isGizmo=!0,this.targetSphere.properties.gizmoSubject=e.target,this.targetSphere.properties.gizmoRoot=this.targetSphere;var g=new o.LineDashedMaterial({color:i,dashSize:4,gapSize:4,opacity:.75,transparent:!0,fog:!1}),v=new o.Geometry;v.vertices.push(this.position.clone()),v.vertices.push(this.targetSphere.position.clone()),v.computeLineDistances(),this.targetLine=new o.Line(v,g),this.targetLine.properties.isGizmo=!0}this.properties.isGizmo=!0},o.SpotLightHelper.prototype=Object.create(o.Object3D.prototype),o.SpotLightHelper.prototype.update=function(){this.direction.subVectors(this.light.target.position,this.light.position),this.lookAt(this.light.target.position);var e=this.light.distance?this.light.distance:1e4,t=e*Math.tan(.5*this.light.angle)*2;this.lightCone.scale.set(t,t,e);var r=o.Math.clamp(this.light.intensity,0,1);this.color.copy(this.light.color),this.color.multiplyScalar(r),this.lightSphere.material.color.copy(this.color),this.lightRays.material.color.copy(this.color),this.lightCone.material.color.copy(this.color),null!==this.targetSphere&&(this.targetSphere.material.color.copy(this.color),this.targetLine.material.color.copy(this.color),this.targetLine.geometry.vertices[0].copy(this.light.position),this.targetLine.geometry.vertices[1].copy(this.light.target.position),this.targetLine.geometry.computeLineDistances(),this.targetLine.geometry.verticesNeedUpdate=!0)},o.ImmediateRenderObject=function(){o.Object3D.call(this),this.render=function(e){}},o.ImmediateRenderObject.prototype=Object.create(o.Object3D.prototype),o.LensFlare=function(e,t,r,i,n){o.Object3D.call(this),this.lensFlares=[],this.positionScreen=new o.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,r,i,n)},o.LensFlare.prototype=Object.create(o.Object3D.prototype),o.LensFlare.prototype.add=function(e,t,r,i,n,a){void 0===t&&(t=-1),void 0===r&&(r=0),void 0===a&&(a=1),void 0===n&&(n=new o.Color(16777215)),void 0===i&&(i=o.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:e,size:t,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:a,color:n,blending:i})},o.LensFlare.prototype.updateLensFlares=function(){var e,t,r=this.lensFlares.length,i=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;r>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)},o.MorphBlendMesh=function(e,t){o.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length,i="__default",n=0,a=r-1,s=r/1;this.createAnimation(i,n,a,s),this.setAnimationWeight(i,1)},o.MorphBlendMesh.prototype=Object.create(o.Mesh.prototype),o.MorphBlendMesh.prototype.createAnimation=function(e,t,r,i){var n={startFrame:t,endFrame:r,length:r-t+1,fps:i,duration:(r-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=n,this.animationsList.push(n)},o.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,r=/([a-z]+)(\d+)/,i={},n=this.geometry,o=0,a=n.morphTargets.length;a>o;o++){var s=n.morphTargets[o],l=s.name.match(r);if(l&&l.length>1){var h=l[1];l[2];i[h]||(i[h]={start:1/0,end:-(1/0)});var c=i[h];o<c.start&&(c.start=o),o>c.end&&(c.end=o),t||(t=h)}}for(var h in i){var c=i[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=t},o.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},o.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},o.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var r=this.animationsMap[e];r&&(r.fps=t,r.duration=(r.end-r.start)/r.fps)},o.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var r=this.animationsMap[e];r&&(r.duration=t,r.fps=(r.end-r.start)/r.duration)},o.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var r=this.animationsMap[e];r&&(r.weight=t)},o.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var r=this.animationsMap[e];r&&(r.time=t)},o.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,r=this.animationsMap[e];return r&&(t=r.time),t},o.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,r=this.animationsMap[e];return r&&(t=r.duration),t},o.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},o.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},o.MorphBlendMesh.prototype.update=function(e){for(var t=0,r=this.animationsList.length;r>t;t++){var i=this.animationsList[t];if(i.active){var n=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.startFrame+o.Math.clamp(Math.floor(i.time/n),0,i.length-1),s=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*s,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var l=i.time%n/n;i.directionBackwards&&(l=1-l),this.morphTargetInfluences[i.currentFrame]=l*s,this.morphTargetInfluences[i.lastFrame]=(1-l)*s}}},o.LensFlarePlugin=function(){function e(e,r){var i=t.createProgram(),n=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),a="precision "+r+" float;\n";return t.shaderSource(n,a+e.fragmentShader),t.shaderSource(o,a+e.vertexShader),t.compileShader(n),t.compileShader(o),t.attachShader(i,n),t.attachShader(i,o),t.linkProgram(i),i}var t,r,i,n={};this.init=function(a){t=a.context,r=a,i=a.getPrecision(),n.vertices=new Float32Array(16),n.faces=new Uint16Array(6);var s=0;n.vertices[s++]=-1,n.vertices[s++]=-1,n.vertices[s++]=0,n.vertices[s++]=0,n.vertices[s++]=1,n.vertices[s++]=-1,n.vertices[s++]=1,n.vertices[s++]=0,n.vertices[s++]=1,n.vertices[s++]=1,n.vertices[s++]=1,n.vertices[s++]=1,n.vertices[s++]=-1,n.vertices[s++]=1,n.vertices[s++]=0,n.vertices[s++]=1,s=0,n.faces[s++]=0,n.faces[s++]=1,n.faces[s++]=2,n.faces[s++]=0,n.faces[s++]=2,n.faces[s++]=3,n.vertexBuffer=t.createBuffer(),n.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,n.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n.faces,t.STATIC_DRAW),n.tempTexture=t.createTexture(),n.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,n.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,n.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(n.hasVertexTexture=!1,n.program=e(o.ShaderFlares.lensFlare,i)):(n.hasVertexTexture=!0,n.program=e(o.ShaderFlares.lensFlareVertexTexture,i)),n.attributes={},n.uniforms={},n.attributes.vertex=t.getAttribLocation(n.program,"position"),n.attributes.uv=t.getAttribLocation(n.program,"uv"),n.uniforms.renderType=t.getUniformLocation(n.program,"renderType"),n.uniforms.map=t.getUniformLocation(n.program,"map"),n.uniforms.occlusionMap=t.getUniformLocation(n.program,"occlusionMap"),n.uniforms.opacity=t.getUniformLocation(n.program,"opacity"),n.uniforms.color=t.getUniformLocation(n.program,"color"),n.uniforms.scale=t.getUniformLocation(n.program,"scale"),n.uniforms.rotation=t.getUniformLocation(n.program,"rotation"),n.uniforms.screenPosition=t.getUniformLocation(n.program,"screenPosition")},this.render=function(e,i,a,s){var l=e.__webglFlares,h=l.length;if(h){var c=new o.Vector3,u=s/a,f=.5*a,p=.5*s,d=16/s,m=new o.Vector2(d*u,d),g=new o.Vector3(1,1,0),v=new o.Vector2(1,1),y=n.uniforms,x=n.attributes;t.useProgram(n.program),t.enableVertexAttribArray(n.attributes.vertex),t.enableVertexAttribArray(n.attributes.uv),t.uniform1i(y.occlusionMap,0),t.uniform1i(y.map,1),t.bindBuffer(t.ARRAY_BUFFER,n.vertexBuffer),t.vertexAttribPointer(x.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(x.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var w,b,_,S,M;for(w=0;h>w;w++)if(d=16/s,m.set(d*u,d),S=l[w],c.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]),c.applyMatrix4(i.matrixWorldInverse),c.applyProjection(i.projectionMatrix),g.copy(c),v.x=g.x*f+f,v.y=g.y*p+p,n.hasVertexTexture||v.x>0&&v.x<a&&v.y>0&&v.y<s)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,n.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,v.x-8,v.y-8,16,16,0),t.uniform1i(y.renderType,0),t.uniform2f(y.scale,m.x,m.y),t.uniform3f(y.screenPosition,g.x,g.y,g.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,v.x-8,v.y-8,16,16,0),t.uniform1i(y.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,n.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),S.positionScreen.copy(g),S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),t.uniform1i(y.renderType,2),t.enable(t.BLEND),b=0,_=S.lensFlares.length;_>b;b++)M=S.lensFlares[b],M.opacity>.001&&M.scale>.001&&(g.x=M.x,g.y=M.y,g.z=M.z,d=M.size*M.scale/s,m.x=d*u,m.y=d,t.uniform3f(y.screenPosition,g.x,g.y,g.z),t.uniform2f(y.scale,m.x,m.y),t.uniform1f(y.rotation,M.rotation),t.uniform1f(y.opacity,M.opacity),t.uniform3f(y.color,M.color.r,M.color.g,M.color.b),r.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),r.setTexture(M.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},o.ShadowMapPlugin=function(){function e(e,t){var r=new o.DirectionalLight;r.isVirtual=!0,r.onlyShadow=!0,r.castShadow=!0,r.shadowCameraNear=e.shadowCameraNear,r.shadowCameraFar=e.shadowCameraFar,r.shadowCameraLeft=e.shadowCameraLeft,r.shadowCameraRight=e.shadowCameraRight,r.shadowCameraBottom=e.shadowCameraBottom,r.shadowCameraTop=e.shadowCameraTop,r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t],r.shadowMapWidth=e.shadowCascadeWidth[t],r.shadowMapHeight=e.shadowCascadeHeight[t],r.pointsWorld=[],r.pointsFrustum=[];for(var i=r.pointsWorld,n=r.pointsFrustum,a=0;8>a;a++)i[a]=new o.Vector3,n[a]=new o.Vector3;var s=e.shadowCascadeNearZ[t],l=e.shadowCascadeFarZ[t];return n[0].set(-1,-1,s),n[1].set(1,-1,s),n[2].set(-1,1,s),n[3].set(1,1,s),n[4].set(-1,-1,l),n[5].set(1,-1,l),n[6].set(-1,1,l),n[7].set(1,1,l),r}function t(e,t){var r=e.shadowCascadeArray[t];r.position.copy(e.position),r.target.position.copy(e.target.position),r.lookAt(r.target),r.shadowCameraVisible=e.shadowCameraVisible,r.shadowDarkness=e.shadowDarkness,r.shadowBias=e.shadowCascadeBias[t];var i=e.shadowCascadeNearZ[t],n=e.shadowCascadeFarZ[t],o=r.pointsFrustum;o[0].z=i,o[1].z=i,o[2].z=i,o[3].z=i,o[4].z=n,o[5].z=n,o[6].z=n,o[7].z=n}function r(e,t){var r=t.shadowCamera,i=t.pointsFrustum,n=t.pointsWorld;p.set(1/0,1/0,1/0),d.set(-(1/0),-(1/0),-(1/0));for(var a=0;8>a;a++){var s=n[a];s.copy(i[a]),o.ShadowMapPlugin.__projector.unprojectVector(s,e),s.applyMatrix4(r.matrixWorldInverse),s.x<p.x&&(p.x=s.x),s.x>d.x&&(d.x=s.x),s.y<p.y&&(p.y=s.y),s.y>d.y&&(d.y=s.y),s.z<p.z&&(p.z=s.z),s.z>d.z&&(d.z=s.z)}r.left=p.x,r.right=d.x,r.top=d.y,r.bottom=p.y,r.updateProjectionMatrix()}function i(e){return e.material instanceof o.MeshFaceMaterial?e.material.materials[0]:e.material}var n,a,s,l,h,c,u=new o.Frustum,f=new o.Matrix4,p=new o.Vector3,d=new o.Vector3,m=new o.Vector3;this.init=function(e){n=e.context,a=e;var t=o.ShaderLib.depthRGBA,r=o.UniformsUtils.clone(t.uniforms);s=new o.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r}),l=new o.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0}),h=new o.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,skinning:!0}),c=new o.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:r,morphTargets:!0,skinning:!0}),s._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0,c._shadowPass=!0},this.render=function(e,t){a.shadowMapEnabled&&a.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,d){var g,v,y,x,w,b,_,S,M,T,C,A,E,L,P=[],R=0,D=null;for(n.clearColor(1,1,1,1),n.disable(n.BLEND),n.enable(n.CULL_FACE),n.frontFace(n.CCW),a.shadowMapCullFace===o.CullFaceFront?n.cullFace(n.FRONT):n.cullFace(n.BACK),a.setDepthTest(!0),g=0,v=p.__lights.length;v>g;g++)if(E=p.__lights[g],E.castShadow)if(E instanceof o.DirectionalLight&&E.shadowCascade)for(w=0;w<E.shadowCascadeCount;w++){var F;if(E.shadowCascadeArray[w])F=E.shadowCascadeArray[w];else{F=e(E,w),F.originalCamera=d;var N=new o.Gyroscope;N.position=E.shadowCascadeOffset,N.add(F),N.add(F.target),d.add(N),E.shadowCascadeArray[w]=F,console.log("Created virtualLight",F)}t(E,w),P[R]=F,R++}else P[R]=E,R++;for(g=0,v=P.length;v>g;g++){if(E=P[g],!E.shadowMap){var U=o.LinearFilter;a.shadowMapType===o.PCFSoftShadowMap&&(U=o.NearestFilter);var z={minFilter:U,magFilter:U,format:o.RGBAFormat};E.shadowMap=new o.WebGLRenderTarget(E.shadowMapWidth,E.shadowMapHeight,z),E.shadowMapSize=new o.Vector2(E.shadowMapWidth,E.shadowMapHeight),E.shadowMatrix=new o.Matrix4}if(!E.shadowCamera){if(E instanceof o.SpotLight)E.shadowCamera=new o.PerspectiveCamera(E.shadowCameraFov,E.shadowMapWidth/E.shadowMapHeight,E.shadowCameraNear,E.shadowCameraFar);else{if(!(E instanceof o.DirectionalLight)){console.error("Unsupported light type for shadow");continue}E.shadowCamera=new o.OrthographicCamera(E.shadowCameraLeft,E.shadowCameraRight,E.shadowCameraTop,E.shadowCameraBottom,E.shadowCameraNear,E.shadowCameraFar)}p.add(E.shadowCamera),a.autoUpdateScene&&p.updateMatrixWorld()}for(E.shadowCameraVisible&&!E.cameraHelper&&(E.cameraHelper=new o.CameraHelper(E.shadowCamera),E.shadowCamera.add(E.cameraHelper)),E.isVirtual&&F.originalCamera==d&&r(d,E),b=E.shadowMap,_=E.shadowMatrix,S=E.shadowCamera,S.position.getPositionFromMatrix(E.matrixWorld),m.getPositionFromMatrix(E.target.matrixWorld),S.lookAt(m),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),E.cameraHelper&&(E.cameraHelper.visible=E.shadowCameraVisible),E.shadowCameraVisible&&E.cameraHelper.update(),_.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),_.multiply(S.projectionMatrix),_.multiply(S.matrixWorldInverse),f.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),u.setFromMatrix(f),a.setRenderTarget(b),a.clear(),L=p.__webglObjects,y=0,x=L.length;x>y;y++)C=L[y],A=C.object,C.render=!1,A.visible&&A.castShadow&&((A instanceof o.Mesh||A instanceof o.ParticleSystem)&&A.frustumCulled&&!u.intersectsObject(A)||(A._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,A.matrixWorld),C.render=!0));var V,B,O;for(y=0,x=L.length;x>y;y++)C=L[y],C.render&&(A=C.object,M=C.buffer,V=i(A),B=A.geometry.morphTargets.length>0&&V.morphTargets,O=A instanceof o.SkinnedMesh&&V.skinning,T=A.customDepthMaterial?A.customDepthMaterial:O?B?c:h:B?l:s,M instanceof o.BufferGeometry?a.renderBufferDirect(S,p.__lights,D,T,M,A):a.renderBuffer(S,p.__lights,D,T,M,A));for(L=p.__webglObjectsImmediate,y=0,x=L.length;x>y;y++)C=L[y],A=C.object,A.visible&&A.castShadow&&(A._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,A.matrixWorld),a.renderImmediateObject(S,p.__lights,D,s,A))}var I=a.getClearColor(),k=a.getClearAlpha();n.clearColor(I.r,I.g,I.b,k),n.enable(n.BLEND),a.shadowMapCullFace===o.CullFaceFront&&n.cullFace(n.BACK)}},o.ShadowMapPlugin.__projector=new o.Projector,o.SpritePlugin=function(){function e(e,t){var i=r.createProgram(),n=r.createShader(r.FRAGMENT_SHADER),o=r.createShader(r.VERTEX_SHADER),a="precision "+t+" float;\n";return r.shaderSource(n,a+e.fragmentShader),r.shaderSource(o,a+e.vertexShader),r.compileShader(n),r.compileShader(o),r.attachShader(i,n),r.attachShader(i,o),r.linkProgram(i),i}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var r,i,n,a={};this.init=function(t){r=t.context,i=t,n=t.getPrecision(),a.vertices=new Float32Array(16),a.faces=new Uint16Array(6);var s=0;a.vertices[s++]=-1,a.vertices[s++]=-1,a.vertices[s++]=0,a.vertices[s++]=0,a.vertices[s++]=1,a.vertices[s++]=-1,a.vertices[s++]=1,a.vertices[s++]=0,a.vertices[s++]=1,a.vertices[s++]=1,a.vertices[s++]=1,a.vertices[s++]=1,a.vertices[s++]=-1,a.vertices[s++]=1,a.vertices[s++]=0,a.vertices[s++]=1,s=0,a.faces[s++]=0,a.faces[s++]=1,a.faces[s++]=2,a.faces[s++]=0,a.faces[s++]=2,a.faces[s++]=3,a.vertexBuffer=r.createBuffer(),a.elementBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,a.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,a.vertices,r.STATIC_DRAW),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.elementBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,a.faces,r.STATIC_DRAW),a.program=e(o.ShaderSprite.sprite,n),a.attributes={},a.uniforms={},a.attributes.position=r.getAttribLocation(a.program,"position"),a.attributes.uv=r.getAttribLocation(a.program,"uv"),a.uniforms.uvOffset=r.getUniformLocation(a.program,"uvOffset"),a.uniforms.uvScale=r.getUniformLocation(a.program,"uvScale"),a.uniforms.rotation=r.getUniformLocation(a.program,"rotation"),a.uniforms.scale=r.getUniformLocation(a.program,"scale"),a.uniforms.alignment=r.getUniformLocation(a.program,"alignment"),a.uniforms.color=r.getUniformLocation(a.program,"color"),a.uniforms.map=r.getUniformLocation(a.program,"map"),a.uniforms.opacity=r.getUniformLocation(a.program,"opacity"),a.uniforms.useScreenCoordinates=r.getUniformLocation(a.program,"useScreenCoordinates"),a.uniforms.sizeAttenuation=r.getUniformLocation(a.program,"sizeAttenuation"),a.uniforms.screenPosition=r.getUniformLocation(a.program,"screenPosition"),a.uniforms.modelViewMatrix=r.getUniformLocation(a.program,"modelViewMatrix"),a.uniforms.projectionMatrix=r.getUniformLocation(a.program,"projectionMatrix"),a.uniforms.fogType=r.getUniformLocation(a.program,"fogType"),a.uniforms.fogDensity=r.getUniformLocation(a.program,"fogDensity"),a.uniforms.fogNear=r.getUniformLocation(a.program,"fogNear"),a.uniforms.fogFar=r.getUniformLocation(a.program,"fogFar"),a.uniforms.fogColor=r.getUniformLocation(a.program,"fogColor"),a.uniforms.alphaTest=r.getUniformLocation(a.program,"alphaTest")},this.render=function(e,n,s,l){var h=e.__webglSprites,c=h.length;if(c){var u=a.attributes,f=a.uniforms,p=l/s,d=.5*s,m=.5*l;r.useProgram(a.program),r.enableVertexAttribArray(u.position),r.enableVertexAttribArray(u.uv),r.disable(r.CULL_FACE),r.enable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,a.vertexBuffer),r.vertexAttribPointer(u.position,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(u.uv,2,r.FLOAT,!1,16,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,a.elementBuffer),r.uniformMatrix4fv(f.projectionMatrix,!1,n.projectionMatrix.elements),r.activeTexture(r.TEXTURE0),r.uniform1i(f.map,0);var g=0,v=0,y=e.fog;y?(r.uniform3f(f.fogColor,y.color.r,y.color.g,y.color.b),y instanceof o.Fog?(r.uniform1f(f.fogNear,y.near),r.uniform1f(f.fogFar,y.far),r.uniform1i(f.fogType,1),g=1,v=1):y instanceof o.FogExp2&&(r.uniform1f(f.fogDensity,y.density),r.uniform1i(f.fogType,2),g=2,v=2)):(r.uniform1i(f.fogType,0),g=0,v=0);var x,w,b,_,S,M=[];for(x=0;c>x;x++)w=h[x],b=w.material,w.visible&&0!==b.opacity&&(b.useScreenCoordinates?w.z=-w.position.z:(w._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,w.matrixWorld),w.z=-w._modelViewMatrix.elements[14]));for(h.sort(t),x=0;c>x;x++)w=h[x],b=w.material,w.visible&&0!==b.opacity&&b.map&&b.map.image&&b.map.image.width&&(r.uniform1f(f.alphaTest,b.alphaTest),b.useScreenCoordinates===!0?(r.uniform1i(f.useScreenCoordinates,1),r.uniform3f(f.screenPosition,(w.position.x*i.devicePixelRatio-d)/d,(m-w.position.y*i.devicePixelRatio)/m,Math.max(0,Math.min(1,w.position.z))),M[0]=i.devicePixelRatio,M[1]=i.devicePixelRatio):(r.uniform1i(f.useScreenCoordinates,0),r.uniform1i(f.sizeAttenuation,b.sizeAttenuation?1:0),r.uniformMatrix4fv(f.modelViewMatrix,!1,w._modelViewMatrix.elements),M[0]=1,M[1]=1),S=e.fog&&b.fog?v:0,g!==S&&(r.uniform1i(f.fogType,S),g=S),_=1/(b.scaleByViewport?l:1),M[0]*=_*p*w.scale.x,M[1]*=_*w.scale.y,r.uniform2f(f.uvScale,b.uvScale.x,b.uvScale.y),r.uniform2f(f.uvOffset,b.uvOffset.x,b.uvOffset.y),r.uniform2f(f.alignment,b.alignment.x,b.alignment.y),r.uniform1f(f.opacity,b.opacity),r.uniform3f(f.color,b.color.r,b.color.g,b.color.b),r.uniform1f(f.rotation,w.rotation),r.uniform2fv(f.scale,M),i.setBlending(b.blending,b.blendEquation,b.blendSrc,b.blendDst),i.setDepthTest(b.depthTest),i.setDepthWrite(b.depthWrite),i.setTexture(b.map,0),r.drawElements(r.TRIANGLES,6,r.UNSIGNED_SHORT,0));r.enable(r.CULL_FACE)}}},o.DepthPassPlugin=function(){function e(e){return e.material instanceof o.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,r,i,n,a,s,l=new o.Frustum,h=new o.Matrix4;this.init=function(e){t=e.context,r=e;var l=o.ShaderLib.depthRGBA,h=o.UniformsUtils.clone(l.uniforms);i=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h}),n=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0}),a=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,skinning:!0}),s=new o.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:h,morphTargets:!0,skinning:!0}),i._shadowPass=!0,n._shadowPass=!0,a._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(c,u){var f,p,d,m,g,v,y,x=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),r.setDepthTest(!0),r.autoUpdateScene&&c.updateMatrixWorld(),u.matrixWorldInverse.getInverse(u.matrixWorld),h.multiplyMatrices(u.projectionMatrix,u.matrixWorldInverse),l.setFromMatrix(h),r.setRenderTarget(this.renderTarget),r.clear(),y=c.__webglObjects,f=0,p=y.length;p>f;f++)g=y[f],v=g.object,g.render=!1,v.visible&&((v instanceof o.Mesh||v instanceof o.ParticleSystem)&&v.frustumCulled&&!l.intersectsObject(v)||(v._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,v.matrixWorld),g.render=!0));var w,b,_;for(f=0,p=y.length;p>f;f++)if(g=y[f],g.render){if(v=g.object,d=g.buffer,v instanceof o.ParticleSystem&&!v.customDepthMaterial)continue;w=e(v),w&&r.setMaterialFaces(v.material),b=v.geometry.morphTargets.length>0&&w.morphTargets,_=v instanceof o.SkinnedMesh&&w.skinning,m=v.customDepthMaterial?v.customDepthMaterial:_?b?s:a:b?n:i,d instanceof o.BufferGeometry?r.renderBufferDirect(u,c.__lights,x,m,d,v):r.renderBuffer(u,c.__lights,x,m,d,v)}for(y=c.__webglObjectsImmediate,f=0,p=y.length;p>f;f++)g=y[f],v=g.object,v.visible&&(v._modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,v.matrixWorld),r.renderImmediateObject(u,c.__lights,x,i,v));var S=r.getClearColor(),M=r.getClearAlpha();t.clearColor(S.r,S.g,S.b,M),t.enable(t.BLEND)}},o.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +","texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility = (       visibility.r / 9.0 ) *","( 1.0 - visibility.g / 9.0 ) *","(       visibility.b / 9.0 ) *","( 1.0 - visibility.a / 9.0 );","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +","texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +","texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +","texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},o.ShaderSprite={sprite:{vertexShader:["uniform int useScreenCoordinates;","uniform int sizeAttenuation;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position + alignment;","vec2 rotatedPosition;","rotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;","rotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;","vec4 finalPosition;","if( useScreenCoordinates != 0 ) {","finalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );","} else {","finalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition * ( sizeAttenuation == 1 ? 1.0 : finalPosition.z );","}","gl_Position = finalPosition;","}"].join("\n"),
fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")}},function(e){window.global={},window.global.colorsArray=[["cyan","00B9E3"],["magenta","E63587"],["orange","FF9D00"],["green","35E655"]],window.global.currentColor=window.global.colorsArray[Math.round(3*Math.random())],window.global.colorName=window.global.currentColor[0],window.global.colorHex=window.global.currentColor[1],$("body").addClass(window.global.colorName),e.init()}(i)}()}();